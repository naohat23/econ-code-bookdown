# ggplot2によるグラフ作成

第4章「ggplot2によるグラフ作成」では、`tidyverse`の`ggplot2`パッケージを使用したグラフ作成のコードについて解説します。

## パッケージのインポート

```{r, results='hide', warning=FALSE, message=FALSE}
library(esquisse)
library(geofacet)
library(ggplotgui)
library(ggpubr)
library(ggsci)
library(ggrepel)
library(lemon)
library(magrittr)
library(openxlsx)
library(RColorBrewer)
library(readxl)
library(tidyverse)
```

## ggplot2とは

`ggplot2`パッケージでは、最初に`ggplot()`関数でグラフを作成するデータセットと変数を指定します。その後に、`geom_histogram()`などのグラフの種類を指定する関数や、`scale_x_date`などの軸設定の関数、`theme()`などの各種設定の関数を`+`で追加していきます。

`ggplot()`関数では、`data`引数に`tibble`形式のデータセットを指定します。`mapping`引数には必ず`aes()`関数を指定し、`aes()`関数の中でX軸やY軸の変数、必要に応じて`color`や`size`など変数の値に応じて変化させる色・サイズなどの要素を指定します。

なお、グラフの種類により、X軸、Y軸に指定できる変数の型（連続型、離散型）が決まっていますので、注意してください。

`ggplot2`パッケージの詳細については[公式ウェブサイト](https://ggplot2.tidyverse.org/)を参照してください。各関数の使い方については、公式ウェブサイトのチートシートが分かりやすくまとまっています。

## ggplot2の設定

```{r}
## ggplotのテーマ設定（Excelのグラフと類似したテーマを選択）
theme_set(theme_light())

## Windowsにおけるggplot2の日本語フォント設定
windowsFonts("MEIRYO" = windowsFont("Meiryo UI"))
windowsFonts("YUGO" = windowsFont("Yu Gothic UI"))
```

## サンプルデータの確認・読み込み

### Rのサンプルデータセット {.unnumbered}

```{r}
# irisデータセット
iris_tbl <- as.tibble(iris)
iris_tbl
```

```{r}
# mpgデータセット
mpg
```

```{r}
# diamondsデータセット
diamonds
```

```{r}
# economicsデータセット
economics
```

### 外部データセット {.unnumbered}

Webからデータを直接読み込むため、プロキシ環境ではプロキシサーバーの設定が必要です。

```{r, eval=FALSE}
## プロキシサーバーとポートを記入
proxy_url <- "http://proxyserver:port/"


## Rのシステム環境変数を設定
Sys.setenv("http_proxy" = proxy_url)
Sys.setenv("https_proxy" = proxy_url)


## Rのダウンロードオプションを設定
options(download.file.method = "libcurl")
options(timeout = NA)
```

まず、Our World in Dataの新型コロナウイルス関連データを読み込みます。データの詳細は[こちら](https://ourworldindata.org/coronavirus)を参照してください。

Hannah Ritchie, Edouard Mathieu, Lucas Rodés-Guirao, Cameron Appel, Charlie Giattino, Esteban Ortiz-Ospina, Joe Hasell, Bobbie Macdonald, Diana Beltekian and Max Roser (2020) - "Coronavirus Pandemic (COVID-19)". Published online at OurWorldInData.org. Retrieved from: '<https://ourworldindata.org/coronavirus>' [Online Resource]

```{r}
# Our World in Dataの新型コロナデータをtibble型で読み込み
data_owid <- readr::read_csv(file = "https://covid.ourworldindata.org/data/owid-covid-data.csv", # ファイルパス／URL
                             col_names = TRUE, # ヘッダー（列名データ）の有無
                             col_types = NULL, # 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）
                             skip = 0) # 読み込み時に上からスキップする行数

# データをコンソールに出力
data_owid
```

次に、内閣府の県内総生産データを読み込みます（生産側、名目、2008SNA、平成23年基準計数）。詳細は[こちら](https://www.esri.cao.go.jp/jp/sna/data/data_list/kenmin/files/contents/main_2018.html)を参照してください。ここではデータをdata.frame形式で読み込み、前処理して縦型のtibble形式に変換します。

```{r}
# 内閣府の県内総生産データをdata.frame形式で読み込み
data_gdp_pref <- openxlsx::read.xlsx(xlsxFile = "https://www.esri.cao.go.jp/jp/sna/data/data_list/kenmin/files/contents/tables/2018/soukatu1.xlsx", # ファイルパス／URL
                                     sheet = 1, # シートインデックス／シート名
                                     startRow = 5, # 読み込み開始行
                                     colNames = TRUE, # 列名データの有無
                                     rowNames = FALSE, # 行名データの有無
                                     rows = 5:53, # 読み込む列（NULLですべて読み込み）
                                     cols = NULL) # 読み込む行（NULLですべて読み込み）

# データの型変換等を行い、縦型に変形したうえで、変化率系列を作成し、tibble形式に変換
data_gdp_pref %<>% 
  dplyr::mutate(across(`2006`:`2018`, as.double)) %>% 
  dplyr::rename(pref_code = X1,
                pref_name = X2) %>% 
  dplyr::select(-X16) %>% 
  tidyr::pivot_longer(cols = c(-"pref_code", -"pref_name"), names_to = "year", values_to = "gdp_nominal") %>% 
  dplyr::mutate(across(c(pref_code, year), as.double)) %>% 
  dplyr::arrange(pref_code, year) %>% 
  dplyr::group_by(pref_name) %>% 
  dplyr::mutate(gdp_nominal_pchg = 100 * (gdp_nominal / dplyr::lag(gdp_nominal, n = 1) - 1)) %>% 
  dplyr::ungroup() %>% 
  tibble::as_tibble()

data_gdp_pref
```

## GUI形式の直感的なグラフ作成

本節では`ggplot2`パッケージによるグラフ作成を行いますが、`ggplot2`はすべてコードを書いてグラフを作成するため、探索的データ分析（EDA）には不向きです。そこで、`ggplot2`によるグラフ作成を行う前に、GUIによるノーコードのグラフ作成パッケージを用い、どのようなグラフを作成するべきか検討します。

### esquisseパッケージ {.unnumbered}

`esquisse`パッケージは、ドラッグ＆ドロップでX軸・Y軸の変数や色・サイズを変化させる属性の変数を指定し、グラフを作成します。`esquisse`は便利なパッケージですが、データセットの規模が大きいと起動に時間がかかるため、変数の数が多い場合は、あらかじめ注目する変数を絞るといった前処理が必要です。

Rで下記のコードを実行すると別のウィンドウで`esquisse`の画面が立ち上がり、インタラクティブな図表作成を行うことができます。ここではコードを示すのみにとどめており、実行していませんので、各自で試してみてください。

```{r, eval=FALSE}
# irisデータ
esquisse::esquisser(data = iris)
```

```{r, eval=FALSE}
## 世界の新型コロナデータの一部を抽出
data_owid %>% 
  dplyr::select(location, date, new_cases_smoothed) %>% 
  dplyr::filter(location %in% c("Japan", "United States", "United Kingdom", "Germany", "France", "Italy")) %>% 
  esquisse::esquisser()
```

### ggplotguiパッケージ {.unnumbered}

その他のGUIによるノーコードのグラフ作成パッケージには、`ggplotgui`があります。

```{r, eval=FALSE}
# irisデータ
ggplotgui::ggplot_shiny(data = iris)
```

```{r, eval=FALSE}
## 世界の新型コロナデータの一部を抽出
data_owid %>% 
  dplyr::select(location, date, new_cases_smoothed) %>% 
  dplyr::filter(location %in% c("Japan", "United States", "United Kingdom", "Germany", "France", "Italy")) %>% 
  ggplotgui::ggplot_shiny()
```

## 1次元の度数分布（離散型）

離散型変数の1次元の度数分布を作成するには、度数棒グラフを用います。度数棒グラフを作成するには`geom_bar()`関数を使用します。

-   X軸：離散型変数
-   Y軸：なし

### 度数棒グラフの基本形 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = manufacturer)) + 
  geom_bar(alpha = 1.0, # 塗りつぶしの透明度
           color = "darkblue", # 線の色
           fill = "lightblue", # 塗りつぶしの色
           size = 0.5, # 線の太さ
           width = 0.9) # 棒の幅 (0-1)
```


## 1次元の度数分布（連続型）

連続型変数の1次元の度数分布を作成するには、ヒストグラムを用います。ヒストグラムを作成するには`geom_histogram()`関数や`geom_freqpoly()`関数を使用します。

-   X軸：連続型変数
-   Y軸：なし

### ヒストグラムの基本形 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy)) +
  geom_histogram(binwidth = 5, # 階級幅
                 color = "gray", # 線の色
                 fill = "darkblue", # 塗りつぶしの色
                 size = 0.5) # 線の太さ
```

### 横並びヒストグラム {.unnumbered}

グループ別のヒストグラムを横並び形式で作成するには、`position`引数に`"dodge"`を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = class)) +
  geom_histogram(binwidth = 5, # 階級幅
                 position = "dodge", # 横並びポジション
                 color = "black", # 線の色
                 size = 0.5) # 線の太さ
```

グループ別の度数分布は`geom_freqpoly()`関数でも可視化することができます。

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy, color = class)) +
  geom_freqpoly(binwidth = 5, # 階級幅
                size = 0.5) # 線の太さ
```

### 積み上げヒストグラム {.unnumbered}

グループ別のヒストグラムを積み上げ形式で作成するには、`position`引数に`"stack"`を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = class)) +
  geom_histogram(binwidth = 5, # 階級幅
                 position = "stack", # 積み上げポジション
                 color = "black", # 線の色
                 size = 0.5) # 線の太さ
```

## 1次元の密度グラフ

密度グラフは`geom_density()`関数で作成します。

-   X軸：連続型変数
-   Y軸：なし

### 密度グラフの基本形 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy)) +
  geom_density(kernel = "gaussian", # カーネル関数の種類
               color = "darkblue", # 線の色
               linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
               size = 1.0) # 線の太さ
```

### 横並び密度グラフ {.unnumbered}

グループ別の密度グラフを横並び形式で作成するには、`position`引数に`"dodge"`を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy, color = class)) +
  geom_density(kernel = "gaussian", # カーネル関数の種類
               position = "dodge", # 横並びポジション
               linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
               size = 1.0) # 線の太さ
```

横並びの密度グラフは`geom_freqpoly()`関数でも作成できます。`geom_freqpoly()`関数で`mapping = aes(y = ..density..)`を指定すると、各グループの度数を標準化して密度グラフに変換します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy, y = ..density.., color = class)) +
  geom_freqpoly(binwidth = 5, # 階級幅
                size = 0.5) # 線の太さ
```

### 積み上げ密度グラフ {.unnumbered}

グループ別の密度グラフを積み上げ形式で作成するには、`position`引数に`"stack"`を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = class)) +
  geom_density(kernel = "gaussian", # カーネル関数の種類
               position = "stack", # 積み上げポジション
               color = "black", # 線の色
               linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
               size = 0.5) # 線の太さ
```


## 2次元の度数分布（離散型）

離散型変数の2次元の度数分布を作成するには、度数バブルチャートや度数ヒートマップを用います。度数バブルチャートを作成するには`geom_count()`関数を使用します。また、離散型変数の度数ヒートマップを作成するには`geom_tile()`関数を使用します。

-   X軸：離散型変数
-   Y軸：離散型変数

### 度数バブルチャートの基本形 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = manufacturer, y = class)) +
  geom_count(alpha = 0.5, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             stroke = 0.5) + # 線の太さ
  scale_size_area(max_size = 15) + # 変量とマーカーの面積を比例させる
  theme(axis.text.x = element_text(angle = 45, hjust = 1.0))
```

### 度数ヒートマップの基本形 {.unnumbered}

```{r}
ggplot(data = mpg %>% 
         dplyr::count(manufacturer, class), # データの度数を格納した変数を作成
       mapping = aes(x = manufacturer, y = class, fill = n)) +
  geom_tile(height = 1.0, # タイルの高さ
            width = 1.0, # タイルの幅
            alpha = 1.0, # 塗りつぶしの色の透明度
            color = "grey", # 線の色
            linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 0.5) + # 線の太さ
  scale_fill_viridis_c() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1.0))
```

## 2次元の度数分布（連続型）

連続型変数の2次元の度数分布を作成するには、度数ヒートマップを用います。連続型変数の度数ヒートマップを作成するには`geom_bin2d()`関数を使用します。

-   X軸：離散型変数
-   Y軸：離散型変数

### 度数ヒートマップの基本形 {.unnumbered}

```{r}
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_bin2d(bins = c(100, 75), # X軸・Y軸の階級数（デフォルトは30）
             alpha = 1.0, # 塗りつぶしの色の透明度
             color = NA, # 線の色
             linetype = "solid", # 線の種類
             size = 0.2) + # 線の太さ
  scale_fill_viridis_c()
```

## 2次元の密度グラフ

2次元の密度グラフを作成するには、`geom_density2d()`関数ファミリーを使用します。

-   X軸：連続型変数
-   Y軸：連続型変数

まず、使用するサンプルデータを作成します。データサイズが大きい場合、2次元密度グラフを作成するために時間を要するため、`dplyr::sample_n()`関数でサンプリングします。

```{r}
diamonds_small <- diamonds %>% 
  dplyr::sample_n(size = 5000)
```

### 2次元密度グラフの基本形 {-}

```{r}
ggplot(data = diamonds_small,
       mapping = aes(x = carat, y = price)) + 
  geom_density2d()
```

### 2次元密度グラフの塗りつぶし版 {-}

```{r}
ggplot(data = diamonds_small,
       mapping = aes(x = carat, y = price)) + 
  geom_density2d_filled() +
  scale_fill_brewer(palette = "Reds",
                    direction = 1)
```


## QQプロット {-}

QQプロットは`geom_qq()`関数で作成します。他のグラフと異なり、`mapping = aes(sample = 変数)`で変数を指定します。

* X軸・Y軸：連続型変数

QQ（Quantile-Quantile）プロットは、データが正規分布にどの程度近いかを検証するグラフです。Y軸にはデータを順番に並べた値、X軸にはデータが正規分布に従うと仮定した場合にとりうる期待値を標準化した値をとり、散布図を描いたものです。

QQプロットが直線上にある場合、データは正規分布に従うと解釈できます。一方、QQプロットが直線から乖離している場合は、正規分布に従っておらず、分布にゆがみがあると解釈できます。

例えば、QQプロットが**右下に凸**な形状の場合は、データは**右に長い裾（テール）**をもちます。一方、QQプロットが**左上に凸**な形状の場合は、データの分布は**左に長い裾（テール）**をもちます。

また、QQプロットが**S字状**（前半は右下に凸、後半は左上に凸）の場合は、データの両裾が重い、いわゆる**ファット・テールの分布**になります。一方、**逆S字状**（前半は左上に凸、後半は右下に凸）の場合は、**ピーク部分が突出した分布**になります。

```{r}
# 右に長い裾をもつデータのQQプロット
ggplot(data = iris,
       mapping = aes(sample = Sepal.Length)) +
  geom_qq_line() +
  geom_qq()
```

```{r}
# ファット・テールをもつデータのQQプロット
ggplot(data = economics,
       mapping = aes(sample = unemploy)) +
  geom_qq_line() +
  geom_qq()
```

## 散布図・バブルチャート

散布図とバブルチャートは`geom_point()`関数で作成します。バブルチャートの上に`geom_smooth()`関数で近似曲線を重ねることができます。

-   X軸：連続型変数
-   Y軸：連続型変数

まず、プロット用のデータを作成します。

```{r}
data_mpg_point <- mpg %>% 
  dplyr::group_by(manufacturer) %>% 
  dplyr::summarise(across(c(displ, cty, hwy), mean, na.rm = TRUE))

data_mpg_point
```

### 散布図の基本形 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             size = 2.0, # マーカーの大きさ
             stroke = 0.5) # 線の太さ
```

### バブルチャートの基本形 {.unnumbered}

バブルチャートを作成するには、`ggplot()`関数の`mapping = aes()`関数で`size`引数にバブルのサイズを変化させたい変数を指定します。

```{r}
ggplot(data = data_mpg_point,
       mapping = aes(x = cty, y = hwy, size = displ)) + # aes() 関数内のsize引数に連続型変数を指定
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             stroke = 0.5) # 線の太さ
```

### 散布図に補助線を追加 {.unnumbered}

水平線、垂直線、傾き・切片のある直線といった補助線を追加するには、それぞれ`geom_hline()`関数、`geom_vline()`関数、`geom_abline()`関数を使用します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_hline(yintercept = 20, # 水平線の縦軸との交点
             color = "Tomato", # 水平線の色
             size = 0.5) + # 水平線の太さ
  geom_vline(xintercept = 20, # 垂直線の横軸との交点
             color = "Forestgreen", # 垂直線の色
             size = 0.5) + # 垂直線の太さ
  geom_abline(intercept = 0, # 直線の切片
              slope = 1, # 直線の傾き
              color = "gold", # 直線の色
              size = 0.5) + # 直線の太さ
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             size = 2.0, # マーカーの大きさ
             stroke = 0.5) # 線の太さ
```

### 散布図にコネクタ線を追加 {.unnumbered}

散布図のマーカー間をつなぐコネクタ線を追加するには、`geom_path()`関数を追加します。折れ線グラフを作成する`geom_line()`関数とは異なるので注意してください。

`geom_path()`関数と`geom_line()`関数はどちらもマーカー間をつなぐコネクタ線を追加する関数ですが、`geom_path()`関数はデータセット上の順番で線を引く一方、`geom_line()`関数はデータセット上の順番に関わらずX軸上の順番で線を引くという違いがあります。

```{r}
economics %>% 
  dplyr::filter(date >= "2000-01-01") %>% 
  ggplot(mapping = aes(x = unemploy, y = uempmed)) +
  geom_path(alpha = 1.0, # 塗りつぶしの透明度
            color = "darkblue", # 線の色
            size = 0.5) + # 線の大きさ
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             size = 2.0, # マーカーの大きさ
             stroke = 0.5) # 線の太さ
```

### 散布図に近似曲線を追加 {.unnumbered}

散布図に近似曲線を追加するには、`geom_smooth()`関数を使用します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             size = 2.0, # マーカーの大きさ
             stroke = 0.5) + # 線の太さ
  geom_smooth(formula = y ~ x, # 近似曲線の推計式
              method = "loess", # 近似手法 (lm, glm, gam, loess)
              alpha = 0.5, # 誤差範囲の透明度
              color = "black", # 近似曲線の色
              fill = "gray", # 誤差範囲の色
              linetype = "dashed", # 近似曲線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
              size = 1.0) # 近似曲線の太さ
```

### 散布図にラベルを追加 {.unnumbered}

散布図にラベルを追加するには、`ggrepel`パッケージの`geom_text_repel()`関数を使用します。`geom_text_repel()`関数は、散布図のマーカーとラベルが重ならないようにラベルの位置を自動で調整します。

```{r}
ggplot(data = data_mpg_point,
       mapping = aes(x = cty, y = hwy)) +
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             size = 2.0, # マーカーの大きさ
             stroke = 0.5) + # 線の太さ
  geom_text_repel(mapping = aes(label = manufacturer),
                  seed = NA, # テキストの配置を決定するランダムシード
                  direction = "both", # テキストの整列方向 (both / x / y)
                  hjust = 0.0, # 横方向の整列位置 (0-1) 
                  vjust = 0.5, # 縦方向の整列位置 (0-1)
                  nudge_x = NULL, # マーカーからの横方向のスペース (NULL, 0-)
                  nudge_y = NULL, # マーカーからの縦方向のスペース (NULL, 0-)
                  box.padding = 0.5, # テキスト周囲のスペース (0-)
                  point.padding = 0.1, # マーカー周囲のスペース (0-)
                  segment.alpha = 1.0, # 引き出し線の透明度
                  segment.color = "grey", # 引き出し線の色
                  segment.size = 0.5, # 引き出し線の太さ
                  min.segment.length = 0, # 引き出し線の最低長
                  color = "black", # テキストの色
                  family = "YUGO", # テキストのフォント
                  fontface = "plain", # テキストの書体 (plain / bold / italic / bold.italic)
                  size = 4.0) # テキストのサイズ
```

### バブルチャートにラベルを追加

```{r}
ggplot(data = data_mpg_point,
       mapping = aes(x = cty, y = hwy, size = displ)) + # aes() 関数内のsize引数に連続型変数を指定
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             stroke = 0.5) + # 線の太さ
  geom_text_repel(mapping = aes(label = manufacturer),
                  seed = NA, # テキストの配置を決定するランダムシード
                  direction = "both", # テキストの整列方向 (both / x / y)
                  hjust = 0.0, # 横方向の整列位置 (0-1) 
                  vjust = 0.5, # 縦方向の整列位置 (0-1)
                  nudge_x = NULL, # マーカーからの横方向のスペース (NULL, 0-)
                  nudge_y = NULL, # マーカーからの縦方向のスペース (NULL, 0-)
                  box.padding = 1.0, # テキスト周囲のスペース (0-)
                  point.padding = 0.1, # マーカー周囲のスペース (0-)
                  segment.alpha = 1.0, # 引き出し線の透明度
                  segment.color = "grey", # 引き出し線の色
                  segment.size = 0.5, # 引き出し線の太さ
                  min.segment.length = 0, # 引き出し線の最低長
                  color = "black", # テキストの色
                  family = "YUGO", # テキストのフォント
                  fontface = "plain", # テキストの書体 (plain / bold / italic / bold.italic)
                  size = 4.0) + # テキストのサイズ
  scale_size_area(max_size = 15) # 変量とマーカーの面積を比例させる
```

## 棒グラフ

棒グラフは`geom_col()`関数で作成します。

-   X軸：離散型変数
-   Y軸：連続型変数

まず、プロット用のデータを作成します。

```{r}
data_mpg_col <- mpg %>% 
  dplyr::group_by(manufacturer) %>% 
  dplyr::summarise(across(c(cty, hwy), mean, na.rm = TRUE))

data_mpg_col
```

```{r, warning=FALSE, message=FALSE}
data_owid_col <- data_owid %>% 
  dplyr::select(location, date, new_cases) %>% 
  dplyr::filter(location %in% c("Japan", "United Kingdom", "Germany", "France", "Italy")) %>% 
  dplyr::mutate(year = str_c(lubridate::year(date), "年"), .after = "date") %>% 
  dplyr::group_by(location, year) %>% 
  dplyr::summarise(across(new_cases, sum, na.rm = TRUE))

data_owid_col
```

### 縦棒グラフの基本形 {.unnumbered}

```{r}
ggplot(data = data_mpg_col,
         mapping = aes(x = manufacturer, y = cty)) + 
  geom_col(alpha = 1.0, # 塗りつぶしの透明度
           color = "darkblue", # 線の色
           fill = "lightblue", # 塗りつぶしの色
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  theme(axis.text.x = element_text(angle = 45, hjust = 1.0))
```

### 横棒グラフ {.unnumbered}

横棒グラフを作成するには、縦棒グラフを作成した後に`coord_flip()`関数で横棒グラフに転換します。そのため、X軸とY軸の変数指定は縦棒グラフの場合と同じです。

```{r}
ggplot(data = data_mpg_col,
       mapping = aes(x = manufacturer, y = cty)) + 
  geom_col(alpha = 1.0, # 塗りつぶしの透明度
           color = "darkblue", # 線の色
           fill = "lightblue", # 塗りつぶしの色
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  coord_flip()
```

### 縦棒グラフの順序並べ替え {.unnumbered}

縦棒グラフのX軸の順番を並べ替えるには、X軸の変数を指定する際に`fct_reorder()`関数を使用します。

```{r}
ggplot(data = data_mpg_col,
       mapping = aes(x = fct_reorder(manufacturer, -cty), y = cty)) + 
  geom_col(alpha = 1.0, # 塗りつぶしの透明度
           color = "darkblue", # 線の色
           fill = "lightblue", # 塗りつぶしの色
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  theme(axis.text.x = element_text(angle = 45, hjust = 1.0))
```

### 縦棒グラフにラベルを追加 {.unnumbered}

縦棒グラフにデータラベルを追加するには、`geom_text()`関数を使用します。

```{r}
ggplot(data = data_mpg_col,
       mapping = aes(x = fct_reorder(manufacturer, -cty), y = cty)) + 
  geom_col(alpha = 1.0, # 塗りつぶしの透明度
           color = "darkblue", # 線の色
           fill = "lightblue", # 塗りつぶしの色
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  geom_text(mapping = aes(label = cty %>% sprintf(fmt = "%0.1f")), # sprintf() 関数で数値の表示形式を指定
            vjust = -1, # 縦方向の整列位置 (0-1)
            color = "black", # テキストの色
            family = "YUGO", # テキストのフォント
            fontface = "plain", # テキストの書体 (plain / bold / italic / bold.italic)
            size = 4.0) + # テキストのサイズ
  theme(axis.text.x = element_text(angle = 45, hjust = 1.0))
```

### 集合縦棒グラフ {.unnumbered}

複数の縦棒グラフを横並び形式で作成するには、`position`引数に`position_dodge()`関数を指定します。

```{r}
ggplot(data = data_owid_col,
       mapping = aes(x = location, y = new_cases, fill = year, group = rev(year))) + 
  geom_col(position = position_dodge(width = 0.5), # 横並びポジション
           alpha = 1.0, # 塗りつぶしの透明度
           size = 0.5, # 線の太さ
           width = 0.9) # 棒の幅 (0-1)
```

### 積み上げ縦棒グラフ {.unnumbered}

複数の縦棒グラフを積み上げ形式で作成するには、`position`引数に`position_stack()`関数を指定します。

```{r}
ggplot(data = data_owid_col,
       mapping = aes(x = location, y = new_cases, fill = year, group = rev(year))) + 
  geom_col(position = position_stack(), # 積み上げポジション
           alpha = 1.0, # 塗りつぶしの透明度
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  guides(fill = guide_legend(reverse = TRUE))
```

### 積み上げ縦棒グラフにラベルを追加 {.unnumbered}

```{r}
ggplot(data = data_owid_col,
       mapping = aes(x = location, y = new_cases, fill = year, group = rev(year))) + 
  geom_col(position = position_stack(), # 積み上げポジション
           alpha = 1.0, # 塗りつぶしの透明度
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  geom_text(mapping = aes(label = new_cases %>% sprintf(fmt = "%0.1f")), # sprintf() 関数で数値の表示形式を指定
            position = position_stack(vjust = 0.5), # position_stack() 関数で積み上げ棒グラフ上のラベル位置を指定
            color = "white", # テキストの色
            family = "YUGO", # テキストのフォント
            fontface = "plain", # テキストの書体 (plain / bold / italic / bold.italic)
            size = 4.0) + # テキストのサイズ
  guides(fill = guide_legend(reverse = TRUE))
```

### 100％積み上げ縦棒グラフ {.unnumbered}

複数の縦棒グラフを合計が100％になる積み上げ形式で作成するには、`position`引数に`position_fill()`関数を指定します。

```{r}
ggplot(data = data_owid_col,
       mapping = aes(x = location, y = new_cases, fill = year, group = rev(year))) + 
  geom_col(position = position_fill(), # 割合積み上げポジション
           alpha = 1.0, # 塗りつぶしの透明度
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  guides(fill = guide_legend(reverse = TRUE))
```

### 100％積み上げ縦棒グラフにラベルを追加 {.unnumbered}

```{r}
data_owid_col %>% 
  dplyr::group_by(location) %>% 
  dplyr::mutate(percent = new_cases / sum(new_cases)) %>% 
  ggplot(mapping = aes(x = location, y = new_cases, fill = year, group = rev(year))) + 
  geom_col(position = position_fill(), # 割合ポジション
           alpha = 1.0, # 塗りつぶしの透明度
           size = 0.5, # 線の太さ
           width = 0.9) + # 棒の幅 (0-1)
  geom_text(mapping = aes(label = percent %>% sprintf(fmt = "%0.2f")), # sprintf() 関数で数値の表示形式を指定
            position = position_fill(vjust = 0.5), # position_fill() 関数で割合棒グラフ上のラベル位置を指定
            color = "white", # テキストの色
            family = "YUGO", # テキストのフォント
            fontface = "plain", # テキストの書体 (plain / bold / italic / bold.italic)
            size = 4.0) + # テキストのサイズ
  guides(fill = guide_legend(reverse = TRUE))
```

## 円グラフ

円グラフを作成するには、`geom_col()`関数で積み上げ棒グラフを作成した後に`coord_polar()`関数で円グラフに転換します。

-   X軸：単一の値
-   Y軸：連続型変数

まず、プロット用のデータを作成します。

```{r}
data_mpg_circle <- mpg %>% 
  dplyr::group_by(class) %>% 
  dplyr::summarise(across(c(hwy), mean, na.rm = TRUE))

data_mpg_circle
```

### 円グラフの基本形 {.unnumbered}

```{r}
ggplot(data = data_mpg_circle,
       mapping = aes(x = 1, y = hwy, fill = class, group = rev(class))) + 
  geom_col(position = position_stack(), # 積み上げポジション
           alpha = 1.0, # 塗りつぶしの透明度
           color = "grey", # 線の色
           size = 0.5) + # 線の太さ
  geom_text(mapping = aes(label = hwy %>% sprintf(fmt = "%0.1f")), # sprintf() 関数で数値の表示形式を指定
            position = position_stack(vjust = 0.5), # position_stack() 関数で積み上げ棒グラフ上のラベル位置を指定
            color = "white", # テキストの色
            family = "YUGO", # テキストのフォント
            fontface = "plain", # テキストの書体 (plain / bold / italic / bold.italic)
            size = 4.0) + # テキストのサイズ
  coord_polar(theta = "y", # 円グラフを作成する軸
              start = 0, # 円グラフの開始位置（ラジアン）
              direction = 1) + # 円グラフの方向（1：時計回り、-1：反時計回り）
  theme(panel.grid = element_blank(), # パネルの軸や目盛り線を表示しない
        axis.title = element_blank(),
        axis.text  = element_blank(),
        axis.ticks = element_blank()) +
  guides(fill = guide_legend(reverse = FALSE))
```

## 折れ線グラフ

折れ線グラフは時系列的に変化するデータを可視化する最も基本的なグラフで、`geom_line()`関数で作成します。

-   X軸：日付型変数
-   Y軸：連続型変数

まず、プロット用のデータを作成します。

```{r}
data_owid_line <- data_owid %>%
  dplyr::select(location, date, new_cases_smoothed) %>% 
  dplyr::filter(location %in% c("Japan", "United Kingdom", "Germany", "France", "Italy"),
                date >= "2022-01-01") %>% 
  tidyr::drop_na(everything())

data_owid_line
```

### 折れ線グラフの基本形 {.unnumbered}

```{r}
ggplot(data = economics,
       mapping = aes(x = date, y = unemploy)) +
  geom_line(alpha = 1.0, # 線の透明度
            color = "darkblue", # 線の色
            linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 1.0) # 線の太さ
```

### 折れ線グラフにマーカーを追加 {.unnumbered}

折れ線グラフを作成する`geom_line()`関数と、散布図を作成する`geom_point()`関数を併用します。

```{r}
ggplot(data = economics,
       mapping = aes(x = date, y = unemploy)) +
  geom_line(alpha = 1.0, # 線の透明度
            color = "darkblue", # 線の色
            linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 1.0) + # 線の太さ
  geom_point(alpha = 1.0, # 塗りつぶしの透明度
             color = "darkblue", # 線の色
             fill = "lightblue", # 塗りつぶしの色
             shape = 21, # マーカーの種類
             size = 2.0, # マーカーの大きさ
             stroke = 0.5) # 線の太さ
```

### 折れ線グラフに系列ラベルを追加 {.unnumbered}

折れ線グラフの数が多く凡例が分かりにくい場合などに、折れ線グラフの右側に系列名のラベルを追加します。ラベルを追加するには、`ggrepel`パッケージの`geom_text_repel`関数を使用します。

```{r}
ggplot(data = data_owid_line,
       mapping = aes(x = date, y = new_cases_smoothed, color = location)) +
  geom_line(alpha = 1.0, # 線の透明度
            linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 1.0) + # 線の太さ
  geom_text_repel(data = data_owid_line %>%
                    dplyr::group_by(location) %>% 
                    dplyr::filter(date == max(date)),
                  mapping = aes(x = date, y = new_cases_smoothed, label = location),
                  seed = NA, # テキストの配置を決定するランダムシード
                  direction = "y", # テキストの整列方向 (both / x / y)
                  hjust = 0.0, # 横方向の整列位置 (0-1) 
                  vjust = 0.5, # 縦方向の整列位置 (0-1)
                  nudge_x = 5, # マーカーからの横方向のスペース (NULL, 0-)
                  nudge_y = NULL, # マーカーからの縦方向のスペース (NULL, 0-)
                  box.padding = 0.1, # テキスト周囲のスペース (0-)
                  point.padding = 0.1, # マーカー周囲のスペース (0-)
                  segment.alpha = 1.0, # 引き出し線の透明度
                  segment.color = "grey", # 引き出し線の色
                  segment.size = 0.5, # 引き出し線の太さ
                  min.segment.length = Inf, # 引き出し線の最低長
                  family = "YUGO", # テキストのフォント
                  fontface = "plain", # テキストの書体 (plain / bold / italic / bold.italic)
                  size = 3.0) + # テキストのサイズ
  scale_x_date(date_breaks = "1 month",　# 日付目盛の周期
               date_labels = "%y/%b", # %Y：4桁年、%y：2桁年、%m：2桁月、%b：1桁月、%d：日
               limits = c(as.Date("2022/01/01"), NA), # 始期・終期（指定しない場合はNA）
               expand = expansion(mult = c(0.00, 0.2), add = c(0, 0))) + # 始期・終期からの余白（multは余白率、addは余白幅）
  theme(legend.position = "none")
```

## ステップグラフ

ステップグラフは折れ線グラフの特殊形です。政策金利のように、段階的に値が変化するデータに適しています。ステップグラフは`geom_step()`関数で作成します。

-   X軸：日付型変数
-   Y軸：連続型変数

まず、サンプルデータを作成します。ここでは、Our World in Dataが提供する新型コロナウイルス感染対策の厳格度を示すStringency Indexを用います。

```{r}
data_owid_step <- data_owid %>% 
  dplyr::select(location, date, stringency_index) %>% 
  dplyr::filter(location %in% c("Japan", "United Kingdom", "Germany", "France", "Italy"))

data_owid_step
```

### ステップグラフの基本形 {.unnumbered}

```{r}
ggplot(data = data_owid_step,
       mapping = aes(x = date, y = stringency_index, color = location)) +
  geom_step(alpha = 1.0, # 線の透明度
            linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 1.0) # 線の太さ
```

## 面グラフ

面グラフは折れ線グラフの特殊形です。面グラフには2種類あり、折れ線グラフとX軸で挟まれた範囲を塗りつぶすグラフは`geom_area()`関数、2つの折れ線グラフで挟まれた範囲を塗りつぶすグラフは`geom_ribbon()`関数で作成します。後者は特にリボングラフと呼ばれ、信頼区間の可視化に用いることができます。

-   X軸：日付型変数
-   Y軸：連続型変数

まず、プロット用のデータを作成します。

```{r}
data_owid_line <- data_owid %>%
  dplyr::select(location, date, new_cases_smoothed) %>% 
  dplyr::filter(location %in% c("Japan", "United Kingdom", "Germany", "France", "Italy"),
                date >= "2022-01-01") %>% 
  tidyr::drop_na(everything())

data_owid_line
```

### 面グラフの基本形 {.unnumbered}

```{r}
ggplot(data = economics,
       mapping = aes(x = date, y = unemploy)) +
  geom_area(alpha = 1.0, # 線の透明度
            color = "darkblue", # 線の色
            fill = "lightblue", # 塗りつぶしの色
            linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 1.0) # 線の太さ
```

### 積み上げ面グラフ {.unnumbered}

複数の面グラフを積み上げ形式で作成するには、`position`引数に`position_stack()`関数を指定します。

```{r}
data_owid_line %>% 
  dplyr::mutate(location = factor(location,
                                  levels = c("Japan", "United Kingdom", "Germany", "France", "Italy") %>% rev())) %>% 
  ggplot(mapping = aes(x = date, y = new_cases_smoothed, fill = location)) +
  geom_area(position = position_stack(),
            alpha = 1.0, # 線の透明度
            linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 1.0) # 線の太さ
```

### リボングラフの基本形 {.unnumbered}

リボングラフでは、`aes()`関数の中で塗りつぶし範囲の下端を`ymin`引数、上端を`ymax`引数に指定します。

```{r}
data_owid_line %>% 
  dplyr::group_by(date) %>% 
  dplyr::summarise(new_cases_max = max(new_cases_smoothed, na.rm = TRUE),
                   new_cases_min = min(new_cases_smoothed, na.rm = TRUE)) %>% 
  ggplot(mapping = aes(x = date, ymin = new_cases_min, ymax = new_cases_max)) +
  geom_ribbon(alpha = 1.0, # 線の透明度
              color = "darkblue", # 線の色
              fill = "lightblue", # 塗りつぶしの色
              linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
              size = 0.5) # 線の太さ
```

### リボングラフに折れ線グラフを追加 {.unnumbered}

リボングラフに折れ線グラフを追加する際は、まず`geom_ribbon()`関数でリボングラフを作成し、そのあとに`+`で`geom_line()`関数をつなげて折れ線グラフを追加します。

```{r}
data_owid_line %>% 
  dplyr::group_by(date) %>% 
  dplyr::summarise(new_cases_max = max(new_cases_smoothed, na.rm = TRUE),
                   new_cases_median = median(new_cases_smoothed, na.rm = TRUE),
                   new_cases_min = min(new_cases_smoothed, na.rm = TRUE)) %>% 
  ggplot(mapping = aes(x = date, ymin = new_cases_min, ymax = new_cases_max, y = new_cases_median)) +
  geom_ribbon(alpha = 1.0, # 線の透明度
              color = "darkblue", # 線の色
              fill = "lightblue", # 塗りつぶしの色
              linetype = "solid", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
              size = 0.5) + # 線の太さ
  geom_line(alpha = 1.0, # 線の透明度
            color = "red", # 線の色
            linetype = "dashed", # 線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
            size = 1.0) # 線の太さ
```

## 箱ひげ図・ヴァイオリングラフ

データの分布範囲を可視化するには箱ひげ図やヴァイオリングラフを用います。箱ひげ図は`geom_boxplot()`関数、ヴァイオリングラフは`geom_violin()`関数で作成します。`geom_jitter()`関数を併用し、箱ひげ図やヴァイオリングラフに個別データの位置をプロットすると、データの分布がより具体的に分かりやすくなります。

-   X軸：離散型変数
-   Y軸：連続型変数

### 箱ひげ図の基本形 {.unnumbered}

箱ひげ図は一般的に、ひげの下端が最小値、箱の下端が第1四分位数、箱内部の横線が中央値、箱の上端が第3四分位数、ひげの上端が最大値を表します。しかし、`ggplot2`パッケージの`geom_boxplot()`で作成すると、ひげの下端・上端は箱の下端・上端から1.5×IQRの範囲内にある最小・最大のサンプルの位置を表すことに注意が必要です。その範囲外にあるサンプルは外れ値として扱われます。なお、IQRは四分位範囲（第3四分位数-第1四分位数）を意味します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = class, y = hwy)) +
  geom_boxplot(outlier.alpha = 1.0, # 外れ値マーカーの塗りつぶしの透明度
               outlier.color = "darkblue", # 外れ値マーカーの線の色
               outlier.fill = "lightblue", # 外れ値マーカーの塗りつぶしの色
               outlier.shape = 21, # 外れ値マーカーの種類（外れ値を表示しない場合はNA）
               outlier.size = 2.0, # 外れ値マーカーの大きさ
               outlier.stroke = 0.5, # 外れ値マーカーの線の太さ
               alpha = 0.5, # 箱の塗りつぶしの透明度
               color = "darkblue", # 箱ひげの線の色
               fill = "lightblue", # 箱の塗りつぶしの色
               size = 0.5) # 箱ひげの線の太さ
```

### 箱ひげ図に個別サンプルを追加 {.unnumbered}

箱ひげ図に個別サンプルを追加する場合は、データの重複表示を避けるため、`geom_boxplot()`関数の`outlier.shape`引数にNAを指定して、箱ひげ図による外れ値のマーカーを非表示にします。

```{r}
ggplot(data = mpg,
       mapping = aes(x = class, y = hwy)) +
  geom_boxplot(outlier.shape = NA, # 外れ値マーカーの種類（外れ値を表示しない場合はNA）
               alpha = 0.5, # 箱の塗りつぶしの透明度
               color = "darkblue", # 箱ひげの線の色
               fill = "lightblue", # 箱の塗りつぶしの色
               size = 0.5) + # 箱ひげの線の太さ
  geom_jitter(height = 0.3, # マーカーの縦方向の分布範囲
              width = 0.3, # マーカーの横方向の分布範囲
              alpha = 1.0, # マーカーの塗りつぶしの透明度
              color = "darkblue", # マーカーの線の色
              fill = "darkblue", # マーカーの塗りつぶしの色
              shape = 21, # マーカーの種類
              size = 1.0, # マーカーの大きさ
              stroke = 0.5) # マーカーの線の太さ
```

### ヴァイオリングラフの基本形 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = class, y = hwy)) +
  geom_violin(scale = "area", # ヴァイオリンの大きさ（area：すべての面積が同じ、count：サンプル個数に比例、width：すべての幅が同じ）
              alpha = 0.5, # ヴァイオリンの塗りつぶしの透明度
              color = "darkblue", # ヴァイオリンの線の色
              fill = "lightblue", # ヴァイオリンの塗りつぶしの色
              linetype = "solid", # ヴァイオリンの線の種類
              size = 0.5) # ヴァイオリンの線の太さ
```

### ヴァイオリングラフに個別サンプルを追加 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = class, y = hwy)) +
  geom_violin(scale = "area", # ヴァイオリンの大きさ（area：すべての面積が同じ、count：サンプル個数に比例、width：すべての幅が同じ）
              alpha = 0.5, # ヴァイオリンの塗りつぶしの透明度
              color = "darkblue", # ヴァイオリンの線の色
              fill = "lightblue", # ヴァイオリンの塗りつぶしの色
              linetype = "solid", # ヴァイオリンの線の種類
              size = 0.5) + # ヴァイオリンの線の太さ
  geom_jitter(height = 0.4, # マーカーの縦方向の分布範囲
              width = 0.4, # マーカーの横方向の分布範囲
              alpha = 1.0, # マーカーの塗りつぶしの透明度
              color = "darkblue", # マーカーの線の色
              fill = "darkblue", # マーカーの塗りつぶしの色
              shape = 21, # マーカーの種類
              size = 1.0, # マーカーの大きさ
              stroke = 0.5) # マーカーの線の太さ
```

## ドットプロット

ドットプロットは`geom_dotplot()`関数で作成します。FOMCで示される参加者の政策金利予想を可視化する際に使用されます。

-   X軸：離散型変数
-   Y軸：離散型変数

### ドットプロットの基本形 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = class, y = hwy)) +
  geom_dotplot(binaxis = "y",
               binwidth = 0.5,
               stackdir = "center",
               alpha = 1.0, # マーカーの塗りつぶしの透明度
               color = "darkblue", # マーカーの線の色
               fill = "lightblue", # マーカーの塗りつぶしの色
               stroke = 0.5) # マーカーの線の太さ
```

## 色の設定

変数の値や属性に応じて色を自動で変化させるには、`geom`関数ファミリーでグラフを作成したあとに、`+`で`scale_color`関数ファミリー（線の色）や`scale_fill`関数ファミリー（塗りつぶしの色）をつなぎます。色を変化に対応する変数が離散型か連続型かによって、どの`scale_color/fill`関数を用いるかが変わります。

まず、プロット用のデータを作成します。

```{r}
data_mpg_color <- mpg %>% 
  dplyr::group_by(class) %>% 
  dplyr::summarise(across(c(cty, hwy), mean, na.rm = TRUE))

data_mpg_color
```

### 色の手動指定（離散型変数） {.unnumbered}

自分で色の割り当てを決める方法です。Rで使用できる色の種類については、[こちら](http://www.okadajp.org/RWiki/?%E8%89%B2%E8%A6%8B%E6%9C%AC)を参照してください。

```{r}
ggplot(data = mpg,
       mapping = aes(x = fl, color = fl, fill = fl)) +
  geom_bar() +
  scale_color_manual(values = c("Red", "Salmon", "Gold", "Forestgreen", "Darkblue")) + # colorで指定した変数の離散値と同数の色を指定
  scale_fill_manual(values = c("Red", "Salmon", "Gold", "Forestgreen", "Darkblue")) # fillで指定した変数の離散値と同数の色を指定
```

### Brewerカラーパレット（離散型変数） {.unnumbered}

`RColorBrewer`パッケージで提供される様々な種類の美麗なプリセットカラーパレットが利用できます。

```{r}
# カラーパレットの確認
RColorBrewer::display.brewer.all()
```

```{r}
ggplot(data = mpg,
       mapping = aes(x = fl, color = fl, fill = fl)) +
  geom_bar() +
  scale_color_brewer(palette = "Paired", # カラーパレット名
                     direction = 1) + # 色の順序（-1で逆順）
  scale_fill_brewer(palette = "Paired", # カラーパレット名
                    direction = 1) # 色の順序（-1で逆順）
```

### Viridisカラーパレット（離散型変数） {.unnumbered}

色覚障害に対応したカラーパレットです。パレットの種類などの詳細は[こちら](https://ggplot2.tidyverse.org/reference/scale_viridis.html)を参照してください。

```{r}
ggplot(data = mpg,
       mapping = aes(x = fl, color = fl, fill = fl)) +
  geom_bar() +
  scale_color_viridis_d(option = "viridis", # パレットの種類（magma / inferno / plasma / viridis / cividis）
                        direction = 1) + # 色の順序（-1で逆順）
  scale_fill_viridis_d(option = "viridis", # パレットの種類（magma / inferno / plasma / viridis / cividis）
                       direction = 1) # 色の順序（-1で逆順）
```

### ggsciカラーパレット（離散型変数） {.unnumbered}

様々な科学ジャーナルで使用されるカラーパレットです。パレットの種類などの詳細は[こちら](https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html)をご覧ください。

```{r}
ggplot(data = mpg,
       mapping = aes(x = fl, color = fl, fill = fl)) +
  geom_bar() +
  scale_color_npg() + 
  scale_fill_npg()
```

### distillerカラーパレット（連続型変数） {.unnumbered}

`RColorBrewer`パッケージで提供される様々な種類の美麗なプリセットカラーパレットが利用できます。

```{r}
# カラーパレットの確認
RColorBrewer::display.brewer.all()
```

```{r, warning=FALSE, message=FALSE}
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = ..x..)) +
  geom_dotplot() +
  scale_fill_distiller(palette = "Blues", # カラーパレット名
                       direction = 1) # 色の順序（-1で逆順）
```

### Viridisカラーパレット（連続型変数） {.unnumbered}

色覚障害に対応したカラーパレットです。パレットの種類などの詳細は[こちら](https://ggplot2.tidyverse.org/reference/scale_viridis.html)を参照してください。

```{r, warning=FALSE, message=FALSE}
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = ..x..)) +
  geom_dotplot() +
  scale_fill_viridis_c(option = "viridis", # パレットの種類（magma / inferno / plasma / viridis / cividis）
                       direction = 1) # 色の順序（-1で逆順）
```

### gradientカラーパレット（連続型変数） {.unnumbered}

自分で色を指定してグラデーションを作成するカラーパレットです。2色グラデーション、3色グラデーション、n色グラデーションの3種類の関数があります。n色グラデーションでは、事前にベースとなるカラーパレットを`RColorBrewer::display.brewer.all()`関数などで確認して使用します。

```{r, warning=FALSE, message=FALSE}
# 2色グラデーション
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = ..x..)) +
  geom_dotplot() +
  scale_fill_gradient(low = "Red", # 最小値の色
                      high = "Forestgreen") # 最大値の色
```

```{r, warning=FALSE, message=FALSE}
# 3色グラデーション
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = ..x..)) +
  geom_dotplot() +
  scale_fill_gradient2(low = "Red", # 最小値の色
                       mid = "Gold", # 中間値の色
                       high = "Forestgreen", # 最大値の色
                       midpoint = 30) # 中間値
```

```{r, warning=FALSE, message=FALSE}
# パレットを指定したn色グラデーション
ggplot(data = mpg,
       mapping = aes(x = hwy, fill = ..x..)) +
  geom_dotplot() +
  scale_fill_gradientn(colors = brewer.pal(name = "RdYlGn",
                                           n = 9))
```

## 軸の設定

X軸、Y軸の設定を行うには、`scale_x/y`関数ファミリーを使用します。X軸、Y軸に指定する変数の型によって、使用する関数が異なります。

まず、プロット用のデータを作成します。

```{r}
data_owid_scale <- data_owid %>% 
  dplyr::group_by(location) %>% 
  dplyr::summarise(across(c(new_cases, new_deaths), mean, na.rm = TRUE))

summary(data_owid_scale)
```

### X軸：連続型、Y軸：連続型 {.unnumbered}

```{r}
ggplot(data = data_owid_scale,
       mapping = aes(x = new_cases, y = new_deaths)) +
  geom_point() +
  geom_smooth() +
  scale_x_continuous(breaks = breaks_x <- seq(0, 1e+06, 100000), # 目盛
                     labels = breaks_x, # 目盛ラベル
                     limits = c(0, 7e+05), # 下限・上限値（指定しない場合はNA）
                     expand = expansion(mult = c(0.05, 0.05), add = c(0, 0))) + # 下限・上限値からの余白（multは余白率、addは余白幅）
  scale_y_continuous(breaks = breaks_y <- seq(0, 10000, 1000), # 目盛
                     labels = breaks_y, # 目盛ラベル
                     limits = c(0, 8000), # 下限・上限値（指定しない場合はNA）
                     expand = expansion(mult = c(0.05, 0.05), add = c(0, 0))) + # 下限・上限値からの余白（multは余白率、addは余白幅）
  labs(x = "新規感染者数（1日当たり平均、人）", # X軸のタイトル
       y = "新規死亡者数（1日当たり平均、人）") + # Y軸のタイトル
  theme(axis.title = element_text(size = 8), # 軸タイトルの文字サイズ
        axis.text.x = element_text(angle = 0, # X軸ラベルの角度
                                   hjust = 0.5, # X軸ラベルの横整列位置（0-1）
                                   vjust = 0.5), # X軸ラベルの縦整列位置（0-1）
        axis.text.y = element_text(angle = 0, # Y軸ラベルの角度
                                   hjust = 0.5, # Y軸ラベルの横整列位置（0-1）
                                   vjust = 0.5)) # Y軸ラベルの縦整列位置（0-1）
```

### 対数目盛 {.unnumbered}

```{r}
ggplot(data = data_owid_scale,
       mapping = aes(x = new_cases, y = new_deaths)) +
  geom_point() +
  geom_smooth() +
  scale_x_log10(breaks = breaks_x <- 10 ** seq(0, 6, 1), # 目盛
                     labels = c(breaks_x[1:4], "1万", "10万", "100万"), # 目盛ラベル
                     limits = c(1, 7e+05), # 下限・上限値（指定しない場合はNA）
                     expand = expansion(mult = c(0.05, 0.05), add = c(0, 0))) + # 下限・上限値からの余白（multは余白率、addは余白幅）
  scale_y_log10(breaks = breaks_y <- 10 ** seq(0, 4, 1), # 目盛
                     labels = c(breaks_y[1:4], "1万"), # 目盛ラベル
                     limits = c(1, 8000), # 下限・上限値（指定しない場合はNA）
                     expand = expansion(mult = c(0.05, 0.05), add = c(0, 0))) + # 下限・上限値からの余白（multは余白率、addは余白幅）
  labs(x = "新規感染者数（1日当たり平均、人）", # X軸のタイトル
       y = "新規死亡者数（1日当たり平均、人）") + # Y軸のタイトル
  theme(axis.title = element_text(size = 8), # 軸タイトルの文字サイズ
        axis.text.x = element_text(angle = 0, # X軸ラベルの角度
                                   hjust = 0.5, # X軸ラベルの横整列位置（0-1）
                                   vjust = 0.5), # X軸ラベルの縦整列位置（0-1）
        axis.text.y = element_text(angle = 0, # Y軸ラベルの角度
                                   hjust = 0.5, # Y軸ラベルの横整列位置（0-1）
                                   vjust = 0.5)) # Y軸ラベルの縦整列位置（0-1）
```

### X軸：日付型、Y軸：連続型 {.unnumbered}

```{r}
# date_breaks引数を使用する場合
ggplot(data = economics,
       mapping = aes(x = date, y = unemploy)) + 
  geom_line() +
  scale_x_date(date_breaks = "3 month",　# 日付目盛の周期
               date_labels = "%y/%b", # 日付フォーマット（%Y：4桁年、%y：2桁年、%m：2桁月、%b：1桁月、%d：日）
               limits = c(as.Date("2000/01/01"), as.Date("2002/12/31")), # 始期・終期（指定しない場合はNA）
               expand = expansion(mult = c(0.00, 0.00), add = c(0, 0))) + # 始期・終期からの余白（multは余白率、addは余白幅）
  scale_y_continuous(breaks = breaks_y <- seq(0, 50000, 1000), # 目盛
                     labels = breaks_y, # 目盛ラベル
                     limits = c(5000, 10000), # 下限・上限値（指定しない場合はNA）
                     expand = expansion(mult = c(0.05, 0.05), add = c(0, 0))) + # 下限・上限値からの余白（multは余白率、addは余白幅）
  labs(x = "日付（年/月）", # X軸のタイトル
       y = "失業者数（千人）") + # Y軸のタイトル
  theme(axis.title = element_text(size = 8), # 軸タイトルの文字サイズ
        axis.text.x = element_text(angle = 0, # X軸ラベルの角度
                                   hjust = 0.5, # X軸ラベルの横整列位置（0-1）
                                   vjust = 0.5), # X軸ラベルの縦整列位置（0-1）
        axis.text.y = element_text(angle = 0, # Y軸ラベルの角度
                                   hjust = 0.5, # Y軸ラベルの横整列位置（0-1）
                                   vjust = 0.5)) # Y軸ラベルの縦整列位置（0-1）
```

```{r}
# date_breaks引数を使用しない場合（結果は同じ）
ggplot(data = economics,
       mapping = aes(x = date, y = unemploy)) + 
  geom_line() +
  scale_x_date(breaks = breaks_x <- seq(as.Date("1967-01-01"), max(economics$date), by = "3 months"), # 日付目盛ベクトル
               date_labels = str_c(str_sub(lubridate::year(breaks_x), 3, 4), "/", lubridate::month(breaks_x)), # 日付目盛ベクトルをラベル用に加工
               limits = c(as.Date("2000/01/01"), as.Date("2002/12/31")), # 始期・終期（指定しない場合はNA）
               expand = expansion(mult = c(0.00, 0.00), add = c(0, 0))) + # 始期・終期からの余白（multは余白率、addは余白幅）
  scale_y_continuous(breaks = breaks_y <- seq(0, 50000, 1000), # 目盛
                     labels = breaks_y, # 目盛ラベル
                     limits = c(5000, 10000), # 下限・上限値（指定しない場合はNA）
                     expand = expansion(mult = c(0.05, 0.05), add = c(0, 0))) + # 下限・上限値からの余白（multは余白率、addは余白幅）
  labs(x = "日付（年/月）", # X軸のタイトル
       y = "失業者数（千人）") + # Y軸のタイトル
  theme(axis.title = element_text(size = 8), # 軸タイトルの文字サイズ
        axis.text.x = element_text(angle = 0, # X軸ラベルの角度
                                   hjust = 0.5, # X軸ラベルの横整列位置（0-1）
                                   vjust = 0.5), # X軸ラベルの縦整列位置（0-1）
        axis.text.y = element_text(angle = 0, # Y軸ラベルの角度
                                   hjust = 0.5, # Y軸ラベルの横整列位置（0-1）
                                   vjust = 0.5)) # Y軸ラベルの縦整列位置（0-1）
```

## 複数グラフ（ファセット）

複数のグラフをまとめたファセットを作成するには、`facet`関数ファミリーを使用します。どのようなファセットにするかで使用する関数が異なります。

### 行方向の複合グラフ {.unnumbered}

行方向に複合グラフを並べる場合は、`facet_rep_grid()`関数の`rows`引数に`vars(離散型変数)`の形でグラフを分けて作成したい変数名を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_point() +
  facet_rep_grid(rows = vars(class), # 変数class別にグラフを作成
                 scales = "fixed", # 目盛設定（fixed：全グラフ共通、free：全グラフ独立、free_x：X軸のみ独立、free_y：Y軸のみ独立）
                 repeat.tick.labels = FALSE) # 目盛表示（TRUE：すべてのグラフに表示、FALSE：端のグラフのみ表示
```

### 列方向の複合グラフ {.unnumbered}

列方向に複合グラフを並べる場合は、`facet_rep_grid()`関数の`cols`引数に`vars(離散型変数)`の形でグラフを分けて作成したい変数名を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_point() +
  facet_rep_grid(cols = vars(class), # 変数class別にグラフを作成
                 scales = "fixed", # 目盛設定（fixed：全グラフ共通、free：全グラフ独立、free_x：X軸のみ独立、free_y：Y軸のみ独立）
                 repeat.tick.labels = FALSE) # 目盛表示（TRUE：すべてのグラフに表示、FALSE：端のグラフのみ表示
```

### 行・列方向の複合グラフ {.unnumbered}

行・列方向に複合グラフを並べる場合は、`facet_rep_grid()`関数の`rows`引数と`cols`引数にそれぞれ`vars(離散型変数)`の形でグラフを分けて作成したい変数名を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_point() +
  facet_rep_grid(rows = vars(year), # 変数year別に行方向のグラフを作成
                 cols = vars(class), # 変数class別に列方向のグラフを作成
                 scales = "fixed", # 目盛設定（fixed：全グラフ共通、free：全グラフ独立、free_x：X軸のみ独立、free_y：Y軸のみ独立）
                 repeat.tick.labels = TRUE) # 目盛表示（TRUE：すべてのグラフに表示、FALSE：端のグラフのみ表示
```

### 行数・列数を指定した複合グラフ {.unnumbered}

行数と列数を指定してグラフを順番に並べるには、`facet_rep_wrap()`関数の`facets`引数に`~ 離散型変数`の形でグラフを分けて作成したい変数名を指定し、`nrow`引数と`ncol`引数に行数・列数を指定します。

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_point() +
  facet_rep_wrap(facets = ~ manufacturer, # 変数manufacturer別にグラフを作成
                 nrow = 3, # 行方向のグラフ数
                 ncol = 5, # 列方向のグラフ数
                 scales = "fixed", # 目盛設定（fixed：全グラフ共通、free：全グラフ独立、free_x：X軸のみ独立、free_y：Y軸のみ独立）
                 repeat.tick.labels = TRUE) # 目盛表示（TRUE：すべてのグラフに表示、FALSE：端のグラフのみ表示
```

### 複合グラフの設定 {.unnumbered}

ファセットの各種設定を行うには、`theme()`関数内に必要事項を記入します。

```{r}
# 行数・列数を指定した複合グラフの例
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy)) +
  geom_point() +
  facet_rep_wrap(facets = ~ manufacturer) + # 変数manufacturer別にグラフを作成
  theme(strip.background = element_rect(color = NA, # ファセットタイトル領域の枠の色
                                        fill = "White"), # ファセットタイトル領域の塗りつぶしの色（NAで無色）
        strip.text = element_text(color = "Black", # ファセットタイトルの色
                                  face = "bold", # ファセットタイトルの書体
                                  size = 8, # ファセットタイトルのフォントサイズ
                                  hjust = 0.5, # ファセットタイトルの横方向の整列位置
                                  vjust = 0.5), # ファセットタイトルの縦方向の整列位置
        panel.spacing.x = unit(x = 2, units = "mm"), # ファセットのグラフ間の横方向のスペース
        panel.spacing.y = unit(x = 2, units = "mm")) # ファセットのグラフ間の縦方向のスペース
```

## 地図ファセット

国別・州別・都道府県別のデータを、地図を模した複合グラフに表示するには、`geofacet`パッケージの`facet_geo()`関数を使用します。

ここでは、日本の県内総生産データを使用します。

```{r}
data_gdp_pref
```

`geofacet`パッケージでは、都道府県名と地図上の位置を結びつける`jp_prefs_grid2`データが用意されています。ただし都道府県名が英語表記でしか格納されていないため、日本語表記を名寄せして追加します。

```{r}
# geofacetのjp_prefs_grid2に都道府県名の日本語表記を追加
data_prefs <- data_gdp_pref %>% 
  dplyr::select(pref_code, pref_name) %>% 
  dplyr::distinct() %>% 
  dplyr::rename(code = pref_code)

jp_prefs_grid2 %<>%
  dplyr::left_join(data_prefs, by = "code")
```

そのうえで、ファセット部分に`facet_geo()`関数を用いると、都道府県別のデータを日本地図を模した形でグラフ化することができます。

```{r}
ggplot(data = data_gdp_pref,
       mapping = aes(x = year, y = gdp_nominal_pchg)) +
  geom_line() +
  geom_point() +
  facet_geo(facets = ~ pref_name, # 変数pref_name別にグラフを作成
            grid = "jp_prefs_grid2", # 使用する地図グリッド
            scales = "fixed") + # 目盛設定（fixed：全グラフ共通、free：全グラフ独立、free_x：X軸のみ独立、free_y：Y軸のみ独立）
  theme(strip.background = element_rect(color = NA, # ファセットタイトル領域の枠の色
                                        fill = NA), # ファセットタイトル領域の塗りつぶしの色（NAで無色）
        strip.text = element_text(color = "Black", # ファセットタイトルの色
                                  face = "bold", # ファセットタイトルの書体
                                  size = 8, # ファセットタイトルのフォントサイズ
                                  hjust = 0.5, # ファセットタイトルの横方向の整列位置
                                  vjust = 0.5), # ファセットタイトルの縦方向の整列位置
        panel.spacing.x = unit(x = 1, units = "mm"), # ファセットのグラフ間の横方向のスペース
        panel.spacing.y = unit(x = 0.5, units = "mm")) # ファセットのグラフ間の縦方向のスペース
```

## その他設定・保存

タイトル、目盛線、凡例、図表全体のフォント、マージンなどの各種設定を行います。

### タイトル・キャプション {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy, fill = class)) +
  geom_point(shape = 21,
             size = 2.0) +
  labs(title = "車体クラス別の一般道燃費と高速道燃費", # 図表タイトル
       caption = "（出所）EPA.gov", # キャプション
       fill = "車体クラス")　+ # 凡例に使用するscaleのタイトル
  theme(plot.title = element_text(size = 10, # 図表タイトルの文字サイズ
                                  face = "bold", # 図表タイトルの書体
                                  hjust = 0.5), # 図表タイトルの横整列位置
        plot.caption = element_text(size = 8, # キャプションの文字サイズ
                                    face = "plain", # キャプションの書体
                                    hjust = 0.0)) # キャプションの横整列位置
```

### パネル目盛線 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy, fill = class)) +
  geom_point(shape = 21,
             size = 2.0) +
  theme(panel.grid.major = element_line(color = "grey", # 主目盛線の色
                                        linetype = "dashed", # 主目盛線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
                                        size = 0.2), # 主目盛線の太さ
        panel.grid.minor = element_blank()) # 補助目盛り線は表示しない
```

### 凡例 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy, fill = class)) +
  geom_point(shape = 21,
             size = 2.0) +
  theme(legend.title = element_text(size = 8, # 凡例タイトルの文字サイズ
                                    face = "bold", # 凡例タイトルの書体
                                    hjust = 0.0), # 凡例タイトルの横整列位置
        legend.text = element_text(size = 6), # 凡例ラベルの文字サイズ
        legend.box.background = element_rect(color = "grey", # 凡例の枠線の色
                                             size = 0.5), # 凡例の枠線の太さ
        legend.margin = margin(t = 1, # 凡例の上マージン
                               b = 1, # 凡例の下マージン
                               r = 1, # 凡例の右マージン
                               l = 1, # 凡例の左マージン
                               unit = "mm"), # 凡例マージンの単位
        legend.justification = c(1.0, 0.0), # 凡例の横整列位置・縦整列位置
        legend.position = c(0.95, 0.05)) + # 凡例の横位置・縦位置
  guides(fill = guide_legend(keywidth = unit(3, units = "mm"), # 凡例キーの幅
                             keyheight = unit(3, units = "mm"), # 凡例キーの高さ
                             direction = "vertical", # 凡例の整列方向（horizontal / vertical）
                             nrow = 3, # 凡例の行数
                             ncol = 3, # 凡例の列数
                             reverse = FALSE)) # 凡例順序の逆転
```

### フォント・マージン設定 {.unnumbered}

```{r}
ggplot(data = mpg,
       mapping = aes(x = cty, y = hwy, fill = class)) +
  geom_point(shape = 21,
             size = 2.0) +
  theme(text = element_text(family = "YUGO", # 図表全体のフォント
                            size = 8), # 図表全体の無事サイズ
        plot.margin = margin(t = 1, # 図表の上マージン
                             b = 1, # 図表の下マージン
                             r = 1, # 図表の右マージン
                             l = 1, # 図表の左マージン
                             unit = "mm")) # 図表マージンの単位
```

### 保存 {.unnumbered}

`ggplot2`パッケージで作成した図表を画像形式で保存するには、`ggsave()`関数を使用します。

```{r, eval=FALSE}
ggsave(filename = "directory/filename.png", # 図表のファイル名
       width = 12.00, # 図表の横サイズ
       height = 9.00, # 図表の縦サイズ
       units = "cm", # 図表のサイズ単位
       dpi = 300) # 図表の解像度
```

## 実例

### 実例1：世界の新型コロナ死亡率の箱ひげ図 {.unnumbered}

```{r, results='hide', warning=FALSE, message=FALSE}
# プロット用のデータの作成
data_plot <- data_owid %>% 
  dplyr::select(location, date, new_cases, new_deaths) %>% 
  dplyr::filter(date <= max(date) - 28) %>% 
  dplyr::mutate(year = lubridate::year(date)) %>% 
  dplyr::group_by(location, year) %>% 
  dplyr::summarise(across(c(new_cases, new_deaths), mean, na.rm = TRUE)) %>% 
  dplyr::mutate(mort_rate = 100 * new_deaths / new_cases,
                year = str_c(year, "年"))
```

```{r}
# プロット
ggplot(data = data_plot,
       mapping = aes(x = year, y = mort_rate, color = year, fill = year)) +
  geom_hline(yintercept = 0, # 水平線の縦軸との交点
             color = "gray", # 水平線の色
             size = 0.5) + # 水平線の太さ
  geom_boxplot(outlier.shape = NA, alpha = 0.25, size = 0.5) +
  geom_jitter(alpha = 0.5, size = 1.0, shape = 21) +
  scale_y_continuous(breaks = breaks_y <- seq(0, 100, 0.5), # 目盛
                     labels = breaks_y %>% sprintf(fmt = "%0.1f"), # 目盛ラベル
                     limits = c(0, 5), # 下限・上限値（指定しない場合はNA）
                     expand = expansion(mult = c(0.05, 0.05), add = c(0, 0))) + # 下限・上限値からの余白（multは余白率、addは余白幅）
  labs(x = element_blank(), # X軸のタイトル
       y = "新型コロナ感染者の致死率（％）") + # Y軸のタイトル
  theme(axis.title = element_text(size = 8)) + # 軸タイトルの文字サイズ
  labs(title = "世界各国の新型コロナ感染者の致死率（年別）", # 図表タイトル
       caption = "（注）箱の中の横線は中央値を示す。2022年は直近4週間のサンプルを除外。\n（出所）Our World in Data、@naohat23") + # キャプション
  theme(plot.title = element_text(size = 10, # 図表タイトルの文字サイズ
                                  face = "bold", # 図表タイトルの書体
                                  hjust = 0.5), # 図表タイトルの横整列位置
        plot.caption = element_text(size = 8, # キャプションの文字サイズ
                                    face = "plain", # キャプションの書体
                                    hjust = 0.0)) + # キャプションの横整列位置
  theme(panel.grid.major = element_line(color = "grey", # 主目盛線の色
                                        linetype = "dashed", # 主目盛線の種類（solid / dashed / dotted / dotdash / twodash / longdash）
                                        size = 0.2), # 主目盛線の太さ
        panel.grid.minor = element_blank()) + # 補助目盛り線は表示しない
  theme(legend.position = "none") + # 凡例の横位置・縦位置
  theme(text = element_text(family = "YUGO", # 図表全体のフォント
                            size = 8), # 図表全体の無事サイズ
        plot.margin = margin(t = 1, # 図表の上マージン
                             b = 1, # 図表の下マージン
                             r = 1, # 図表の右マージン
                             l = 1, # 図表の左マージン
                             unit = "mm")) # 図表マージンの単位
```

```{r, eval=FALSE}
# 保存
ggsave(filename = "directory/filename.png", # 図表のファイル名
       width = 12.00, # 図表の横サイズ
       height = 9.00, # 図表の縦サイズ
       units = "cm", # 図表のサイズ単位
       dpi = 600) # 図表の解像度
```
