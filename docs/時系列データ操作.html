<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 時系列データ操作 | エコノミストのためのR</title>
  <meta name="description" content="4 時系列データ操作 | エコノミストのためのR" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="4 時系列データ操作 | エコノミストのためのR" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="naohat23/econ-code-bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 時系列データ操作 | エコノミストのためのR" />
  
  
  

<meta name="author" content="服部直樹" />


<meta name="date" content="2022-06-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidyverseによるデータ操作.html"/>
<link rel="next" href="ggplot2によるグラフ作成.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://naohat23.github.io/econ-code-bookdown">エコノミストのためのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>はじめに</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#なぜrを使うのか"><i class="fa fa-check"></i>なぜRを使うのか？</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本書で出来ること"><i class="fa fa-check"></i>本書で出来ること　</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本書で出来ないこと"><i class="fa fa-check"></i>本書で出来ないこと</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#目次"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#参考文献ウェブサイト"><i class="fa fa-check"></i>参考文献・ウェブサイト</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#rプログラミングデータ分析"><i class="fa fa-check"></i>Rプログラミング・データ分析</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#計量経済学"><i class="fa fa-check"></i>計量経済学</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rの設定.html"><a href="rの設定.html"><i class="fa fa-check"></i><b>1</b> Rの設定</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rの設定.html"><a href="rの設定.html#設定全般"><i class="fa fa-check"></i><b>1.1</b> 設定全般</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#rのインストール"><i class="fa fa-check"></i>Rのインストール</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#rのバージョン確認"><i class="fa fa-check"></i>Rのバージョン確認</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#セッション情報の確認"><i class="fa fa-check"></i>セッション情報の確認</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#オブジェクトを全削除"><i class="fa fa-check"></i>オブジェクトを全削除</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#警告の非表示"><i class="fa fa-check"></i>警告の非表示</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#関数が出力する警告やメッセージの非表示"><i class="fa fa-check"></i>関数が出力する警告やメッセージの非表示</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="rの設定.html"><a href="rの設定.html#プロキシサーバーの設定"><i class="fa fa-check"></i><b>1.2</b> プロキシサーバーの設定</a></li>
<li class="chapter" data-level="1.3" data-path="rの設定.html"><a href="rの設定.html#パッケージ"><i class="fa fa-check"></i><b>1.3</b> パッケージ</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#使用するパッケージ一覧"><i class="fa fa-check"></i>使用するパッケージ一覧</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#パッケージのインストールとインポート"><i class="fa fa-check"></i>パッケージのインストールとインポート</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="rの設定.html"><a href="rの設定.html#グラフの設定"><i class="fa fa-check"></i><b>1.4</b> グラフの設定</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#グラフのテーマ設定"><i class="fa fa-check"></i>グラフのテーマ設定</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#グラフのフォント設定"><i class="fa fa-check"></i>グラフのフォント設定</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="rの設定.html"><a href="rの設定.html#サンプルデータセット"><i class="fa fa-check"></i><b>1.5</b> サンプルデータセット</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#rのサンプルデータセット"><i class="fa fa-check"></i>Rのサンプルデータセット</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#外部データセット"><i class="fa fa-check"></i>外部データセット</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="rの設定.html"><a href="rの設定.html#r起動時に実行する設定"><i class="fa fa-check"></i><b>1.6</b> R起動時に実行する設定</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html"><i class="fa fa-check"></i><b>2</b> Rの基本的な使用方法</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#主要ショートカットキー"><i class="fa fa-check"></i><b>2.1</b> 主要ショートカットキー</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#編集"><i class="fa fa-check"></i>編集</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#実行"><i class="fa fa-check"></i>実行</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#その他"><i class="fa fa-check"></i>その他</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#基本操作"><i class="fa fa-check"></i><b>2.2</b> 基本操作</a></li>
<li class="chapter" data-level="2.3" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#演算"><i class="fa fa-check"></i><b>2.3</b> 演算</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#四則計算"><i class="fa fa-check"></i>四則計算</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#数値計算"><i class="fa fa-check"></i>数値計算</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#一致大小関係"><i class="fa fa-check"></i>一致・大小関係</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#包含集合関係"><i class="fa fa-check"></i>包含・集合関係</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトル"><i class="fa fa-check"></i><b>2.4</b> ベクトル</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトルの作成"><i class="fa fa-check"></i>ベクトルの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトル要素へのアクセス"><i class="fa fa-check"></i>ベクトル要素へのアクセス</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#規則性があるベクトルの作成"><i class="fa fa-check"></i>規則性があるベクトルの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトルの演算"><i class="fa fa-check"></i>ベクトルの演算</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列"><i class="fa fa-check"></i><b>2.5</b> 行列</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列の作成"><i class="fa fa-check"></i>行列の作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列の要素へのアクセス"><i class="fa fa-check"></i>行列の要素へのアクセス</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列の演算"><i class="fa fa-check"></i>行列の演算</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データフレーム"><i class="fa fa-check"></i><b>2.6</b> データフレーム</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データフレームの作成"><i class="fa fa-check"></i>データフレームの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データフレームの要素へのアクセス"><i class="fa fa-check"></i>データフレームの要素へのアクセス</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#その他のデータフレームの機能"><i class="fa fa-check"></i>その他のデータフレームの機能</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#リスト"><i class="fa fa-check"></i><b>2.7</b> リスト</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#リストの作成"><i class="fa fa-check"></i>リストの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#リストの要素へのアクセス"><i class="fa fa-check"></i>リストの要素へのアクセス</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#制御構文"><i class="fa fa-check"></i><b>2.8</b> 制御構文</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ifelse文"><i class="fa fa-check"></i>if/else文</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#forループ"><i class="fa fa-check"></i>forループ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#whileループ"><i class="fa fa-check"></i>whileループ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#breakによる繰り返しの終了"><i class="fa fa-check"></i>breakによる繰り返しの終了</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#tryによるエラー処理"><i class="fa fa-check"></i>tryによるエラー処理</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データの読み込み書き出し"><i class="fa fa-check"></i><b>2.9</b> データの読み込み・書き出し</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#csvデータの読み込み"><i class="fa fa-check"></i>CSVデータの読み込み</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#excelデータの読み込みxls形式"><i class="fa fa-check"></i>Excelデータの読み込み（xls形式）</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#excelデータの読み込みxlsx形式"><i class="fa fa-check"></i>Excelデータの読み込み（xlsx形式）</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#csvデータの書き出し"><i class="fa fa-check"></i>CSVデータの書き出し</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#オブジェクトのセーブロード"><i class="fa fa-check"></i><b>2.10</b> オブジェクトのセーブ・ロード</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#セーブ"><i class="fa fa-check"></i>セーブ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ロード"><i class="fa fa-check"></i>ロード</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html"><i class="fa fa-check"></i><b>3</b> tidyverseによるデータ操作</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#第3章の準備"><i class="fa fa-check"></i><b>3.1</b> 第3章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#パッケージのインポート"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#外部データセットの取得"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#tidyverseとは"><i class="fa fa-check"></i><b>3.2</b> tidyverseとは</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#tidy-data縦型横型データ"><i class="fa fa-check"></i>tidy data（縦型・横型データ）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#tidyverseの特徴"><i class="fa fa-check"></i>tidyverseの特徴</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列の選択"><i class="fa fa-check"></i><b>3.3</b> 列の選択</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名で選択"><i class="fa fa-check"></i>列名で選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名を格納したベクトルで選択"><i class="fa fa-check"></i>列名を格納したベクトルで選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列を非選択削除"><i class="fa fa-check"></i>列を非選択（削除）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名に特定の文字列を含む列を選択"><i class="fa fa-check"></i>列名に特定の文字列を含む列を選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名が特定の文字列から始まる列を選択"><i class="fa fa-check"></i>列名が特定の文字列から始まる列を選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名が特定の文字列で終わる列を選択"><i class="fa fa-check"></i>列名が特定の文字列で終わる列を選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#特定の型の列を選択"><i class="fa fa-check"></i>特定の型の列を選択</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名の変更"><i class="fa fa-check"></i><b>3.4</b> 列名の変更</a></li>
<li class="chapter" data-level="3.5" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#行のフィルタ"><i class="fa fa-check"></i><b>3.5</b> 行のフィルタ</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#条件に一致する行"><i class="fa fa-check"></i>条件に一致する行</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#条件に一致しない行not条件"><i class="fa fa-check"></i>条件に一致しない行（NOT条件）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数条件"><i class="fa fa-check"></i>複数条件</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#andor条件を明示的に指定した複数条件"><i class="fa fa-check"></i>AND・OR条件を明示的に指定した複数条件</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#in演算子によるor条件"><i class="fa fa-check"></i><code>%in%</code>演算子によるOR条件</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#or条件の否定"><i class="fa fa-check"></i>OR条件の否定</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#関数による条件指定"><i class="fa fa-check"></i>関数による条件指定</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#論理値を返す関数による条件指定"><i class="fa fa-check"></i>論理値を返す関数による条件指定</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#行の並べ替え"><i class="fa fa-check"></i><b>3.6</b> 行の並べ替え</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#昇順ソート"><i class="fa fa-check"></i>昇順ソート</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#降順ソート"><i class="fa fa-check"></i>降順ソート</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#降順ソート日付型"><i class="fa fa-check"></i>降順ソート（日付型）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数条件によるソート"><i class="fa fa-check"></i>複数条件によるソート</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列の作成修正"><i class="fa fa-check"></i><b>3.7</b> 列の作成・修正</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#新たな列の作成"><i class="fa fa-check"></i>新たな列の作成</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#既存の列の修正"><i class="fa fa-check"></i>既存の列の修正</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#条件付き系列の作成"><i class="fa fa-check"></i>条件付き系列の作成</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数列の一括処理"><i class="fa fa-check"></i>複数列の一括処理</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ化"><i class="fa fa-check"></i><b>3.8</b> グループ化</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#単一の列でグループ化"><i class="fa fa-check"></i>単一の列でグループ化</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数の列でグループ化"><i class="fa fa-check"></i>複数の列でグループ化</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ化フィルタ"><i class="fa fa-check"></i>グループ化＆フィルタ</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ化の解除"><i class="fa fa-check"></i>グループ化の解除</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#集計"><i class="fa fa-check"></i><b>3.9</b> 集計</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ別の集計"><i class="fa fa-check"></i>グループ別の集計</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#クロス集計"><i class="fa fa-check"></i>クロス集計</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数列の一括処理-1"><i class="fa fa-check"></i>複数列の一括処理</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#縦型横型の変換"><i class="fa fa-check"></i><b>3.10</b> 縦型・横型の変換</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#縦型データを横型データに変換"><i class="fa fa-check"></i>縦型データを横型データに変換</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#横型データを縦型データに変換"><i class="fa fa-check"></i>横型データを縦型データに変換</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#データの結合"><i class="fa fa-check"></i><b>3.11</b> データの結合</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#内部結合"><i class="fa fa-check"></i>内部結合</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#左外部結合"><i class="fa fa-check"></i>左外部結合</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#右外部結合"><i class="fa fa-check"></i>右外部結合</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#完全外部結合"><i class="fa fa-check"></i>完全外部結合</a></li>
</ul></li>
<li class="chapter" data-level="3.12" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#重複処理"><i class="fa fa-check"></i><b>3.12</b> 重複処理</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#重複行の抽出"><i class="fa fa-check"></i>重複行の抽出</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#重複行の削除"><i class="fa fa-check"></i>重複行の削除</a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#欠損値処理"><i class="fa fa-check"></i><b>3.13</b> 欠損値処理</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#naの削除"><i class="fa fa-check"></i>NAの削除</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#naの置換"><i class="fa fa-check"></i>NAの置換</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#naのフィル"><i class="fa fa-check"></i>NAのフィル</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#補完処理"><i class="fa fa-check"></i><b>3.14</b> 補完処理</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#組み合わせ候補の補完"><i class="fa fa-check"></i>組み合わせ候補の補完</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#時系列データの補完"><i class="fa fa-check"></i>時系列データの補完</a></li>
</ul></li>
<li class="chapter" data-level="3.15" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#サンプリング"><i class="fa fa-check"></i><b>3.15</b> サンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="時系列データ操作.html"><a href="時系列データ操作.html"><i class="fa fa-check"></i><b>4</b> 時系列データ操作</a>
<ul>
<li class="chapter" data-level="4.1" data-path="時系列データ操作.html"><a href="時系列データ操作.html#第4章の準備"><i class="fa fa-check"></i><b>4.1</b> 第4章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#パッケージのインポート-1"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#外部データセットの取得-1"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="時系列データ操作.html"><a href="時系列データ操作.html#データ変換"><i class="fa fa-check"></i><b>4.2</b> データ変換</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ラグリード系列の作成"><i class="fa fa-check"></i>ラグ・リード系列の作成</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#変化率系列の作成"><i class="fa fa-check"></i>変化率系列の作成</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#移動平均系列の作成"><i class="fa fa-check"></i>移動平均系列の作成</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="時系列データ操作.html"><a href="時系列データ操作.html#時系列データの頻度変換"><i class="fa fa-check"></i><b>4.3</b> 時系列データの頻度変換</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データを週次データに変換"><i class="fa fa-check"></i>日次データを週次データに変換</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データを月次データに変換"><i class="fa fa-check"></i>日次データを月次データに変換</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データを四半期データに変換"><i class="fa fa-check"></i>日次データを四半期データに変換</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="時系列データ操作.html"><a href="時系列データ操作.html#季節調整x-13"><i class="fa fa-check"></i><b>4.4</b> 季節調整（X-13）</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts型データの可視化"><i class="fa fa-check"></i>ts型データの可視化</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#x-13arima-seatsの実施方法"><i class="fa fa-check"></i>X-13ARIMA-SEATSの実施方法</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#実例月次データの季節調整"><i class="fa fa-check"></i>実例：月次データの季節調整</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="時系列データ操作.html"><a href="時系列データ操作.html#季節調整stl分解"><i class="fa fa-check"></i><b>4.5</b> 季節調整（STL分解）</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#stl分解の実施方法"><i class="fa fa-check"></i>STL分解の実施方法</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#週次データのstl分解"><i class="fa fa-check"></i>週次データのSTL分解</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データのstl分解単一周期"><i class="fa fa-check"></i>日次データのSTL分解（単一周期）</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データのstl分解複数周期"><i class="fa fa-check"></i>日次データのSTL分解（複数周期）</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="時系列データ操作.html"><a href="時系列データ操作.html#トレンド推定"><i class="fa fa-check"></i><b>4.6</b> トレンド推定</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#hpフィルタ"><i class="fa fa-check"></i>HPフィルタ</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#一般化加法モデルgam"><i class="fa fa-check"></i>一般化加法モデル（GAM）</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html"><i class="fa fa-check"></i><b>5</b> ggplot2によるグラフ作成</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#第5章の準備"><i class="fa fa-check"></i><b>5.1</b> 第5章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#パッケージのインポート-2"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#外部データセットの取得-2"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggplot2とは"><i class="fa fa-check"></i><b>5.2</b> ggplot2とは</a></li>
<li class="chapter" data-level="5.3" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggplot2の設定"><i class="fa fa-check"></i><b>5.3</b> ggplot2の設定</a></li>
<li class="chapter" data-level="5.4" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#gui形式の直感的なグラフ作成"><i class="fa fa-check"></i><b>5.4</b> GUI形式の直感的なグラフ作成</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#esquisseパッケージ"><i class="fa fa-check"></i>esquisseパッケージ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggplotguiパッケージ"><i class="fa fa-check"></i>ggplotguiパッケージ</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布離散型"><i class="fa fa-check"></i><b>5.5</b> 1次元の度数分布（離散型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数棒グラフの基本形"><i class="fa fa-check"></i>度数棒グラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布連続型"><i class="fa fa-check"></i><b>5.6</b> 1次元の度数分布（連続型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ヒストグラムの基本形"><i class="fa fa-check"></i>ヒストグラムの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#横並びヒストグラム"><i class="fa fa-check"></i>横並びヒストグラム</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げヒストグラム"><i class="fa fa-check"></i>積み上げヒストグラム</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の密度グラフ"><i class="fa fa-check"></i><b>5.7</b> 1次元の密度グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#密度グラフの基本形"><i class="fa fa-check"></i>密度グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#横並び密度グラフ"><i class="fa fa-check"></i>横並び密度グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ密度グラフ"><i class="fa fa-check"></i>積み上げ密度グラフ</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布離散型-1"><i class="fa fa-check"></i><b>5.8</b> 2次元の度数分布（離散型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数バブルチャートの基本形"><i class="fa fa-check"></i>度数バブルチャートの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数ヒートマップの基本形"><i class="fa fa-check"></i>度数ヒートマップの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布連続型-1"><i class="fa fa-check"></i><b>5.9</b> 2次元の度数分布（連続型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数ヒートマップの基本形-1"><i class="fa fa-check"></i>度数ヒートマップの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の密度グラフ-1"><i class="fa fa-check"></i><b>5.10</b> 2次元の密度グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元密度グラフの基本形"><i class="fa fa-check"></i>2次元密度グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元密度グラフの塗りつぶし版"><i class="fa fa-check"></i>2次元密度グラフの塗りつぶし版</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#qqプロット"><i class="fa fa-check"></i><b>5.11</b> QQプロット</a></li>
<li class="chapter" data-level="5.12" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図バブルチャート"><i class="fa fa-check"></i><b>5.12</b> 散布図・バブルチャート</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図の基本形"><i class="fa fa-check"></i>散布図の基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#バブルチャートの基本形"><i class="fa fa-check"></i>バブルチャートの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図に補助線を追加"><i class="fa fa-check"></i>散布図に補助線を追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図にコネクタ線を追加"><i class="fa fa-check"></i>散布図にコネクタ線を追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図に近似曲線を追加"><i class="fa fa-check"></i>散布図に近似曲線を追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図にラベルを追加"><i class="fa fa-check"></i>散布図にラベルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#バブルチャートにラベルを追加"><i class="fa fa-check"></i>バブルチャートにラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#棒グラフ"><i class="fa fa-check"></i><b>5.13</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#縦棒グラフの基本形"><i class="fa fa-check"></i>縦棒グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#横棒グラフ"><i class="fa fa-check"></i>横棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#縦棒グラフの順序並べ替え"><i class="fa fa-check"></i>縦棒グラフの順序並べ替え</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#縦棒グラフにラベルを追加"><i class="fa fa-check"></i>縦棒グラフにラベルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#集合縦棒グラフ"><i class="fa fa-check"></i>集合縦棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフ"><i class="fa fa-check"></i>積み上げ縦棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフにラベルを追加"><i class="fa fa-check"></i>積み上げ縦棒グラフにラベルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフ-1"><i class="fa fa-check"></i>100％積み上げ縦棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフにラベルを追加-1"><i class="fa fa-check"></i>100％積み上げ縦棒グラフにラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#円グラフ"><i class="fa fa-check"></i><b>5.14</b> 円グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#円グラフの基本形"><i class="fa fa-check"></i>円グラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.15" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフ"><i class="fa fa-check"></i><b>5.15</b> 折れ線グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフの基本形"><i class="fa fa-check"></i>折れ線グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフにマーカーを追加"><i class="fa fa-check"></i>折れ線グラフにマーカーを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフに系列ラベルを追加"><i class="fa fa-check"></i>折れ線グラフに系列ラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.16" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ステップグラフ"><i class="fa fa-check"></i><b>5.16</b> ステップグラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ステップグラフの基本形"><i class="fa fa-check"></i>ステップグラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.17" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#面グラフ"><i class="fa fa-check"></i><b>5.17</b> 面グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#面グラフの基本形"><i class="fa fa-check"></i>面グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ面グラフ"><i class="fa fa-check"></i>積み上げ面グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#リボングラフの基本形"><i class="fa fa-check"></i>リボングラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#リボングラフに折れ線グラフを追加"><i class="fa fa-check"></i>リボングラフに折れ線グラフを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.18" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#箱ひげ図ヴァイオリングラフ"><i class="fa fa-check"></i><b>5.18</b> 箱ひげ図・ヴァイオリングラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#箱ひげ図の基本形"><i class="fa fa-check"></i>箱ひげ図の基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#箱ひげ図に個別サンプルを追加"><i class="fa fa-check"></i>箱ひげ図に個別サンプルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ヴァイオリングラフの基本形"><i class="fa fa-check"></i>ヴァイオリングラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ヴァイオリングラフに個別サンプルを追加"><i class="fa fa-check"></i>ヴァイオリングラフに個別サンプルを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.19" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ドットプロット"><i class="fa fa-check"></i><b>5.19</b> ドットプロット</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ドットプロットの基本形"><i class="fa fa-check"></i>ドットプロットの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.20" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#色の設定"><i class="fa fa-check"></i><b>5.20</b> 色の設定</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#色の手動指定離散型変数"><i class="fa fa-check"></i>色の手動指定（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#brewerカラーパレット離散型変数"><i class="fa fa-check"></i>Brewerカラーパレット（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#viridisカラーパレット離散型変数"><i class="fa fa-check"></i>Viridisカラーパレット（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggsciカラーパレット離散型変数"><i class="fa fa-check"></i>ggsciカラーパレット（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#distillerカラーパレット連続型変数"><i class="fa fa-check"></i>distillerカラーパレット（連続型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#viridisカラーパレット連続型変数"><i class="fa fa-check"></i>Viridisカラーパレット（連続型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#gradientカラーパレット連続型変数"><i class="fa fa-check"></i>gradientカラーパレット（連続型変数）</a></li>
</ul></li>
<li class="chapter" data-level="5.21" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#軸の設定"><i class="fa fa-check"></i><b>5.21</b> 軸の設定</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#x軸連続型y軸連続型"><i class="fa fa-check"></i>X軸：連続型、Y軸：連続型</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#対数目盛"><i class="fa fa-check"></i>対数目盛</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#x軸日付型y軸連続型"><i class="fa fa-check"></i>X軸：日付型、Y軸：連続型</a></li>
</ul></li>
<li class="chapter" data-level="5.22" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#複合グラフファセット"><i class="fa fa-check"></i><b>5.22</b> 複合グラフ（ファセット）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#行方向の複合グラフ"><i class="fa fa-check"></i>行方向の複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#列方向の複合グラフ"><i class="fa fa-check"></i>列方向の複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#行列方向の複合グラフ"><i class="fa fa-check"></i>行・列方向の複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#行数列数を指定した複合グラフ"><i class="fa fa-check"></i>行数・列数を指定した複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#複合グラフの設定"><i class="fa fa-check"></i>複合グラフの設定</a></li>
</ul></li>
<li class="chapter" data-level="5.23" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#地図ファセット"><i class="fa fa-check"></i><b>5.23</b> 地図ファセット</a></li>
<li class="chapter" data-level="5.24" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#その他設定保存"><i class="fa fa-check"></i><b>5.24</b> その他設定・保存</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#タイトルキャプション"><i class="fa fa-check"></i>タイトル・キャプション</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#パネル目盛線"><i class="fa fa-check"></i>パネル目盛線</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#凡例"><i class="fa fa-check"></i>凡例</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#フォントマージン設定"><i class="fa fa-check"></i>フォント・マージン設定</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#保存"><i class="fa fa-check"></i>保存</a></li>
</ul></li>
<li class="chapter" data-level="5.25" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#実例"><i class="fa fa-check"></i><b>5.25</b> 実例</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#実例1世界の新型コロナ死亡率の箱ひげ図"><i class="fa fa-check"></i>実例1：世界の新型コロナ死亡率の箱ひげ図</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="探索的データ分析.html"><a href="探索的データ分析.html"><i class="fa fa-check"></i><b>6</b> 探索的データ分析</a>
<ul>
<li class="chapter" data-level="6.1" data-path="探索的データ分析.html"><a href="探索的データ分析.html#第6章の準備"><i class="fa fa-check"></i><b>6.1</b> 第6章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#パッケージのインポート-3"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#ggplot2の設定-1"><i class="fa fa-check"></i>ggplot2の設定</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="探索的データ分析.html"><a href="探索的データ分析.html#データの中身記述統計量"><i class="fa fa-check"></i><b>6.2</b> データの中身（記述統計量）</a></li>
<li class="chapter" data-level="6.3" data-path="探索的データ分析.html"><a href="探索的データ分析.html#データの分布"><i class="fa fa-check"></i><b>6.3</b> データの分布</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#離散型変数の度数分布"><i class="fa fa-check"></i>離散型変数の度数分布</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#連続型変数の度数分布"><i class="fa fa-check"></i>連続型変数の度数分布</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#外れ値"><i class="fa fa-check"></i>外れ値</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="探索的データ分析.html"><a href="探索的データ分析.html#データの関係性"><i class="fa fa-check"></i><b>6.4</b> データの関係性</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#離散型変数の関係性"><i class="fa fa-check"></i>離散型変数の関係性</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#連続型変数の関係性"><i class="fa fa-check"></i>連続型変数の関係性</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="探索的データ分析.html"><a href="探索的データ分析.html#相関関係ペアプロット"><i class="fa fa-check"></i><b>6.5</b> 相関関係・ペアプロット</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#相関係数行列"><i class="fa fa-check"></i>相関係数行列</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#corrplotパッケージ"><i class="fa fa-check"></i>corrplotパッケージ</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#corrrパッケージ"><i class="fa fa-check"></i>corrrパッケージ</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#ggallyパッケージ"><i class="fa fa-check"></i>GGallyパッケージ</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="探索的データ分析.html"><a href="探索的データ分析.html#探索的データ分析の一括実行"><i class="fa fa-check"></i><b>6.6</b> 探索的データ分析の一括実行</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#dataexplorerパッケージ"><i class="fa fa-check"></i>DataExplorerパッケージ</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#smartedaパッケージ"><i class="fa fa-check"></i>SmartEDAパッケージ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="線形回帰.html"><a href="線形回帰.html"><i class="fa fa-check"></i><b>7</b> 線形回帰</a>
<ul>
<li class="chapter" data-level="7.1" data-path="線形回帰.html"><a href="線形回帰.html#第7章の準備"><i class="fa fa-check"></i><b>7.1</b> 第7章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#パッケージのインポート-4"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#外部データセットの取得-3"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="線形回帰.html"><a href="線形回帰.html#用語の説明"><i class="fa fa-check"></i><b>7.2</b> 用語の説明</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#標本と推定"><i class="fa fa-check"></i>標本と推定</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#推定量の望ましい性質"><i class="fa fa-check"></i>推定量の望ましい性質</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="線形回帰.html"><a href="線形回帰.html#最小2乗法ols"><i class="fa fa-check"></i><b>7.3</b> 最小2乗法（OLS）</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#最小2乗法の仮定"><i class="fa fa-check"></i>最小2乗法の仮定</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#検定と信頼区間"><i class="fa fa-check"></i>検定と信頼区間</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="線形回帰.html"><a href="線形回帰.html#モデルの種類と係数の解釈"><i class="fa fa-check"></i><b>7.4</b> モデルの種類と係数の解釈</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#水準モデル"><i class="fa fa-check"></i>水準モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#対数モデル"><i class="fa fa-check"></i>対数モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#変化率モデル"><i class="fa fa-check"></i>変化率モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#多項式モデル"><i class="fa fa-check"></i>多項式モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#交互作用モデル"><i class="fa fa-check"></i>交互作用モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#ダミー変数"><i class="fa fa-check"></i>ダミー変数</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="線形回帰.html"><a href="線形回帰.html#単回帰モデル"><i class="fa fa-check"></i><b>7.5</b> 単回帰モデル</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実証例4.1-線形単回帰"><i class="fa fa-check"></i>実証例4.1 線形単回帰</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#対数変化率モデルの推定"><i class="fa fa-check"></i>対数・変化率モデルの推定</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#重回帰モデル"><i class="fa fa-check"></i>重回帰モデル</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#欠落変数バイアス"><i class="fa fa-check"></i>欠落変数バイアス</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#多重共線性"><i class="fa fa-check"></i>多重共線性</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#変数選択の指針"><i class="fa fa-check"></i>変数選択の指針</a></li>
<li class="chapter" data-level="7.5.1" data-path="線形回帰.html"><a href="線形回帰.html#実証例5.15.4-線形重回帰"><i class="fa fa-check"></i><b>7.5.1</b> 実証例5.1・5.4 線形重回帰</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実証例5.5-多項式モデル"><i class="fa fa-check"></i>実証例5.5 多項式モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実証例5.6-ダミー交互作用モデル"><i class="fa fa-check"></i>実証例5.6 ダミー・交互作用モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実証例5.7-ダミー交互作用モデル"><i class="fa fa-check"></i>実証例5.7 ダミー・交互作用モデル</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">エコノミストのためのR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="時系列データ操作" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> 時系列データ操作<a href="時系列データ操作.html#時系列データ操作" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>第4章「時系列データ操作」では、時系列データに特有のデータ操作方法について解説します。時系列データ特有の操作とは、変化率やラグなどのデータ変換、日次・月次などの頻度変換、季節調整、トレンド推定などです。</p>
<p>Rで時系列データを扱う方法には、主に次の2つがあります。</p>
<p>まず、第3章で使用した<strong>tibble形式</strong>です。tibble形式は複数の列を含むデータフレームの形状をしており、データそのものを格納する列と、日付型データを格納する列を組み合わせることで、時系列データを扱うことができます。</p>
<p>もう一つは<strong>ts型</strong>です。ts型はデータと日付があらかじめセットになった一次元のデータ構造で、季節調整を行う<code>seasonal</code>パッケージなどで使用されます。</p>
<div id="第4章の準備" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> 第4章の準備<a href="時系列データ操作.html#第4章の準備" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="パッケージのインポート-1" class="section level3 unnumbered hasAnchor">
<h3>パッケージのインポート<a href="時系列データ操作.html#パッケージのインポート-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="時系列データ操作.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb336-2"><a href="時系列データ操作.html#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb336-3"><a href="時系列データ操作.html#cb336-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pbapply)</span>
<span id="cb336-4"><a href="時系列データ操作.html#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seasonal)</span>
<span id="cb336-5"><a href="時系列データ操作.html#cb336-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seasonalview)</span>
<span id="cb336-6"><a href="時系列データ操作.html#cb336-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb336-7"><a href="時系列データ操作.html#cb336-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb336-8"><a href="時系列データ操作.html#cb336-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code></pre></div>
</div>
<div id="外部データセットの取得-1" class="section level3 unnumbered hasAnchor">
<h3>外部データセットの取得<a href="時系列データ操作.html#外部データセットの取得-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>この章では、外部データセットとして以下のデータを使用します。第1章のコードを使用してあらかじめウェブからデータセットを取得してください。</p>
<ul>
<li>OWIDのCOVID-19データセット：　<code>data_owid</code></li>
<li>日本の産業別就業者数：　<code>data_labor</code></li>
</ul>
</div>
</div>
<div id="データ変換" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> データ変換<a href="時系列データ操作.html#データ変換" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、時系列データのラグ・リード系列、変化率、移動平均を計算する方法を解説します。</p>
<p>まず、Our World in Dataの<code>data_owid</code>データセットから使用するサンプルデータを作成します。</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="時系列データ操作.html#cb337-1" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb337-2"><a href="時系列データ操作.html#cb337-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(location, date, new_cases, new_deaths) <span class="sc">%&gt;%</span> </span>
<span id="cb337-3"><a href="時系列データ操作.html#cb337-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>,</span>
<span id="cb337-4"><a href="時系列データ操作.html#cb337-4" aria-hidden="true" tabindex="-1"></a>                date <span class="sc">&gt;=</span> <span class="st">&quot;2022-01-01&quot;</span>)</span></code></pre></div>
<div id="ラグリード系列の作成" class="section level3 unnumbered hasAnchor">
<h3>ラグ・リード系列の作成<a href="時系列データ操作.html#ラグリード系列の作成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>dplyr::lag()</code>関数と<code>dplyr::leag()</code>関数で、既存の列のラグ・リード系列を作成します。</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="時系列データ操作.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1期ラグの系列を追加</span></span>
<span id="cb338-2"><a href="時系列データ操作.html#cb338-2" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="sc">%&gt;%</span> </span>
<span id="cb338-3"><a href="時系列データ操作.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">new_cases_lag =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(new_cases, <span class="at">n =</span> <span class="dv">1</span>)) </span></code></pre></div>
<pre><code>## # A tibble: 176 x 5
##    location date       new_cases new_deaths new_cases_lag
##    &lt;chr&gt;    &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
##  1 Japan    2022-01-01       456          0            NA
##  2 Japan    2022-01-02       477          2           456
##  3 Japan    2022-01-03       672          1           477
##  4 Japan    2022-01-04      1149          1           672
##  5 Japan    2022-01-05      2490          1          1149
##  6 Japan    2022-01-06      4297          1          2490
##  7 Japan    2022-01-07      6070          1          4297
##  8 Japan    2022-01-08      8302          2          6070
##  9 Japan    2022-01-09      8071          1          8302
## 10 Japan    2022-01-10      6265          2          8071
## # ... with 166 more rows</code></pre>
</div>
<div id="変化率系列の作成" class="section level3 unnumbered hasAnchor">
<h3>変化率系列の作成<a href="時系列データ操作.html#変化率系列の作成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>dplyr::lag()</code>関数で、既存の列の変化率系列を作成します。</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="時系列データ操作.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 前期比変化率（％表示）の系列を追加</span></span>
<span id="cb340-2"><a href="時系列データ操作.html#cb340-2" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="sc">%&gt;%</span> </span>
<span id="cb340-3"><a href="時系列データ操作.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">new_cases_chg =</span> <span class="dv">100</span> <span class="sc">*</span> (new_cases <span class="sc">/</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(new_cases, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>)) </span></code></pre></div>
<pre><code>## # A tibble: 176 x 5
##    location date       new_cases new_deaths new_cases_chg
##    &lt;chr&gt;    &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
##  1 Japan    2022-01-01       456          0         NA   
##  2 Japan    2022-01-02       477          2          4.61
##  3 Japan    2022-01-03       672          1         40.9 
##  4 Japan    2022-01-04      1149          1         71.0 
##  5 Japan    2022-01-05      2490          1        117.  
##  6 Japan    2022-01-06      4297          1         72.6 
##  7 Japan    2022-01-07      6070          1         41.3 
##  8 Japan    2022-01-08      8302          2         36.8 
##  9 Japan    2022-01-09      8071          1         -2.78
## 10 Japan    2022-01-10      6265          2        -22.4 
## # ... with 166 more rows</code></pre>
</div>
<div id="移動平均系列の作成" class="section level3 unnumbered hasAnchor">
<h3>移動平均系列の作成<a href="時系列データ操作.html#移動平均系列の作成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>zoo</code>パッケージの<code>rollmean()</code>関数で、移動平均系列を作成します。</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="時系列データ操作.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 後方7日移動平均の系列を追加</span></span>
<span id="cb342-2"><a href="時系列データ操作.html#cb342-2" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="sc">%&gt;%</span> </span>
<span id="cb342-3"><a href="時系列データ操作.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">new_cases_7dma =</span> zoo<span class="sc">::</span><span class="fu">rollmean</span>(new_cases, <span class="co"># 移動平均を作成するもとの系列名</span></span>
<span id="cb342-4"><a href="時系列データ操作.html#cb342-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">k =</span> <span class="dv">7</span>, <span class="co"># 移動平均の期間</span></span>
<span id="cb342-5"><a href="時系列データ操作.html#cb342-5" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">na.pad =</span> <span class="cn">TRUE</span>, <span class="co"># 系列の先端部分で移動平均を計算できない箇所をNAで埋めるか</span></span>
<span id="cb342-6"><a href="時系列データ操作.html#cb342-6" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">align =</span> <span class="st">&quot;right&quot;</span>)) <span class="co"># left：前方移動平均、center：中央移動平均、right：後方移動平均</span></span></code></pre></div>
<pre><code>## # A tibble: 176 x 5
##    location date       new_cases new_deaths new_cases_7dma
##    &lt;chr&gt;    &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;
##  1 Japan    2022-01-01       456          0            NA 
##  2 Japan    2022-01-02       477          2            NA 
##  3 Japan    2022-01-03       672          1            NA 
##  4 Japan    2022-01-04      1149          1            NA 
##  5 Japan    2022-01-05      2490          1            NA 
##  6 Japan    2022-01-06      4297          1            NA 
##  7 Japan    2022-01-07      6070          1          2230.
##  8 Japan    2022-01-08      8302          2          3351 
##  9 Japan    2022-01-09      8071          1          4436.
## 10 Japan    2022-01-10      6265          2          5235.
## # ... with 166 more rows</code></pre>
</div>
</div>
<div id="時系列データの頻度変換" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> 時系列データの頻度変換<a href="時系列データ操作.html#時系列データの頻度変換" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>tidyverse</code>と整合性がある金融時系列データ分析用の<code>tidyquant</code>パッケージに含まれる<code>tq_transmute()</code>関数を用いて、時系列データの頻度変換（高頻度データから低頻度データへの変換）を行います。</p>
<p>なお、<code>tidyquant</code>は頻度変換以外にも様々な分析機能があります。詳しくは<a href="https://business-science.github.io/tidyquant/">公式ウェブサイト</a>を参照してください。</p>
<p>まず、Our World in Dataの<code>data_owid</code>データセットから、使用するサンプルデータを作成します。<code>tq_transmute()</code>関数に入力する時系列データは、原則として横型データである点に留意してください。</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="時系列データ操作.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># サンプルデータ（日次）</span></span>
<span id="cb344-2"><a href="時系列データ操作.html#cb344-2" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb344-3"><a href="時系列データ操作.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(location, date, new_cases) <span class="sc">%&gt;%</span> </span>
<span id="cb344-4"><a href="時系列データ操作.html#cb344-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="st">&quot;2021-01-01&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb344-5"><a href="時系列データ操作.html#cb344-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb344-6"><a href="時系列データ操作.html#cb344-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">&quot;date&quot;</span>, <span class="at">names_from =</span> <span class="st">&quot;location&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;new_cases&quot;</span>)</span></code></pre></div>
<div id="日次データを週次データに変換" class="section level3 unnumbered hasAnchor">
<h3>日次データを週次データに変換<a href="時系列データ操作.html#日次データを週次データに変換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>tidyquant::tq_transmute()</code>関数を使用して日次データを週次データに変換すると、月曜～日曜のデータが<code>FUN</code>に指定した関数で集計され、日曜の日付で記録されます。</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="時系列データ操作.html#cb345-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span> </span>
<span id="cb345-2"><a href="時系列データ操作.html#cb345-2" aria-hidden="true" tabindex="-1"></a>  tidyquant<span class="sc">::</span><span class="fu">tq_transmute</span>(<span class="at">select =</span> <span class="sc">-</span>date, <span class="at">mutate_fun =</span> apply.weekly, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 78 x 245
##    date       Afghanistan Africa Albania Algeria Andorra Angola Anguilla
##    &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 2021-01-03       126.  24211.    374     266     47.7   29.7    0.667
##  2 2021-01-10       111.  31857.    594.    248     56.3   78.7    0    
##  3 2021-01-17        70.7 29727.    585     241.    71     97.4    0    
##  4 2021-01-24        87.3 25102.    655.    252.    66.6   74.9    0    
##  5 2021-01-31        61.1 18531.    836.    249     55.4   56.7    0.143
##  6 2021-02-07        44.6 14379.   1030.    250.    44.9   41.4    0.143
##  7 2021-02-14        22.4 11848.   1106.    232.    36     40      0.143
##  8 2021-02-21        16   10877.   1024.    172.    28     21.9    0    
##  9 2021-02-28        15.7  9707.    989.    168.    23.9   41.1    0    
## 10 2021-03-07        19    9535.    819.    163.    25.1   39.9    0    
## # ... with 68 more rows, and 237 more variables: `Antigua and Barbuda` &lt;dbl&gt;,
## #   Argentina &lt;dbl&gt;, Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;,
## #   Austria &lt;dbl&gt;, Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;,
## #   Bangladesh &lt;dbl&gt;, Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;,
## #   Belize &lt;dbl&gt;, Benin &lt;dbl&gt;, Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, ...</code></pre>
<p>なお、日曜～土曜のデータを集計し日曜の日付で記録したい場合は、<code>rollmean()</code>関数を使用して前方7日移動平均を計算し、日曜の値を抽出します。</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="時系列データ操作.html#cb347-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span></span>
<span id="cb347-2"><a href="時系列データ操作.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>date, rollmean, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">na.pad =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">&quot;left&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb347-3"><a href="時系列データ操作.html#cb347-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">wday</span>(date) <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 77 x 245
##    date       Afghanistan Africa Albania Algeria Andorra Angola Anguilla
##    &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 2021-01-03       116.  30479     577.    251.    60     78.3    0.286
##  2 2021-01-10        76.9 30443.    598.    243.    64.6   87      0    
##  3 2021-01-17        88.7 26023.    604.    251.    65.9   86      0    
##  4 2021-01-24        64.1 19162.    830     250.    55.1   59.3    0.143
##  5 2021-01-31        46   14925.    994.    215.    45.9   40      0.143
##  6 2021-02-07        20.4 12066.   1111.    269.    36.7   38.1    0.143
##  7 2021-02-14        15.3 11007.   1011.    179.    29.9   24.3    0    
##  8 2021-02-21        18.1  9721.   1022.    171.    25.3   40.4    0    
##  9 2021-02-28        19    9670.    838.    163.    24.3   39      0    
## 10 2021-03-07        17   10201.    678.    148.    29.9   38.3    0.429
## # ... with 67 more rows, and 237 more variables: `Antigua and Barbuda` &lt;dbl&gt;,
## #   Argentina &lt;dbl&gt;, Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;,
## #   Austria &lt;dbl&gt;, Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;,
## #   Bangladesh &lt;dbl&gt;, Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;,
## #   Belize &lt;dbl&gt;, Benin &lt;dbl&gt;, Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, ...</code></pre>
</div>
<div id="日次データを月次データに変換" class="section level3 unnumbered hasAnchor">
<h3>日次データを月次データに変換<a href="時系列データ操作.html#日次データを月次データに変換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>tidyquant::tq_transmute()</code>関数を使用して日次データを月次データに変換すると、月初～月末のデータが<code>FUN</code>に指定した関数で集計され、月末の日付で記録されます。</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="時系列データ操作.html#cb349-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span> </span>
<span id="cb349-2"><a href="時系列データ操作.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  tidyquant<span class="sc">::</span><span class="fu">tq_transmute</span>(<span class="at">select =</span> <span class="sc">-</span>date, <span class="at">mutate_fun =</span> apply.monthly, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18 x 245
##    date       Afghanistan Africa Albania Algeria Andorra Angola Anguilla
##    &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 2021-01-31        86.9 26102.  639.    249.     60.9   72.4    0.0968
##  2 2021-02-28        24.7 11703. 1037.    205.     33.2   36.1    0.0714
##  3 2021-03-31        23.9 10321.  580.    132.     36.9   48.5    0.226 
##  4 2021-04-30       110.  11347.  198.    164.     40.7  145.     2.27  
##  5 2021-05-31       390.   9119.   39.7   220.     16.0  255.     0.516 
##  6 2021-06-30      1561.  22139.    6.87  357.      6.13 143.     0     
##  7 2021-07-31       919.  38865.   18.1  1025.     24.7  127.     0.129 
##  8 2021-08-31       196.  34873.  429.    796.     11.5  154.     3.35  
##  9 2021-09-30        65.1 17350.  791.    243.      6.3  301.     6.4   
## 10 2021-10-31        34.7  6251.  489.     99.8     9.48 253.    17.3   
## 11 2021-11-30        34.6  5468.  488.    136.     53.3   24.5   14.7   
## 12 2021-12-31        25.6 34489.  332.    255.    214.   530.     9.29  
## 13 2022-01-31       162.  36481. 1559.   1087.    394.   533     21.0   
## 14 2022-02-28       383.  15932.  465     458.     72.9   22.3    8.25  
## 15 2022-03-31       132.   7282.   68.2    23.7    65.3   13.8    4.68  
## 16 2022-04-30        37.7  3801.   47.7     3.63   44.2    3.93   2.93  
## 17 2022-05-31        47.4  6860.   32.1     3.35   49.8   15.3   13.4   
## 18 2022-06-25        69    5549.  108.      5.84   40      0      8.32  
## # ... with 237 more variables: `Antigua and Barbuda` &lt;dbl&gt;, Argentina &lt;dbl&gt;,
## #   Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;, Austria &lt;dbl&gt;,
## #   Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;, Bangladesh &lt;dbl&gt;,
## #   Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;, Belize &lt;dbl&gt;, Benin &lt;dbl&gt;,
## #   Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, ...</code></pre>
</div>
<div id="日次データを四半期データに変換" class="section level3 unnumbered hasAnchor">
<h3>日次データを四半期データに変換<a href="時系列データ操作.html#日次データを四半期データに変換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>tidyquant::tq_transmute()</code>関数を使用して日次データを四半期データに変換すると、期初～期末のデータが<code>FUN</code>に指定した関数で集計され、期末の日付で記録されます。</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="時系列データ操作.html#cb351-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span> </span>
<span id="cb351-2"><a href="時系列データ操作.html#cb351-2" aria-hidden="true" tabindex="-1"></a>  tidyquant<span class="sc">::</span><span class="fu">tq_transmute</span>(<span class="at">select =</span> <span class="sc">-</span>date, <span class="at">mutate_fun =</span> apply.quarterly, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 245
##   date       Afghanistan Africa Albania Algeria Andorra Angola Anguilla
##   &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
## 1 2021-03-31        45.8 16187.   743.   195.      44.0  52.9     0.133
## 2 2021-06-30       684.  14146.    80.9  247.      20.9 182.      0.923
## 3 2021-09-30       397.  30504.   409.   693.      14.2 193.      3.26 
## 4 2021-12-31        31.6 15510.   436.   164.      92.6 272.     13.8  
## 5 2022-03-31       221   20031.   705.   525.     181.  195.     11.4  
## 6 2022-06-25        50.3  5411.    59.5    4.17    45.2   6.88    8.27 
## # ... with 237 more variables: `Antigua and Barbuda` &lt;dbl&gt;, Argentina &lt;dbl&gt;,
## #   Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;, Austria &lt;dbl&gt;,
## #   Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;, Bangladesh &lt;dbl&gt;,
## #   Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;, Belize &lt;dbl&gt;, Benin &lt;dbl&gt;,
## #   Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, ...</code></pre>
</div>
</div>
<div id="季節調整x-13" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> 季節調整（X-13）<a href="時系列データ操作.html#季節調整x-13" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、<code>seasonal</code>パッケージを用いた時系列データへの季節調整方法について解説します。</p>
<p><code>seasonal</code>パッケージでは、米国商務省センサス局が開発したX-13ARIMA-SEATSを用いて、ts型の月次データ、四半期データ、半期データに対し季節調整を適用することができます。</p>
<p><code>seasonal</code>パッケージや、X-13ARIMA-SEATSの詳細については、Sax &amp; Eddelbuettel（2018）や、奥本（2016）を参照してください。</p>
<p>サンプルデータとして、ts型データである<code>seasonal::unemp</code>データセットを用い、<code>seasonal</code>パッケージの使用方法を確認します。</p>
<div id="ts型データの可視化" class="section level3 unnumbered hasAnchor">
<h3>ts型データの可視化<a href="時系列データ操作.html#ts型データの可視化" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>季節調整の前に、データを確認します。ts型データは<code>plot()</code>関数でグラフを作成できます。</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="時系列データ操作.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(seasonal<span class="sc">::</span>unemp)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
</div>
<div id="x-13arima-seatsの実施方法" class="section level3 unnumbered hasAnchor">
<h3>X-13ARIMA-SEATSの実施方法<a href="時系列データ操作.html#x-13arima-seatsの実施方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>seasonal</code>パッケージでは、<code>seas()</code>関数を使用してts型データにX-13ARIMA-SEATSを適用します。<code>seas()</code>関数は、季節調整の結果を格納したseas型のオブジェクトを返します。</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="時系列データ操作.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seas()関数で季節調整を実行</span></span>
<span id="cb354-2"><a href="時系列データ操作.html#cb354-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> seasonal<span class="sc">::</span><span class="fu">seas</span>(<span class="at">x =</span> seasonal<span class="sc">::</span>unemp)</span>
<span id="cb354-3"><a href="時系列データ操作.html#cb354-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-4"><a href="時系列データ操作.html#cb354-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整の結果を出力</span></span>
<span id="cb354-5"><a href="時系列データ操作.html#cb354-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<pre><code>## 
## Call:
## seasonal::seas(x = seasonal::unemp)
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## AR-Nonseasonal-01  0.94360    0.03441   27.43   &lt;2e-16 ***
## MA-Nonseasonal-01  0.82540    0.05654   14.60   &lt;2e-16 ***
## MA-Seasonal-12     0.85071    0.03362   25.30   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## SEATS adj.  ARIMA: (1 1 1)(0 1 1)  Obs.: 323  Transform: none
## AICc:  4324, BIC:  4339  QS (no seasonality in final):    0  
## Box-Ljung (no autocorr.): 22.04   Shapiro (normality): 0.9946</code></pre>
<p><code>plot()</code>関数で、原数値と季節調整値のグラフを作成できます。黒色の線が原数値、赤色の線が季節調整値です。外れ値がある場合はグラフ中に外れ値が表示されます。</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="時系列データ操作.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<p>季節調整値を出力するには、<code>seasonal::final()</code>関数を使用します。</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="時系列データ操作.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整値をunemp_saに格納</span></span>
<span id="cb357-2"><a href="時系列データ操作.html#cb357-2" aria-hidden="true" tabindex="-1"></a>unemp_sa <span class="ot">&lt;-</span> seasonal<span class="sc">::</span><span class="fu">final</span>(m)</span>
<span id="cb357-3"><a href="時系列データ操作.html#cb357-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-4"><a href="時系列データ操作.html#cb357-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unemp_saの折れ線グラフを作成</span></span>
<span id="cb357-5"><a href="時系列データ操作.html#cb357-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(unemp_sa, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>
<p><code>monthplot()</code>関数を使用すると、季節変動（Seasonal component）と不規則変動（Seasonal irregular component）を月別に確認することができます。</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="時系列データ操作.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">monthplot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>
</div>
<div id="実例月次データの季節調整" class="section level3 unnumbered hasAnchor">
<h3>実例：月次データの季節調整<a href="時系列データ操作.html#実例月次データの季節調整" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここでは、日本の産業別就業者数データセット<code>data_labor</code>に対し、月次の季節調整を適用します。<code>data_labor</code>はtibble形式のデータフレームの中に、日付型の列と、複数の数値型のデータの列を格納したものです。</p>
<ol style="list-style-type: decimal">
<li>tibble形式のデータフレームに格納されている数値型データをts型データに変換する</li>
<li>tibble形式のデータフレームをリスト形式に変換する</li>
<li><code>pblapply()</code>で一括して<code>seas()</code>関数の季節調整を適用する。季節調整エラーは<code>try()</code>関数で処理する</li>
<li>季節調整エラーを取得する</li>
<li>季節調整値を取得する</li>
<li>エラーが生じた系列は原数値を取得する</li>
</ol>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="時系列データ操作.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_laborから一部を抽出</span></span>
<span id="cb359-2"><a href="時系列データ操作.html#cb359-2" aria-hidden="true" tabindex="-1"></a>data_labor_nsa <span class="ot">&lt;-</span> data_labor <span class="sc">%&gt;%</span> </span>
<span id="cb359-3"><a href="時系列データ操作.html#cb359-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date, <span class="st">`</span><span class="at">総数</span><span class="st">`</span>, <span class="st">`</span><span class="at">製造</span><span class="st">`</span>, <span class="st">`</span><span class="at">情報通信</span><span class="st">`</span>)</span>
<span id="cb359-4"><a href="時系列データ操作.html#cb359-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-5"><a href="時系列データ操作.html#cb359-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 数値型データをts型データに変換</span></span>
<span id="cb359-6"><a href="時系列データ操作.html#cb359-6" aria-hidden="true" tabindex="-1"></a>data_labor_ts <span class="ot">&lt;-</span> data_labor_nsa <span class="sc">%&gt;%</span> </span>
<span id="cb359-7"><a href="時系列データ操作.html#cb359-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span> </span>
<span id="cb359-8"><a href="時系列データ操作.html#cb359-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">12</span>, <span class="co"># 月次データの場合は12を指定</span></span>
<span id="cb359-9"><a href="時系列データ操作.html#cb359-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">c</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(data_labor<span class="sc">$</span>date[<span class="dv">1</span>]), lubridate<span class="sc">::</span><span class="fu">month</span>(data_labor<span class="sc">$</span>date[<span class="dv">1</span>]))) <span class="co"># データ開始年月を指定</span></span>
<span id="cb359-10"><a href="時系列データ操作.html#cb359-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-11"><a href="時系列データ操作.html#cb359-11" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble形式をリスト形式に変換</span></span>
<span id="cb359-12"><a href="時系列データ操作.html#cb359-12" aria-hidden="true" tabindex="-1"></a>data_labor_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb359-13"><a href="時系列データ操作.html#cb359-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb359-14"><a href="時系列データ操作.html#cb359-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-15"><a href="時系列データ操作.html#cb359-15" aria-hidden="true" tabindex="-1"></a><span class="co"># pblapply()関数で一括してseas()関数の季節調整を適用</span></span>
<span id="cb359-16"><a href="時系列データ操作.html#cb359-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整でエラーが発生する可能性があるため、try()関数でエラー処理を行う</span></span>
<span id="cb359-17"><a href="時系列データ操作.html#cb359-17" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">pblapply</span>(data_labor_ts,</span>
<span id="cb359-18"><a href="時系列データ操作.html#cb359-18" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(e) <span class="fu">try</span>(<span class="fu">suppressMessages</span>(<span class="fu">seas</span>(e, <span class="at">transform.function =</span> <span class="st">&quot;auto&quot;</span>)),</span>
<span id="cb359-19"><a href="時系列データ操作.html#cb359-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">silent =</span> <span class="cn">TRUE</span>))</span>
<span id="cb359-20"><a href="時系列データ操作.html#cb359-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-21"><a href="時系列データ操作.html#cb359-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整エラーを取得</span></span>
<span id="cb359-22"><a href="時系列データ操作.html#cb359-22" aria-hidden="true" tabindex="-1"></a>result_iserror <span class="ot">&lt;-</span> <span class="fu">sapply</span>(result, class) <span class="sc">==</span> <span class="st">&quot;try-error&quot;</span></span>
<span id="cb359-23"><a href="時系列データ操作.html#cb359-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-24"><a href="時系列データ操作.html#cb359-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整値を取得し、tibble形式データフレームのdata_labor_saに格納</span></span>
<span id="cb359-25"><a href="時系列データ操作.html#cb359-25" aria-hidden="true" tabindex="-1"></a>data_labor_sa <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, <span class="fu">lapply</span>(result[<span class="sc">!</span>result_iserror], final)) <span class="sc">%&gt;%</span> </span>
<span id="cb359-26"><a href="時系列データ操作.html#cb359-26" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb359-27"><a href="時系列データ操作.html#cb359-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(data_labor[, <span class="dv">1</span>], .)</span>
<span id="cb359-28"><a href="時系列データ操作.html#cb359-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-29"><a href="時系列データ操作.html#cb359-29" aria-hidden="true" tabindex="-1"></a><span class="co"># エラーが生じた系列は原数値を取得してdata_labor_saに追加</span></span>
<span id="cb359-30"><a href="時系列データ操作.html#cb359-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">which</span>(result_iserror)) {</span>
<span id="cb359-31"><a href="時系列データ操作.html#cb359-31" aria-hidden="true" tabindex="-1"></a>  data_labor_sa <span class="ot">&lt;-</span> data_labor[, <span class="fu">names</span>(result[col])] <span class="sc">%&gt;%</span> </span>
<span id="cb359-32"><a href="時系列データ操作.html#cb359-32" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(data_labor_sa)</span>
<span id="cb359-33"><a href="時系列データ操作.html#cb359-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb359-34"><a href="時系列データ操作.html#cb359-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-35"><a href="時系列データ操作.html#cb359-35" aria-hidden="true" tabindex="-1"></a><span class="co"># data_labor_saの列をdata_labor_nsaの列順で並べ替え</span></span>
<span id="cb359-36"><a href="時系列データ操作.html#cb359-36" aria-hidden="true" tabindex="-1"></a>data_labor_sa <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb359-37"><a href="時系列データ操作.html#cb359-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">names</span>(data_labor_nsa)))</span></code></pre></div>
<p>個別系列の季節調整結果を可視化するには、<code>plot()</code>関数を使用します。一部の系列は季節性がないと判断されるため、季節調整が行われていません。</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="時系列データ操作.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result[[<span class="fu">which</span>(<span class="fu">names</span>(result) <span class="sc">==</span> <span class="st">&quot;総数&quot;</span>)]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-130-1.png" width="672" /></p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="時系列データ操作.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result[[<span class="fu">which</span>(<span class="fu">names</span>(result) <span class="sc">==</span> <span class="st">&quot;製造&quot;</span>)]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-130-2.png" width="672" /></p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="時系列データ操作.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result[[<span class="fu">which</span>(<span class="fu">names</span>(result) <span class="sc">==</span> <span class="st">&quot;情報通信&quot;</span>)]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-130-3.png" width="672" /></p>
</div>
</div>
<div id="季節調整stl分解" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> 季節調整（STL分解）<a href="時系列データ操作.html#季節調整stl分解" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>上で紹介したX-13ARIMA-SEATSは、月次データ、四半期データ、半期データに適用できますが、週次データや日次データには適用できません。そこで、週次データや日次データの季節調整を行うために<code>stats</code>パッケージの<code>stl()</code>関数による<strong>STL分解</strong>を使用します。</p>
<p>STL分解とは、Seasonal Decomposition of Time Series by Loessの略で、時系列データを季節変動、トレンド変動、不規則変動に分解する手法です。</p>
<div id="stl分解の実施方法" class="section level3 unnumbered hasAnchor">
<h3>STL分解の実施方法<a href="時系列データ操作.html#stl分解の実施方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>STL分解を行うには、ts型の時系列データに対し、<code>stats</code>パッケージの<code>stl()</code>関数を適用します。<code>stl()</code>関数はSTL分解の結果を格納したstl型のオブジェクトを返します。</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="時系列データ操作.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stl()関数でSTL分解を実行</span></span>
<span id="cb363-2"><a href="時系列データ操作.html#cb363-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">stl</span>(<span class="at">x =</span> seasonal<span class="sc">::</span>unemp,</span>
<span id="cb363-3"><a href="時系列データ操作.html#cb363-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>)</span>
<span id="cb363-4"><a href="時系列データ操作.html#cb363-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-5"><a href="時系列データ操作.html#cb363-5" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb363-6"><a href="時系列データ操作.html#cb363-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-131-1.png" width="672" /></p>
<p>季節調整値を出力するには、<code>stl()</code>関数が返すstl型オブジェクトに格納されている<code>time.series</code>にアクセスします。<code>time.series</code>には、季節変動（<code>seasonal</code>）、トレンド変動（<code>trend</code>）、不規則変動（<code>remainder</code>）の順番にデータが格納されています。</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="時系列データ操作.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整値（トレンド）をunemp_saに格納</span></span>
<span id="cb364-2"><a href="時系列データ操作.html#cb364-2" aria-hidden="true" tabindex="-1"></a>unemp_sa <span class="ot">&lt;-</span> m<span class="sc">$</span>time.series[, <span class="st">&quot;trend&quot;</span>]</span>
<span id="cb364-3"><a href="時系列データ操作.html#cb364-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-4"><a href="時系列データ操作.html#cb364-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unemp_saの折れ線グラフを作成</span></span>
<span id="cb364-5"><a href="時系列データ操作.html#cb364-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(unemp_sa, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
</div>
<div id="週次データのstl分解" class="section level3 unnumbered hasAnchor">
<h3>週次データのSTL分解<a href="時系列データ操作.html#週次データのstl分解" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>STL分解は、<code>seasonal::unemp</code>のような月次データだけでなく、より高頻度なデータにも適用できるのが特徴です。</p>
<p>ここでは、週次データである<code>fpp2::gasoline</code>データセットに対し、STL分解を適用します。週次データは<code>ts()</code>関数における<code>frequency</code>引数が52.18となっています。これは、うるう年を考慮した1年の平均日数365.25日を7で割った値であり、週次データは一周期が52.18週であることを示しています。</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="時系列データ操作.html#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb365-2"><a href="時系列データ操作.html#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<pre><code>## Time Series:
## Start = 1991.1 
## End = 1991.19582477755 
## Frequency = 52.1785714285714 
## [1] 6.621 6.433 6.582 7.224 6.875 6.947</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="時系列データ操作.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの可視化</span></span>
<span id="cb367-2"><a href="時系列データ操作.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="時系列データ操作.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stl()関数でSTL分解を実行</span></span>
<span id="cb368-2"><a href="時系列データ操作.html#cb368-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">stl</span>(<span class="at">x =</span> fpp2<span class="sc">::</span>gasoline,</span>
<span id="cb368-3"><a href="時系列データ操作.html#cb368-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>)</span>
<span id="cb368-4"><a href="時系列データ操作.html#cb368-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-5"><a href="時系列データ操作.html#cb368-5" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb368-6"><a href="時系列データ操作.html#cb368-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-135-1.png" width="672" /></p>
</div>
<div id="日次データのstl分解単一周期" class="section level3 unnumbered hasAnchor">
<h3>日次データのSTL分解（単一周期）<a href="時系列データ操作.html#日次データのstl分解単一周期" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>さらに、STL分解は日次データにも適用可能です。日次データの周期性は通常、週、月、年の3種類あると考えられます。ただし、ts型では一種類の周期性しか指定できないため、ここでは週を一周期に設定し、<code>ts()</code>関数の<code>frequency</code>引数に7を指定して、STL分解を行います。</p>
<p>使用するデータは、Our World in Dataの<code>data_owid</code>データセットにおける、日本の新規感染者数です。</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="時系列データ操作.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_owidから日本の新規感染者数（日次）を抽出</span></span>
<span id="cb369-2"><a href="時系列データ操作.html#cb369-2" aria-hidden="true" tabindex="-1"></a>data_cases_jp <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb369-3"><a href="時系列データ操作.html#cb369-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb369-4"><a href="時系列データ操作.html#cb369-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>(new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb369-5"><a href="時系列データ操作.html#cb369-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(new_cases)</span>
<span id="cb369-6"><a href="時系列データ操作.html#cb369-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-7"><a href="時系列データ操作.html#cb369-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1週＝7日の周期を設定したts型データに変換</span></span>
<span id="cb369-8"><a href="時系列データ操作.html#cb369-8" aria-hidden="true" tabindex="-1"></a>data_cases_jp_ts <span class="ot">&lt;-</span> data_cases_jp <span class="sc">%&gt;%</span> </span>
<span id="cb369-9"><a href="時系列データ操作.html#cb369-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">22</span>),</span>
<span id="cb369-10"><a href="時系列データ操作.html#cb369-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">frequency =</span> <span class="dv">7</span>)</span>
<span id="cb369-11"><a href="時系列データ操作.html#cb369-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-12"><a href="時系列データ操作.html#cb369-12" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果をmに格納</span></span>
<span id="cb369-13"><a href="時系列データ操作.html#cb369-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">stl</span>(<span class="at">x =</span> data_cases_jp_ts,</span>
<span id="cb369-14"><a href="時系列データ操作.html#cb369-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>)</span>
<span id="cb369-15"><a href="時系列データ操作.html#cb369-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-16"><a href="時系列データ操作.html#cb369-16" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb369-17"><a href="時系列データ操作.html#cb369-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
</div>
<div id="日次データのstl分解複数周期" class="section level3 unnumbered hasAnchor">
<h3>日次データのSTL分解（複数周期）<a href="時系列データ操作.html#日次データのstl分解複数周期" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データに複数の周期性を設定したい場合は、ts型の拡張版であるmsts型データを用います。msts型データは<code>forecast</code>パッケージの<code>msts()</code>関数で作成できます。</p>
<p>ここでは、日次データに対し、1週間＝7日と、1年＝365.25日の2種類の周期性を設定しています。</p>
<p>msts型データに対するSTL分解は、<code>stats::stl()</code>関数ではなく、<code>forecast</code>パッケージの<code>mstl()</code>関数を使用します。</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="時系列データ操作.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_owidから日本の新規感染者数（日次）を抽出</span></span>
<span id="cb370-2"><a href="時系列データ操作.html#cb370-2" aria-hidden="true" tabindex="-1"></a>data_cases_jp <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb370-3"><a href="時系列データ操作.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb370-4"><a href="時系列データ操作.html#cb370-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>(new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb370-5"><a href="時系列データ操作.html#cb370-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(new_cases)</span>
<span id="cb370-6"><a href="時系列データ操作.html#cb370-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-7"><a href="時系列データ操作.html#cb370-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1週間＝7日と1年＝365.25日の周期を設定したmsts型データに変換</span></span>
<span id="cb370-8"><a href="時系列データ操作.html#cb370-8" aria-hidden="true" tabindex="-1"></a>data_cases_jp_msts <span class="ot">&lt;-</span> data_cases_jp <span class="sc">%&gt;%</span>  </span>
<span id="cb370-9"><a href="時系列データ操作.html#cb370-9" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">msts</span>(<span class="at">seasonal.period =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="fl">365.25</span>),</span>
<span id="cb370-10"><a href="時系列データ操作.html#cb370-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">22</span>))</span>
<span id="cb370-11"><a href="時系列データ操作.html#cb370-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-12"><a href="時系列データ操作.html#cb370-12" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果をmに格納</span></span>
<span id="cb370-13"><a href="時系列データ操作.html#cb370-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">mstl</span>(<span class="at">x =</span> data_cases_jp_ts, <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>)</span>
<span id="cb370-14"><a href="時系列データ操作.html#cb370-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-15"><a href="時系列データ操作.html#cb370-15" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb370-16"><a href="時系列データ操作.html#cb370-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
</div>
</div>
<div id="トレンド推定" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> トレンド推定<a href="時系列データ操作.html#トレンド推定" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>seasonal</code>パッケージのサンプルデータセット<code>unemp</code>（米国の失業者数、原数値）を対象に、トレンド推定を行う方法を解説します。</p>
<div id="hpフィルタ" class="section level3 unnumbered hasAnchor">
<h3>HPフィルタ<a href="時系列データ操作.html#hpフィルタ" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>HPフィルタ（Hodrick Prescott Filter）は、時系列データのトレンド成分と循環成分を推定する手法です。</p>
<p>具体的には、時系列データがトレンド成分<span class="math inline">\(g_t\)</span>と循環成分<span class="math inline">\(c_t\)</span>で構成されると仮定し、次の式のように、全期間を通して「循環成分の2乗の総和」と「トレンド成分の2階階差の2乗の総和」の加重和が最小になるような<span class="math inline">\(g_t\)</span>を計算します。</p>
<p>ここで、<span class="math inline">\(\lambda\)</span>はトレードオフの関係にある2つの項にウェイトをつける調整パラメータです。<span class="math inline">\(\lambda\)</span>が大きいほどトレンド成分が直線に近く、<span class="math inline">\(\lambda\)</span>が小さいほどトレンド成分が元のデータに近くなります。一般的に、四半期データには<span class="math inline">\(\lambda = 1600\)</span>が、月次データには<span class="math inline">\(\lambda = 14400\)</span>が使用されます。</p>
<p><span class="math display">\[
\min \Bigg\{ \sum_{t=1}^{T}{c_t^2} + \lambda \sum_{t=1}^{T}[(g_t - g_{t-1})-(g_{t-1}-g_{t-1})]^2 \Bigg\}
\]</span></p>
<p>HPフィルタを適用するには、時系列データに対し、<code>mFilter</code>パッケージの<code>hpfilter()</code>関数を使用します。データ型は数値型ベクトル、ts型どちらでもOKです。</p>
<p>推定したトレンド成分、循環成分は、推定結果を格納したオブジェクトに、それぞれ<code>trend</code>、<code>cycle</code>の名称で格納されています。</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="時系列データ操作.html#cb371-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> mFilter<span class="sc">::</span><span class="fu">hpfilter</span>(<span class="at">x =</span> seasonal<span class="sc">::</span>unemp, <span class="co"># HPフィルタを適用する時系列データ（数値型ベクトル、ts型）</span></span>
<span id="cb371-2"><a href="時系列データ操作.html#cb371-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">type =</span> <span class="st">&quot;lambda&quot;</span>,</span>
<span id="cb371-3"><a href="時系列データ操作.html#cb371-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">freq =</span> <span class="dv">14400</span>, <span class="co"># ラムダの値（四半期：1600、月次：14400）</span></span>
<span id="cb371-4"><a href="時系列データ操作.html#cb371-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">drift =</span> <span class="cn">FALSE</span>) <span class="co"># ドリフト項の有無 </span></span>
<span id="cb371-5"><a href="時系列データ操作.html#cb371-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-6"><a href="時系列データ操作.html#cb371-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
## Title:
##  Hodrick-Prescott Filter 
## 
## Call:
##  mFilter::hpfilter(x = seasonal::unemp, freq = 14400, type = &quot;lambda&quot;, 
##     drift = FALSE)
## 
## Method:
##  hpfilter
## 
## Filter Type:
##  lambda
## 
## Series:
##  seasonal::unemp
## 
## Descriptive Statistics:
##  
##  seasonal::unemp     Trend           Cycle         
##  Min.   : 5153   Min.   : 5915   Min.   :-2235.97  
##  1st Qu.: 7012   1st Qu.: 7236   1st Qu.: -473.54  
##  Median : 8078   Median : 8115   Median :  -78.87  
##  Mean   : 8766   Mean   : 8766   Mean   :    0.00  
##  3rd Qu.: 9476   3rd Qu.: 9235   3rd Qu.:  437.43  
##  Max.   :16147   Max.   :14235   Max.   : 2441.18  
## 
## In-sample error measures:
##         ME        MSE        MAE        MPE       MAPE 
## -2.008e-13  5.236e+05  5.652e+02 -9.939e-03  6.582e-02</code></pre>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="時系列データ操作.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="co"># トレンド推定結果を可視化（コンソールでEnterを押すと表示）</span></span>
<span id="cb373-2"><a href="時系列データ操作.html#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result)</span></code></pre></div>
</div>
<div id="一般化加法モデルgam" class="section level3 unnumbered hasAnchor">
<h3>一般化加法モデル（GAM）<a href="時系列データ操作.html#一般化加法モデルgam" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>一般化加法モデル（Generalizes Additive Model、GAM）は、線形モデルがもつ解釈性の良さを保ったまま、非線形モデルのような高い説明力を両立させる手法です。</p>
<p>具体的には次のように、被説明変数<span class="math inline">\(Y\)</span>を、説明変数<span class="math inline">\(X\)</span>を要素とする非線形関数<span class="math inline">\(f(X)\)</span>の和として説明するモデルです。非線形関数を用いることにより、説明変数と被説明変数の間の複雑な関係を説明できる一方で、被説明変数がそれぞれの非線形関数の和になっていることで、被説明変数の変動要因を説明変数毎に分解することができ、高い解釈性を維持している点が特徴です。</p>
<p><span class="math display">\[
Y_i = \beta_0 + f_1(X_{1i}) + f_2(X_{2i}) + \dots + f_k(X_{ki}) + u_i
\]</span></p>
<p>ここでは<span class="math inline">\(X\)</span>として時系列インデックスを用いることでトレンドを推定しますが、GAMはトレンド推定以外にも様々な用途に使用可能です。例えば、<a href="https://www.mizuho-rt.co.jp/publication/mhri/research/pdf/report/report20-1021.pdf">服部直樹（2020）「新型コロナウイルス感染症（COVID-19）の感染拡大要因は何か」</a>では、GAMの拡張版である「交互作用項付き一般化加法モデル（GA2M）」を使用して、新型コロナウイルス感染者数の変動要因の説明を試みています（ただし、同レポートではPythonによるGA2Mの実装を用いています）。</p>
<p>一般化加法モデルは、<code>mgcv</code>パッケージの<code>gam()</code>関数で推定します。事前に時系列インデックスを作成し、<code>gam()</code>関数の<code>formula</code>引数で<code>被説明変数 ~ s(時系列インデックス)</code>と指定します。説明変数である時系列インデックスを<code>s()</code>に配置することにより、非線形関数を適用します（<code>s()</code>を用いなければ、通常の線形回帰と同じ結果になります）。</p>
<p><code>gam()</code>関数の使用方法の詳細については、<a href="https://logics-of-blue.com/%E5%B9%B3%E6%BB%91%E5%8C%96%E3%82%B9%E3%83%97%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%A8%E5%8A%A0%E6%B3%95%E3%83%A2%E3%83%87%E3%83%AB/">こちら</a>のウェブサイトを参照してください。</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="時系列データ操作.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unempデータをベクトル形式に変換してdataに格納</span></span>
<span id="cb374-2"><a href="時系列データ操作.html#cb374-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb374-3"><a href="時系列データ操作.html#cb374-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2016-11-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 month&quot;</span>),</span>
<span id="cb374-4"><a href="時系列データ操作.html#cb374-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">unemp =</span> seasonal<span class="sc">::</span>unemp <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>()</span>
<span id="cb374-5"><a href="時系列データ操作.html#cb374-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb374-6"><a href="時系列データ操作.html#cb374-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-7"><a href="時系列データ操作.html#cb374-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dataに時系列インデックスtimeを追加</span></span>
<span id="cb374-8"><a href="時系列データ操作.html#cb374-8" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb374-9"><a href="時系列データ操作.html#cb374-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">seq_along</span>(date))</span>
<span id="cb374-10"><a href="時系列データ操作.html#cb374-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-11"><a href="時系列データ操作.html#cb374-11" aria-hidden="true" tabindex="-1"></a><span class="co"># GAMでトレンド推定</span></span>
<span id="cb374-12"><a href="時系列データ操作.html#cb374-12" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="at">formula =</span> unemp <span class="sc">~</span> <span class="fu">s</span>(time),</span>
<span id="cb374-13"><a href="時系列データ操作.html#cb374-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="co"># 分布関数</span></span>
<span id="cb374-14"><a href="時系列データ操作.html#cb374-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sp =</span> <span class="cn">NULL</span>, <span class="co"># 平滑度を決めるパラメータ（大きいほど直線に近く、小さいほど元データに近い。NULLで自動最適化）</span></span>
<span id="cb374-15"><a href="時系列データ操作.html#cb374-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> data)</span>
<span id="cb374-16"><a href="時系列データ操作.html#cb374-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-17"><a href="時系列データ操作.html#cb374-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定結果を出力</span></span>
<span id="cb374-18"><a href="時系列データ操作.html#cb374-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## unemp ~ s(time)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  8765.87      44.51   196.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F p-value    
## s(time) 8.974      9 326.7  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.901   Deviance explained = 90.4%
## GCV = 6.6028e+05  Scale est. = 6.399e+05  n = 323</code></pre>
<p>推定したトレンド系列は、推定結果を格納したオブジェクトに<code>fitted.values</code>の名称で格納されています。</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="時系列データ操作.html#cb376-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb376-2"><a href="時系列データ操作.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">unemp_fitted =</span> result<span class="sc">$</span>fitted.values)</span></code></pre></div>
<pre><code>## # A tibble: 323 x 4
##    date       unemp  time unemp_fitted
##    &lt;date&gt;     &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt;
##  1 1990-01-01  7413     1        7055.
##  2 1990-02-01  7296     2        7139.
##  3 1990-03-01  6852     3        7224.
##  4 1990-04-01  6620     4        7308.
##  5 1990-05-01  6533     5        7392.
##  6 1990-06-01  6884     6        7476.
##  7 1990-07-01  7137     7        7559.
##  8 1990-08-01  7008     8        7642.
##  9 1990-09-01  7003     9        7724.
## 10 1990-10-01  6892    10        7806.
## # ... with 313 more rows</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="時系列データ操作.html#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># トレンド推定結果を可視化</span></span>
<span id="cb378-2"><a href="時系列データ操作.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result, <span class="co"># gam()関数で推定した結果を格納したオブジェクト</span></span>
<span id="cb378-3"><a href="時系列データ操作.html#cb378-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">residuals =</span> <span class="cn">TRUE</span>, <span class="co"># 元データを表示するか</span></span>
<span id="cb378-4"><a href="時系列データ操作.html#cb378-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="co"># 信頼区間を表示するか</span></span>
<span id="cb378-5"><a href="時系列データ操作.html#cb378-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="st">&quot;*&quot;</span>) <span class="co"># 元データのマーカー</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="時系列データ操作.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定したモデルのチェック</span></span>
<span id="cb379-2"><a href="時系列データ操作.html#cb379-2" aria-hidden="true" tabindex="-1"></a>mgcv<span class="sc">::</span><span class="fu">gam.check</span>(result)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-143-1.png" width="672" /></p>
<pre><code>## 
## Method: GCV   Optimizer: magic
## Smoothing parameter selection converged after 12 iterations.
## The RMS GCV score gradient at convergence was 2.293679 .
## The Hessian was positive definite.
## Model rank =  10 / 10 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##           k&#39;  edf k-index p-value    
## s(time) 9.00 8.97    0.23  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidyverseによるデータ操作.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot2によるグラフ作成.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlights": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
