<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 時系列データ操作 | エコノミストのためのR</title>
  <meta name="description" content="7 時系列データ操作 | エコノミストのためのR" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="7 時系列データ操作 | エコノミストのためのR" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="naohat23/econ-code-bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 時系列データ操作 | エコノミストのためのR" />
  
  
  

<meta name="author" content="服部直樹" />


<meta name="date" content="2023-06-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="線形回帰.html"/>
<link rel="next" href="時系列分析.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://econ-code.verse.jp/index.html">エコノミストのためのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>はじめに</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#なぜrを使うのか"><i class="fa fa-check"></i>なぜRを使うのか？</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本書で出来ること"><i class="fa fa-check"></i>本書で出来ること　</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本書で出来ないこと"><i class="fa fa-check"></i>本書で出来ないこと</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#目次"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#参考文献ウェブサイト"><i class="fa fa-check"></i>参考文献・ウェブサイト</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#rプログラミング"><i class="fa fa-check"></i>Rプログラミング</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#統計学計量経済学"><i class="fa fa-check"></i>統計学・計量経済学</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#時系列データ分析"><i class="fa fa-check"></i>時系列データ分析</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#変更履歴"><i class="fa fa-check"></i>変更履歴</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年6月18日-メジャーアップデート"><i class="fa fa-check"></i>2023年6月18日 メジャーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年6月18日-マイナーアップデート"><i class="fa fa-check"></i>2023年6月18日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年4月6日-マイナーアップデート"><i class="fa fa-check"></i>2023年4月6日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年3月18日-マイナーアップデート"><i class="fa fa-check"></i>2023年3月18日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年2月6日-マイナーアップデート"><i class="fa fa-check"></i>2023年2月6日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年10月22日-マイナーアップデート"><i class="fa fa-check"></i>2022年10月22日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年9月7日-マイナーアップデート"><i class="fa fa-check"></i>2022年9月7日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年7月17日-マイナーアップデート"><i class="fa fa-check"></i>2022年7月17日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年7月9日-マイナーアップデート"><i class="fa fa-check"></i>2022年7月9日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年6月26日-ローンチ"><i class="fa fa-check"></i>2022年6月26日 ローンチ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rの設定.html"><a href="rの設定.html"><i class="fa fa-check"></i><b>1</b> Rの設定</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rの設定.html"><a href="rの設定.html#設定全般"><i class="fa fa-check"></i><b>1.1</b> 設定全般</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#rのインストール"><i class="fa fa-check"></i>Rのインストール</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#rのバージョン確認"><i class="fa fa-check"></i>Rのバージョン確認</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#セッション情報の確認"><i class="fa fa-check"></i>セッション情報の確認</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#オブジェクトを全削除"><i class="fa fa-check"></i>オブジェクトを全削除</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#警告の非表示"><i class="fa fa-check"></i>警告の非表示</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#関数が出力する警告やメッセージの非表示"><i class="fa fa-check"></i>関数が出力する警告やメッセージの非表示</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="rの設定.html"><a href="rの設定.html#通信関連の設定"><i class="fa fa-check"></i><b>1.2</b> 通信関連の設定</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="rの設定.html"><a href="rの設定.html#プロキシ設定"><i class="fa fa-check"></i><b>1.2.1</b> プロキシ設定</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#ssl設定"><i class="fa fa-check"></i>SSL設定</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="rの設定.html"><a href="rの設定.html#パッケージ"><i class="fa fa-check"></i><b>1.3</b> パッケージ</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#使用するパッケージ一覧"><i class="fa fa-check"></i>使用するパッケージ一覧</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#インストールとインポート"><i class="fa fa-check"></i>インストールとインポート</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#インストール時のエラー"><i class="fa fa-check"></i>インストール時のエラー</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="rの設定.html"><a href="rの設定.html#グラフの設定"><i class="fa fa-check"></i><b>1.4</b> グラフの設定</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#グラフのテーマ設定"><i class="fa fa-check"></i>グラフのテーマ設定</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#グラフのフォント設定"><i class="fa fa-check"></i>グラフのフォント設定</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="rの設定.html"><a href="rの設定.html#サンプルデータセット"><i class="fa fa-check"></i><b>1.5</b> サンプルデータセット</a>
<ul>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#rのサンプルデータセット"><i class="fa fa-check"></i>Rのサンプルデータセット</a></li>
<li class="chapter" data-level="" data-path="rの設定.html"><a href="rの設定.html#外部データセット"><i class="fa fa-check"></i>外部データセット</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="rの設定.html"><a href="rの設定.html#r起動時に実行する設定"><i class="fa fa-check"></i><b>1.6</b> R起動時に実行する設定</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html"><i class="fa fa-check"></i><b>2</b> Rの基本的な使用方法</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#第2章の準備"><i class="fa fa-check"></i><b>2.1</b> 第2章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#パッケージのインポート"><i class="fa fa-check"></i>パッケージのインポート</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#主要ショートカットキー"><i class="fa fa-check"></i><b>2.2</b> 主要ショートカットキー</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#編集"><i class="fa fa-check"></i>編集</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#実行"><i class="fa fa-check"></i>実行</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#その他"><i class="fa fa-check"></i>その他</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#基本操作"><i class="fa fa-check"></i><b>2.3</b> 基本操作</a></li>
<li class="chapter" data-level="2.4" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#演算"><i class="fa fa-check"></i><b>2.4</b> 演算</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#四則計算"><i class="fa fa-check"></i>四則計算</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#数値計算"><i class="fa fa-check"></i>数値計算</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#一致大小関係"><i class="fa fa-check"></i>一致・大小関係</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#包含集合関係"><i class="fa fa-check"></i>包含・集合関係</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトル"><i class="fa fa-check"></i><b>2.5</b> ベクトル</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトルの作成"><i class="fa fa-check"></i>ベクトルの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトル要素へのアクセス"><i class="fa fa-check"></i>ベクトル要素へのアクセス</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#規則性があるベクトルの作成"><i class="fa fa-check"></i>規則性があるベクトルの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ベクトルの演算"><i class="fa fa-check"></i>ベクトルの演算</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列"><i class="fa fa-check"></i><b>2.6</b> 行列</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列の作成"><i class="fa fa-check"></i>行列の作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列の要素へのアクセス"><i class="fa fa-check"></i>行列の要素へのアクセス</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#行列の演算"><i class="fa fa-check"></i>行列の演算</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データフレーム"><i class="fa fa-check"></i><b>2.7</b> データフレーム</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データフレームの作成"><i class="fa fa-check"></i>データフレームの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データフレームの要素へのアクセス"><i class="fa fa-check"></i>データフレームの要素へのアクセス</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#その他のデータフレームの機能"><i class="fa fa-check"></i>その他のデータフレームの機能</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#リスト"><i class="fa fa-check"></i><b>2.8</b> リスト</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#リストの作成"><i class="fa fa-check"></i>リストの作成</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#リストの要素へのアクセス"><i class="fa fa-check"></i>リストの要素へのアクセス</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#リストに要素を追加"><i class="fa fa-check"></i>リストに要素を追加</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#文字列操作"><i class="fa fa-check"></i><b>2.9</b> 文字列操作</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#文字列の連結"><i class="fa fa-check"></i>文字列の連結</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#文字列の切り出し"><i class="fa fa-check"></i>文字列の切り出し</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#文字列の検出置換"><i class="fa fa-check"></i>文字列の検出・置換</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#文字列の変換"><i class="fa fa-check"></i>文字列の変換</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#文字列のパディング"><i class="fa fa-check"></i>文字列のパディング</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#文字列によるプログラム実行"><i class="fa fa-check"></i>文字列によるプログラム実行</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#制御構文"><i class="fa fa-check"></i><b>2.10</b> 制御構文</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ifelse文"><i class="fa fa-check"></i>if/else文</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#forループ"><i class="fa fa-check"></i>forループ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#whileループ"><i class="fa fa-check"></i>whileループ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#breakによる繰り返しの終了"><i class="fa fa-check"></i>breakによる繰り返しの終了</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#nextによる処理のスキップ"><i class="fa fa-check"></i>nextによる処理のスキップ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#tryによるエラー処理"><i class="fa fa-check"></i>tryによるエラー処理</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ファイル操作"><i class="fa fa-check"></i><b>2.11</b> ファイル操作</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ディレクトリ関連"><i class="fa fa-check"></i>ディレクトリ関連</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ファイル関連"><i class="fa fa-check"></i>ファイル関連</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ファイルのダウンロード"><i class="fa fa-check"></i>ファイルのダウンロード</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データの読み込み"><i class="fa fa-check"></i><b>2.12</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#csvデータ"><i class="fa fa-check"></i>CSVデータ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#xlsxlsx形式データ"><i class="fa fa-check"></i>xls・xlsx形式データ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#xlsx形式データ"><i class="fa fa-check"></i>xlsx形式データ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#複数データの読み込み"><i class="fa fa-check"></i>複数データの読み込み</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#excelの日付値の修正"><i class="fa fa-check"></i>Excelの日付値の修正</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#データの書き出し"><i class="fa fa-check"></i><b>2.13</b> データの書き出し</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#csvデータの書き出し"><i class="fa fa-check"></i>CSVデータの書き出し</a></li>
</ul></li>
<li class="chapter" data-level="2.14" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#オブジェクトのセーブロード"><i class="fa fa-check"></i><b>2.14</b> オブジェクトのセーブ・ロード</a>
<ul>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#セーブ"><i class="fa fa-check"></i>セーブ</a></li>
<li class="chapter" data-level="" data-path="rの基本的な使用方法.html"><a href="rの基本的な使用方法.html#ロード"><i class="fa fa-check"></i>ロード</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html"><i class="fa fa-check"></i><b>3</b> tidyverseによるデータ操作</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#第3章の準備"><i class="fa fa-check"></i><b>3.1</b> 第3章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#パッケージのインポート-1"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#外部データセットの取得"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#tidyverseとは"><i class="fa fa-check"></i><b>3.2</b> tidyverseとは</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#tidy-data縦型横型データ"><i class="fa fa-check"></i>tidy data（縦型・横型データ）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#tidyverseの特徴"><i class="fa fa-check"></i>tidyverseの特徴</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列の選択"><i class="fa fa-check"></i><b>3.3</b> 列の選択</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名で選択"><i class="fa fa-check"></i>列名で選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名を格納したベクトルで選択"><i class="fa fa-check"></i>列名を格納したベクトルで選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列を非選択削除"><i class="fa fa-check"></i>列を非選択（削除）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名に特定の文字列を含む列を選択"><i class="fa fa-check"></i>列名に特定の文字列を含む列を選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名が特定の文字列から始まる列を選択"><i class="fa fa-check"></i>列名が特定の文字列から始まる列を選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名が特定の文字列で終わる列を選択"><i class="fa fa-check"></i>列名が特定の文字列で終わる列を選択</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#特定の型の列を選択"><i class="fa fa-check"></i>特定の型の列を選択</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列名の変更"><i class="fa fa-check"></i><b>3.4</b> 列名の変更</a></li>
<li class="chapter" data-level="3.5" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#行のスライスとサンプリング"><i class="fa fa-check"></i><b>3.5</b> 行のスライスとサンプリング</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#行のスライス"><i class="fa fa-check"></i>行のスライス</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#サンプリング"><i class="fa fa-check"></i>サンプリング</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#行のフィルタ"><i class="fa fa-check"></i><b>3.6</b> 行のフィルタ</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#条件に一致する行"><i class="fa fa-check"></i>条件に一致する行</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#条件に一致しない行not条件"><i class="fa fa-check"></i>条件に一致しない行（NOT条件）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数条件"><i class="fa fa-check"></i>複数条件</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#andor条件を明示的に指定した複数条件"><i class="fa fa-check"></i>AND・OR条件を明示的に指定した複数条件</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#in演算子によるor条件"><i class="fa fa-check"></i><code>%in%</code>演算子によるOR条件</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#or条件の否定"><i class="fa fa-check"></i>OR条件の否定</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#関数による条件指定"><i class="fa fa-check"></i>関数による条件指定</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#論理値を返す関数による条件指定"><i class="fa fa-check"></i>論理値を返す関数による条件指定</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数列の一括条件指定"><i class="fa fa-check"></i>複数列の一括条件指定</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#行の並べ替え"><i class="fa fa-check"></i><b>3.7</b> 行の並べ替え</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#昇順ソート"><i class="fa fa-check"></i>昇順ソート</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#降順ソート"><i class="fa fa-check"></i>降順ソート</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#降順ソート日付型"><i class="fa fa-check"></i>降順ソート（日付型）</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数条件によるソート"><i class="fa fa-check"></i>複数条件によるソート</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#列の作成修正"><i class="fa fa-check"></i><b>3.8</b> 列の作成・修正</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#新たな列の作成"><i class="fa fa-check"></i>新たな列の作成</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#既存の列の修正"><i class="fa fa-check"></i>既存の列の修正</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#条件付き系列の作成"><i class="fa fa-check"></i>条件付き系列の作成</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数列の一括処理"><i class="fa fa-check"></i>複数列の一括処理</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ化"><i class="fa fa-check"></i><b>3.9</b> グループ化</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#単一の列でグループ化"><i class="fa fa-check"></i>単一の列でグループ化</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数の列でグループ化"><i class="fa fa-check"></i>複数の列でグループ化</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ化フィルタ"><i class="fa fa-check"></i>グループ化＆フィルタ</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ化の解除"><i class="fa fa-check"></i>グループ化の解除</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#集計"><i class="fa fa-check"></i><b>3.10</b> 集計</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#グループ別の集計"><i class="fa fa-check"></i>グループ別の集計</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#クロス集計"><i class="fa fa-check"></i>クロス集計</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#複数列の一括処理-1"><i class="fa fa-check"></i>複数列の一括処理</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#カウント"><i class="fa fa-check"></i><b>3.11</b> カウント</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#変数のカウント"><i class="fa fa-check"></i>1変数のカウント</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#多変数のカウント"><i class="fa fa-check"></i>多変数のカウント</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#条件付きカウント"><i class="fa fa-check"></i>条件付きカウント</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#要素の種類をカウント"><i class="fa fa-check"></i>要素の種類をカウント</a></li>
</ul></li>
<li class="chapter" data-level="3.12" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#縦型横型の変換"><i class="fa fa-check"></i><b>3.12</b> 縦型・横型の変換</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#縦型データを横型データに変換"><i class="fa fa-check"></i>縦型データを横型データに変換</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#横型データを縦型データに変換"><i class="fa fa-check"></i>横型データを縦型データに変換</a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#データの結合"><i class="fa fa-check"></i><b>3.13</b> データの結合</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#内部結合"><i class="fa fa-check"></i>内部結合</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#左外部結合"><i class="fa fa-check"></i>左外部結合</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#右外部結合"><i class="fa fa-check"></i>右外部結合</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#完全外部結合"><i class="fa fa-check"></i>完全外部結合</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#重複処理"><i class="fa fa-check"></i><b>3.14</b> 重複処理</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#重複行の削除"><i class="fa fa-check"></i>重複行の削除</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#重複行の抽出"><i class="fa fa-check"></i>重複行の抽出</a></li>
</ul></li>
<li class="chapter" data-level="3.15" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#欠損値処理"><i class="fa fa-check"></i><b>3.15</b> 欠損値処理</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#naの削除"><i class="fa fa-check"></i>NAの削除</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#naの置換"><i class="fa fa-check"></i>NAの置換</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#naのフィル"><i class="fa fa-check"></i>NAのフィル</a></li>
</ul></li>
<li class="chapter" data-level="3.16" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#補完処理"><i class="fa fa-check"></i><b>3.16</b> 補完処理</a>
<ul>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#組み合わせ候補の補完"><i class="fa fa-check"></i>組み合わせ候補の補完</a></li>
<li class="chapter" data-level="" data-path="tidyverseによるデータ操作.html"><a href="tidyverseによるデータ操作.html#時系列データの補完"><i class="fa fa-check"></i>時系列データの補完</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html"><i class="fa fa-check"></i><b>4</b> ggplot2によるグラフ作成</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#第4章の準備"><i class="fa fa-check"></i><b>4.1</b> 第4章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#パッケージのインポート-2"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#外部データセットの取得-1"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggplot2とは"><i class="fa fa-check"></i><b>4.2</b> ggplot2とは</a></li>
<li class="chapter" data-level="4.3" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggplot2の設定"><i class="fa fa-check"></i><b>4.3</b> ggplot2の設定</a></li>
<li class="chapter" data-level="4.4" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#gui形式の直感的なグラフ作成"><i class="fa fa-check"></i><b>4.4</b> GUI形式の直感的なグラフ作成</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#esquisseパッケージ"><i class="fa fa-check"></i>esquisseパッケージ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggplotguiパッケージ"><i class="fa fa-check"></i>ggplotguiパッケージ</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布離散型"><i class="fa fa-check"></i><b>4.5</b> 1次元の度数分布（離散型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数棒グラフの基本形"><i class="fa fa-check"></i>度数棒グラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布連続型"><i class="fa fa-check"></i><b>4.6</b> 1次元の度数分布（連続型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ヒストグラムの基本形"><i class="fa fa-check"></i>ヒストグラムの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#横並びヒストグラム"><i class="fa fa-check"></i>横並びヒストグラム</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げヒストグラム"><i class="fa fa-check"></i>積み上げヒストグラム</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の密度グラフ"><i class="fa fa-check"></i><b>4.7</b> 1次元の密度グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#密度グラフの基本形"><i class="fa fa-check"></i>密度グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#横並び密度グラフ"><i class="fa fa-check"></i>横並び密度グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ密度グラフ"><i class="fa fa-check"></i>積み上げ密度グラフ</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布離散型-1"><i class="fa fa-check"></i><b>4.8</b> 2次元の度数分布（離散型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数バブルチャートの基本形"><i class="fa fa-check"></i>度数バブルチャートの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数ヒートマップの基本形"><i class="fa fa-check"></i>度数ヒートマップの基本形</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の度数分布連続型-1"><i class="fa fa-check"></i><b>4.9</b> 2次元の度数分布（連続型）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#度数ヒートマップの基本形-1"><i class="fa fa-check"></i>度数ヒートマップの基本形</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元の密度グラフ-1"><i class="fa fa-check"></i><b>4.10</b> 2次元の密度グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元密度グラフの基本形"><i class="fa fa-check"></i>2次元密度グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#次元密度グラフの塗りつぶし版"><i class="fa fa-check"></i>2次元密度グラフの塗りつぶし版</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#qqプロット"><i class="fa fa-check"></i><b>4.11</b> QQプロット</a></li>
<li class="chapter" data-level="4.12" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図バブルチャート"><i class="fa fa-check"></i><b>4.12</b> 散布図・バブルチャート</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図の基本形"><i class="fa fa-check"></i>散布図の基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#バブルチャートの基本形"><i class="fa fa-check"></i>バブルチャートの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図にコネクタ線を追加"><i class="fa fa-check"></i>散布図にコネクタ線を追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図に近似曲線を追加"><i class="fa fa-check"></i>散布図に近似曲線を追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#散布図にラベルを追加"><i class="fa fa-check"></i>散布図にラベルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#バブルチャートにラベルを追加"><i class="fa fa-check"></i>バブルチャートにラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#棒グラフ"><i class="fa fa-check"></i><b>4.13</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#縦棒グラフの基本形"><i class="fa fa-check"></i>縦棒グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#横棒グラフ"><i class="fa fa-check"></i>横棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#縦棒グラフの順序並べ替え"><i class="fa fa-check"></i>縦棒グラフの順序並べ替え</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#縦棒グラフにラベルを追加"><i class="fa fa-check"></i>縦棒グラフにラベルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#集合縦棒グラフ"><i class="fa fa-check"></i>集合縦棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフ"><i class="fa fa-check"></i>積み上げ縦棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフにラベルを追加"><i class="fa fa-check"></i>積み上げ縦棒グラフにラベルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフ-1"><i class="fa fa-check"></i>100％積み上げ縦棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ縦棒グラフにラベルを追加-1"><i class="fa fa-check"></i>100％積み上げ縦棒グラフにラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#円グラフ"><i class="fa fa-check"></i><b>4.14</b> 円グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#円グラフの基本形"><i class="fa fa-check"></i>円グラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフ"><i class="fa fa-check"></i><b>4.15</b> 折れ線グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフの基本形"><i class="fa fa-check"></i>折れ線グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフにマーカーを追加"><i class="fa fa-check"></i>折れ線グラフにマーカーを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#折れ線グラフに系列ラベルを追加"><i class="fa fa-check"></i>折れ線グラフに系列ラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="4.16" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ステップグラフ"><i class="fa fa-check"></i><b>4.16</b> ステップグラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ステップグラフの基本形"><i class="fa fa-check"></i>ステップグラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="4.17" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#面グラフ"><i class="fa fa-check"></i><b>4.17</b> 面グラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#面グラフの基本形"><i class="fa fa-check"></i>面グラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#積み上げ面グラフ"><i class="fa fa-check"></i>積み上げ面グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#リボングラフの基本形"><i class="fa fa-check"></i>リボングラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#リボングラフに折れ線グラフを追加"><i class="fa fa-check"></i>リボングラフに折れ線グラフを追加</a></li>
</ul></li>
<li class="chapter" data-level="4.18" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#箱ひげ図ヴァイオリングラフ"><i class="fa fa-check"></i><b>4.18</b> 箱ひげ図・ヴァイオリングラフ</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#箱ひげ図の基本形"><i class="fa fa-check"></i>箱ひげ図の基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#箱ひげ図に個別サンプルを追加"><i class="fa fa-check"></i>箱ひげ図に個別サンプルを追加</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ヴァイオリングラフの基本形"><i class="fa fa-check"></i>ヴァイオリングラフの基本形</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ヴァイオリングラフに個別サンプルを追加"><i class="fa fa-check"></i>ヴァイオリングラフに個別サンプルを追加</a></li>
</ul></li>
<li class="chapter" data-level="4.19" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ドットプロット"><i class="fa fa-check"></i><b>4.19</b> ドットプロット</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ドットプロットの基本形"><i class="fa fa-check"></i>ドットプロットの基本形</a></li>
</ul></li>
<li class="chapter" data-level="4.20" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#複合グラフファセット"><i class="fa fa-check"></i><b>4.20</b> 複合グラフ（ファセット）</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#行方向の複合グラフ"><i class="fa fa-check"></i>行方向の複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#列方向の複合グラフ"><i class="fa fa-check"></i>列方向の複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#行列方向の複合グラフ"><i class="fa fa-check"></i>行・列方向の複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#行数列数を指定した複合グラフ"><i class="fa fa-check"></i>行数・列数を指定した複合グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#複合グラフの設定"><i class="fa fa-check"></i>複合グラフの設定</a></li>
</ul></li>
<li class="chapter" data-level="4.21" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#地図ファセット"><i class="fa fa-check"></i><b>4.21</b> 地図ファセット</a></li>
<li class="chapter" data-level="4.22" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#補助線"><i class="fa fa-check"></i><b>4.22</b> 補助線</a></li>
<li class="chapter" data-level="4.23" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#設定色"><i class="fa fa-check"></i><b>4.23</b> 設定：色</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#色の手動指定離散型変数"><i class="fa fa-check"></i>色の手動指定（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#brewerカラーパレット離散型変数"><i class="fa fa-check"></i>Brewerカラーパレット（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#viridisカラーパレット離散型変数"><i class="fa fa-check"></i>Viridisカラーパレット（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#ggsciカラーパレット離散型変数"><i class="fa fa-check"></i>ggsciカラーパレット（離散型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#distillerカラーパレット連続型変数"><i class="fa fa-check"></i>distillerカラーパレット（連続型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#viridisカラーパレット連続型変数"><i class="fa fa-check"></i>Viridisカラーパレット（連続型変数）</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#gradientカラーパレット連続型変数"><i class="fa fa-check"></i>gradientカラーパレット（連続型変数）</a></li>
</ul></li>
<li class="chapter" data-level="4.24" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#設定軸"><i class="fa fa-check"></i><b>4.24</b> 設定：軸</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#x軸連続型y軸連続型"><i class="fa fa-check"></i>X軸：連続型、Y軸：連続型</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#対数目盛"><i class="fa fa-check"></i>対数目盛</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#x軸日付型y軸連続型"><i class="fa fa-check"></i>X軸：日付型、Y軸：連続型</a></li>
</ul></li>
<li class="chapter" data-level="4.25" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#設定パネル目盛線"><i class="fa fa-check"></i><b>4.25</b> 設定：パネル目盛線</a></li>
<li class="chapter" data-level="4.26" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#設定凡例"><i class="fa fa-check"></i><b>4.26</b> 設定：凡例</a></li>
<li class="chapter" data-level="4.27" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#設定タイトルキャプション"><i class="fa fa-check"></i><b>4.27</b> 設定：タイトル・キャプション</a></li>
<li class="chapter" data-level="4.28" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#設定フォントマージン"><i class="fa fa-check"></i><b>4.28</b> 設定：フォント・マージン</a></li>
<li class="chapter" data-level="4.29" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#グラフの保存"><i class="fa fa-check"></i><b>4.29</b> グラフの保存</a></li>
<li class="chapter" data-level="4.30" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#実例"><i class="fa fa-check"></i><b>4.30</b> 実例</a>
<ul>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#実例1折れ線グラフ"><i class="fa fa-check"></i>実例1：折れ線グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#実例2積み上げ棒グラフ"><i class="fa fa-check"></i>実例2：積み上げ棒グラフ</a></li>
<li class="chapter" data-level="" data-path="ggplot2によるグラフ作成.html"><a href="ggplot2によるグラフ作成.html#実例3箱ひげ図"><i class="fa fa-check"></i>実例3：箱ひげ図</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="探索的データ分析.html"><a href="探索的データ分析.html"><i class="fa fa-check"></i><b>5</b> 探索的データ分析</a>
<ul>
<li class="chapter" data-level="5.1" data-path="探索的データ分析.html"><a href="探索的データ分析.html#第5章の準備"><i class="fa fa-check"></i><b>5.1</b> 第5章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#パッケージのインポート-3"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#ggplot2の設定-1"><i class="fa fa-check"></i>ggplot2の設定</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="探索的データ分析.html"><a href="探索的データ分析.html#データの中身記述統計量"><i class="fa fa-check"></i><b>5.2</b> データの中身（記述統計量）</a></li>
<li class="chapter" data-level="5.3" data-path="探索的データ分析.html"><a href="探索的データ分析.html#データの分布"><i class="fa fa-check"></i><b>5.3</b> データの分布</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#離散型変数の度数分布"><i class="fa fa-check"></i>離散型変数の度数分布</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#連続型変数の度数分布"><i class="fa fa-check"></i>連続型変数の度数分布</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#外れ値"><i class="fa fa-check"></i>外れ値</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="探索的データ分析.html"><a href="探索的データ分析.html#データの関係性"><i class="fa fa-check"></i><b>5.4</b> データの関係性</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#離散型変数の関係性"><i class="fa fa-check"></i>離散型変数の関係性</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#連続型変数の関係性"><i class="fa fa-check"></i>連続型変数の関係性</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="探索的データ分析.html"><a href="探索的データ分析.html#相関関係ペアプロット"><i class="fa fa-check"></i><b>5.5</b> 相関関係・ペアプロット</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#相関係数行列"><i class="fa fa-check"></i>相関係数行列</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#corrplotパッケージ"><i class="fa fa-check"></i>corrplotパッケージ</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#corrrパッケージ"><i class="fa fa-check"></i>corrrパッケージ</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#ggallyパッケージ"><i class="fa fa-check"></i>GGallyパッケージ</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="探索的データ分析.html"><a href="探索的データ分析.html#探索的データ分析の一括実行"><i class="fa fa-check"></i><b>5.6</b> 探索的データ分析の一括実行</a>
<ul>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#dataexplorerパッケージ"><i class="fa fa-check"></i>DataExplorerパッケージ</a></li>
<li class="chapter" data-level="" data-path="探索的データ分析.html"><a href="探索的データ分析.html#smartedaパッケージ"><i class="fa fa-check"></i>SmartEDAパッケージ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="線形回帰.html"><a href="線形回帰.html"><i class="fa fa-check"></i><b>6</b> 線形回帰</a>
<ul>
<li class="chapter" data-level="6.1" data-path="線形回帰.html"><a href="線形回帰.html#第6章の準備"><i class="fa fa-check"></i><b>6.1</b> 第6章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#パッケージのインポート-4"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#外部データセットの取得-2"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="線形回帰.html"><a href="線形回帰.html#用語の説明"><i class="fa fa-check"></i><b>6.2</b> 用語の説明</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#標本と推定"><i class="fa fa-check"></i>標本と推定</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#推定量の望ましい性質"><i class="fa fa-check"></i>推定量の望ましい性質</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="線形回帰.html"><a href="線形回帰.html#最小2乗法ols"><i class="fa fa-check"></i><b>6.3</b> 最小2乗法（OLS）</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#最小2乗法の仮定"><i class="fa fa-check"></i>最小2乗法の仮定</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#検定と信頼区間"><i class="fa fa-check"></i>検定と信頼区間</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="線形回帰.html"><a href="線形回帰.html#モデルの種類と係数の解釈"><i class="fa fa-check"></i><b>6.4</b> モデルの種類と係数の解釈</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#水準モデル"><i class="fa fa-check"></i>水準モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#対数モデル"><i class="fa fa-check"></i>対数モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#変化率モデル"><i class="fa fa-check"></i>変化率モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#多項式モデル"><i class="fa fa-check"></i>多項式モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#交互作用モデル"><i class="fa fa-check"></i>交互作用モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#ダミー変数"><i class="fa fa-check"></i>ダミー変数</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="線形回帰.html"><a href="線形回帰.html#重回帰モデルの役割と注意点"><i class="fa fa-check"></i><b>6.5</b> 重回帰モデルの役割と注意点</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#欠落変数バイアス"><i class="fa fa-check"></i>欠落変数バイアス</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#多重共線性"><i class="fa fa-check"></i>多重共線性</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#変数選択の指針"><i class="fa fa-check"></i>変数選択の指針</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="線形回帰.html"><a href="線形回帰.html#rの単回帰モデル推定"><i class="fa fa-check"></i><b>6.6</b> Rの単回帰モデル推定</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実例線形単回帰"><i class="fa fa-check"></i>実例：線形単回帰</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実例回帰診断プロット"><i class="fa fa-check"></i>実例：回帰診断プロット</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実例対数変化率モデルの推定"><i class="fa fa-check"></i>実例：対数・変化率モデルの推定</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="線形回帰.html"><a href="線形回帰.html#rの重回帰モデル推定"><i class="fa fa-check"></i><b>6.7</b> Rの重回帰モデル推定</a>
<ul>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実例線形重回帰"><i class="fa fa-check"></i>実例：線形重回帰</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実例多項式モデル"><i class="fa fa-check"></i>実例：多項式モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実例ダミー交互作用モデル"><i class="fa fa-check"></i>実例：ダミー・交互作用モデル</a></li>
<li class="chapter" data-level="" data-path="線形回帰.html"><a href="線形回帰.html#実例ダミー変数同士の交互作用モデル"><i class="fa fa-check"></i>実例：ダミー変数同士の交互作用モデル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="時系列データ操作.html"><a href="時系列データ操作.html"><i class="fa fa-check"></i><b>7</b> 時系列データ操作</a>
<ul>
<li class="chapter" data-level="7.1" data-path="時系列データ操作.html"><a href="時系列データ操作.html#第7章の準備"><i class="fa fa-check"></i><b>7.1</b> 第7章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#パッケージのインポート-5"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#外部データセットの取得-3"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="時系列データ操作.html"><a href="時系列データ操作.html#時系列データとは"><i class="fa fa-check"></i><b>7.2</b> 時系列データとは</a></li>
<li class="chapter" data-level="7.3" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式データ"><i class="fa fa-check"></i><b>7.3</b> ts形式データ</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式データの表示"><i class="fa fa-check"></i>ts形式データの表示</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式データ情報の取得"><i class="fa fa-check"></i>ts形式データ情報の取得</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式データのフィルタ"><i class="fa fa-check"></i>ts形式データのフィルタ</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式データのプロット"><i class="fa fa-check"></i>ts形式データのプロット</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式データの変換"><i class="fa fa-check"></i><b>7.4</b> ts形式データの変換</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式に変換ts"><i class="fa fa-check"></i>ts形式に変換：ts()</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式に変換as_tsibble"><i class="fa fa-check"></i>ts形式に変換：as_tsibble()</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日付型データ関数"><i class="fa fa-check"></i><b>7.5</b> 日付型データ関数</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日付型データの生成"><i class="fa fa-check"></i>日付型データの生成</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日付型データの計算"><i class="fa fa-check"></i>日付型データの計算</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日付型と文字列型の変換"><i class="fa fa-check"></i>日付型と文字列型の変換</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日付情報の抽出"><i class="fa fa-check"></i>日付情報の抽出</a></li>
<li class="chapter" data-level="7.5.1" data-path="時系列データ操作.html"><a href="時系列データ操作.html#四半期ベースの時系列インデックス"><i class="fa fa-check"></i><b>7.5.1</b> 四半期ベースの時系列インデックス</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="時系列データ操作.html"><a href="時系列データ操作.html#様々な時系列データ系列の作成"><i class="fa fa-check"></i><b>7.6</b> 様々な時系列データ系列の作成</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ラグリード系列の作成"><i class="fa fa-check"></i>ラグ・リード系列の作成</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#変化率系列の作成"><i class="fa fa-check"></i>変化率系列の作成</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#移動平均系列の作成"><i class="fa fa-check"></i>移動平均系列の作成</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="時系列データ操作.html"><a href="時系列データ操作.html#時系列データの頻度変換"><i class="fa fa-check"></i><b>7.7</b> 時系列データの頻度変換</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データを週次データに変換"><i class="fa fa-check"></i>日次データを週次データに変換</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データを月次データに変換"><i class="fa fa-check"></i>日次データを月次データに変換</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データを四半期データに変換"><i class="fa fa-check"></i>日次データを四半期データに変換</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="時系列データ操作.html"><a href="時系列データ操作.html#季節調整x-13"><i class="fa fa-check"></i><b>7.8</b> 季節調整（X-13）</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#ts形式データの可視化"><i class="fa fa-check"></i>ts形式データの可視化</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#x-13arima-seatsの実施方法"><i class="fa fa-check"></i>X-13ARIMA-SEATSの実施方法</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#実例月次データの季節調整"><i class="fa fa-check"></i>実例：月次データの季節調整</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="時系列データ操作.html"><a href="時系列データ操作.html#季節調整stl分解"><i class="fa fa-check"></i><b>7.9</b> 季節調整（STL分解）</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#stl分解の実施方法"><i class="fa fa-check"></i>STL分解の実施方法</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#週次データのstl分解"><i class="fa fa-check"></i>週次データのSTL分解</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データのstl分解単一周期"><i class="fa fa-check"></i>日次データのSTL分解（単一周期）</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#日次データのstl分解複数周期"><i class="fa fa-check"></i>日次データのSTL分解（複数周期）</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="時系列データ操作.html"><a href="時系列データ操作.html#トレンド"><i class="fa fa-check"></i><b>7.10</b> トレンド</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#線形トレンド"><i class="fa fa-check"></i>線形トレンド</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#区分線形トレンド"><i class="fa fa-check"></i>区分線形トレンド</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#hpフィルタ"><i class="fa fa-check"></i>HPフィルタ</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#一般化加法モデルgam"><i class="fa fa-check"></i>一般化加法モデル（GAM）</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="時系列データ操作.html"><a href="時系列データ操作.html#構造変化"><i class="fa fa-check"></i><b>7.11</b> 構造変化</a>
<ul>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#構造変化点が既知の場合"><i class="fa fa-check"></i>構造変化点が既知の場合</a></li>
<li class="chapter" data-level="" data-path="時系列データ操作.html"><a href="時系列データ操作.html#構造変化点が未知の場合"><i class="fa fa-check"></i>構造変化点が未知の場合</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="時系列分析.html"><a href="時系列分析.html"><i class="fa fa-check"></i><b>8</b> 時系列分析</a>
<ul>
<li class="chapter" data-level="8.1" data-path="時系列分析.html"><a href="時系列分析.html#第8章の準備"><i class="fa fa-check"></i><b>8.1</b> 第8章の準備</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#パッケージのインポート-6"><i class="fa fa-check"></i>パッケージのインポート</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#外部データセットの取得-4"><i class="fa fa-check"></i>外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="時系列分析.html"><a href="時系列分析.html#定常性"><i class="fa fa-check"></i><b>8.2</b> 定常性</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#定常性の定義"><i class="fa fa-check"></i>定常性の定義</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#ホワイトノイズ"><i class="fa fa-check"></i>ホワイトノイズ</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="時系列分析.html"><a href="時系列分析.html#非定常過程"><i class="fa fa-check"></i><b>8.3</b> 非定常過程</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#単位根"><i class="fa fa-check"></i>単位根</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#階差定常過程和分過程"><i class="fa fa-check"></i>階差定常過程・和分過程</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#ランダムウォーク"><i class="fa fa-check"></i>ランダムウォーク</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#トレンド定常過程"><i class="fa fa-check"></i>トレンド定常過程</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="時系列分析.html"><a href="時系列分析.html#単位根検定adf検定"><i class="fa fa-check"></i><b>8.4</b> 単位根検定（ADF検定）</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#adf検定フロー自作関数"><i class="fa fa-check"></i>ADF検定フロー自作関数</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例adf検定フロー"><i class="fa fa-check"></i>実例：ADF検定フロー</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="時系列分析.html"><a href="時系列分析.html#系列相関"><i class="fa fa-check"></i><b>8.5</b> 系列相関</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#自己相関acf"><i class="fa fa-check"></i>自己相関（ACF）</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#偏自己相関pacf"><i class="fa fa-check"></i>偏自己相関（PACF）</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#リュンボックス検定"><i class="fa fa-check"></i>リュン＝ボックス検定</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="時系列分析.html"><a href="時系列分析.html#ボックスジェンキンス法"><i class="fa fa-check"></i><b>8.6</b> ボックス＝ジェンキンス法</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#armaモデル"><i class="fa fa-check"></i>ARMAモデル</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#arimaモデル"><i class="fa fa-check"></i>ARIMAモデル</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#ボックスジェンキンス法の分析フロー"><i class="fa fa-check"></i>ボックス＝ジェンキンス法の分析フロー</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例ボックスジェンキンス法"><i class="fa fa-check"></i>実例：ボックス＝ジェンキンス法</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="時系列分析.html"><a href="時系列分析.html#共和分"><i class="fa fa-check"></i><b>8.7</b> 共和分</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#見せかけの回帰"><i class="fa fa-check"></i>見せかけの回帰</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#共和分関係"><i class="fa fa-check"></i>共和分関係</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#エングルグレンジャー検定"><i class="fa fa-check"></i>エングル＝グレンジャー検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例見せかけの回帰"><i class="fa fa-check"></i>実例：見せかけの回帰</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例共和分"><i class="fa fa-check"></i>実例：共和分</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#ヨハンセン検定"><i class="fa fa-check"></i>ヨハンセン検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#ヨハンセン検定フロー自作関数"><i class="fa fa-check"></i>ヨハンセン検定フロー自作関数</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例ヨハンセン検定"><i class="fa fa-check"></i>実例：ヨハンセン検定</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="時系列分析.html"><a href="時系列分析.html#varモデル"><i class="fa fa-check"></i><b>8.8</b> VARモデル</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#レベルvarモデル"><i class="fa fa-check"></i>レベルVARモデル</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#階差varモデル"><i class="fa fa-check"></i>階差VARモデル</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#vecモデル"><i class="fa fa-check"></i>VECモデル</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#構造varモデル"><i class="fa fa-check"></i>構造VARモデル</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#構造vecモデル"><i class="fa fa-check"></i>構造VECモデル</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="時系列分析.html"><a href="時系列分析.html#varモデルに関連する分析"><i class="fa fa-check"></i><b>8.9</b> VARモデルに関連する分析</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#グレンジャー因果性"><i class="fa fa-check"></i>グレンジャー因果性</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#インパルス応答"><i class="fa fa-check"></i>インパルス応答</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#予測誤差の分散分解"><i class="fa fa-check"></i>予測誤差の分散分解</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="時系列分析.html"><a href="時系列分析.html#varモデルの分析フロー"><i class="fa fa-check"></i><b>8.10</b> VARモデルの分析フロー</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#探索的データ分析-2"><i class="fa fa-check"></i>1. 探索的データ分析</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#変数選択"><i class="fa fa-check"></i>2. 変数選択</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#ラグ次数の選択"><i class="fa fa-check"></i>3. ラグ次数の選択</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#単位根検定-1"><i class="fa fa-check"></i>4. 単位根検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#共和分検定"><i class="fa fa-check"></i>5. 共和分検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#データ分割-1"><i class="fa fa-check"></i>6. データ分割</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#誘導varvecモデルの推定"><i class="fa fa-check"></i>7. 誘導VAR・VECモデルの推定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#構造varvecモデルの識別"><i class="fa fa-check"></i>8. 構造VAR・VECモデルの識別</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#誤差項の検定"><i class="fa fa-check"></i>9. 誤差項の検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#モデル推定後の分析"><i class="fa fa-check"></i>10. モデル推定後の分析</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#予測"><i class="fa fa-check"></i>11. 予測</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="時系列分析.html"><a href="時系列分析.html#varモデルの実例"><i class="fa fa-check"></i><b>8.11</b> VARモデルの実例</a>
<ul>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例探索的データ分析"><i class="fa fa-check"></i>実例：探索的データ分析</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例変数選択グレンジャー因果性検定"><i class="fa fa-check"></i>実例：変数選択（グレンジャー因果性検定）</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例ラグ次数選択"><i class="fa fa-check"></i>実例：ラグ次数選択</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例adf検定"><i class="fa fa-check"></i>実例：ADF検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例ヨハンセン検定-1"><i class="fa fa-check"></i>実例：ヨハンセン検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例varモデルの推定"><i class="fa fa-check"></i>実例：VARモデルの推定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例vecモデルの推定"><i class="fa fa-check"></i>実例：VECモデルの推定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例構造varモデルの推定"><i class="fa fa-check"></i>実例：構造VARモデルの推定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例構造vecモデルの推定"><i class="fa fa-check"></i>実例：構造VECモデルの推定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例誤差項の検定"><i class="fa fa-check"></i>実例：誤差項の検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例インパルス応答"><i class="fa fa-check"></i>実例：インパルス応答</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例予測誤差の分散分解"><i class="fa fa-check"></i>実例：予測誤差の分散分解</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例グレンジャー因果性検定"><i class="fa fa-check"></i>実例：グレンジャー因果性検定</a></li>
<li class="chapter" data-level="" data-path="時系列分析.html"><a href="時系列分析.html#実例予測"><i class="fa fa-check"></i>実例：予測</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">エコノミストのためのR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="時系列データ操作" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> 時系列データ操作<a href="時系列データ操作.html#時系列データ操作" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>第7章「時系列データ操作」では、時系列データに特有の操作方法について解説します。時系列データ特有の操作には、変化率やラグなどのデータ変換、日次・月次などの頻度変換、季節調整、トレンドや構造変化の推定などがあります。</p>
<div id="第7章の準備" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> 第7章の準備<a href="時系列データ操作.html#第7章の準備" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="パッケージのインポート-5" class="section level3 unnumbered hasAnchor">
<h3>パッケージのインポート<a href="時系列データ操作.html#パッケージのインポート-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="時系列データ操作.html#cb662-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb662-2"><a href="時系列データ操作.html#cb662-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mFilter)</span>
<span id="cb662-3"><a href="時系列データ操作.html#cb662-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb662-4"><a href="時系列データ操作.html#cb662-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pbapply)</span>
<span id="cb662-5"><a href="時系列データ操作.html#cb662-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seasonal)</span>
<span id="cb662-6"><a href="時系列データ操作.html#cb662-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(strucchange)</span>
<span id="cb662-7"><a href="時系列データ操作.html#cb662-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb662-8"><a href="時系列データ操作.html#cb662-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb662-9"><a href="時系列データ操作.html#cb662-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code></pre></div>
</div>
<div id="外部データセットの取得-3" class="section level3 unnumbered hasAnchor">
<h3>外部データセットの取得<a href="時系列データ操作.html#外部データセットの取得-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>この章では、外部データセットとして以下のデータを使用します。第1章のコードを使用してあらかじめウェブからデータセットを取得してください。</p>
<ul>
<li>OWIDのCOVID-19データセット：　<code>data_owid</code></li>
<li>日本の産業別就業者数：　<code>data_labor</code></li>
</ul>
<p>また、この章では、西山 他（2019）のデータセットを使用します。<a href="http://www.yuhikaku.co.jp/books/detail/9784641053854">西山 他（2019）のサポートウェブサイト</a>からデータファイルを取得し、各自の実行環境のワーキングディレクトリ直下に<code>data_nishiyama</code>フォルダを作成して、その中に格納してください。</p>
</div>
</div>
<div id="時系列データとは" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> 時系列データとは<a href="時系列データ操作.html#時系列データとは" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>時系列データは、観察対象の特徴を特定の時間間隔で記録したデータです。観測の時間間隔は観測者によって日次、週次、月次、四半期、年次など任意に設定されます。一般的に時系列データは、観測したデータ本体と、観測時点を示す日付・時間情報がセットになっています。四半期毎に公表されるGDPデータなどの経済指標や、毎日の株価・為替データといった金融指標は、代表的な時系列データです。</p>
<p>Rで時系列データを扱う方法には、主に次の2つがあります。</p>
<p>まず、第3章で使用した<strong>tibble形式</strong>です。tibble形式は複数の列を含むデータフレームの形状をしており、データそのものを格納する列と、日付型データを格納する列を組み合わせることで、時系列データを扱うことができます。</p>
<p>もう一つは<strong>ts形式</strong>です。ts形式はデータと日付があらかじめセットになった一次元のデータ構造で、季節調整を行う<code>seasonal</code>パッケージなどで使用されます。</p>
</div>
<div id="ts形式データ" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> ts形式データ<a href="時系列データ操作.html#ts形式データ" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>まず、時系列データ特有のデータ構造であるts形式の取り扱い方法について解説します。</p>
<p>ts形式データのサンプルデータセットとして、<code>seasonal</code>パッケージの<code>unemp</code>データセット（月次データ）と、<code>fpp2</code>パッケージの<code>gasoline</code>データセット（週次データ）を用います。</p>
<div id="ts形式データの表示" class="section level3 unnumbered hasAnchor">
<h3>ts形式データの表示<a href="時系列データ操作.html#ts形式データの表示" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>月次のts形式データは、行方向に年、列方向に月、の行列の形でコンソールに表示されます。</p>
<p>ただし、これはあくまで表示方法の問題であり、ts形式データが行列（2次元）の構造であることを意味するわけではありません。</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="時系列データ操作.html#cb663-1" aria-hidden="true" tabindex="-1"></a>seasonal<span class="sc">::</span>unemp</span></code></pre></div>
<pre><code>##        Jan   Feb   Mar   Apr   May   Jun   Jul   Aug   Sep   Oct   Nov   Dec
## 1990  7413  7296  6852  6620  6533  6884  7137  7008  7003  6892  7396  7525
## 1991  8787  9121  8995  8226  8435  8992  8792  8439  8270  8232  8494  8755
## 1992 10186 10401  9913  9135  9389 10366 10099  9605  9316  8813  9086  9045
## 1993 10158 10004  9478  8835  8807  9473  9223  8655  8302  8296  8094  7959
## 1994  9492  9262  8874  8078  7656  8251  8281  7868  7379  7155  6973  6690
## 1995  8101  7685  7480  7378  7185  7727  7892  7457  7167  6884  7024  6872
## 1996  8270  7858  7700  7124  7166  7377  7693  6868  6700  6577  6816  6680
## 1997  7933  7647  7399  6551  6398  7094  6981  6594  6403  5995  5914  5957
## 1998  7069  6804  6816  5643  5764  6534  6567  6173  6039  5831  5711  5565
## 1999  6604  6563  6119  5688  5507  6271  6319  5826  5661  5372  5380  5245
## 2000  6316  6284  6069  5212  5460  5959  6028  5863  5359  5153  5336  5264
## 2001  6647  6523  6509  6004  5901  6816  6858  7017  6766  7175  7617  7773
## 2002  9051  8823  8776  8255  7969  8758  8693  8271  7790  7769  8170  8209
## 2003  9395  9260  9018  8501  8500  9649  9319  8830  8436  8169  8269  7945
## 2004  9144  8770  8834  7837  7792  8616  8518  7940  7545  7531  7665  7599
## 2005  8444  8549  7986  7335  7287  7870  7839  7327  7259  6964  7271  6956
## 2006  7608  7692  7255  6804  6655  7341  7602  7086  6625  6272  6576  6491
## 2007  7649  7400  6913  6532  6486  7295  7556  7088  6952  6773  6917  7371
## 2008  8221  7953  8027  7287  8076  8933  9433  9479  9199  9469 10015 10999
## 2009 13009 13699 13895 13248 13973 15095 15201 14823 14538 14547 14407 14740
## 2010 16147 15991 15678 14609 14369 14885 15137 14759 14140 13903 14282 13997
## 2011 14937 14542 14060 13237 13421 14409 14428 14008 13520 13102 12613 12692
## 2012 13541 13430 12904 11910 12271 13184 13400 12696 11742 11741 11404 11844
## 2013 13181 12500 11815 11014 11302 12248 12083 11462 10885 10773 10271  9984
## 2014 10855 10893 10537  9079  9443  9893 10307  9787  8962  8680  8630  8331
## 2015  9498  9095  8682  7966  8370  8638  8805  8162  7628  7597  7573  7542
## 2016  8309  8219  8116  7413  7207  8144  8267  7996  7658  7447  7066</code></pre>
<p>一方、週次のts形式データの場合はベクトルの形で出力されます。</p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb665-1"><a href="時系列データ操作.html#cb665-1" aria-hidden="true" tabindex="-1"></a>fpp2<span class="sc">::</span>gasoline <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">200</span>)</span></code></pre></div>
<pre><code>## Time Series:
## Start = 1991.1 
## End = 1994.91382614648 
## Frequency = 52.1785714285714 
##   [1] 6.621 6.433 6.582 7.224 6.875 6.947 7.328 6.777 7.503 6.916 7.045 6.956
##  [13] 6.976 7.185 6.899 7.396 7.287 7.220 7.651 7.720 7.543 7.961 7.327 7.380
##  [25] 7.501 7.605 7.584 7.401 7.505 7.427 6.993 7.402 7.391 7.088 6.949 7.506
##  [37] 7.396 7.421 7.159 7.379 7.369 6.652 6.769 6.828 7.344 7.447 7.186 6.642
##  [49] 6.788 6.783 7.037 7.112 7.039 6.576 7.002 6.770 7.002 6.806 7.221 7.379
##  [61] 7.027 7.744 6.464 7.376 7.899 7.318 7.174 7.086 7.774 7.104 7.129 7.407
##  [73] 7.701 7.572 7.813 7.422 7.792 7.433 7.796 7.700 7.365 7.814 7.326 7.473
##  [85] 7.181 7.286 7.293 7.514 7.204 7.276 7.509 6.923 7.056 7.240 7.138 7.432
##  [97] 7.354 7.400 7.596 7.358 6.852 6.726 7.131 6.603 7.322 6.779 7.325 6.961
## [109] 7.188 7.100 7.239 7.194 6.964 6.797 7.561 7.392 7.470 7.657 7.649 7.295
## [121] 7.364 7.018 7.740 7.392 7.804 7.868 7.578 8.113 7.916 7.336 8.033 7.581
## [133] 8.187 7.629 7.386 7.889 7.478 7.485 7.387 7.276 7.613 7.704 7.788 7.640
## [145] 7.552 7.992 6.845 7.430 8.074 7.684 7.411 7.567 7.124 7.124 7.157 6.321
## [157] 6.953 7.487 6.993 7.372 7.286 7.214 7.521 7.481 7.398 7.187 7.720 7.042
## [169] 7.892 6.824 7.552 7.938 8.028 7.461 7.770 7.650 7.909 7.930 7.562 8.006
## [181] 7.523 7.581 7.638 8.187 7.836 7.750 8.061 6.955 7.601 7.763 7.733 7.515
## [193] 7.562 8.143 8.204 7.432 7.377 7.929 7.431 7.593</code></pre>
</div>
<div id="ts形式データ情報の取得" class="section level3 unnumbered hasAnchor">
<h3>ts形式データ情報の取得<a href="時系列データ操作.html#ts形式データ情報の取得" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ts形式データの日付情報を取得するには、<code>frequency()</code>、<code>start()</code>、<code>end()</code>などの関数を用います。</p>
<p>月次データの周期は12であり、開始・終了時点は1～12の整数で表されます。</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="時系列データ操作.html#cb667-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付の周期（1年当たりのデータ頻度）</span></span>
<span id="cb667-2"><a href="時系列データ操作.html#cb667-2" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(seasonal<span class="sc">::</span>unemp)</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="時系列データ操作.html#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの開始時点</span></span>
<span id="cb669-2"><a href="時系列データ操作.html#cb669-2" aria-hidden="true" tabindex="-1"></a><span class="fu">start</span>(seasonal<span class="sc">::</span>unemp)</span></code></pre></div>
<pre><code>## [1] 1990    1</code></pre>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="時系列データ操作.html#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの終了時点</span></span>
<span id="cb671-2"><a href="時系列データ操作.html#cb671-2" aria-hidden="true" tabindex="-1"></a><span class="fu">end</span>(seasonal<span class="sc">::</span>unemp)</span></code></pre></div>
<pre><code>## [1] 2016   11</code></pre>
<p>一方、週次データの周期は約52.18です。これは、うるう年を考慮した1年の平均日数365.25日を7で割った値であり、1年間が平均して52.18週であることを示しています。</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="時系列データ操作.html#cb673-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付の周期（1年当たりのデータ頻度）</span></span>
<span id="cb673-2"><a href="時系列データ操作.html#cb673-2" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<pre><code>## [1] 52.17857</code></pre>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="時系列データ操作.html#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの開始時点</span></span>
<span id="cb675-2"><a href="時系列データ操作.html#cb675-2" aria-hidden="true" tabindex="-1"></a><span class="fu">start</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<pre><code>## [1] 1991.1</code></pre>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="時系列データ操作.html#cb677-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの終了時点</span></span>
<span id="cb677-2"><a href="時系列データ操作.html#cb677-2" aria-hidden="true" tabindex="-1"></a><span class="fu">end</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<pre><code>## [1] 2017.049</code></pre>
</div>
<div id="ts形式データのフィルタ" class="section level3 unnumbered hasAnchor">
<h3>ts形式データのフィルタ<a href="時系列データ操作.html#ts形式データのフィルタ" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ts形式データをフィルタするには、<code>window()</code>関数を使用して<code>start</code>引数と<code>end</code>引数に年を指定します。</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="時系列データ操作.html#cb679-1" aria-hidden="true" tabindex="-1"></a><span class="fu">window</span>(seasonal<span class="sc">::</span>unemp, <span class="at">start =</span> <span class="dv">1999</span>, <span class="at">end =</span> <span class="dv">2000</span>)</span></code></pre></div>
<pre><code>##       Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec
## 1999 6604 6563 6119 5688 5507 6271 6319 5826 5661 5372 5380 5245
## 2000 6316</code></pre>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="時系列データ操作.html#cb681-1" aria-hidden="true" tabindex="-1"></a><span class="fu">window</span>(fpp2<span class="sc">::</span>gasoline, <span class="at">start =</span> <span class="dv">2016</span>, <span class="at">end =</span> <span class="dv">2017</span>)</span></code></pre></div>
<pre><code>## Time Series:
## Start = 2016.0144421629 
## End = 2016.99185489391 
## Frequency = 52.1785714285714 
##  [1] 8.500 9.079 8.941 8.341 9.122 9.203 9.576 9.121 9.411 9.458 9.503 9.244
## [13] 9.224 9.633 9.444 9.315 9.502 9.658 9.755 9.516 9.716 9.568 9.762 9.815
## [25] 9.709 9.755 9.671 9.785 9.797 9.752 9.769 9.762 9.659 9.511 9.595 9.406
## [37] 9.650 8.880 9.390 9.264 8.798 9.118 9.183 9.213 9.359 9.024 9.080 8.757
## [49] 8.874 9.269 9.278 8.465</code></pre>
</div>
<div id="ts形式データのプロット" class="section level3 unnumbered hasAnchor">
<h3>ts形式データのプロット<a href="時系列データ操作.html#ts形式データのプロット" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ts形式データをプロットするには、<code>plot()</code>関数を使用します。ts形式データはデータと日付がセットになっているため、X軸には自動的に日付が表示されます。</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="時系列データ操作.html#cb683-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(seasonal<span class="sc">::</span>unemp)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-312-1.png" width="672" /></p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="時系列データ操作.html#cb684-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-313-1.png" width="672" /></p>
</div>
</div>
<div id="ts形式データの変換" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> ts形式データの変換<a href="時系列データ操作.html#ts形式データの変換" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>data.frame形式やtibble形式といった通常のデータフレームからts形式へ変換するには、<code>ts()</code>関数でts形式データの行列に変換する方法と、<code>tsibble</code>パッケージの<code>as_tsibble()</code>関数でts形式データフレームであるtsibble形式データに変換する方法の2種類があります。</p>
<div id="ts形式に変換ts" class="section level3 unnumbered hasAnchor">
<h3>ts形式に変換：ts()<a href="時系列データ操作.html#ts形式に変換ts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>ts()</code>関数を使用して、通常のデータフレーム形式のデータを、ts形式の行列に変換します。</p>
<p>まず、縦型データの場合は一般的に日付列の要素が重複していますので、日付列の要素に重複が無くなるよう、行をフィルタするか、横型データに変換します。次に、<code>dplyr::arrange()</code>関数を用いてデータを日付列で昇順に並べ替えます。最後に、<code>ts()</code>関数で<code>frequency</code>引数に周期を、<code>start</code>引数にデータ開始時点を指定します。</p>
<div id="年次データ" class="section level4 unnumbered hasAnchor">
<h4>年次データ<a href="時系列データ操作.html#年次データ" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>年次データを<code>ts()</code>関数でts形式に変換します。</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="時系列データ操作.html#cb685-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列の要素が重複している場合は、重複がなくなるように行をフィルタ</span></span>
<span id="cb685-2"><a href="時系列データ操作.html#cb685-2" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> data_gdp_pref <span class="sc">%&gt;%</span> </span>
<span id="cb685-3"><a href="時系列データ操作.html#cb685-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(pref_name <span class="sc">==</span> <span class="st">&quot;東京都&quot;</span>)</span>
<span id="cb685-4"><a href="時系列データ操作.html#cb685-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-5"><a href="時系列データ操作.html#cb685-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb685-6"><a href="時系列データ操作.html#cb685-6" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb685-7"><a href="時系列データ操作.html#cb685-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(year)</span>
<span id="cb685-8"><a href="時系列データ操作.html#cb685-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-9"><a href="時系列データ操作.html#cb685-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ts()関数でts形式に変換</span></span>
<span id="cb685-10"><a href="時系列データ操作.html#cb685-10" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb685-11"><a href="時系列データ操作.html#cb685-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">1</span>, <span class="co"># 周期：年次データのため周期は1</span></span>
<span id="cb685-12"><a href="時系列データ操作.html#cb685-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="dv">2006</span> <span class="co"># データ開始時点は2006年</span></span>
<span id="cb685-13"><a href="時系列データ操作.html#cb685-13" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb685-14"><a href="時系列データ操作.html#cb685-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-15"><a href="時系列データ操作.html#cb685-15" aria-hidden="true" tabindex="-1"></a>data_ts</span></code></pre></div>
<pre><code>## Time Series:
## Start = 2006 
## End = 2018 
## Frequency = 1 
##      pref_code pref_name year gdp_nominal gdp_nominal_pchg
## 2006        13         1 2006   104897928               NA
## 2007        13         1 2007   105331451        0.4132808
## 2008        13         1 2008   103814636       -1.4400400
## 2009        13         1 2009    97556925       -6.0277734
## 2010        13         1 2010    97911461        0.3634145
## 2011        13         1 2011   100277084        2.4160839
## 2012        13         1 2012    99824147       -0.4516855
## 2013        13         1 2013   101234576        1.4129137
## 2014        13         1 2014   101769228        0.5281318
## 2015        13         1 2015   104494963        2.6783489
## 2016        13         1 2016   105126848        0.6047038
## 2017        13         1 2017   105964694        0.7969858
## 2018        13         1 2018   107041763        1.0164414</code></pre>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="時系列データ操作.html#cb687-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_ts)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p><code>ts()</code>関数で変換したデータはts形式の行列になるため、<code>$</code>演算子で列を選択することができません。列を選択するには、<code>行列[, 要素の列インデックス]</code>もしくは、<code>行列[, "列名"]</code>とします。</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="時系列データ操作.html#cb689-1" aria-hidden="true" tabindex="-1"></a>data_ts[, <span class="st">&quot;gdp_nominal&quot;</span>]</span></code></pre></div>
<pre><code>## Time Series:
## Start = 2006 
## End = 2018 
## Frequency = 1 
##  [1] 104897928 105331451 103814636  97556925  97911461 100277084  99824147
##  [8] 101234576 101769228 104494963 105126848 105964694 107041763</code></pre>
<p><code>as.list()</code>関数でリスト形式に変換すると、データフレーム形式と同様に<code>$</code>演算子で列を選択することができます。<code>リスト[[列インデックス]]</code>でも各列にアクセス可能です。</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="時系列データ操作.html#cb691-1" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb691-2"><a href="時系列データ操作.html#cb691-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb691-3"><a href="時系列データ操作.html#cb691-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-4"><a href="時系列データ操作.html#cb691-4" aria-hidden="true" tabindex="-1"></a>data_ts<span class="sc">$</span>gdp_nominal</span></code></pre></div>
<pre><code>## Time Series:
## Start = 2006 
## End = 2018 
## Frequency = 1 
##  [1] 104897928 105331451 103814636  97556925  97911461 100277084  99824147
##  [8] 101234576 101769228 104494963 105126848 105964694 107041763</code></pre>
</div>
<div id="四半期データ" class="section level4 unnumbered hasAnchor">
<h4>四半期データ<a href="時系列データ操作.html#四半期データ" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>四半期データを<code>ts()</code>関数でts形式に変換します。</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="時系列データ操作.html#cb693-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb693-2"><a href="時系列データ操作.html#cb693-2" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> data_gdp_jp <span class="sc">%&gt;%</span> </span>
<span id="cb693-3"><a href="時系列データ操作.html#cb693-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(日付) <span class="sc">%&gt;%</span> </span>
<span id="cb693-4"><a href="時系列データ操作.html#cb693-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>日付)</span>
<span id="cb693-5"><a href="時系列データ操作.html#cb693-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb693-6"><a href="時系列データ操作.html#cb693-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ts()関数でts形式に変換</span></span>
<span id="cb693-7"><a href="時系列データ操作.html#cb693-7" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb693-8"><a href="時系列データ操作.html#cb693-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">4</span>, <span class="co"># 周期：四半期データのため周期は4</span></span>
<span id="cb693-9"><a href="時系列データ操作.html#cb693-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1991</span>, <span class="dv">1</span>) <span class="co"># データ開始時点は1991年1～3月期のため、c(1991, 1)と指定</span></span>
<span id="cb693-10"><a href="時系列データ操作.html#cb693-10" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb693-11"><a href="時系列データ操作.html#cb693-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb693-12"><a href="時系列データ操作.html#cb693-12" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##         国内総生産 民間最終消費支出 民間住宅 民間企業設備 民間在庫変動
## 1991 Q1   446307.6         247534.8  29812.0      66259.2       4229.0
## 1991 Q2   443743.7         248757.7  31118.5      66065.0      -2884.5
## 1991 Q3   448945.0         250618.8  33628.1      65999.2       -280.5
## 1991 Q4   447169.1         250780.0  32218.2      67028.9      -1601.9
## 1992 Q1   452113.0         252928.4  31121.5      68647.7       2253.7
## 1992 Q2   456276.2         254883.7  30381.5      71088.0       1116.7
##         政府最終消費支出 公的固定資本形成 公的在庫変動   純輸出     開差
## 1991 Q1          71357.3          47106.5       -542.3  -7720.2 -11728.6
## 1991 Q2          72243.7          48020.5        622.8  -8364.3 -11835.8
## 1991 Q3          72789.0          46302.7        806.2  -9067.4 -11851.0
## 1991 Q4          72949.9          45588.7        853.3  -9379.0 -11269.1
## 1992 Q1          74470.4          43641.5        -27.7 -10500.2 -10422.3
## 1992 Q2          74611.2          45422.2        199.2 -11408.7 -10017.6</code></pre>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="時系列データ操作.html#cb695-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_ts)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
</div>
<div id="月次データ" class="section level4 unnumbered hasAnchor">
<h4>月次データ<a href="時系列データ操作.html#月次データ" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>月次データを<code>ts()</code>関数でts形式に変換します。</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="時系列データ操作.html#cb697-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb697-2"><a href="時系列データ操作.html#cb697-2" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> data_labor <span class="sc">%&gt;%</span> </span>
<span id="cb697-3"><a href="時系列データ操作.html#cb697-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb697-4"><a href="時系列データ操作.html#cb697-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb697-5"><a href="時系列データ操作.html#cb697-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-6"><a href="時系列データ操作.html#cb697-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ts()関数でts形式に変換</span></span>
<span id="cb697-7"><a href="時系列データ操作.html#cb697-7" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb697-8"><a href="時系列データ操作.html#cb697-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">12</span>, <span class="co"># 周期：四半期データのため周期は4</span></span>
<span id="cb697-9"><a href="時系列データ操作.html#cb697-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>) <span class="co"># データ開始時点は2002年1月のため、c(2002, 1)と指定</span></span>
<span id="cb697-10"><a href="時系列データ操作.html#cb697-10" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb697-11"><a href="時系列データ操作.html#cb697-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-12"><a href="時系列データ操作.html#cb697-12" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##          総数 農林 建設 製造 情報通信 運輸・郵便 卸・小売 金融・保険
## Jan 2002 6267  224  589 1210      153        331     1131        165
## Feb 2002 6248  227  611 1201      156        324     1075        164
## Mar 2002 6297  242  628 1238      156        323     1081        161
## Apr 2002 6333  278  624 1213      159        315     1121        167
## May 2002 6356  307  607 1194      157        322     1134        171
## Jun 2002 6373  311  594 1223      159        330     1115        170
##          不動産・物品賃貸 学術・専門・技術 宿泊・飲食 生活関連・娯楽 教育
## Jan 2002               95              208        393            243  284
## Feb 2002               96              208        395            246  273
## Mar 2002               99              207        397            246  266
## Apr 2002               95              200        394            235  267
## May 2002               96              203        391            233  270
## Jun 2002              108              202        390            242  280
##          医療・福祉 複合サービス その他サービス 公務
## Jan 2002        462           76            373  219
## Feb 2002        471           76            374  218
## Mar 2002        467           76            375  218
## Apr 2002        473           73            383  212
## May 2002        476           72            375  217
## Jun 2002        469           77            368  211</code></pre>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="時系列データ操作.html#cb699-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_ts)</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
</div>
<div id="週次データ" class="section level4 unnumbered hasAnchor">
<h4>週次データ<a href="時系列データ操作.html#週次データ" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>週次データを<code>ts()</code>関数でts形式に変換します。</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="時系列データ操作.html#cb701-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日次データのdata_owidから水曜日のデータを抽出して週次データに変換</span></span>
<span id="cb701-2"><a href="時系列データ操作.html#cb701-2" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb701-3"><a href="時系列データ操作.html#cb701-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">wday</span>(date) <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb701-4"><a href="時系列データ操作.html#cb701-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb701-5"><a href="時系列データ操作.html#cb701-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列の要素が重複している場合は、重複がなくなるように行をフィルタ</span></span>
<span id="cb701-6"><a href="時系列データ操作.html#cb701-6" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb701-7"><a href="時系列データ操作.html#cb701-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>)</span>
<span id="cb701-8"><a href="時系列データ操作.html#cb701-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb701-9"><a href="時系列データ操作.html#cb701-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb701-10"><a href="時系列データ操作.html#cb701-10" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb701-11"><a href="時系列データ操作.html#cb701-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date)</span>
<span id="cb701-12"><a href="時系列データ操作.html#cb701-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb701-13"><a href="時系列データ操作.html#cb701-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ts()関数でts形式に変換</span></span>
<span id="cb701-14"><a href="時系列データ操作.html#cb701-14" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb701-15"><a href="時系列データ操作.html#cb701-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="fl">365.25</span> <span class="sc">/</span> <span class="dv">7</span>, <span class="co"># 周期：週次データのため周期は365.25 / 7</span></span>
<span id="cb701-16"><a href="時系列データ操作.html#cb701-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">c</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">min</span>(data_ts<span class="sc">$</span>date)), lubridate<span class="sc">::</span><span class="fu">week</span>(<span class="fu">min</span>(data_ts<span class="sc">$</span>date))) <span class="co"># データ開始時点の年と週番号を指定</span></span>
<span id="cb701-17"><a href="時系列データ操作.html#cb701-17" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb701-18"><a href="時系列データ操作.html#cb701-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb701-19"><a href="時系列データ操作.html#cb701-19" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## Time Series:
## Start = 2020.01916495551 
## End = 2020.11498973306 
## Frequency = 52.1785714285714 
##          continent location  date total_cases new_cases new_cases_smoothed
## 2020.019         1        1 18269          NA         0              0.000
## 2020.038         1        1 18276           1         0              0.143
## 2020.057         1        1 18283           1         0              0.000
## 2020.077         1        1 18290           7         3              0.857
## 2020.096         1        1 18297          23         3              2.286
## 2020.115         1        1 18304          28         2              0.714
##          total_deaths new_deaths total_cases_per_million new_cases_per_million
## 2020.019           NA          0                      NA                 0.000
## 2020.038           NA          0                   0.008                 0.000
## 2020.057           NA          0                   0.008                 0.000
## 2020.077           NA          0                   0.056                 0.024
## 2020.096           NA          0                   0.186                 0.024
## 2020.115           NA          0                   0.226                 0.016
##          total_deaths_per_million new_deaths_per_million
## 2020.019                       NA                      0
## 2020.038                       NA                      0
## 2020.057                       NA                      0
## 2020.077                       NA                      0
## 2020.096                       NA                      0
## 2020.115                       NA                      0
##          people_fully_vaccinated stringency_index
## 2020.019                      NA             2.78
## 2020.038                      NA             2.78
## 2020.057                      NA             2.78
## 2020.077                      NA             2.78
## 2020.096                      NA            19.44
## 2020.115                      NA            19.44</code></pre>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="時系列データ操作.html#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_ts)</span></code></pre></div>
<pre><code>## [1] 52.17857</code></pre>
</div>
<div id="日次データ" class="section level4 unnumbered hasAnchor">
<h4>日次データ<a href="時系列データ操作.html#日次データ" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>日次データを<code>ts()</code>関数でts形式に変換します。</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="時系列データ操作.html#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列の要素が重複している場合は、重複がなくなるように行をフィルタ</span></span>
<span id="cb705-2"><a href="時系列データ操作.html#cb705-2" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb705-3"><a href="時系列データ操作.html#cb705-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>)</span>
<span id="cb705-4"><a href="時系列データ操作.html#cb705-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-5"><a href="時系列データ操作.html#cb705-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb705-6"><a href="時系列データ操作.html#cb705-6" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb705-7"><a href="時系列データ操作.html#cb705-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date)</span>
<span id="cb705-8"><a href="時系列データ操作.html#cb705-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-9"><a href="時系列データ操作.html#cb705-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ts()関数でts形式に変換</span></span>
<span id="cb705-10"><a href="時系列データ操作.html#cb705-10" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb705-11"><a href="時系列データ操作.html#cb705-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="fl">365.25</span>, <span class="co"># 周期：日次データのため周期は365.25</span></span>
<span id="cb705-12"><a href="時系列データ操作.html#cb705-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">c</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">min</span>(data_ts<span class="sc">$</span>date)), <span class="fu">as.numeric</span>(<span class="fu">min</span>(data_ts<span class="sc">$</span>date) <span class="sc">-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>))) <span class="co"># データ開始時点の年と、年初からの日数を指定</span></span>
<span id="cb705-13"><a href="時系列データ操作.html#cb705-13" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb705-14"><a href="時系列データ操作.html#cb705-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-15"><a href="時系列データ操作.html#cb705-15" aria-hidden="true" tabindex="-1"></a>data_ts <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## Time Series:
## Start = 2020.00273785079 
## End = 2020.01642710472 
## Frequency = 365.25 
##          continent location  date total_cases new_cases new_cases_smoothed
## 2020.003         1        1 18264          NA         0                 NA
## 2020.005         1        1 18265          NA         0                 NA
## 2020.008         1        1 18266          NA         0                 NA
## 2020.011         1        1 18267          NA         0                 NA
## 2020.014         1        1 18268          NA         0                 NA
## 2020.016         1        1 18269          NA         0                  0
##          total_deaths new_deaths total_cases_per_million new_cases_per_million
## 2020.003           NA          0                      NA                     0
## 2020.005           NA          0                      NA                     0
## 2020.008           NA          0                      NA                     0
## 2020.011           NA          0                      NA                     0
## 2020.014           NA          0                      NA                     0
## 2020.016           NA          0                      NA                     0
##          total_deaths_per_million new_deaths_per_million
## 2020.003                       NA                      0
## 2020.005                       NA                      0
## 2020.008                       NA                      0
## 2020.011                       NA                      0
## 2020.014                       NA                      0
## 2020.016                       NA                      0
##          people_fully_vaccinated stringency_index
## 2020.003                      NA             0.00
## 2020.005                      NA             0.00
## 2020.008                      NA             0.00
## 2020.011                      NA             0.00
## 2020.014                      NA             2.78
## 2020.016                      NA             2.78</code></pre>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="時系列データ操作.html#cb707-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_ts)</span></code></pre></div>
<pre><code>## [1] 365.25</code></pre>
</div>
</div>
<div id="ts形式に変換as_tsibble" class="section level3 unnumbered hasAnchor">
<h3>ts形式に変換：as_tsibble()<a href="時系列データ操作.html#ts形式に変換as_tsibble" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>as_tsibble()</code>関数を使用して、通常のデータフレーム形式のデータを、tsibble形式のデータフレームに変換します。tsibble形式とは、ts形式の情報をもったtibbleのようなものです。</p>
<p><code>as_tsibble()</code>関数の<code>index</code>引数に日付情報を格納した列を指定します。tsibble形式では日付を格納した列において要素が重複することを許容しないため、縦型データで日付要素が重複している場合は、<code>key</code>引数に日付要素を一意にするための列名を指定します。</p>
<p><code>as_tsibble()</code>関数では、<code>index</code>引数に指定した列の内容で周期が自動的に判断されます。<code>YYYY-MM-DD</code>の形になっているDate型の列は日次（day）と判断されるため、四半期、月次、週次データは、それぞれyearquarter型、yearmonth型、yearweek型にあらかじめ変換してから<code>as_tsibble()</code>関数を適用する必要があります。なお、<code>YYYY</code>の形は年次データと判断されます。</p>
<div id="年次データ-1" class="section level4 unnumbered hasAnchor">
<h4>年次データ<a href="時系列データ操作.html#年次データ-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>年次データを<code>as_tsibble()</code>関数でtsibble形式に変換します。周期は1年になります。</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="時系列データ操作.html#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb709-2"><a href="時系列データ操作.html#cb709-2" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="ot">&lt;-</span> data_gdp_pref <span class="sc">%&gt;%</span> </span>
<span id="cb709-3"><a href="時系列データ操作.html#cb709-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(year)</span>
<span id="cb709-4"><a href="時系列データ操作.html#cb709-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-5"><a href="時系列データ操作.html#cb709-5" aria-hidden="true" tabindex="-1"></a><span class="co"># key引数にpref_nameを指定してtsibble形式に変換</span></span>
<span id="cb709-6"><a href="時系列データ操作.html#cb709-6" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb709-7"><a href="時系列データ操作.html#cb709-7" aria-hidden="true" tabindex="-1"></a>  tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> year, <span class="at">key =</span> pref_name)</span>
<span id="cb709-8"><a href="時系列データ操作.html#cb709-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-9"><a href="時系列データ操作.html#cb709-9" aria-hidden="true" tabindex="-1"></a>data_tsibble</span></code></pre></div>
<pre><code>## # A tsibble: 611 x 5 [1Y]
## # Key:       pref_name [47]
##    pref_code pref_name  year gdp_nominal gdp_nominal_pchg
##        &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;
##  1        24 三重県     2006     8391255            NA   
##  2        24 三重県     2007     8586062             2.32
##  3        24 三重県     2008     7858164            -8.48
##  4        24 三重県     2009     7491413            -4.67
##  5        24 三重県     2010     7694240             2.71
##  6        24 三重県     2011     7435912            -3.36
##  7        24 三重県     2012     7626982             2.57
##  8        24 三重県     2013     7919655             3.84
##  9        24 三重県     2014     7671850            -3.13
## 10        24 三重県     2015     7916818             3.19
## # … with 601 more rows</code></pre>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="時系列データ操作.html#cb711-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_tsibble)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="四半期データ-1" class="section level4 unnumbered hasAnchor">
<h4>四半期データ<a href="時系列データ操作.html#四半期データ-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>四半期データを<code>as_tsibble()</code>関数でtsibble形式に変換します。周期は4四半期になります。</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="時系列データ操作.html#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb713-2"><a href="時系列データ操作.html#cb713-2" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="ot">&lt;-</span> data_gdp_jp <span class="sc">%&gt;%</span> </span>
<span id="cb713-3"><a href="時系列データ操作.html#cb713-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(日付)</span>
<span id="cb713-4"><a href="時系列データ操作.html#cb713-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-5"><a href="時系列データ操作.html#cb713-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列をyearquarter型に変換してからtsibble形式に変換</span></span>
<span id="cb713-6"><a href="時系列データ操作.html#cb713-6" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb713-7"><a href="時系列データ操作.html#cb713-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(日付 <span class="ot">=</span> 日付 <span class="sc">%&gt;%</span> tsibble<span class="sc">::</span><span class="fu">yearquarter</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb713-8"><a href="時系列データ操作.html#cb713-8" aria-hidden="true" tabindex="-1"></a>  tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> 日付)</span>
<span id="cb713-9"><a href="時系列データ操作.html#cb713-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-10"><a href="時系列データ操作.html#cb713-10" aria-hidden="true" tabindex="-1"></a>data_tsibble</span></code></pre></div>
<pre><code>## # A tsibble: 113 x 11 [1Q]
##       日付 国内総生産 民間最終…¹ 民間…² 民間企…³ 民間…⁴ 政府最…⁵ 公的…⁶ 公的在…⁷
##      &lt;qtr&gt;      &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 1994 Q1    446308.    247535. 29812    66259.  4229    71357. 47106.   -542. 
##  2 1994 Q2    443744.    248758. 31118.   66065  -2884.   72244. 48020.    623. 
##  3 1994 Q3    448945     250619. 33628.   65999.  -280.   72789  46303.    806. 
##  4 1994 Q4    447169.    250780  32218.   67029. -1602.   72950. 45589.    853. 
##  5 1995 Q1    452113     252928. 31122.   68648.  2254.   74470. 43642.    -27.7
##  6 1995 Q2    456276.    254884. 30382.   71088   1117.   74611. 45422.    199. 
##  7 1995 Q3    461709.    256356. 29742.   72334.  2106.   75543  48926     173. 
##  8 1995 Q4    462860.    258171. 30431.   73525.  1033.   75789  49134.    235. 
##  9 1996 Q1    466623.    257412. 31806.   73285   1643    76459  51647.    597. 
## 10 1996 Q2    472494.    260510  33278.   75804   2979.   76392. 50920     191. 
## # … with 103 more rows, 2 more variables: 純輸出 &lt;dbl&gt;, 開差 &lt;dbl&gt;, and
## #   abbreviated variable names ¹​民間最終消費支出, ²​民間住宅, ³​民間企業設備,
## #   ⁴​民間在庫変動, ⁵​政府最終消費支出, ⁶​公的固定資本形成, ⁷​公的在庫変動</code></pre>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="時系列データ操作.html#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_tsibble)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
</div>
<div id="月次データ-1" class="section level4 unnumbered hasAnchor">
<h4>月次データ<a href="時系列データ操作.html#月次データ-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>月次データを<code>as_tsibble()</code>関数でtsibble形式に変換します。周期は12カ月になります。</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="時系列データ操作.html#cb717-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb717-2"><a href="時系列データ操作.html#cb717-2" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="ot">&lt;-</span> data_labor <span class="sc">%&gt;%</span> </span>
<span id="cb717-3"><a href="時系列データ操作.html#cb717-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date)</span>
<span id="cb717-4"><a href="時系列データ操作.html#cb717-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-5"><a href="時系列データ操作.html#cb717-5" aria-hidden="true" tabindex="-1"></a><span class="co"># date列をyearmonth型に変換してからtsibble形式に変換</span></span>
<span id="cb717-6"><a href="時系列データ操作.html#cb717-6" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="sc">%&lt;&gt;%</span></span>
<span id="cb717-7"><a href="時系列データ操作.html#cb717-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> date <span class="sc">%&gt;%</span> tsibble<span class="sc">::</span><span class="fu">yearmonth</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb717-8"><a href="時系列データ操作.html#cb717-8" aria-hidden="true" tabindex="-1"></a>  tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> date)</span>
<span id="cb717-9"><a href="時系列データ操作.html#cb717-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-10"><a href="時系列データ操作.html#cb717-10" aria-hidden="true" tabindex="-1"></a>data_tsibble</span></code></pre></div>
<pre><code>## # A tsibble: 256 x 18 [1M]
##        date  総数  農林  建設  製造 情報通信 運輸・郵…¹ 卸・小…² 金融…³ 不動産…⁴
##       &lt;mth&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 2002 Jan  6267   224   589  1210      153        331     1131    165       95
##  2 2002 Feb  6248   227   611  1201      156        324     1075    164       96
##  3 2002 Mar  6297   242   628  1238      156        323     1081    161       99
##  4 2002 Apr  6333   278   624  1213      159        315     1121    167       95
##  5 2002 May  6356   307   607  1194      157        322     1134    171       96
##  6 2002 Jun  6373   311   594  1223      159        330     1115    170      108
##  7 2002 Jul  6374   294   622  1199      160        328     1116    180      110
##  8 2002 Aug  6371   288   620  1207      164        326     1085    176      103
##  9 2002 Sep  6353   286   621  1183      171        333     1081    174      100
## 10 2002 Oct  6355   271   642  1176      160        333     1116    172      102
## # … with 246 more rows, 8 more variables: `学術・専門・技術` &lt;dbl&gt;,
## #   `宿泊・飲食` &lt;dbl&gt;, `生活関連・娯楽` &lt;dbl&gt;, 教育 &lt;dbl&gt;, `医療・福祉` &lt;dbl&gt;,
## #   複合サービス &lt;dbl&gt;, その他サービス &lt;dbl&gt;, 公務 &lt;dbl&gt;, and abbreviated
## #   variable names ¹​`運輸・郵便`, ²​`卸・小売`, ³​`金融・保険`,
## #   ⁴​`不動産・物品賃貸`</code></pre>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="時系列データ操作.html#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_tsibble)</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
</div>
<div id="週次データ-1" class="section level4 unnumbered hasAnchor">
<h4>週次データ<a href="時系列データ操作.html#週次データ-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>週次データを<code>as_tsibble()</code>関数でtsibble形式に変換します。周期は52.18週になります。</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="時系列データ操作.html#cb721-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日次データのdata_owidから水曜日のデータを抽出して週次データに変換</span></span>
<span id="cb721-2"><a href="時系列データ操作.html#cb721-2" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb721-3"><a href="時系列データ操作.html#cb721-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">wday</span>(date) <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb721-4"><a href="時系列データ操作.html#cb721-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-5"><a href="時系列データ操作.html#cb721-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb721-6"><a href="時系列データ操作.html#cb721-6" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb721-7"><a href="時系列データ操作.html#cb721-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date)</span>
<span id="cb721-8"><a href="時系列データ操作.html#cb721-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-9"><a href="時系列データ操作.html#cb721-9" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb721-10"><a href="時系列データ操作.html#cb721-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> date <span class="sc">%&gt;%</span> tsibble<span class="sc">::</span><span class="fu">yearweek</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb721-11"><a href="時系列データ操作.html#cb721-11" aria-hidden="true" tabindex="-1"></a>  tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> date, <span class="at">key =</span> location)</span>
<span id="cb721-12"><a href="時系列データ操作.html#cb721-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-13"><a href="時系列データ操作.html#cb721-13" aria-hidden="true" tabindex="-1"></a>data_tsibble</span></code></pre></div>
<pre><code>## # A tsibble: 45,516 x 14 [1W]
## # Key:       location [255]
##    continent location       date total…¹ new_c…² new_c…³ total…⁴ new_d…⁵ total…⁶
##    &lt;chr&gt;     &lt;chr&gt;        &lt;week&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Asia      Afghanist… 2020 W02      NA       0   0          NA       0  NA    
##  2 Asia      Afghanist… 2020 W03      NA       0   0          NA       0  NA    
##  3 Asia      Afghanist… 2020 W04      NA       0   0          NA       0  NA    
##  4 Asia      Afghanist… 2020 W05      NA       0   0          NA       0  NA    
##  5 Asia      Afghanist… 2020 W06      NA       0   0          NA       0  NA    
##  6 Asia      Afghanist… 2020 W07      NA       0   0          NA       0  NA    
##  7 Asia      Afghanist… 2020 W08      NA       0   0          NA       0  NA    
##  8 Asia      Afghanist… 2020 W09       1       1   0.143      NA       0   0.024
##  9 Asia      Afghanist… 2020 W10       1       0   0          NA       0   0.024
## 10 Asia      Afghanist… 2020 W11       4       0   0.429      NA       0   0.097
## # … with 45,506 more rows, 5 more variables: new_cases_per_million &lt;dbl&gt;,
## #   total_deaths_per_million &lt;dbl&gt;, new_deaths_per_million &lt;dbl&gt;,
## #   people_fully_vaccinated &lt;dbl&gt;, stringency_index &lt;dbl&gt;, and abbreviated
## #   variable names ¹​total_cases, ²​new_cases, ³​new_cases_smoothed,
## #   ⁴​total_deaths, ⁵​new_deaths, ⁶​total_cases_per_million</code></pre>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="時系列データ操作.html#cb723-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_tsibble)</span></code></pre></div>
<pre><code>## [1] 52.18</code></pre>
</div>
<div id="日次データ-1" class="section level4 unnumbered hasAnchor">
<h4>日次データ<a href="時系列データ操作.html#日次データ-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>日次データを<code>as_tsibble()</code>関数でtsibble形式に変換します。周期は7日になります。</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb725-1"><a href="時系列データ操作.html#cb725-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付列で昇順に並べ替え</span></span>
<span id="cb725-2"><a href="時系列データ操作.html#cb725-2" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb725-3"><a href="時系列データ操作.html#cb725-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date)</span>
<span id="cb725-4"><a href="時系列データ操作.html#cb725-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb725-5"><a href="時系列データ操作.html#cb725-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tsibble形式に変換</span></span>
<span id="cb725-6"><a href="時系列データ操作.html#cb725-6" aria-hidden="true" tabindex="-1"></a>data_tsibble <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb725-7"><a href="時系列データ操作.html#cb725-7" aria-hidden="true" tabindex="-1"></a>  tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> date, <span class="at">key =</span> location)</span>
<span id="cb725-8"><a href="時系列データ操作.html#cb725-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb725-9"><a href="時系列データ操作.html#cb725-9" aria-hidden="true" tabindex="-1"></a>data_tsibble</span></code></pre></div>
<pre><code>## # A tsibble: 318,421 x 14 [1D]
## # Key:       location [255]
##    continent location date       total…¹ new_c…² new_c…³ total…⁴ new_d…⁵ total…⁶
##    &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Asia      Afghani… 2020-01-03      NA       0      NA      NA       0      NA
##  2 Asia      Afghani… 2020-01-04      NA       0      NA      NA       0      NA
##  3 Asia      Afghani… 2020-01-05      NA       0      NA      NA       0      NA
##  4 Asia      Afghani… 2020-01-06      NA       0      NA      NA       0      NA
##  5 Asia      Afghani… 2020-01-07      NA       0      NA      NA       0      NA
##  6 Asia      Afghani… 2020-01-08      NA       0       0      NA       0      NA
##  7 Asia      Afghani… 2020-01-09      NA       0       0      NA       0      NA
##  8 Asia      Afghani… 2020-01-10      NA       0       0      NA       0      NA
##  9 Asia      Afghani… 2020-01-11      NA       0       0      NA       0      NA
## 10 Asia      Afghani… 2020-01-12      NA       0       0      NA       0      NA
## # … with 318,411 more rows, 5 more variables: new_cases_per_million &lt;dbl&gt;,
## #   total_deaths_per_million &lt;dbl&gt;, new_deaths_per_million &lt;dbl&gt;,
## #   people_fully_vaccinated &lt;dbl&gt;, stringency_index &lt;dbl&gt;, and abbreviated
## #   variable names ¹​total_cases, ²​new_cases, ³​new_cases_smoothed,
## #   ⁴​total_deaths, ⁵​new_deaths, ⁶​total_cases_per_million</code></pre>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="時系列データ操作.html#cb727-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(data_tsibble)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
</div>
</div>
</div>
<div id="日付型データ関数" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> 日付型データ関数<a href="時系列データ操作.html#日付型データ関数" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>日付型データを扱う際に便利な関数を紹介します。</p>
<div id="日付型データの生成" class="section level3 unnumbered hasAnchor">
<h3>日付型データの生成<a href="時系列データ操作.html#日付型データの生成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>連続した日付型データを生成するには、<code>seq()</code>関数を使用します。</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="時系列データ操作.html#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 開始日と終了日を指定して1年毎の日付データを生成</span></span>
<span id="cb729-2"><a href="時系列データ操作.html#cb729-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2010-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 year&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;2010-01-01&quot; &quot;2011-01-01&quot; &quot;2012-01-01&quot; &quot;2013-01-01&quot; &quot;2014-01-01&quot;
##  [6] &quot;2015-01-01&quot; &quot;2016-01-01&quot; &quot;2017-01-01&quot; &quot;2018-01-01&quot; &quot;2019-01-01&quot;
## [11] &quot;2020-01-01&quot;</code></pre>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="時系列データ操作.html#cb731-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 開始日と終了日を指定して1四半期毎の日付データを生成</span></span>
<span id="cb731-2"><a href="時系列データ操作.html#cb731-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2010-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2012-12-31&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 quarter&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;2010-01-01&quot; &quot;2010-04-01&quot; &quot;2010-07-01&quot; &quot;2010-10-01&quot; &quot;2011-01-01&quot;
##  [6] &quot;2011-04-01&quot; &quot;2011-07-01&quot; &quot;2011-10-01&quot; &quot;2012-01-01&quot; &quot;2012-04-01&quot;
## [11] &quot;2012-07-01&quot; &quot;2012-10-01&quot;</code></pre>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="時系列データ操作.html#cb733-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 開始日と終了日を指定して2カ月毎の日付データを生成</span></span>
<span id="cb733-2"><a href="時系列データ操作.html#cb733-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-12-31&quot;</span>), <span class="at">by =</span> <span class="st">&quot;2 month&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-01&quot; &quot;2022-03-01&quot; &quot;2022-05-01&quot; &quot;2022-07-01&quot; &quot;2022-09-01&quot;
## [6] &quot;2022-11-01&quot;</code></pre>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="時系列データ操作.html#cb735-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 開始日と終了日を指定して3週間毎の日付データを生成</span></span>
<span id="cb735-2"><a href="時系列データ操作.html#cb735-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-03-30&quot;</span>), <span class="at">by =</span> <span class="st">&quot;3 week&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-01&quot; &quot;2022-01-22&quot; &quot;2022-02-12&quot; &quot;2022-03-05&quot; &quot;2022-03-26&quot;</code></pre>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="時系列データ操作.html#cb737-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 開始日と終了日を指定して4日毎の日付データを生成</span></span>
<span id="cb737-2"><a href="時系列データ操作.html#cb737-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-01-31&quot;</span>), <span class="at">by =</span> <span class="st">&quot;4 day&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-01&quot; &quot;2022-01-05&quot; &quot;2022-01-09&quot; &quot;2022-01-13&quot; &quot;2022-01-17&quot;
## [6] &quot;2022-01-21&quot; &quot;2022-01-25&quot; &quot;2022-01-29&quot;</code></pre>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="時系列データ操作.html#cb739-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 開始日とデータ数を指定して1カ月毎の日付データを生成</span></span>
<span id="cb739-2"><a href="時系列データ操作.html#cb739-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 month&quot;</span>, <span class="at">length.out =</span> <span class="dv">12</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;2022-01-01&quot; &quot;2022-02-01&quot; &quot;2022-03-01&quot; &quot;2022-04-01&quot; &quot;2022-05-01&quot;
##  [6] &quot;2022-06-01&quot; &quot;2022-07-01&quot; &quot;2022-08-01&quot; &quot;2022-09-01&quot; &quot;2022-10-01&quot;
## [11] &quot;2022-11-01&quot; &quot;2022-12-01&quot;</code></pre>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="時系列データ操作.html#cb741-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 開始日とデータ数を合わせるベクトルを指定して2日毎の日付データを生成</span></span>
<span id="cb741-2"><a href="時系列データ操作.html#cb741-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 day&quot;</span>, <span class="at">along.with =</span> letters)</span></code></pre></div>
<pre><code>##  [1] &quot;2022-01-01&quot; &quot;2022-01-02&quot; &quot;2022-01-03&quot; &quot;2022-01-04&quot; &quot;2022-01-05&quot;
##  [6] &quot;2022-01-06&quot; &quot;2022-01-07&quot; &quot;2022-01-08&quot; &quot;2022-01-09&quot; &quot;2022-01-10&quot;
## [11] &quot;2022-01-11&quot; &quot;2022-01-12&quot; &quot;2022-01-13&quot; &quot;2022-01-14&quot; &quot;2022-01-15&quot;
## [16] &quot;2022-01-16&quot; &quot;2022-01-17&quot; &quot;2022-01-18&quot; &quot;2022-01-19&quot; &quot;2022-01-20&quot;
## [21] &quot;2022-01-21&quot; &quot;2022-01-22&quot; &quot;2022-01-23&quot; &quot;2022-01-24&quot; &quot;2022-01-25&quot;
## [26] &quot;2022-01-26&quot;</code></pre>
</div>
<div id="日付型データの計算" class="section level3 unnumbered hasAnchor">
<h3>日付型データの計算<a href="時系列データ操作.html#日付型データの計算" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>日付型データの年・月・日を足し引きするには、<code>years()</code>、<code>months()</code>、<code>days()</code>関数を使用します。</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="時系列データ操作.html#cb743-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 年</span></span>
<span id="cb743-2"><a href="時系列データ操作.html#cb743-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2028-01-01&quot;</code></pre>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="時系列データ操作.html#cb745-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 月</span></span>
<span id="cb745-2"><a href="時系列データ操作.html#cb745-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>) <span class="sc">-</span> <span class="fu">months</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022-10-01&quot;</code></pre>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb747-1"><a href="時系列データ操作.html#cb747-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日</span></span>
<span id="cb747-2"><a href="時系列データ操作.html#cb747-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2023-04-11&quot;</code></pre>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="時系列データ操作.html#cb749-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 年・月・日</span></span>
<span id="cb749-2"><a href="時系列データ操作.html#cb749-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2024-02-02&quot;</code></pre>
</div>
<div id="日付型と文字列型の変換" class="section level3 unnumbered hasAnchor">
<h3>日付型と文字列型の変換<a href="時系列データ操作.html#日付型と文字列型の変換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>日付型データを文字列型データに変換するには、<code>strftime()</code>関数を使用します。一方、文字列型データを日付型データに変換するには、<code>strptime()</code>関数や、lubridateパッケージの<code>ymd()</code>関数を使用します。</p>
<p><code>format</code>引数は以下のように指定します。</p>
<p><code>%Y</code>：4桁の年
<code>%y</code>：下2桁の年
<code>%m</code>：2桁の月（01～12）
<code>%d</code>：2桁の日（01～31）
<code>%e</code>：1～2桁の日（1～31、1桁の日は前に半角スペースあり）</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="時系列データ操作.html#cb751-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付型データを文字列型データに変換</span></span>
<span id="cb751-2"><a href="時系列データ操作.html#cb751-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strftime</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="at">format =</span> <span class="st">&quot;%Y年%m月%d日&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022年01月01日&quot;</code></pre>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="時系列データ操作.html#cb753-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付型データを文字列型データに変換する際、月と日を1桁表示して半角スペースを削除</span></span>
<span id="cb753-2"><a href="時系列データ操作.html#cb753-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strftime</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="at">format =</span> <span class="st">&quot;%m/%e&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb753-3"><a href="時系列データ操作.html#cb753-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="st">&quot;^0&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb753-4"><a href="時系列データ操作.html#cb753-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="at">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1/1&quot;</code></pre>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="時系列データ操作.html#cb755-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 文字列型データを日付型データに変換</span></span>
<span id="cb755-2"><a href="時系列データ操作.html#cb755-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strptime</span>(<span class="st">&quot;20221231&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y%m%d&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022-12-31 JST&quot;</code></pre>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="時系列データ操作.html#cb757-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 年月日の順番で記載されている文字列型データを日付型データに変換</span></span>
<span id="cb757-2"><a href="時系列データ操作.html#cb757-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;20000101&quot;</span>, <span class="st">&quot;010203&quot;</span>, <span class="st">&quot;020505&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2000-01-01&quot; &quot;2001-02-03&quot; &quot;2002-05-05&quot;</code></pre>
</div>
<div id="日付情報の抽出" class="section level3 unnumbered hasAnchor">
<h3>日付情報の抽出<a href="時系列データ操作.html#日付情報の抽出" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>日付型データから日付情報を抽出するには、lubridateパッケージの関数を用います。</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="時系列データ操作.html#cb759-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 年</span></span>
<span id="cb759-2"><a href="時系列データ操作.html#cb759-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 2022</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="時系列データ操作.html#cb761-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 月</span></span>
<span id="cb761-2"><a href="時系列データ操作.html#cb761-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">month</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2022-12-31&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="時系列データ操作.html#cb763-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日</span></span>
<span id="cb763-2"><a href="時系列データ操作.html#cb763-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2022-01-15&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 2022</code></pre>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="時系列データ操作.html#cb765-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 四半期</span></span>
<span id="cb765-2"><a href="時系列データ操作.html#cb765-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">quarter</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;2022-01-10&quot;</span>, <span class="st">&quot;2022-05-01&quot;</span>, <span class="st">&quot;2022-09-30&quot;</span>, <span class="st">&quot;2022-11-20&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="時系列データ操作.html#cb767-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 曜日番号（日曜：1～土曜：7）</span></span>
<span id="cb767-2"><a href="時系列データ操作.html#cb767-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">wday</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;2022-01-01&quot;</span>, <span class="st">&quot;2022-01-02&quot;</span>, <span class="st">&quot;2022-01-03&quot;</span>, <span class="st">&quot;2022-01-08&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] 7 1 2 7</code></pre>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="時系列データ操作.html#cb769-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 週番号（1月1日始まり）</span></span>
<span id="cb769-2"><a href="時系列データ操作.html#cb769-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">week</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;2022-01-01&quot;</span>, <span class="st">&quot;2022-01-02&quot;</span>, <span class="st">&quot;2022-01-03&quot;</span>, <span class="st">&quot;2022-01-08&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] 1 1 1 2</code></pre>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="時系列データ操作.html#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 週番号（最初の月曜始まり）</span></span>
<span id="cb771-2"><a href="時系列データ操作.html#cb771-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">isoweek</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;2022-01-01&quot;</span>, <span class="st">&quot;2022-01-02&quot;</span>, <span class="st">&quot;2022-01-03&quot;</span>, <span class="st">&quot;2022-01-08&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] 52 52  1  1</code></pre>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="時系列データ操作.html#cb773-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 週番号（最初の日曜始まり）</span></span>
<span id="cb773-2"><a href="時系列データ操作.html#cb773-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">epiweek</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;2022-01-01&quot;</span>, <span class="st">&quot;2022-01-02&quot;</span>, <span class="st">&quot;2022-01-03&quot;</span>, <span class="st">&quot;2022-01-08&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] 52  1  1  1</code></pre>
</div>
<div id="四半期ベースの時系列インデックス" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> 四半期ベースの時系列インデックス<a href="時系列データ操作.html#四半期ベースの時系列インデックス" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>日付型データから四半期ベースの時系列インデックスを生成するには<code>lubridate::quarter()</code>関数を、四半期ベースの時系列インデックスから日付型データを作成するには<code>lubridate::date()</code>関数と<code>zoo::as.yearqtr()</code>関数を使用します。</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="時系列データ操作.html#cb775-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日付型データから四半期ベースのインデックスを生成</span></span>
<span id="cb775-2"><a href="時系列データ操作.html#cb775-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">quarter</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;2012-03-26&quot;</span>, <span class="st">&quot;2012-05-04&quot;</span>, <span class="st">&quot;2012-09-23&quot;</span>, <span class="st">&quot;2012-12-31&quot;</span>)),</span>
<span id="cb775-3"><a href="時系列データ操作.html#cb775-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">&quot;year.quarter&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 2012.1 2012.2 2012.3 2012.4</code></pre>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="時系列データ操作.html#cb777-1" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">quarter</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">&quot;2012-03-26&quot;</span>, <span class="st">&quot;2012-05-04&quot;</span>, <span class="st">&quot;2012-09-23&quot;</span>, <span class="st">&quot;2012-12-31&quot;</span>)),</span>
<span id="cb777-2"><a href="時系列データ操作.html#cb777-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">&quot;year.quarter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb777-3"><a href="時系列データ操作.html#cb777-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;Q&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2012Q1&quot; &quot;2012Q2&quot; &quot;2012Q3&quot; &quot;2012Q4&quot;</code></pre>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="時系列データ操作.html#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 四半期ベースのインデックスから日付型データを生成</span></span>
<span id="cb779-2"><a href="時系列データ操作.html#cb779-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">date</span>(zoo<span class="sc">::</span><span class="fu">as.yearqtr</span>(<span class="fu">c</span>(<span class="st">&quot;2012 Q1&quot;</span>, <span class="st">&quot;2012 Q2&quot;</span>, <span class="st">&quot;2012 Q3&quot;</span>, <span class="st">&quot;2012 Q4&quot;</span>), <span class="at">format =</span> <span class="st">&quot;%Y Q%q&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2012-01-01&quot; &quot;2012-04-01&quot; &quot;2012-07-01&quot; &quot;2012-10-01&quot;</code></pre>
</div>
</div>
<div id="様々な時系列データ系列の作成" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> 様々な時系列データ系列の作成<a href="時系列データ操作.html#様々な時系列データ系列の作成" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、時系列データのラグ・リード系列、変化率、移動平均を計算する方法を解説します。</p>
<p>まず、Our World in Dataの<code>data_owid</code>データセットから使用するサンプルデータを作成します。</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="時系列データ操作.html#cb781-1" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb781-2"><a href="時系列データ操作.html#cb781-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(location, date, new_cases, new_deaths) <span class="sc">%&gt;%</span> </span>
<span id="cb781-3"><a href="時系列データ操作.html#cb781-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>,</span>
<span id="cb781-4"><a href="時系列データ操作.html#cb781-4" aria-hidden="true" tabindex="-1"></a>                date <span class="sc">&gt;=</span> <span class="st">&quot;2022-01-01&quot;</span></span>
<span id="cb781-5"><a href="時系列データ操作.html#cb781-5" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<div id="ラグリード系列の作成" class="section level3 unnumbered hasAnchor">
<h3>ラグ・リード系列の作成<a href="時系列データ操作.html#ラグリード系列の作成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>dplyr::lag()</code>関数と<code>dplyr::leag()</code>関数で、既存の列のラグ・リード系列を作成します。</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="時系列データ操作.html#cb782-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1期ラグの系列を追加</span></span>
<span id="cb782-2"><a href="時系列データ操作.html#cb782-2" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="sc">%&gt;%</span> </span>
<span id="cb782-3"><a href="時系列データ操作.html#cb782-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">new_cases_lag =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(new_cases, <span class="at">n =</span> <span class="dv">1</span>)) </span></code></pre></div>
<pre><code>## # A tibble: 530 × 5
##    location date       new_cases new_deaths new_cases_lag
##    &lt;chr&gt;    &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
##  1 Japan    2022-01-01       504          0            NA
##  2 Japan    2022-01-02       516          2           504
##  3 Japan    2022-01-03       783          1           516
##  4 Japan    2022-01-04      1256          1           783
##  5 Japan    2022-01-05      2506          1          1256
##  6 Japan    2022-01-06      4194          0          2506
##  7 Japan    2022-01-07      5983          2          4194
##  8 Japan    2022-01-08      7930          2          5983
##  9 Japan    2022-01-09      8144          1          7930
## 10 Japan    2022-01-10      6394          2          8144
## # … with 520 more rows</code></pre>
</div>
<div id="変化率系列の作成" class="section level3 unnumbered hasAnchor">
<h3>変化率系列の作成<a href="時系列データ操作.html#変化率系列の作成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>dplyr::lag()</code>関数で、既存の列の変化率系列を作成します。</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="時系列データ操作.html#cb784-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 前期比変化率（％表示）の系列を追加</span></span>
<span id="cb784-2"><a href="時系列データ操作.html#cb784-2" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="sc">%&gt;%</span> </span>
<span id="cb784-3"><a href="時系列データ操作.html#cb784-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">new_cases_chg =</span> <span class="dv">100</span> <span class="sc">*</span> (new_cases <span class="sc">/</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(new_cases, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>)) </span></code></pre></div>
<pre><code>## # A tibble: 530 × 5
##    location date       new_cases new_deaths new_cases_chg
##    &lt;chr&gt;    &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
##  1 Japan    2022-01-01       504          0         NA   
##  2 Japan    2022-01-02       516          2          2.38
##  3 Japan    2022-01-03       783          1         51.7 
##  4 Japan    2022-01-04      1256          1         60.4 
##  5 Japan    2022-01-05      2506          1         99.5 
##  6 Japan    2022-01-06      4194          0         67.4 
##  7 Japan    2022-01-07      5983          2         42.7 
##  8 Japan    2022-01-08      7930          2         32.5 
##  9 Japan    2022-01-09      8144          1          2.70
## 10 Japan    2022-01-10      6394          2        -21.5 
## # … with 520 more rows</code></pre>
</div>
<div id="移動平均系列の作成" class="section level3 unnumbered hasAnchor">
<h3>移動平均系列の作成<a href="時系列データ操作.html#移動平均系列の作成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>zoo</code>パッケージの<code>rollmean()</code>関数で、移動平均系列を作成します。</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="時系列データ操作.html#cb786-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 後方7日移動平均の系列を追加</span></span>
<span id="cb786-2"><a href="時系列データ操作.html#cb786-2" aria-hidden="true" tabindex="-1"></a>data_owid_jp <span class="sc">%&gt;%</span> </span>
<span id="cb786-3"><a href="時系列データ操作.html#cb786-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">new_cases_7dma =</span> zoo<span class="sc">::</span><span class="fu">rollmean</span>(new_cases, <span class="co"># 移動平均を作成するもとの系列名</span></span>
<span id="cb786-4"><a href="時系列データ操作.html#cb786-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">k =</span> <span class="dv">7</span>, <span class="co"># 移動平均の期間</span></span>
<span id="cb786-5"><a href="時系列データ操作.html#cb786-5" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">na.pad =</span> <span class="cn">TRUE</span>, <span class="co"># 系列の先端部分で移動平均を計算できない箇所をNAで埋めるか</span></span>
<span id="cb786-6"><a href="時系列データ操作.html#cb786-6" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">align =</span> <span class="st">&quot;right&quot;</span>) <span class="co"># left：前方移動平均、center：中央移動平均、right：後方移動平均</span></span>
<span id="cb786-7"><a href="時系列データ操作.html#cb786-7" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## # A tibble: 530 × 5
##    location date       new_cases new_deaths new_cases_7dma
##    &lt;chr&gt;    &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;
##  1 Japan    2022-01-01       504          0            NA 
##  2 Japan    2022-01-02       516          2            NA 
##  3 Japan    2022-01-03       783          1            NA 
##  4 Japan    2022-01-04      1256          1            NA 
##  5 Japan    2022-01-05      2506          1            NA 
##  6 Japan    2022-01-06      4194          0            NA 
##  7 Japan    2022-01-07      5983          2          2249.
##  8 Japan    2022-01-08      7930          2          3310.
##  9 Japan    2022-01-09      8144          1          4399.
## 10 Japan    2022-01-10      6394          2          5201 
## # … with 520 more rows</code></pre>
</div>
</div>
<div id="時系列データの頻度変換" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> 時系列データの頻度変換<a href="時系列データ操作.html#時系列データの頻度変換" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>tidyverse</code>と整合性がある金融時系列データ分析用の<code>tidyquant</code>パッケージに含まれる<code>tq_transmute()</code>関数を用いて、時系列データの頻度変換（高頻度データから低頻度データへの変換）を行います。</p>
<p>なお、<code>tidyquant</code>は頻度変換以外にも様々な分析機能があります。詳しくは<a href="https://business-science.github.io/tidyquant/">公式ウェブサイト</a>を参照してください。</p>
<p>まず、Our World in Dataの<code>data_owid</code>データセットから、使用するサンプルデータを作成します。<code>tq_transmute()</code>関数に入力する時系列データは、原則として横型データである点に留意してください。</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="時系列データ操作.html#cb788-1" aria-hidden="true" tabindex="-1"></a><span class="co"># サンプルデータ（日次）</span></span>
<span id="cb788-2"><a href="時系列データ操作.html#cb788-2" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb788-3"><a href="時系列データ操作.html#cb788-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(location, date, new_cases) <span class="sc">%&gt;%</span> </span>
<span id="cb788-4"><a href="時系列データ操作.html#cb788-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="st">&quot;2021-01-01&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb788-5"><a href="時系列データ操作.html#cb788-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb788-6"><a href="時系列データ操作.html#cb788-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">&quot;date&quot;</span>, <span class="at">names_from =</span> <span class="st">&quot;location&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;new_cases&quot;</span>)</span></code></pre></div>
<div id="日次データを週次データに変換" class="section level3 unnumbered hasAnchor">
<h3>日次データを週次データに変換<a href="時系列データ操作.html#日次データを週次データに変換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>tidyquant::tq_transmute()</code>関数を使用して日次データを週次データに変換すると、月曜～日曜のデータが<code>FUN</code>に指定した関数で集計され、日曜の日付で記録されます。</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="時系列データ操作.html#cb789-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span> </span>
<span id="cb789-2"><a href="時系列データ操作.html#cb789-2" aria-hidden="true" tabindex="-1"></a>  tidyquant<span class="sc">::</span><span class="fu">tq_transmute</span>(<span class="at">select =</span> <span class="sc">-</span>date, <span class="at">mutate_fun =</span> apply.weekly, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 129 × 256
##    date       Afghanistan Africa Albania Algeria Americ…¹ Andorra Angola Angui…²
##    &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1 2021-01-03       126.  26506.    526.    283.        0    61     58.3   0.667
##  2 2021-01-10       111.  31139.    522.    251.        0    60     78.3   0    
##  3 2021-01-17        70.7 30384.    608.    243.        0    64.6   87     0    
##  4 2021-01-24        87.3 26347.    574.    251.        0    65.9   86     0    
##  5 2021-01-31        61.1 19323.    814.    250.        0    55.1   59.3   0.286
##  6 2021-02-07        44.6 15378.    962.    247.        0    45.9   40     0    
##  7 2021-02-14        22.4 12412.   1108.    237.        0    36.7   38.1   0.143
##  8 2021-02-21        16   11044.   1011.    179.        0    29.9   24.3   0    
##  9 2021-02-28        15.7 10580.   1046.    171.        0    25.3   40.4   0    
## 10 2021-03-07        19   10119     867.    163.        0    24.3   39     0    
## # … with 119 more rows, 247 more variables: `Antigua and Barbuda` &lt;dbl&gt;,
## #   Argentina &lt;dbl&gt;, Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;,
## #   Austria &lt;dbl&gt;, Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;,
## #   Bangladesh &lt;dbl&gt;, Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;,
## #   Belize &lt;dbl&gt;, Benin &lt;dbl&gt;, Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, …</code></pre>
<p>なお、日曜～土曜のデータを集計し日曜の日付で記録したい場合は、<code>rollmean()</code>関数を使用して前方7日移動平均を計算し、日曜の値を抽出します。</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="時系列データ操作.html#cb791-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span></span>
<span id="cb791-2"><a href="時系列データ操作.html#cb791-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>date, rollmean, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">na.pad =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">&quot;left&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb791-3"><a href="時系列データ操作.html#cb791-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">wday</span>(date) <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 128 × 256
##    date       Afghanistan Africa Albania Algeria Americ…¹ Andorra Angola Angui…²
##    &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1 2021-01-03       116.  29316.    484.    251.        0    53.1   71.1   0.143
##  2 2021-01-10        76.9 31496.    613.    246.        0    65.3   87.6   0    
##  3 2021-01-17        88.7 26499.    560.    249         0    67.1   84.3   0    
##  4 2021-01-24        64.1 20790.    791.    252.        0    60.1   64.9   0.143
##  5 2021-01-31        46   15983.    934.    249.        0    47.9   43.9   0.143
##  6 2021-02-07        20.4 12665.   1112.    239.        0    36.4   37.7   0.143
##  7 2021-02-14        15.3 11295.   1009.    185.        0    31.1   26.3   0    
##  8 2021-02-21        18.1 10772.   1068.    172.        0    25.3   40.1   0    
##  9 2021-02-28        19   10064.    887.    163.        0    25.1   38.1   0    
## 10 2021-03-07        17    9576.    703     151.        0    32.9   34.1   0.143
## # … with 118 more rows, 247 more variables: `Antigua and Barbuda` &lt;dbl&gt;,
## #   Argentina &lt;dbl&gt;, Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;,
## #   Austria &lt;dbl&gt;, Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;,
## #   Bangladesh &lt;dbl&gt;, Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;,
## #   Belize &lt;dbl&gt;, Benin &lt;dbl&gt;, Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, …</code></pre>
</div>
<div id="日次データを月次データに変換" class="section level3 unnumbered hasAnchor">
<h3>日次データを月次データに変換<a href="時系列データ操作.html#日次データを月次データに変換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>tidyquant::tq_transmute()</code>関数を使用して日次データを月次データに変換すると、月初～月末のデータが<code>FUN</code>に指定した関数で集計され、月末の日付で記録されます。</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="時系列データ操作.html#cb793-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span> </span>
<span id="cb793-2"><a href="時系列データ操作.html#cb793-2" aria-hidden="true" tabindex="-1"></a>  tidyquant<span class="sc">::</span><span class="fu">tq_transmute</span>(<span class="at">select =</span> <span class="sc">-</span>date, <span class="at">mutate_fun =</span> apply.monthly, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 30 × 256
##    date       Afghanistan Africa Albania Algeria Americ…¹ Andorra Angola Angui…²
##    &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1 2021-01-31        86.9 26770.   619.     252.   0        61.4    75.8  0.129 
##  2 2021-02-28        24.7 12354.  1031.     208.   0        34.4    35.7  0.0357
##  3 2021-03-31        23.9 10559.   619.     132.   0        35.3    45.2  0.226 
##  4 2021-04-30       110.  11586.   215.     160.   0        41.8   142.   2.2   
##  5 2021-05-31       390.   9274.    46.4    221.   0        16.0   256.   0.581 
##  6 2021-06-30      1561.  21463.     7.2    350.   0         6.9   144.   0     
##  7 2021-07-31       919.  39375.    15.7    999.   0        25.1   128.   0.161 
##  8 2021-08-31       196.  36218.   382.     819.   0        11.4   151.   3.32  
##  9 2021-09-30        61.1 17490.   798.     254.   0.0333    5.9   308.   5.73  
## 10 2021-10-31        33.4  6606.   502.     102.   0.0968    9.90  251.  16.2   
## # … with 20 more rows, 247 more variables: `Antigua and Barbuda` &lt;dbl&gt;,
## #   Argentina &lt;dbl&gt;, Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;,
## #   Austria &lt;dbl&gt;, Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;,
## #   Bangladesh &lt;dbl&gt;, Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;,
## #   Belize &lt;dbl&gt;, Benin &lt;dbl&gt;, Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, …</code></pre>
</div>
<div id="日次データを四半期データに変換" class="section level3 unnumbered hasAnchor">
<h3>日次データを四半期データに変換<a href="時系列データ操作.html#日次データを四半期データに変換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>tidyquant::tq_transmute()</code>関数を使用して日次データを四半期データに変換すると、期初～期末のデータが<code>FUN</code>に指定した関数で集計され、期末の日付で記録されます。</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="時系列データ操作.html#cb795-1" aria-hidden="true" tabindex="-1"></a>data_owid_cases_wide <span class="sc">%&gt;%</span> </span>
<span id="cb795-2"><a href="時系列データ操作.html#cb795-2" aria-hidden="true" tabindex="-1"></a>  tidyquant<span class="sc">::</span><span class="fu">tq_transmute</span>(<span class="at">select =</span> <span class="sc">-</span>date, <span class="at">mutate_fun =</span> apply.quarterly, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 256
##    date       Afghanistan Africa Albania Algeria Ameri…¹ Andorra  Angola Angui…²
##    &lt;date&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 2021-03-31        45.8 16701.  747.    197.    0        44.0   52.8     0.133
##  2 2021-06-30       684.  14055.   88.9   244.    0        21.5  181.      0.923
##  3 2021-09-30       396.  31175.  394.    695.    0.0109   14.2  195.      3.04 
##  4 2021-12-31        32.7 15796.  436.    161.    0.109    86.0  220.     14.0  
##  5 2022-03-31       218.  23134.  718.    529.   42.3     188.   248.     11.4  
##  6 2022-06-30        52.0  6424.   62.0     4.52 29.5      41.2   24.0     8.31 
##  7 2022-09-30       181.   3893.  563.     50.0  19.0      26.7   20.8     4.45 
##  8 2022-12-31        92.2  1360.   19.4     5.90  0.380    16.6   20.3     0.424
##  9 2023-03-31        32.5   812.   12.1     4.04  0.456     1.99   2.53    0    
## 10 2023-06-17       162.    281.    3.13    3.47  0.0667    1.13   0.813   0    
## # … with 247 more variables: `Antigua and Barbuda` &lt;dbl&gt;, Argentina &lt;dbl&gt;,
## #   Armenia &lt;dbl&gt;, Aruba &lt;dbl&gt;, Asia &lt;dbl&gt;, Australia &lt;dbl&gt;, Austria &lt;dbl&gt;,
## #   Azerbaijan &lt;dbl&gt;, Bahamas &lt;dbl&gt;, Bahrain &lt;dbl&gt;, Bangladesh &lt;dbl&gt;,
## #   Barbados &lt;dbl&gt;, Belarus &lt;dbl&gt;, Belgium &lt;dbl&gt;, Belize &lt;dbl&gt;, Benin &lt;dbl&gt;,
## #   Bermuda &lt;dbl&gt;, Bhutan &lt;dbl&gt;, Bolivia &lt;dbl&gt;,
## #   `Bonaire Sint Eustatius and Saba` &lt;dbl&gt;, `Bosnia and Herzegovina` &lt;dbl&gt;,
## #   Botswana &lt;dbl&gt;, Brazil &lt;dbl&gt;, `British Virgin Islands` &lt;dbl&gt;, …</code></pre>
</div>
</div>
<div id="季節調整x-13" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> 季節調整（X-13）<a href="時系列データ操作.html#季節調整x-13" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、<code>seasonal</code>パッケージを用いた時系列データへの季節調整方法について解説します。</p>
<p><code>seasonal</code>パッケージでは、米国商務省センサス局が開発したX-13ARIMA-SEATSを用いて、ts形式の月次データ、四半期データ、半期データに対し季節調整を適用することができます。</p>
<p><code>seasonal</code>パッケージや、X-13ARIMA-SEATSの詳細については、Sax &amp; Eddelbuettel（2018）や、奥本（2016）を参照してください。</p>
<p>サンプルデータとして、ts形式のデータである<code>seasonal::unemp</code>データセットを用い、<code>seasonal</code>パッケージの使用方法を確認します。</p>
<div id="ts形式データの可視化" class="section level3 unnumbered hasAnchor">
<h3>ts形式データの可視化<a href="時系列データ操作.html#ts形式データの可視化" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>季節調整の前に、データを確認します。ts形式のデータは<code>plot()</code>関数でグラフを作成できます。</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="時系列データ操作.html#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(seasonal<span class="sc">::</span>unemp)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-340-1.png" width="672" /></p>
</div>
<div id="x-13arima-seatsの実施方法" class="section level3 unnumbered hasAnchor">
<h3>X-13ARIMA-SEATSの実施方法<a href="時系列データ操作.html#x-13arima-seatsの実施方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>seasonal</code>パッケージでは、<code>seas()</code>関数を使用してts形式のデータにX-13ARIMA-SEATSを適用します。<code>seas()</code>関数は、季節調整の結果を格納したseas型のオブジェクトを返します。</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="時系列データ操作.html#cb798-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seas()関数で季節調整を実行</span></span>
<span id="cb798-2"><a href="時系列データ操作.html#cb798-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> seasonal<span class="sc">::</span><span class="fu">seas</span>(<span class="at">x =</span> seasonal<span class="sc">::</span>unemp)</span>
<span id="cb798-3"><a href="時系列データ操作.html#cb798-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb798-4"><a href="時系列データ操作.html#cb798-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整の結果を出力</span></span>
<span id="cb798-5"><a href="時系列データ操作.html#cb798-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<pre><code>## 
## Call:
## seasonal::seas(x = seasonal::unemp)
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## AR-Nonseasonal-01  0.94360    0.03441   27.43   &lt;2e-16 ***
## MA-Nonseasonal-01  0.82540    0.05654   14.60   &lt;2e-16 ***
## MA-Seasonal-12     0.85071    0.03362   25.30   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## SEATS adj.  ARIMA: (1 1 1)(0 1 1)  Obs.: 323  Transform: none
## AICc:  4324, BIC:  4339  QS (no seasonality in final):    0  
## Box-Ljung (no autocorr.): 22.04   Shapiro (normality): 0.9946</code></pre>
<p><code>plot()</code>関数で、原数値と季節調整値のグラフを作成できます。黒色の線が原数値、赤色の線が季節調整値です。外れ値がある場合はグラフ中に外れ値が表示されます。</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="時系列データ操作.html#cb800-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-342-1.png" width="672" /></p>
<p>季節調整値を出力するには、<code>seasonal::final()</code>関数を使用します。</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="時系列データ操作.html#cb801-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整値をunemp_saに格納</span></span>
<span id="cb801-2"><a href="時系列データ操作.html#cb801-2" aria-hidden="true" tabindex="-1"></a>unemp_sa <span class="ot">&lt;-</span> seasonal<span class="sc">::</span><span class="fu">final</span>(m)</span>
<span id="cb801-3"><a href="時系列データ操作.html#cb801-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb801-4"><a href="時系列データ操作.html#cb801-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unemp_saの折れ線グラフを作成</span></span>
<span id="cb801-5"><a href="時系列データ操作.html#cb801-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(unemp_sa, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-343-1.png" width="672" /></p>
<p><code>monthplot()</code>関数を使用すると、季節変動（Seasonal component）と不規則変動（Seasonal irregular component）を月別に確認することができます。</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="時系列データ操作.html#cb802-1" aria-hidden="true" tabindex="-1"></a><span class="fu">monthplot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-344-1.png" width="672" /></p>
</div>
<div id="実例月次データの季節調整" class="section level3 unnumbered hasAnchor">
<h3>実例：月次データの季節調整<a href="時系列データ操作.html#実例月次データの季節調整" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここでは、日本の産業別就業者数データセット<code>data_labor</code>に対し、月次の季節調整を適用します。<code>data_labor</code>はtibble形式のデータフレームの中に、日付型の列と、複数の数値型のデータの列を格納したものです。</p>
<ol style="list-style-type: decimal">
<li>tibble形式のデータフレームに格納されている数値型データのベクトルをts形式に変換する</li>
<li>tibble形式のデータフレームをリスト形式に変換する</li>
<li><code>pblapply()</code>で一括して<code>seas()</code>関数の季節調整を適用する。季節調整エラーは<code>try()</code>関数で処理する</li>
<li>季節調整エラーを取得する</li>
<li>季節調整値を取得する</li>
<li>エラーが生じた系列は原数値を取得する</li>
</ol>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb803-1"><a href="時系列データ操作.html#cb803-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_laborから一部を抽出</span></span>
<span id="cb803-2"><a href="時系列データ操作.html#cb803-2" aria-hidden="true" tabindex="-1"></a>data_labor_nsa <span class="ot">&lt;-</span> data_labor <span class="sc">%&gt;%</span> </span>
<span id="cb803-3"><a href="時系列データ操作.html#cb803-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date, <span class="st">`</span><span class="at">総数</span><span class="st">`</span>, <span class="st">`</span><span class="at">製造</span><span class="st">`</span>, <span class="st">`</span><span class="at">情報通信</span><span class="st">`</span>)</span>
<span id="cb803-4"><a href="時系列データ操作.html#cb803-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-5"><a href="時系列データ操作.html#cb803-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 数値型データのベクトルをts形式に変換</span></span>
<span id="cb803-6"><a href="時系列データ操作.html#cb803-6" aria-hidden="true" tabindex="-1"></a>data_labor_ts <span class="ot">&lt;-</span> data_labor_nsa <span class="sc">%&gt;%</span> </span>
<span id="cb803-7"><a href="時系列データ操作.html#cb803-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span> </span>
<span id="cb803-8"><a href="時系列データ操作.html#cb803-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">12</span>, <span class="co"># 月次データの場合は12を指定</span></span>
<span id="cb803-9"><a href="時系列データ操作.html#cb803-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">start =</span> <span class="fu">c</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(data_labor<span class="sc">$</span>date[<span class="dv">1</span>]), lubridate<span class="sc">::</span><span class="fu">month</span>(data_labor<span class="sc">$</span>date[<span class="dv">1</span>])) <span class="co"># データ開始年月を指定</span></span>
<span id="cb803-10"><a href="時系列データ操作.html#cb803-10" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb803-11"><a href="時系列データ操作.html#cb803-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-12"><a href="時系列データ操作.html#cb803-12" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble形式をリスト形式に変換</span></span>
<span id="cb803-13"><a href="時系列データ操作.html#cb803-13" aria-hidden="true" tabindex="-1"></a>data_labor_ts <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb803-14"><a href="時系列データ操作.html#cb803-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb803-15"><a href="時系列データ操作.html#cb803-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-16"><a href="時系列データ操作.html#cb803-16" aria-hidden="true" tabindex="-1"></a><span class="co"># pblapply()関数で一括してseas()関数の季節調整を適用</span></span>
<span id="cb803-17"><a href="時系列データ操作.html#cb803-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整でエラーが発生する可能性があるため、try()関数でエラー処理を行う</span></span>
<span id="cb803-18"><a href="時系列データ操作.html#cb803-18" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">pblapply</span>(data_labor_ts,</span>
<span id="cb803-19"><a href="時系列データ操作.html#cb803-19" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(e) <span class="fu">try</span>(<span class="fu">suppressMessages</span>(<span class="fu">seas</span>(e, <span class="at">transform.function =</span> <span class="st">&quot;auto&quot;</span>)), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb803-20"><a href="時系列データ操作.html#cb803-20" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb803-21"><a href="時系列データ操作.html#cb803-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-22"><a href="時系列データ操作.html#cb803-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整エラーを取得</span></span>
<span id="cb803-23"><a href="時系列データ操作.html#cb803-23" aria-hidden="true" tabindex="-1"></a>result_iserror <span class="ot">&lt;-</span> <span class="fu">sapply</span>(result, class) <span class="sc">==</span> <span class="st">&quot;try-error&quot;</span></span>
<span id="cb803-24"><a href="時系列データ操作.html#cb803-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-25"><a href="時系列データ操作.html#cb803-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整値を取得し、tibble形式データフレームのdata_labor_saに格納</span></span>
<span id="cb803-26"><a href="時系列データ操作.html#cb803-26" aria-hidden="true" tabindex="-1"></a>data_labor_sa <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, <span class="fu">lapply</span>(result[<span class="sc">!</span>result_iserror], final)) <span class="sc">%&gt;%</span> </span>
<span id="cb803-27"><a href="時系列データ操作.html#cb803-27" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb803-28"><a href="時系列データ操作.html#cb803-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(data_labor[, <span class="dv">1</span>], .)</span>
<span id="cb803-29"><a href="時系列データ操作.html#cb803-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-30"><a href="時系列データ操作.html#cb803-30" aria-hidden="true" tabindex="-1"></a><span class="co"># エラーが生じた系列は原数値を取得してdata_labor_saに追加</span></span>
<span id="cb803-31"><a href="時系列データ操作.html#cb803-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">which</span>(result_iserror)) {</span>
<span id="cb803-32"><a href="時系列データ操作.html#cb803-32" aria-hidden="true" tabindex="-1"></a>  data_labor_sa <span class="ot">&lt;-</span> data_labor[, <span class="fu">names</span>(result[col])] <span class="sc">%&gt;%</span> </span>
<span id="cb803-33"><a href="時系列データ操作.html#cb803-33" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(data_labor_sa)</span>
<span id="cb803-34"><a href="時系列データ操作.html#cb803-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb803-35"><a href="時系列データ操作.html#cb803-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb803-36"><a href="時系列データ操作.html#cb803-36" aria-hidden="true" tabindex="-1"></a><span class="co"># data_labor_saの列をdata_labor_nsaの列順で並べ替え</span></span>
<span id="cb803-37"><a href="時系列データ操作.html#cb803-37" aria-hidden="true" tabindex="-1"></a>data_labor_sa <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb803-38"><a href="時系列データ操作.html#cb803-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">names</span>(data_labor_nsa)))</span></code></pre></div>
<p>個別系列の季節調整結果を可視化するには、<code>plot()</code>関数を使用します。一部の系列は季節性がないと判断されるため、季節調整が行われていません。</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="時系列データ操作.html#cb804-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result[[<span class="fu">which</span>(<span class="fu">names</span>(result) <span class="sc">==</span> <span class="st">&quot;総数&quot;</span>)]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-346-1.png" width="672" /></p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb805-1"><a href="時系列データ操作.html#cb805-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result[[<span class="fu">which</span>(<span class="fu">names</span>(result) <span class="sc">==</span> <span class="st">&quot;製造&quot;</span>)]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-346-2.png" width="672" /></p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="時系列データ操作.html#cb806-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result[[<span class="fu">which</span>(<span class="fu">names</span>(result) <span class="sc">==</span> <span class="st">&quot;情報通信&quot;</span>)]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-346-3.png" width="672" /></p>
</div>
</div>
<div id="季節調整stl分解" class="section level2 hasAnchor" number="7.9">
<h2><span class="header-section-number">7.9</span> 季節調整（STL分解）<a href="時系列データ操作.html#季節調整stl分解" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>上で紹介したX-13ARIMA-SEATSは、月次データ、四半期データ、半期データに適用できますが、週次データや日次データには適用できません。そこで、週次データや日次データの季節調整を行うために<code>stats</code>パッケージの<code>stl()</code>関数による<strong>STL分解</strong>を使用します。</p>
<p>STL分解とは、Seasonal Decomposition of Time Series by Loessの略で、時系列データを季節変動、トレンド変動、不規則変動に分解する手法です。</p>
<div id="stl分解の実施方法" class="section level3 unnumbered hasAnchor">
<h3>STL分解の実施方法<a href="時系列データ操作.html#stl分解の実施方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>STL分解を行うには、ts形式の時系列データに対し、<code>stats</code>パッケージの<code>stl()</code>関数を適用します。<code>stl()</code>関数はSTL分解の結果を格納したstl型のオブジェクトを返します。</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="時系列データ操作.html#cb807-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stl()関数でSTL分解を実行</span></span>
<span id="cb807-2"><a href="時系列データ操作.html#cb807-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">stl</span>(<span class="at">x =</span> seasonal<span class="sc">::</span>unemp,</span>
<span id="cb807-3"><a href="時系列データ操作.html#cb807-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span></span>
<span id="cb807-4"><a href="時系列データ操作.html#cb807-4" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb807-5"><a href="時系列データ操作.html#cb807-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb807-6"><a href="時系列データ操作.html#cb807-6" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb807-7"><a href="時系列データ操作.html#cb807-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-347-1.png" width="672" /></p>
<p>季節調整値を出力するには、<code>stl()</code>関数が返すstl型オブジェクトに格納されている<code>time.series</code>にアクセスします。<code>time.series</code>には、季節変動（<code>seasonal</code>）、トレンド変動（<code>trend</code>）、不規則変動（<code>remainder</code>）の順番にデータが格納されています。</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="時系列データ操作.html#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 季節調整値（トレンド）をunemp_saに格納</span></span>
<span id="cb808-2"><a href="時系列データ操作.html#cb808-2" aria-hidden="true" tabindex="-1"></a>unemp_sa <span class="ot">&lt;-</span> m<span class="sc">$</span>time.series[, <span class="st">&quot;trend&quot;</span>]</span>
<span id="cb808-3"><a href="時系列データ操作.html#cb808-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-4"><a href="時系列データ操作.html#cb808-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unemp_saの折れ線グラフを作成</span></span>
<span id="cb808-5"><a href="時系列データ操作.html#cb808-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(unemp_sa, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-348-1.png" width="672" /></p>
</div>
<div id="週次データのstl分解" class="section level3 unnumbered hasAnchor">
<h3>週次データのSTL分解<a href="時系列データ操作.html#週次データのstl分解" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>STL分解は、<code>seasonal::unemp</code>のような月次データだけでなく、より高頻度なデータにも適用できるのが特徴です。</p>
<p>ここでは、週次データである<code>fpp2::gasoline</code>データセットに対し、STL分解を適用します。週次データは<code>ts()</code>関数における<code>frequency</code>引数が52.18となっています。これは、うるう年を考慮した1年の平均日数365.25日を7で割った値であり、週次データは一周期が52.18週であることを示しています。</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="時系列データ操作.html#cb809-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb809-2"><a href="時系列データ操作.html#cb809-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<pre><code>## Time Series:
## Start = 1991.1 
## End = 1991.19582477755 
## Frequency = 52.1785714285714 
## [1] 6.621 6.433 6.582 7.224 6.875 6.947</code></pre>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="時系列データ操作.html#cb811-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの可視化</span></span>
<span id="cb811-2"><a href="時系列データ操作.html#cb811-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fpp2<span class="sc">::</span>gasoline)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-350-1.png" width="672" /></p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="時系列データ操作.html#cb812-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stl()関数でSTL分解を実行</span></span>
<span id="cb812-2"><a href="時系列データ操作.html#cb812-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">stl</span>(<span class="at">x =</span> fpp2<span class="sc">::</span>gasoline,</span>
<span id="cb812-3"><a href="時系列データ操作.html#cb812-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span></span>
<span id="cb812-4"><a href="時系列データ操作.html#cb812-4" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb812-5"><a href="時系列データ操作.html#cb812-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-6"><a href="時系列データ操作.html#cb812-6" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb812-7"><a href="時系列データ操作.html#cb812-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-351-1.png" width="672" /></p>
</div>
<div id="日次データのstl分解単一周期" class="section level3 unnumbered hasAnchor">
<h3>日次データのSTL分解（単一周期）<a href="時系列データ操作.html#日次データのstl分解単一周期" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>さらに、STL分解は日次データにも適用可能です。日次データの周期性は通常、週、月、年の3種類あると考えられます。ただし、ts形式では一種類の周期性しか指定できないため、ここでは週を一周期に設定し、<code>ts()</code>関数の<code>frequency</code>引数に7を指定して、STL分解を行います。</p>
<p>使用するデータは、Our World in Dataの<code>data_owid</code>データセットにおける、日本の新規感染者数です。</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="時系列データ操作.html#cb813-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_owidから日本の新規感染者数（日次）を抽出</span></span>
<span id="cb813-2"><a href="時系列データ操作.html#cb813-2" aria-hidden="true" tabindex="-1"></a>data_cases_jp <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb813-3"><a href="時系列データ操作.html#cb813-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb813-4"><a href="時系列データ操作.html#cb813-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>(new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb813-5"><a href="時系列データ操作.html#cb813-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(new_cases)</span>
<span id="cb813-6"><a href="時系列データ操作.html#cb813-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-7"><a href="時系列データ操作.html#cb813-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1週＝7日の周期を設定したts形式のデータに変換</span></span>
<span id="cb813-8"><a href="時系列データ操作.html#cb813-8" aria-hidden="true" tabindex="-1"></a>data_cases_jp_ts <span class="ot">&lt;-</span> data_cases_jp <span class="sc">%&gt;%</span> </span>
<span id="cb813-9"><a href="時系列データ操作.html#cb813-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">22</span>),</span>
<span id="cb813-10"><a href="時系列データ操作.html#cb813-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">frequency =</span> <span class="dv">7</span></span>
<span id="cb813-11"><a href="時系列データ操作.html#cb813-11" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb813-12"><a href="時系列データ操作.html#cb813-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-13"><a href="時系列データ操作.html#cb813-13" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果をmに格納</span></span>
<span id="cb813-14"><a href="時系列データ操作.html#cb813-14" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">stl</span>(<span class="at">x =</span> data_cases_jp_ts,</span>
<span id="cb813-15"><a href="時系列データ操作.html#cb813-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span></span>
<span id="cb813-16"><a href="時系列データ操作.html#cb813-16" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb813-17"><a href="時系列データ操作.html#cb813-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-18"><a href="時系列データ操作.html#cb813-18" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb813-19"><a href="時系列データ操作.html#cb813-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-352-1.png" width="672" /></p>
</div>
<div id="日次データのstl分解複数周期" class="section level3 unnumbered hasAnchor">
<h3>日次データのSTL分解（複数周期）<a href="時系列データ操作.html#日次データのstl分解複数周期" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データに複数の周期性を設定したい場合は、ts形式の拡張版であるmsts形式のデータを用います。msts形式のデータは<code>forecast</code>パッケージの<code>msts()</code>関数で作成できます。</p>
<p>ここでは、日次データに対し、1週間＝7日と、1年＝365.25日の2種類の周期性を設定しています。</p>
<p>msts形式のデータに対するSTL分解は、<code>stats::stl()</code>関数ではなく、<code>forecast</code>パッケージの<code>mstl()</code>関数を使用します。</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="時系列データ操作.html#cb814-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_owidから日本の新規感染者数（日次）を抽出</span></span>
<span id="cb814-2"><a href="時系列データ操作.html#cb814-2" aria-hidden="true" tabindex="-1"></a>data_cases_jp <span class="ot">&lt;-</span> data_owid <span class="sc">%&gt;%</span> </span>
<span id="cb814-3"><a href="時系列データ操作.html#cb814-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">&quot;Japan&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb814-4"><a href="時系列データ操作.html#cb814-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>(new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb814-5"><a href="時系列データ操作.html#cb814-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(new_cases)</span>
<span id="cb814-6"><a href="時系列データ操作.html#cb814-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-7"><a href="時系列データ操作.html#cb814-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1週間＝7日と1年＝365.25日の周期を設定したmsts形式のデータに変換</span></span>
<span id="cb814-8"><a href="時系列データ操作.html#cb814-8" aria-hidden="true" tabindex="-1"></a>data_cases_jp_msts <span class="ot">&lt;-</span> data_cases_jp <span class="sc">%&gt;%</span>  </span>
<span id="cb814-9"><a href="時系列データ操作.html#cb814-9" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">msts</span>(<span class="at">seasonal.period =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="fl">365.25</span>),</span>
<span id="cb814-10"><a href="時系列データ操作.html#cb814-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">22</span>)</span>
<span id="cb814-11"><a href="時系列データ操作.html#cb814-11" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb814-12"><a href="時系列データ操作.html#cb814-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-13"><a href="時系列データ操作.html#cb814-13" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果をmに格納</span></span>
<span id="cb814-14"><a href="時系列データ操作.html#cb814-14" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">mstl</span>(<span class="at">x =</span> data_cases_jp_ts, <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>)</span>
<span id="cb814-15"><a href="時系列データ操作.html#cb814-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-16"><a href="時系列データ操作.html#cb814-16" aria-hidden="true" tabindex="-1"></a><span class="co"># STL分解の結果を可視化</span></span>
<span id="cb814-17"><a href="時系列データ操作.html#cb814-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-353-1.png" width="672" /></p>
</div>
</div>
<div id="トレンド" class="section level2 hasAnchor" number="7.10">
<h2><span class="header-section-number">7.10</span> トレンド<a href="時系列データ操作.html#トレンド" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>トレンドには、<strong>線形トレンド</strong>と<strong>非線形トレンド</strong>があります（※）。線形トレンドは、時系列インデックス（毎期1ずつ増加する整数の時間変数）を説明変数とする線形単回帰モデルで推定することができます。一方、非線形トレンドは、HPフィルタや一般化加法モデル（GAM）などの手法を用いて推定します。</p>
<p>※線形トレンドと非線形トレンドは、<strong>確定トレンド（deterministic trend）</strong>と呼ばれます。確定トレンドは単純な直線または曲線で表されるもので、一般的にイメージされるトレンドはこちらに当たります。そのほかに、<strong>確率トレンド（stochastic trend）</strong>と呼ばれるトレンドもあり、こちらは方向が定まらないジグザグ線で表されます。この節では、確定トレンドについて解説します。</p>
<div id="線形トレンド" class="section level3 unnumbered hasAnchor">
<h3>線形トレンド<a href="時系列データ操作.html#線形トレンド" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>線形トレンド（linear trend）</strong>では、次のような線形トレンド・モデルを最小二乗法（OLS）で推定します。<span class="math inline">\(t\)</span>は時系列インデックス（毎期1ずつ増加する整数の時間変数）、<span class="math inline">\(u_t\)</span>は誤差項です。</p>
<p><span class="math display">\[
Y_t = \mu + \delta t + u_t
\]</span></p>
<p>実例として、西山 他（2019）P.547～549に掲載されている「実証例11.1 GDPの線形トレンド・モデル推定」の一部を再現します。推計に用いるデータは第10章「系列相関と時系列モデル」で用いられている日本の実質GDP（年次、1980～2017年）と同じものを使用します。なお、実証例11.1では1955年からのデータが用いられており、時系列インデックスの値など細かな点で違いがありますので、注意してください。</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="時系列データ操作.html#cb815-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XLSXデータを読み込み</span></span>
<span id="cb815-2"><a href="時系列データ操作.html#cb815-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data_nishiyama/ch10/Fig_1_nominalGDP_annual.xlsx&quot;</span>, <span class="co"># ファイルパス（拡張子が必要、URLは不可）</span></span>
<span id="cb815-3"><a href="時系列データ操作.html#cb815-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="co"># シートインデックス／シート名</span></span>
<span id="cb815-4"><a href="時系列データ操作.html#cb815-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;日付&quot;</span>, <span class="st">&quot;名目年率&quot;</span>, <span class="st">&quot;実質年率&quot;</span>), <span class="co"># ヘッダー（列名データ）の有無／列名指定</span></span>
<span id="cb815-5"><a href="時系列データ操作.html#cb815-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）</span></span>
<span id="cb815-6"><a href="時系列データ操作.html#cb815-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span> <span class="co"># 読み込み時に上からスキップする行数</span></span>
<span id="cb815-7"><a href="時系列データ操作.html#cb815-7" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb815-8"><a href="時系列データ操作.html#cb815-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-9"><a href="時系列データ操作.html#cb815-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列インデックスtimeを追加</span></span>
<span id="cb815-10"><a href="時系列データ操作.html#cb815-10" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb815-11"><a href="時系列データ操作.html#cb815-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">seq_along</span>(日付))</span>
<span id="cb815-12"><a href="時系列データ操作.html#cb815-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-13"><a href="時系列データ操作.html#cb815-13" aria-hidden="true" tabindex="-1"></a><span class="co"># データの内容を確認</span></span>
<span id="cb815-14"><a href="時系列データ操作.html#cb815-14" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>## # A tibble: 38 × 4
##     日付 名目年率 実質年率  time
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1  1980  250636.  260625.     1
##  2  1981  268831.  271596      2
##  3  1982  282582   280592.     3
##  4  1983  295304.  290478.     4
##  5  1984  313145.  303555.     5
##  6  1985  333686   319441.     6
##  7  1986  350345.  330068.     7
##  8  1987  366339.  345682.     8
##  9  1988  393641.  369137.     9
## 10  1989  421469.  387070.    10
## # … with 28 more rows</code></pre>
<p>ここでは、実質GDPの自然対数に100を掛けた値について線形トレンドを推定します。この操作により、時系列インデックス<span class="math inline">\(t\)</span>の係数<span class="math inline">\(\delta\)</span>の推定値は実質GDPのトレンド成長率（％表示）を示すことになります。詳細は、西山 他（2019）P.532を参照してください。</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="時系列データ操作.html#cb817-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質年率データを対数変換し100を掛けた系列を計算</span></span>
<span id="cb817-2"><a href="時系列データ操作.html#cb817-2" aria-hidden="true" tabindex="-1"></a>data_lm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb817-3"><a href="時系列データ操作.html#cb817-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ln_real =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">log</span>(実質年率))</span>
<span id="cb817-4"><a href="時系列データ操作.html#cb817-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-5"><a href="時系列データ操作.html#cb817-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定期間として1991年から2017年を指定</span></span>
<span id="cb817-6"><a href="時系列データ操作.html#cb817-6" aria-hidden="true" tabindex="-1"></a>data_lm <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb817-7"><a href="時系列データ操作.html#cb817-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(日付 <span class="sc">&gt;=</span> <span class="dv">1991</span>,</span>
<span id="cb817-8"><a href="時系列データ操作.html#cb817-8" aria-hidden="true" tabindex="-1"></a>                日付 <span class="sc">&lt;=</span> <span class="dv">2017</span></span>
<span id="cb817-9"><a href="時系列データ操作.html#cb817-9" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb817-10"><a href="時系列データ操作.html#cb817-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-11"><a href="時系列データ操作.html#cb817-11" aria-hidden="true" tabindex="-1"></a>data_lm</span></code></pre></div>
<pre><code>## # A tibble: 27 × 5
##     日付 名目年率 実質年率  time ln_real
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1  1991  482845.  419883     12   1295.
##  2  1992  495056.  423444.    13   1296.
##  3  1993  495291   421251.    14   1295.
##  4  1994  501538.  425434.    15   1296.
##  5  1995  512542.  437100.    16   1299.
##  6  1996  525807.  450650.    17   1302.
##  7  1997  534142.  455499.    18   1303.
##  8  1998  527877.  450360.    19   1302.
##  9  1999  519652.  449225.    20   1302.
## 10  2000  526706   461712.    21   1304.
## # … with 17 more rows</code></pre>
<p>推定した結果、時系列インデックスの係数推定値のp値が0.05を下回っているため、トレンドがないとの帰無仮説（<span class="math inline">\(\delta = 0\)</span>）は棄却されます。したがって、1991～2017年の実質GDPには平均成長率約0.85％のトレンドがあると判断できます。</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="時系列データ操作.html#cb819-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 線形トレンド・モデルを推定</span></span>
<span id="cb819-2"><a href="時系列データ操作.html#cb819-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">lm_robust</span>(<span class="at">formula =</span> ln_real <span class="sc">~</span> time,</span>
<span id="cb819-3"><a href="時系列データ操作.html#cb819-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> data_lm,</span>
<span id="cb819-4"><a href="時系列データ操作.html#cb819-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">se_type =</span> <span class="st">&quot;classical&quot;</span>, <span class="co"># 標準誤差の設定（classical, HC0, HC1, HC2, HC3, CR0, CR2）</span></span>
<span id="cb819-5"><a href="時系列データ操作.html#cb819-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">alpha =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb819-6"><a href="時系列データ操作.html#cb819-6" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb819-7"><a href="時系列データ操作.html#cb819-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-8"><a href="時系列データ操作.html#cb819-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
## Call:
## estimatr::lm_robust(formula = ln_real ~ time, data = data_lm, 
##     se_type = &quot;classical&quot;, alpha = 0.05)
## 
## Standard error type:  classical 
## 
## Coefficients:
##              Estimate Std. Error t value  Pr(&gt;|t|)  CI Lower  CI Upper DF
## (Intercept) 1285.5341    1.23019 1044.99 1.567e-59 1283.0005 1288.0677 25
## time           0.8491    0.04698   18.07 7.259e-16    0.7524    0.9459 25
## 
## Multiple R-squared:  0.9289 ,    Adjusted R-squared:  0.9261 
## F-statistic: 326.7 on 1 and 25 DF,  p-value: 7.259e-16</code></pre>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="時系列データ操作.html#cb821-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質GDPを対数変換して100を掛けた値と、線形トレンド・モデルの推定結果をプロット</span></span>
<span id="cb821-2"><a href="時系列データ操作.html#cb821-2" aria-hidden="true" tabindex="-1"></a>data_lm <span class="sc">%&gt;%</span> </span>
<span id="cb821-3"><a href="時系列データ操作.html#cb821-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fitted =</span> result<span class="sc">$</span>fitted.values) <span class="sc">%&gt;%</span> </span>
<span id="cb821-4"><a href="時系列データ操作.html#cb821-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb821-5"><a href="時系列データ操作.html#cb821-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> 日付, <span class="at">y =</span> ln_real), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb821-6"><a href="時系列データ操作.html#cb821-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> 日付, <span class="at">y =</span> fitted), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-357-1.png" width="672" /></p>
</div>
<div id="区分線形トレンド" class="section level3 unnumbered hasAnchor">
<h3>区分線形トレンド<a href="時系列データ操作.html#区分線形トレンド" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次のように、期間によって異なる線形トレンドを推定するモデルを<strong>区分線形トレンド</strong>といいます。</p>
<p><span class="math display">\[
Y_t =
\begin{cases}
  {\mu_1 + \delta_1 t + u_t \quad (1990年以前)}\\
  {\mu_2 + \delta_2 t + u_t \quad (1991年以降)}
\end{cases}
\]</span></p>
<p>こうした区分線形トレンド・モデルは、1990年以前に0、1991年以降に1をとるダミー変数<span class="math inline">\(D_t\)</span>を定義して、次のように書き換えることができます。</p>
<p><span class="math display">\[
Y_t = \beta_0 + \beta_1 D_t + \beta_2 t + \beta_3 (D_t \times t) + u_t
\]</span></p>
<p>これをダミー変数<span class="math inline">\(D_t\)</span>を使用せずに記述すると、次のとおりです。</p>
<p><span class="math display">\[
Y_t =
\begin{cases}
  {\beta_0 + \beta_2 t + u_t \quad (1990年以前)}\\
  {\beta_0 + \beta_1 + (\beta_2 + \beta_3) t + u_t \quad (1991年以降)}
\end{cases}
\]</span></p>
<p>線形トレンド・モデルと同様に、日本の実質GDPデータを用いて区分線形トレンド・モデルを推定します。ダミー変数は<code>dplyr</code>パッケージの<code>if_else()</code>関数を使って作成します。</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="時系列データ操作.html#cb822-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XLSXデータを読み込み</span></span>
<span id="cb822-2"><a href="時系列データ操作.html#cb822-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data_nishiyama/ch10/Fig_1_nominalGDP_annual.xlsx&quot;</span>, <span class="co"># ファイルパス（拡張子が必要、URLは不可）</span></span>
<span id="cb822-3"><a href="時系列データ操作.html#cb822-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="co"># シートインデックス／シート名</span></span>
<span id="cb822-4"><a href="時系列データ操作.html#cb822-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;日付&quot;</span>, <span class="st">&quot;名目年率&quot;</span>, <span class="st">&quot;実質年率&quot;</span>), <span class="co"># ヘッダー（列名データ）の有無／列名指定</span></span>
<span id="cb822-5"><a href="時系列データ操作.html#cb822-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）</span></span>
<span id="cb822-6"><a href="時系列データ操作.html#cb822-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span> <span class="co"># 読み込み時に上からスキップする行数</span></span>
<span id="cb822-7"><a href="時系列データ操作.html#cb822-7" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb822-8"><a href="時系列データ操作.html#cb822-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb822-9"><a href="時系列データ操作.html#cb822-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列インデックスtimeを追加</span></span>
<span id="cb822-10"><a href="時系列データ操作.html#cb822-10" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb822-11"><a href="時系列データ操作.html#cb822-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">seq_along</span>(日付))</span>
<span id="cb822-12"><a href="時系列データ操作.html#cb822-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb822-13"><a href="時系列データ操作.html#cb822-13" aria-hidden="true" tabindex="-1"></a><span class="co"># データの内容を確認</span></span>
<span id="cb822-14"><a href="時系列データ操作.html#cb822-14" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>## # A tibble: 38 × 4
##     日付 名目年率 実質年率  time
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1  1980  250636.  260625.     1
##  2  1981  268831.  271596      2
##  3  1982  282582   280592.     3
##  4  1983  295304.  290478.     4
##  5  1984  313145.  303555.     5
##  6  1985  333686   319441.     6
##  7  1986  350345.  330068.     7
##  8  1987  366339.  345682.     8
##  9  1988  393641.  369137.     9
## 10  1989  421469.  387070.    10
## # … with 28 more rows</code></pre>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="時系列データ操作.html#cb824-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質年率データを対数変換し100を掛けた系列を計算</span></span>
<span id="cb824-2"><a href="時系列データ操作.html#cb824-2" aria-hidden="true" tabindex="-1"></a>data_lm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb824-3"><a href="時系列データ操作.html#cb824-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ln_real =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">log</span>(実質年率))</span>
<span id="cb824-4"><a href="時系列データ操作.html#cb824-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-5"><a href="時系列データ操作.html#cb824-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1990年以前に0、1991年以降に1をとるダミー変数dummyを作成</span></span>
<span id="cb824-6"><a href="時系列データ操作.html#cb824-6" aria-hidden="true" tabindex="-1"></a>data_lm <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb824-7"><a href="時系列データ操作.html#cb824-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">dummy =</span> <span class="fu">if_else</span>(日付 <span class="sc">&gt;=</span> <span class="dv">1991</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb824-8"><a href="時系列データ操作.html#cb824-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-9"><a href="時系列データ操作.html#cb824-9" aria-hidden="true" tabindex="-1"></a>data_lm</span></code></pre></div>
<pre><code>## # A tibble: 38 × 6
##     日付 名目年率 実質年率  time ln_real dummy
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1  1980  250636.  260625.     1   1247.     0
##  2  1981  268831.  271596      2   1251.     0
##  3  1982  282582   280592.     3   1254.     0
##  4  1983  295304.  290478.     4   1258.     0
##  5  1984  313145.  303555.     5   1262.     0
##  6  1985  333686   319441.     6   1267.     0
##  7  1986  350345.  330068.     7   1271.     0
##  8  1987  366339.  345682.     8   1275.     0
##  9  1988  393641.  369137.     9   1282.     0
## 10  1989  421469.  387070.    10   1287.     0
## # … with 28 more rows</code></pre>
<p>推定の結果、時系列インデックス<code>time</code>の係数推定値のp値が0.05を下回っており、1990年以前にトレンドがないとの帰無仮説が棄却されます。したがって、1980～1990年の実質GDPには平均成長率約4.44％のトレンドがあると判断できます。</p>
<p>また、傾きダミー<code>dummy:time</code>の係数推定値のp値が0.05を下回っており、1991年以降のトレンドは1990年以前のトレンドと差がないとの帰無仮説が棄却されます。この結果は、1991～2017年のトレンド成長率が約0.85％（4.444から傾きダミー<code>dummy:time</code>の係数推定値3.595を減じた値）であることを示していると解釈できます。</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="時系列データ操作.html#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 区分線形トレンド・モデルを推定</span></span>
<span id="cb826-2"><a href="時系列データ操作.html#cb826-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">lm_robust</span>(<span class="at">formula =</span> ln_real <span class="sc">~</span> dummy <span class="sc">+</span> time <span class="sc">+</span> dummy <span class="sc">*</span> time,</span>
<span id="cb826-3"><a href="時系列データ操作.html#cb826-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> data_lm,</span>
<span id="cb826-4"><a href="時系列データ操作.html#cb826-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">se_type =</span> <span class="st">&quot;classical&quot;</span>, <span class="co"># 標準誤差の設定（classical, HC0, HC1, HC2, HC3, CR0, CR2）</span></span>
<span id="cb826-5"><a href="時系列データ操作.html#cb826-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">alpha =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb826-6"><a href="時系列データ操作.html#cb826-6" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb826-7"><a href="時系列データ操作.html#cb826-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-8"><a href="時系列データ操作.html#cb826-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
## Call:
## estimatr::lm_robust(formula = ln_real ~ dummy + time + dummy * 
##     time, data = data_lm, se_type = &quot;classical&quot;, alpha = 0.05)
## 
## Standard error type:  classical 
## 
## Coefficients:
##             Estimate Std. Error t value  Pr(&gt;|t|) CI Lower CI Upper DF
## (Intercept) 1241.194     1.1311 1097.33 6.258e-79 1238.896 1243.493 34
## dummy         44.340     1.6000   27.71 6.404e-25   41.088   47.591 34
## time           4.444     0.1668   26.65 2.297e-24    4.105    4.783 34
## dummy:time    -3.595     0.1723  -20.86 5.865e-21   -3.945   -3.244 34
## 
## Multiple R-squared:  0.9932 ,    Adjusted R-squared:  0.9926 
## F-statistic:  1654 on 3 and 34 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="時系列データ操作.html#cb828-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質GDPを対数変換して100を掛けた値と、線形トレンド・モデルの推定結果をプロット</span></span>
<span id="cb828-2"><a href="時系列データ操作.html#cb828-2" aria-hidden="true" tabindex="-1"></a>data_lm <span class="sc">%&gt;%</span> </span>
<span id="cb828-3"><a href="時系列データ操作.html#cb828-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">fitted_1 =</span> <span class="fu">if_else</span>(日付 <span class="sc">&lt;=</span> <span class="dv">1990</span>, result<span class="sc">$</span>fitted.values, <span class="cn">NA_real_</span>),</span>
<span id="cb828-4"><a href="時系列データ操作.html#cb828-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">fitted_2 =</span> <span class="fu">if_else</span>(日付 <span class="sc">&gt;=</span> <span class="dv">1991</span>, result<span class="sc">$</span>fitted.values, <span class="cn">NA_real_</span>)</span>
<span id="cb828-5"><a href="時系列データ操作.html#cb828-5" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span> </span>
<span id="cb828-6"><a href="時系列データ操作.html#cb828-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb828-7"><a href="時系列データ操作.html#cb828-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> 日付, <span class="at">y =</span> ln_real), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb828-8"><a href="時系列データ操作.html#cb828-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> 日付, <span class="at">y =</span> fitted_1), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb828-9"><a href="時系列データ操作.html#cb828-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> 日付, <span class="at">y =</span> fitted_2), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-361-1.png" width="672" /></p>
</div>
<div id="hpフィルタ" class="section level3 unnumbered hasAnchor">
<h3>HPフィルタ<a href="時系列データ操作.html#hpフィルタ" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>HPフィルタ（Hodrick Prescott filter）</strong>は、非線形トレンド推定手法の一種です。</p>
<p>具体的には、時系列データがトレンド成分<span class="math inline">\(g_t\)</span>と循環成分<span class="math inline">\(c_t\)</span>で構成されると仮定し、次の式のように、全期間を通して「循環成分の2乗の総和」と「トレンド成分の2階階差の2乗の総和」の加重和が最小になるような<span class="math inline">\(g_t\)</span>を計算します（肥後・中田（1998））。</p>
<p><span class="math display">\[
\min \Bigg\{ \sum_{t=1}^{T}{c_t^2} + \lambda \sum_{t=1}^{T}[(g_t - g_{t-1})-(g_{t-1}-g_{t-2})]^2 \Bigg\}
\]</span></p>
<p>ここで、<span class="math inline">\(\lambda\)</span>はトレードオフの関係にある2つの項にウェイトをつける調整パラメータです。<span class="math inline">\(\lambda\)</span>が大きいほどトレンド成分が直線に近く、<span class="math inline">\(\lambda\)</span>が小さいほどトレンド成分が元のデータに近くなります。</p>
<p>一般的にマクロ経済分析では、四半期データに対し<span class="math inline">\(\lambda = 1600\)</span>が用いられます。これにより、8年周期以下の景気循環は必ず循環成分に含まれるようになり、通常の景気循環の認識に近くなります。また、年次データでは<span class="math inline">\(\lambda = 100\)</span>、月次データでは<span class="math inline">\(\lambda = 14400\)</span>が伝統的に用いられています（西山 他（2019）P.536）。</p>
<p>以下では、<code>seasonal</code>パッケージのサンプルデータセット<code>unemp</code>（米国の失業者数、原数値）を対象にして、HPフィルタでトレンド推定を行う方法を解説します。</p>
<p>HPフィルタを適用するには、時系列データに対し、<code>mFilter</code>パッケージの<code>hpfilter()</code>関数を使用します。データ構造は数値型ベクトル、ts形式どちらでもOKです。</p>
<p>推定したトレンド成分、循環成分は、推定結果を格納したオブジェクトに、それぞれ<code>trend</code>、<code>cycle</code>の名称で格納されています。</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="時系列データ操作.html#cb829-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> mFilter<span class="sc">::</span><span class="fu">hpfilter</span>(<span class="at">x =</span> seasonal<span class="sc">::</span>unemp, <span class="co"># HPフィルタを適用する時系列データ（数値型ベクトル、ts形式）</span></span>
<span id="cb829-2"><a href="時系列データ操作.html#cb829-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">type =</span> <span class="st">&quot;lambda&quot;</span>,</span>
<span id="cb829-3"><a href="時系列データ操作.html#cb829-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">freq =</span> <span class="dv">14400</span>, <span class="co"># ラムダの値（四半期：1600、月次：14400）</span></span>
<span id="cb829-4"><a href="時系列データ操作.html#cb829-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">drift =</span> <span class="cn">FALSE</span> <span class="co"># ドリフト項の有無 </span></span>
<span id="cb829-5"><a href="時系列データ操作.html#cb829-5" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb829-6"><a href="時系列データ操作.html#cb829-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-7"><a href="時系列データ操作.html#cb829-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
## Title:
##  Hodrick-Prescott Filter 
## 
## Call:
##  mFilter::hpfilter(x = seasonal::unemp, freq = 14400, type = &quot;lambda&quot;, 
##     drift = FALSE)
## 
## Method:
##  hpfilter
## 
## Filter Type:
##  lambda
## 
## Series:
##  seasonal::unemp
## 
## Descriptive Statistics:
##  
##  seasonal::unemp     Trend           Cycle         
##  Min.   : 5153   Min.   : 5915   Min.   :-2235.97  
##  1st Qu.: 7012   1st Qu.: 7236   1st Qu.: -473.54  
##  Median : 8078   Median : 8115   Median :  -78.87  
##  Mean   : 8766   Mean   : 8766   Mean   :    0.00  
##  3rd Qu.: 9476   3rd Qu.: 9235   3rd Qu.:  437.43  
##  Max.   :16147   Max.   :14235   Max.   : 2441.18  
## 
## In-sample error measures:
##         ME        MSE        MAE        MPE       MAPE 
##  2.935e-14  5.236e+05  5.652e+02 -9.939e-03  6.582e-02</code></pre>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="時系列データ操作.html#cb831-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hpfilter()関数の出力結果から開始日と終了日を確認</span></span>
<span id="cb831-2"><a href="時系列データ操作.html#cb831-2" aria-hidden="true" tabindex="-1"></a><span class="fu">start</span>(result<span class="sc">$</span>trend)</span></code></pre></div>
<pre><code>## [1] 1990    1</code></pre>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="時系列データ操作.html#cb833-1" aria-hidden="true" tabindex="-1"></a><span class="fu">end</span>(result<span class="sc">$</span>trend)</span></code></pre></div>
<pre><code>## [1] 2016   11</code></pre>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="時系列データ操作.html#cb835-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hpfilter()関数の出力結果からtibble形式のデータフレームを作成</span></span>
<span id="cb835-2"><a href="時系列データ操作.html#cb835-2" aria-hidden="true" tabindex="-1"></a>data_result <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2016-11-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 month&quot;</span>),</span>
<span id="cb835-3"><a href="時系列データ操作.html#cb835-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cycle =</span> result<span class="sc">$</span>cycle <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb835-4"><a href="時系列データ操作.html#cb835-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trend =</span> result<span class="sc">$</span>trend <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb835-5"><a href="時系列データ操作.html#cb835-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">original =</span> result<span class="sc">$</span>x <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>()</span>
<span id="cb835-6"><a href="時系列データ操作.html#cb835-6" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb835-7"><a href="時系列データ操作.html#cb835-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb835-8"><a href="時系列データ操作.html#cb835-8" aria-hidden="true" tabindex="-1"></a>data_result_long <span class="ot">&lt;-</span> data_result <span class="sc">%&gt;%</span> </span>
<span id="cb835-9"><a href="時系列データ操作.html#cb835-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="st">&quot;date&quot;</span>, <span class="at">names_to =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) </span>
<span id="cb835-10"><a href="時系列データ操作.html#cb835-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb835-11"><a href="時系列データ操作.html#cb835-11" aria-hidden="true" tabindex="-1"></a><span class="co"># HPフィルタの結果をプロット</span></span>
<span id="cb835-12"><a href="時系列データ操作.html#cb835-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_result_long,</span>
<span id="cb835-13"><a href="時系列データ操作.html#cb835-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb835-14"><a href="時系列データ操作.html#cb835-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-363-1.png" width="672" /></p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="時系列データ操作.html#cb836-1" aria-hidden="true" tabindex="-1"></a><span class="co"># トレンド推定結果を可視化（コンソールでEnterを押すと表示される）</span></span>
<span id="cb836-2"><a href="時系列データ操作.html#cb836-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result)</span></code></pre></div>
</div>
<div id="一般化加法モデルgam" class="section level3 unnumbered hasAnchor">
<h3>一般化加法モデル（GAM）<a href="時系列データ操作.html#一般化加法モデルgam" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>一般化加法モデル（Generalizes Additive Model、GAM）</strong>は非線形モデルの一種であり、非線形モデルによる高い説明力と、線形モデルがもつ解釈性の良さを両立させることができる手法です。</p>
<p>具体的には次のように、被説明変数<span class="math inline">\(Y\)</span>を、説明変数<span class="math inline">\(X\)</span>を要素とする非線形関数<span class="math inline">\(f(X)\)</span>の和として説明するモデルです。非線形関数を用いることにより、説明変数と被説明変数の間の複雑な関係を説明できる一方で、被説明変数がそれぞれの非線形関数の和になっていることで、被説明変数の変動要因を説明変数毎に分解することができ、高い解釈性を維持している点が特徴です。</p>
<p><span class="math display">\[
Y_i = \beta_0 + f_1(X_{1i}) + f_2(X_{2i}) + \dots + f_k(X_{ki}) + u_i
\]</span></p>
<p>ここでは<span class="math inline">\(X\)</span>として時系列インデックスを用いることでトレンドを推定しますが、GAMはトレンド推定以外にも様々な用途に使用可能です。例えば、<a href="https://www.mizuho-rt.co.jp/publication/mhri/research/pdf/report/report20-1021.pdf">服部直樹（2020）「新型コロナウイルス感染症（COVID-19）の感染拡大要因は何か」</a>では、GAMの拡張版である「交互作用項付き一般化加法モデル（GA2M）」を使用して、新型コロナウイルス感染者数の変動要因の説明を試みています（ただし、同レポートではPythonによるGA2Mの実装を用いています）。</p>
<p>一般化加法モデルは、<code>mgcv</code>パッケージの<code>gam()</code>関数で推定します。事前に時系列インデックスを作成し、<code>gam()</code>関数の<code>formula</code>引数で<code>被説明変数 ~ s(時系列インデックス)</code>と指定します。説明変数である時系列インデックスを<code>s()</code>に配置することにより、非線形関数を適用します（<code>s()</code>を用いなければ、通常の線形回帰と同じ結果になります）。</p>
<p><code>gam()</code>関数の使用方法の詳細については、<a href="https://logics-of-blue.com/%E5%B9%B3%E6%BB%91%E5%8C%96%E3%82%B9%E3%83%97%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%A8%E5%8A%A0%E6%B3%95%E3%83%A2%E3%83%87%E3%83%AB/">こちら</a>のウェブサイトを参照してください。</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="時系列データ操作.html#cb837-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unempデータをベクトル形式に変換してdataに格納</span></span>
<span id="cb837-2"><a href="時系列データ操作.html#cb837-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb837-3"><a href="時系列データ操作.html#cb837-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2016-11-01&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 month&quot;</span>),</span>
<span id="cb837-4"><a href="時系列データ操作.html#cb837-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">unemp =</span> seasonal<span class="sc">::</span>unemp <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>()</span>
<span id="cb837-5"><a href="時系列データ操作.html#cb837-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb837-6"><a href="時系列データ操作.html#cb837-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-7"><a href="時系列データ操作.html#cb837-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dataに時系列インデックスtimeを追加</span></span>
<span id="cb837-8"><a href="時系列データ操作.html#cb837-8" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb837-9"><a href="時系列データ操作.html#cb837-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">seq_along</span>(date))</span>
<span id="cb837-10"><a href="時系列データ操作.html#cb837-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-11"><a href="時系列データ操作.html#cb837-11" aria-hidden="true" tabindex="-1"></a><span class="co"># GAMでトレンド推定</span></span>
<span id="cb837-12"><a href="時系列データ操作.html#cb837-12" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="at">formula =</span> unemp <span class="sc">~</span> <span class="fu">s</span>(time),</span>
<span id="cb837-13"><a href="時系列データ操作.html#cb837-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="co"># 分布関数</span></span>
<span id="cb837-14"><a href="時系列データ操作.html#cb837-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sp =</span> <span class="cn">NULL</span>, <span class="co"># 平滑度を決めるパラメータ（大きいほど直線に近く、小さいほど元データに近い。NULLで自動最適化）</span></span>
<span id="cb837-15"><a href="時系列データ操作.html#cb837-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> data</span>
<span id="cb837-16"><a href="時系列データ操作.html#cb837-16" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb837-17"><a href="時系列データ操作.html#cb837-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb837-18"><a href="時系列データ操作.html#cb837-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定結果を出力</span></span>
<span id="cb837-19"><a href="時系列データ操作.html#cb837-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## unemp ~ s(time)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  8765.87      44.51   196.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df     F p-value    
## s(time) 8.974      9 326.7  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.901   Deviance explained = 90.4%
## GCV = 6.6028e+05  Scale est. = 6.399e+05  n = 323</code></pre>
<p>推定したトレンド系列は、推定結果を格納したオブジェクトに<code>fitted.values</code>の名称で格納されています。</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="時系列データ操作.html#cb839-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb839-2"><a href="時系列データ操作.html#cb839-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">unemp_fitted =</span> result<span class="sc">$</span>fitted.values)</span></code></pre></div>
<pre><code>## # A tibble: 323 × 4
##    date       unemp  time unemp_fitted
##    &lt;date&gt;     &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt;
##  1 1990-01-01  7413     1        7055.
##  2 1990-02-01  7296     2        7139.
##  3 1990-03-01  6852     3        7224.
##  4 1990-04-01  6620     4        7308.
##  5 1990-05-01  6533     5        7392.
##  6 1990-06-01  6884     6        7476.
##  7 1990-07-01  7137     7        7559.
##  8 1990-08-01  7008     8        7642.
##  9 1990-09-01  7003     9        7724.
## 10 1990-10-01  6892    10        7806.
## # … with 313 more rows</code></pre>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb841-1"><a href="時系列データ操作.html#cb841-1" aria-hidden="true" tabindex="-1"></a><span class="co"># トレンド推定結果を可視化</span></span>
<span id="cb841-2"><a href="時系列データ操作.html#cb841-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result, <span class="co"># gam()関数で推定した結果を格納したオブジェクト</span></span>
<span id="cb841-3"><a href="時系列データ操作.html#cb841-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">residuals =</span> <span class="cn">TRUE</span>, <span class="co"># 元データを表示するか</span></span>
<span id="cb841-4"><a href="時系列データ操作.html#cb841-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="co"># 信頼区間を表示するか</span></span>
<span id="cb841-5"><a href="時系列データ操作.html#cb841-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="st">&quot;*&quot;</span> <span class="co"># 元データのマーカー</span></span>
<span id="cb841-6"><a href="時系列データ操作.html#cb841-6" aria-hidden="true" tabindex="-1"></a>     )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-367-1.png" width="672" /></p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="時系列データ操作.html#cb842-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定したモデルのチェック</span></span>
<span id="cb842-2"><a href="時系列データ操作.html#cb842-2" aria-hidden="true" tabindex="-1"></a>mgcv<span class="sc">::</span><span class="fu">gam.check</span>(result)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-368-1.png" width="672" /></p>
<pre><code>## 
## Method: GCV   Optimizer: magic
## Smoothing parameter selection converged after 12 iterations.
## The RMS GCV score gradient at convergence was 2.293679 .
## The Hessian was positive definite.
## Model rank =  10 / 10 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##           k&#39;  edf k-index p-value    
## s(time) 9.00 8.97    0.23  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="構造変化" class="section level2 hasAnchor" number="7.11">
<h2><span class="header-section-number">7.11</span> 構造変化<a href="時系列データ操作.html#構造変化" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>線形トレンド・モデルを応用して構造変化の推定を行うことができます。</p>
<p>バブル崩壊やアジア通貨危機、リーマンショック、コロナ禍など、構造変化したと考えられる時点が既知の場合は、その時点における構造変化の有無を仮説検定します。</p>
<p>一方、構造変化したと考えられる時点が未知の場合は、構造変化が発生した可能性が最も高い時点を推定します。</p>
<div id="構造変化点が既知の場合" class="section level3 unnumbered hasAnchor">
<h3>構造変化点が既知の場合<a href="時系列データ操作.html#構造変化点が既知の場合" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>構造変化した時点が既知の場合は、構造変化点を<span class="math inline">\(T^*\)</span>とした次の重回帰モデル</p>
<p><span class="math display">\[
Y_t =
\begin{cases}
  {\beta_0 + \beta_1 X_{1t} + \dots + \beta_k X_{kt} + u_t \quad (t \lt T^*)}\\
  {\beta^*_0 + \beta^*_1 X_{1t} + \dots + \beta^*_k X_{kt} + u_t \quad (t \geq T^*)}
\end{cases}
\]</span></p>
<p>について、構造変化がない帰無仮説</p>
<p><span class="math display">\[
H_0: \beta_0 = \beta^*_0, \; \beta_1 = \beta^*_1, \; \ldots \; \beta_k = \beta^*_k
\]</span></p>
<p>を、少なくとも1つの係数に対して等式が成立しない対立仮説に対して検定します。こうした検定は、一般的に<strong>チャウ検定（Chow test）</strong>と呼ばれています。</p>
<p>構造変化点が既知の場合の構造変化の検定には、<code>strucchange</code>パッケージの<code>sctest()</code>関数を使用します。ここでは、線形トレンド・モデルの推定で使用した日本の実質GDPデータ（対数変換して100を掛けた値、1980～2017年）に対し、1991年に構造変化が起きたか否かを検定します。</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="時系列データ操作.html#cb844-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XLSXデータを読み込み</span></span>
<span id="cb844-2"><a href="時系列データ操作.html#cb844-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data_nishiyama/ch10/Fig_1_nominalGDP_annual.xlsx&quot;</span>, <span class="co"># ファイルパス（拡張子が必要、URLは不可）</span></span>
<span id="cb844-3"><a href="時系列データ操作.html#cb844-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="co"># シートインデックス／シート名</span></span>
<span id="cb844-4"><a href="時系列データ操作.html#cb844-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;日付&quot;</span>, <span class="st">&quot;名目年率&quot;</span>, <span class="st">&quot;実質年率&quot;</span>), <span class="co"># ヘッダー（列名データ）の有無／列名指定</span></span>
<span id="cb844-5"><a href="時系列データ操作.html#cb844-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）</span></span>
<span id="cb844-6"><a href="時系列データ操作.html#cb844-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span> <span class="co"># 読み込み時に上からスキップする行数</span></span>
<span id="cb844-7"><a href="時系列データ操作.html#cb844-7" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb844-8"><a href="時系列データ操作.html#cb844-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb844-9"><a href="時系列データ操作.html#cb844-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列インデックスtimeを追加</span></span>
<span id="cb844-10"><a href="時系列データ操作.html#cb844-10" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb844-11"><a href="時系列データ操作.html#cb844-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">seq_along</span>(日付))</span>
<span id="cb844-12"><a href="時系列データ操作.html#cb844-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb844-13"><a href="時系列データ操作.html#cb844-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質年率データを対数変換し100を掛けた系列を計算</span></span>
<span id="cb844-14"><a href="時系列データ操作.html#cb844-14" aria-hidden="true" tabindex="-1"></a>data_lm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb844-15"><a href="時系列データ操作.html#cb844-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ln_real =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">log</span>(実質年率))</span>
<span id="cb844-16"><a href="時系列データ操作.html#cb844-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb844-17"><a href="時系列データ操作.html#cb844-17" aria-hidden="true" tabindex="-1"></a><span class="co"># データの内容を確認</span></span>
<span id="cb844-18"><a href="時系列データ操作.html#cb844-18" aria-hidden="true" tabindex="-1"></a>data_lm</span></code></pre></div>
<pre><code>## # A tibble: 38 × 5
##     日付 名目年率 実質年率  time ln_real
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1  1980  250636.  260625.     1   1247.
##  2  1981  268831.  271596      2   1251.
##  3  1982  282582   280592.     3   1254.
##  4  1983  295304.  290478.     4   1258.
##  5  1984  313145.  303555.     5   1262.
##  6  1985  333686   319441.     6   1267.
##  7  1986  350345.  330068.     7   1271.
##  8  1987  366339.  345682.     8   1275.
##  9  1988  393641.  369137.     9   1282.
## 10  1989  421469.  387070.    10   1287.
## # … with 28 more rows</code></pre>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="時系列データ操作.html#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質GDPを対数変換して100を掛けた値をプロット</span></span>
<span id="cb846-2"><a href="時系列データ操作.html#cb846-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_lm,</span>
<span id="cb846-3"><a href="時系列データ操作.html#cb846-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> ln_real)</span>
<span id="cb846-4"><a href="時系列データ操作.html#cb846-4" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb846-5"><a href="時系列データ操作.html#cb846-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-370-1.png" width="672" /></p>
<p><code>stricchange::sctest()</code>関数で1991年（データの行インデックスが12）について構造変化の検定を行うと、p値が0.05を下回るため、構造変化がない帰無仮説を棄却します。したがって、日本の実質GDPは1991年に構造変化が生じていたと解釈できます。</p>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb847-1"><a href="時系列データ操作.html#cb847-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sctest()関数で構造変化の検定を実施</span></span>
<span id="cb847-2"><a href="時系列データ操作.html#cb847-2" aria-hidden="true" tabindex="-1"></a>strucchange<span class="sc">::</span><span class="fu">sctest</span>(<span class="at">formula =</span> ln_real <span class="sc">~</span> time, <span class="co"># 構造変化を検定するモデル</span></span>
<span id="cb847-3"><a href="時系列データ操作.html#cb847-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> data_lm, <span class="co"># データ</span></span>
<span id="cb847-4"><a href="時系列データ操作.html#cb847-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;Chow&quot;</span>, <span class="co"># チャウ検定を意味する&quot;Chow&quot;を指定</span></span>
<span id="cb847-5"><a href="時系列データ操作.html#cb847-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">point =</span> <span class="dv">12</span> <span class="co"># 検定する構造変化点（データの行インデックス番号）を指定</span></span>
<span id="cb847-6"><a href="時系列データ操作.html#cb847-6" aria-hidden="true" tabindex="-1"></a>                    )</span></code></pre></div>
<pre><code>## 
##  Chow test
## 
## data:  ln_real ~ time
## F = 388.35, p-value &lt; 2.2e-16</code></pre>
</div>
<div id="構造変化点が未知の場合" class="section level3 unnumbered hasAnchor">
<h3>構造変化点が未知の場合<a href="時系列データ操作.html#構造変化点が未知の場合" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>構造変化した時点が未知の場合は、<code>strucchange::breakpoints()</code>関数を使用し、構造変化した可能性が最も高い時点を推定します。</p>
<p>ここでは、「構造変化が既知の場合」と同じ日本の実質GDPデータ（対数変換して100を掛けた値、1980～2017年）を用い、構造変化点を推定します。</p>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="時系列データ操作.html#cb849-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XLSXデータを読み込み</span></span>
<span id="cb849-2"><a href="時系列データ操作.html#cb849-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data_nishiyama/ch10/Fig_1_nominalGDP_annual.xlsx&quot;</span>, <span class="co"># ファイルパス（拡張子が必要、URLは不可）</span></span>
<span id="cb849-3"><a href="時系列データ操作.html#cb849-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="co"># シートインデックス／シート名</span></span>
<span id="cb849-4"><a href="時系列データ操作.html#cb849-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;日付&quot;</span>, <span class="st">&quot;名目年率&quot;</span>, <span class="st">&quot;実質年率&quot;</span>), <span class="co"># ヘッダー（列名データ）の有無／列名指定</span></span>
<span id="cb849-5"><a href="時系列データ操作.html#cb849-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）</span></span>
<span id="cb849-6"><a href="時系列データ操作.html#cb849-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span> <span class="co"># 読み込み時に上からスキップする行数</span></span>
<span id="cb849-7"><a href="時系列データ操作.html#cb849-7" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb849-8"><a href="時系列データ操作.html#cb849-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-9"><a href="時系列データ操作.html#cb849-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列インデックスtimeを追加</span></span>
<span id="cb849-10"><a href="時系列データ操作.html#cb849-10" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb849-11"><a href="時系列データ操作.html#cb849-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">seq_along</span>(日付))</span>
<span id="cb849-12"><a href="時系列データ操作.html#cb849-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-13"><a href="時系列データ操作.html#cb849-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質年率データを対数変換し100を掛けた系列を計算</span></span>
<span id="cb849-14"><a href="時系列データ操作.html#cb849-14" aria-hidden="true" tabindex="-1"></a>data_lm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb849-15"><a href="時系列データ操作.html#cb849-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ln_real =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">log</span>(実質年率))</span>
<span id="cb849-16"><a href="時系列データ操作.html#cb849-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-17"><a href="時系列データ操作.html#cb849-17" aria-hidden="true" tabindex="-1"></a><span class="co"># データの内容を確認</span></span>
<span id="cb849-18"><a href="時系列データ操作.html#cb849-18" aria-hidden="true" tabindex="-1"></a>data_lm</span></code></pre></div>
<pre><code>## # A tibble: 38 × 5
##     日付 名目年率 実質年率  time ln_real
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1  1980  250636.  260625.     1   1247.
##  2  1981  268831.  271596      2   1251.
##  3  1982  282582   280592.     3   1254.
##  4  1983  295304.  290478.     4   1258.
##  5  1984  313145.  303555.     5   1262.
##  6  1985  333686   319441.     6   1267.
##  7  1986  350345.  330068.     7   1271.
##  8  1987  366339.  345682.     8   1275.
##  9  1988  393641.  369137.     9   1282.
## 10  1989  421469.  387070.    10   1287.
## # … with 28 more rows</code></pre>
<p><code>strucchange::breakpoints()</code>関数では、<code>h</code>引数に最小セグメントサイズを、<code>breaks</code>引数に構造変化の数を指定します。</p>
<p>最小セグメントサイズは、構造変化点とデータ端点（もしくは別の構造変化点）の間の区間に含まれるサンプルサイズの最小値を定めるものです。例えば、最小セグメントサイズを0.15、構造変化の数を1に指定すると、データの両端から15％の区間は構造変化点の候補から除外されます。最小セグメントサイズは0.15や0.05といった値が用いされるのが一般的です（西山 他（2019）P.565）。</p>
<p>この例では、構造変化点として12が推定されました。これは、データの行インデックス12、すなわち1991年に構造変化が発生した可能性が最も大きいことを意味しています。</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="時系列データ操作.html#cb851-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> strucchange<span class="sc">::</span><span class="fu">breakpoints</span>(<span class="at">formula =</span> ln_real <span class="sc">~</span> time, <span class="co"># 構造変化点を推定するモデル</span></span>
<span id="cb851-2"><a href="時系列データ操作.html#cb851-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> data_lm, <span class="co"># データ</span></span>
<span id="cb851-3"><a href="時系列データ操作.html#cb851-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">h =</span> <span class="fl">0.15</span>, <span class="co"># 最小セグメントサイズ</span></span>
<span id="cb851-4"><a href="時系列データ操作.html#cb851-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">breaks =</span> <span class="dv">1</span> <span class="co"># 構造変化の数</span></span>
<span id="cb851-5"><a href="時系列データ操作.html#cb851-5" aria-hidden="true" tabindex="-1"></a>                                   )</span>
<span id="cb851-6"><a href="時系列データ操作.html#cb851-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb851-7"><a href="時系列データ操作.html#cb851-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result)</span></code></pre></div>
<pre><code>## 
##   Optimal (m+1)-segment partition: 
## 
## Call:
## breakpoints.formula(formula = ln_real ~ time, h = 0.15, breaks = 1, 
##     data = data_lm)
## 
## Breakpoints at observation number:
##           
## m = 1   12
## 
## Corresponding to breakdates:
##                         
## m = 1   0.31578947368421
## 
## Fit:
##                  
## m   0      1     
## RSS 2456.3  103.0
## BIC  277.2  167.6</code></pre>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="時系列データ操作.html#cb853-1" aria-hidden="true" tabindex="-1"></a>data_lm <span class="sc">%&gt;%</span> </span>
<span id="cb853-2"><a href="時系列データ操作.html#cb853-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">12</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##    日付 名目年率 実質年率  time ln_real
##   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1  1991  482845.   419883    12   1295.</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="線形回帰.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="時系列分析.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlights": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
