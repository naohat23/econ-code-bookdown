<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 時系列分析 | エコノミストのためのR</title>
  <meta name="description" content="9 時系列分析 | エコノミストのためのR" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="9 時系列分析 | エコノミストのためのR" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="naohat23/econ-code-bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 時系列分析 | エコノミストのためのR" />
  
  
  

<meta name="author" content="服部直樹" />


<meta name="date" content="2023-12-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="08_ts.html"/>
<link rel="next" href="appendix_cont.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://econ-code.verse.jp/index.html">エコノミストのためのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> はじめに</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#なぜrを使うのか"><i class="fa fa-check"></i><b>1.1</b> なぜRを使うのか？</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#本書でできること"><i class="fa fa-check"></i><b>1.2</b> 本書でできること</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#目次"><i class="fa fa-check"></i><b>1.3</b> 目次</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第1章-はじめに"><i class="fa fa-check"></i>第1章 はじめに</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第2章-rの設定"><i class="fa fa-check"></i>第2章 Rの設定</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第3章-rの基本的な使用方法"><i class="fa fa-check"></i>第3章 Rの基本的な使用方法</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第4章-tidyverseによるデータ操作"><i class="fa fa-check"></i>第4章 tidyverseによるデータ操作</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第5章-ggplot2によるグラフ作成"><i class="fa fa-check"></i>第5章 ggplot2によるグラフ作成</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第6章-探索的データ分析eda"><i class="fa fa-check"></i>第6章 探索的データ分析（EDA）</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第7章-線形回帰"><i class="fa fa-check"></i>第7章 線形回帰</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第8章-時系列データ操作"><i class="fa fa-check"></i>第8章 時系列データ操作</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#第9章-時系列分析"><i class="fa fa-check"></i>第9章 時系列分析</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#付録-寄与度の計算方法"><i class="fa fa-check"></i>付録 寄与度の計算方法</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#パネルデータ分析"><i class="fa fa-check"></i>パネルデータ分析</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#参考文献ウェブサイト"><i class="fa fa-check"></i><b>1.4</b> 参考文献・ウェブサイト</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#rプログラミング"><i class="fa fa-check"></i>Rプログラミング</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#統計学計量経済学"><i class="fa fa-check"></i>統計学・計量経済学</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#時系列データ分析"><i class="fa fa-check"></i>時系列データ分析</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#変更履歴"><i class="fa fa-check"></i><b>1.5</b> 変更履歴</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年12月13日-マイナーアップデート"><i class="fa fa-check"></i>2023年12月13日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年10月9日-マイナーアップデート"><i class="fa fa-check"></i>2023年10月9日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年9月27日-マイナーアップデート"><i class="fa fa-check"></i>2023年9月27日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年9月22日-メジャーアップデート"><i class="fa fa-check"></i>2023年9月22日 メジャーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年6月18日-メジャーアップデート"><i class="fa fa-check"></i>2023年6月18日 メジャーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年6月18日-マイナーアップデート"><i class="fa fa-check"></i>2023年6月18日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年4月6日-マイナーアップデート"><i class="fa fa-check"></i>2023年4月6日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年3月18日-マイナーアップデート"><i class="fa fa-check"></i>2023年3月18日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年2月6日-マイナーアップデート"><i class="fa fa-check"></i>2023年2月6日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年10月22日-マイナーアップデート"><i class="fa fa-check"></i>2022年10月22日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年9月7日-マイナーアップデート"><i class="fa fa-check"></i>2022年9月7日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年7月17日-マイナーアップデート"><i class="fa fa-check"></i>2022年7月17日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年7月9日-マイナーアップデート"><i class="fa fa-check"></i>2022年7月9日 マイナーアップデート</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#年6月26日-ローンチ"><i class="fa fa-check"></i>2022年6月26日 ローンチ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02_setting.html"><a href="02_setting.html"><i class="fa fa-check"></i><b>2</b> Rの設定</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02_setting.html"><a href="02_setting.html#設定全般"><i class="fa fa-check"></i><b>2.1</b> 設定全般</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="02_setting.html"><a href="02_setting.html#rのインストール"><i class="fa fa-check"></i><b>2.1.1</b> Rのインストール</a></li>
<li class="chapter" data-level="2.1.2" data-path="02_setting.html"><a href="02_setting.html#rのバージョン確認"><i class="fa fa-check"></i><b>2.1.2</b> Rのバージョン確認</a></li>
<li class="chapter" data-level="2.1.3" data-path="02_setting.html"><a href="02_setting.html#セッション情報の確認"><i class="fa fa-check"></i><b>2.1.3</b> セッション情報の確認</a></li>
<li class="chapter" data-level="2.1.4" data-path="02_setting.html"><a href="02_setting.html#オブジェクトを全削除"><i class="fa fa-check"></i><b>2.1.4</b> オブジェクトを全削除</a></li>
<li class="chapter" data-level="2.1.5" data-path="02_setting.html"><a href="02_setting.html#警告の非表示"><i class="fa fa-check"></i><b>2.1.5</b> 警告の非表示</a></li>
<li class="chapter" data-level="2.1.6" data-path="02_setting.html"><a href="02_setting.html#関数が出力する警告やメッセージの非表示"><i class="fa fa-check"></i><b>2.1.6</b> 関数が出力する警告やメッセージの非表示</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="02_setting.html"><a href="02_setting.html#通信関連の設定"><i class="fa fa-check"></i><b>2.2</b> 通信関連の設定</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="02_setting.html"><a href="02_setting.html#プロキシ設定"><i class="fa fa-check"></i><b>2.2.1</b> プロキシ設定</a></li>
<li class="chapter" data-level="2.2.2" data-path="02_setting.html"><a href="02_setting.html#ssl設定"><i class="fa fa-check"></i><b>2.2.2</b> SSL設定</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="02_setting.html"><a href="02_setting.html#パッケージ"><i class="fa fa-check"></i><b>2.3</b> パッケージ</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="02_setting.html"><a href="02_setting.html#使用するパッケージ一覧"><i class="fa fa-check"></i><b>2.3.1</b> 使用するパッケージ一覧</a></li>
<li class="chapter" data-level="2.3.2" data-path="02_setting.html"><a href="02_setting.html#インストールとインポート"><i class="fa fa-check"></i><b>2.3.2</b> インストールとインポート</a></li>
<li class="chapter" data-level="2.3.3" data-path="02_setting.html"><a href="02_setting.html#インストール時のエラー"><i class="fa fa-check"></i><b>2.3.3</b> インストール時のエラー</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="02_setting.html"><a href="02_setting.html#グラフの設定"><i class="fa fa-check"></i><b>2.4</b> グラフの設定</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="02_setting.html"><a href="02_setting.html#グラフのテーマ設定"><i class="fa fa-check"></i><b>2.4.1</b> グラフのテーマ設定</a></li>
<li class="chapter" data-level="2.4.2" data-path="02_setting.html"><a href="02_setting.html#グラフのフォント設定"><i class="fa fa-check"></i><b>2.4.2</b> グラフのフォント設定</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="02_setting.html"><a href="02_setting.html#サンプルデータセット"><i class="fa fa-check"></i><b>2.5</b> サンプルデータセット</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="02_setting.html"><a href="02_setting.html#rのサンプルデータセット"><i class="fa fa-check"></i><b>2.5.1</b> Rのサンプルデータセット</a></li>
<li class="chapter" data-level="2.5.2" data-path="02_setting.html"><a href="02_setting.html#外部データセット"><i class="fa fa-check"></i><b>2.5.2</b> 外部データセット</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="02_setting.html"><a href="02_setting.html#r起動時に実行する設定"><i class="fa fa-check"></i><b>2.6</b> R起動時に実行する設定</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03_introduction.html"><a href="03_introduction.html"><i class="fa fa-check"></i><b>3</b> Rの基本的な使用方法</a>
<ul>
<li class="chapter" data-level="3.1" data-path="03_introduction.html"><a href="03_introduction.html#第3章の準備"><i class="fa fa-check"></i><b>3.1</b> 第3章の準備</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="03_introduction.html"><a href="03_introduction.html#パッケージのインポート"><i class="fa fa-check"></i><b>3.1.1</b> パッケージのインポート</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="03_introduction.html"><a href="03_introduction.html#主要ショートカットキー"><i class="fa fa-check"></i><b>3.2</b> 主要ショートカットキー</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="03_introduction.html"><a href="03_introduction.html#編集"><i class="fa fa-check"></i><b>3.2.1</b> 編集</a></li>
<li class="chapter" data-level="3.2.2" data-path="03_introduction.html"><a href="03_introduction.html#実行"><i class="fa fa-check"></i><b>3.2.2</b> 実行</a></li>
<li class="chapter" data-level="3.2.3" data-path="03_introduction.html"><a href="03_introduction.html#その他"><i class="fa fa-check"></i><b>3.2.3</b> その他</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="03_introduction.html"><a href="03_introduction.html#基本操作"><i class="fa fa-check"></i><b>3.3</b> 基本操作</a></li>
<li class="chapter" data-level="3.4" data-path="03_introduction.html"><a href="03_introduction.html#演算"><i class="fa fa-check"></i><b>3.4</b> 演算</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="03_introduction.html"><a href="03_introduction.html#四則計算"><i class="fa fa-check"></i><b>3.4.1</b> 四則計算</a></li>
<li class="chapter" data-level="3.4.2" data-path="03_introduction.html"><a href="03_introduction.html#数値計算"><i class="fa fa-check"></i><b>3.4.2</b> 数値計算</a></li>
<li class="chapter" data-level="3.4.3" data-path="03_introduction.html"><a href="03_introduction.html#一致大小関係"><i class="fa fa-check"></i><b>3.4.3</b> 一致・大小関係</a></li>
<li class="chapter" data-level="3.4.4" data-path="03_introduction.html"><a href="03_introduction.html#包含集合関係"><i class="fa fa-check"></i><b>3.4.4</b> 包含・集合関係</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="03_introduction.html"><a href="03_introduction.html#ベクトル"><i class="fa fa-check"></i><b>3.5</b> ベクトル</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="03_introduction.html"><a href="03_introduction.html#ベクトルの作成"><i class="fa fa-check"></i><b>3.5.1</b> ベクトルの作成</a></li>
<li class="chapter" data-level="3.5.2" data-path="03_introduction.html"><a href="03_introduction.html#ベクトル要素へのアクセス"><i class="fa fa-check"></i><b>3.5.2</b> ベクトル要素へのアクセス</a></li>
<li class="chapter" data-level="3.5.3" data-path="03_introduction.html"><a href="03_introduction.html#規則性があるベクトルの作成"><i class="fa fa-check"></i><b>3.5.3</b> 規則性があるベクトルの作成</a></li>
<li class="chapter" data-level="3.5.4" data-path="03_introduction.html"><a href="03_introduction.html#ベクトルの演算"><i class="fa fa-check"></i><b>3.5.4</b> ベクトルの演算</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="03_introduction.html"><a href="03_introduction.html#行列"><i class="fa fa-check"></i><b>3.6</b> 行列</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="03_introduction.html"><a href="03_introduction.html#行列の作成"><i class="fa fa-check"></i><b>3.6.1</b> 行列の作成</a></li>
<li class="chapter" data-level="3.6.2" data-path="03_introduction.html"><a href="03_introduction.html#行列の要素へのアクセス"><i class="fa fa-check"></i><b>3.6.2</b> 行列の要素へのアクセス</a></li>
<li class="chapter" data-level="3.6.3" data-path="03_introduction.html"><a href="03_introduction.html#行列の演算"><i class="fa fa-check"></i><b>3.6.3</b> 行列の演算</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="03_introduction.html"><a href="03_introduction.html#データフレーム"><i class="fa fa-check"></i><b>3.7</b> データフレーム</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="03_introduction.html"><a href="03_introduction.html#データフレームの作成"><i class="fa fa-check"></i><b>3.7.1</b> データフレームの作成</a></li>
<li class="chapter" data-level="3.7.2" data-path="03_introduction.html"><a href="03_introduction.html#データフレームの要素へのアクセス"><i class="fa fa-check"></i><b>3.7.2</b> データフレームの要素へのアクセス</a></li>
<li class="chapter" data-level="3.7.3" data-path="03_introduction.html"><a href="03_introduction.html#その他のデータフレームの機能"><i class="fa fa-check"></i><b>3.7.3</b> その他のデータフレームの機能</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="03_introduction.html"><a href="03_introduction.html#リスト"><i class="fa fa-check"></i><b>3.8</b> リスト</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="03_introduction.html"><a href="03_introduction.html#リストの作成"><i class="fa fa-check"></i><b>3.8.1</b> リストの作成</a></li>
<li class="chapter" data-level="3.8.2" data-path="03_introduction.html"><a href="03_introduction.html#リストの要素へのアクセス"><i class="fa fa-check"></i><b>3.8.2</b> リストの要素へのアクセス</a></li>
<li class="chapter" data-level="3.8.3" data-path="03_introduction.html"><a href="03_introduction.html#リストに要素を追加"><i class="fa fa-check"></i><b>3.8.3</b> リストに要素を追加</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="03_introduction.html"><a href="03_introduction.html#文字列操作"><i class="fa fa-check"></i><b>3.9</b> 文字列操作</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="03_introduction.html"><a href="03_introduction.html#文字列の連結"><i class="fa fa-check"></i><b>3.9.1</b> 文字列の連結</a></li>
<li class="chapter" data-level="3.9.2" data-path="03_introduction.html"><a href="03_introduction.html#文字列の切り出し"><i class="fa fa-check"></i><b>3.9.2</b> 文字列の切り出し</a></li>
<li class="chapter" data-level="3.9.3" data-path="03_introduction.html"><a href="03_introduction.html#文字列の検出"><i class="fa fa-check"></i><b>3.9.3</b> 文字列の検出</a></li>
<li class="chapter" data-level="3.9.4" data-path="03_introduction.html"><a href="03_introduction.html#文字列の置換"><i class="fa fa-check"></i><b>3.9.4</b> 文字列の置換</a></li>
<li class="chapter" data-level="3.9.5" data-path="03_introduction.html"><a href="03_introduction.html#文字列の変換"><i class="fa fa-check"></i><b>3.9.5</b> 文字列の変換</a></li>
<li class="chapter" data-level="3.9.6" data-path="03_introduction.html"><a href="03_introduction.html#文字列のパディング"><i class="fa fa-check"></i><b>3.9.6</b> 文字列のパディング</a></li>
<li class="chapter" data-level="3.9.7" data-path="03_introduction.html"><a href="03_introduction.html#文字列によるプログラム実行"><i class="fa fa-check"></i><b>3.9.7</b> 文字列によるプログラム実行</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="03_introduction.html"><a href="03_introduction.html#制御構文"><i class="fa fa-check"></i><b>3.10</b> 制御構文</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="03_introduction.html"><a href="03_introduction.html#ifelse文"><i class="fa fa-check"></i><b>3.10.1</b> if/else文</a></li>
<li class="chapter" data-level="3.10.2" data-path="03_introduction.html"><a href="03_introduction.html#forループ"><i class="fa fa-check"></i><b>3.10.2</b> forループ</a></li>
<li class="chapter" data-level="3.10.3" data-path="03_introduction.html"><a href="03_introduction.html#whileループ"><i class="fa fa-check"></i><b>3.10.3</b> whileループ</a></li>
<li class="chapter" data-level="3.10.4" data-path="03_introduction.html"><a href="03_introduction.html#breakによる繰り返しの終了"><i class="fa fa-check"></i><b>3.10.4</b> breakによる繰り返しの終了</a></li>
<li class="chapter" data-level="3.10.5" data-path="03_introduction.html"><a href="03_introduction.html#nextによる処理のスキップ"><i class="fa fa-check"></i><b>3.10.5</b> nextによる処理のスキップ</a></li>
<li class="chapter" data-level="3.10.6" data-path="03_introduction.html"><a href="03_introduction.html#tryによるエラー処理"><i class="fa fa-check"></i><b>3.10.6</b> tryによるエラー処理</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="03_introduction.html"><a href="03_introduction.html#ファイル操作"><i class="fa fa-check"></i><b>3.11</b> ファイル操作</a>
<ul>
<li class="chapter" data-level="3.11.1" data-path="03_introduction.html"><a href="03_introduction.html#ディレクトリ関連"><i class="fa fa-check"></i><b>3.11.1</b> ディレクトリ関連</a></li>
<li class="chapter" data-level="3.11.2" data-path="03_introduction.html"><a href="03_introduction.html#ファイル関連"><i class="fa fa-check"></i><b>3.11.2</b> ファイル関連</a></li>
<li class="chapter" data-level="3.11.3" data-path="03_introduction.html"><a href="03_introduction.html#ファイルのダウンロード"><i class="fa fa-check"></i><b>3.11.3</b> ファイルのダウンロード</a></li>
</ul></li>
<li class="chapter" data-level="3.12" data-path="03_introduction.html"><a href="03_introduction.html#データの読み込み"><i class="fa fa-check"></i><b>3.12</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="3.12.1" data-path="03_introduction.html"><a href="03_introduction.html#csvデータ"><i class="fa fa-check"></i><b>3.12.1</b> CSVデータ</a></li>
<li class="chapter" data-level="3.12.2" data-path="03_introduction.html"><a href="03_introduction.html#xlsxlsx形式データ"><i class="fa fa-check"></i><b>3.12.2</b> xls・xlsx形式データ</a></li>
<li class="chapter" data-level="3.12.3" data-path="03_introduction.html"><a href="03_introduction.html#xlsx形式データ"><i class="fa fa-check"></i><b>3.12.3</b> xlsx形式データ</a></li>
<li class="chapter" data-level="3.12.4" data-path="03_introduction.html"><a href="03_introduction.html#複数データの読み込み"><i class="fa fa-check"></i><b>3.12.4</b> 複数データの読み込み</a></li>
<li class="chapter" data-level="3.12.5" data-path="03_introduction.html"><a href="03_introduction.html#excelの日付値の修正"><i class="fa fa-check"></i><b>3.12.5</b> Excelの日付値の修正</a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="03_introduction.html"><a href="03_introduction.html#データの書き出し"><i class="fa fa-check"></i><b>3.13</b> データの書き出し</a>
<ul>
<li class="chapter" data-level="3.13.1" data-path="03_introduction.html"><a href="03_introduction.html#csvデータの書き出し"><i class="fa fa-check"></i><b>3.13.1</b> CSVデータの書き出し</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="03_introduction.html"><a href="03_introduction.html#オブジェクトのセーブロード"><i class="fa fa-check"></i><b>3.14</b> オブジェクトのセーブ・ロード</a>
<ul>
<li class="chapter" data-level="3.14.1" data-path="03_introduction.html"><a href="03_introduction.html#セーブ"><i class="fa fa-check"></i><b>3.14.1</b> セーブ</a></li>
<li class="chapter" data-level="3.14.2" data-path="03_introduction.html"><a href="03_introduction.html#ロード"><i class="fa fa-check"></i><b>3.14.2</b> ロード</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04_tidyverse.html"><a href="04_tidyverse.html"><i class="fa fa-check"></i><b>4</b> tidyverseによるデータ操作</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#第4章の準備"><i class="fa fa-check"></i><b>4.1</b> 第4章の準備</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#パッケージのインポート-1"><i class="fa fa-check"></i><b>4.1.1</b> パッケージのインポート</a></li>
<li class="chapter" data-level="4.1.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#外部データセットの取得"><i class="fa fa-check"></i><b>4.1.2</b> 外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#tidyverseとは"><i class="fa fa-check"></i><b>4.2</b> tidyverseとは</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#tidy-data縦型横型データ"><i class="fa fa-check"></i><b>4.2.1</b> tidy data（縦型・横型データ）</a></li>
<li class="chapter" data-level="4.2.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#tidyverseの特徴"><i class="fa fa-check"></i><b>4.2.2</b> tidyverseの特徴</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#列の選択"><i class="fa fa-check"></i><b>4.3</b> 列の選択</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#列名で選択"><i class="fa fa-check"></i><b>4.3.1</b> 列名で選択</a></li>
<li class="chapter" data-level="4.3.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#列名ベクトルで選択"><i class="fa fa-check"></i><b>4.3.2</b> 列名ベクトルで選択</a></li>
<li class="chapter" data-level="4.3.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#列を非選択削除"><i class="fa fa-check"></i><b>4.3.3</b> 列を非選択（削除）</a></li>
<li class="chapter" data-level="4.3.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#特定文字列で始まる列を選択"><i class="fa fa-check"></i><b>4.3.4</b> 特定文字列で始まる列を選択</a></li>
<li class="chapter" data-level="4.3.5" data-path="04_tidyverse.html"><a href="04_tidyverse.html#特定文字列で終わる列を選択"><i class="fa fa-check"></i><b>4.3.5</b> 特定文字列で終わる列を選択</a></li>
<li class="chapter" data-level="4.3.6" data-path="04_tidyverse.html"><a href="04_tidyverse.html#特定文字列を含む列を選択"><i class="fa fa-check"></i><b>4.3.6</b> 特定文字列を含む列を選択</a></li>
<li class="chapter" data-level="4.3.7" data-path="04_tidyverse.html"><a href="04_tidyverse.html#特定の型の列を選択"><i class="fa fa-check"></i><b>4.3.7</b> 特定の型の列を選択</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#列名の変更"><i class="fa fa-check"></i><b>4.4</b> 列名の変更</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#列名の変更-1"><i class="fa fa-check"></i><b>4.4.1</b> 列名の変更</a></li>
<li class="chapter" data-level="4.4.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#複数列名の一括変更"><i class="fa fa-check"></i><b>4.4.2</b> 複数列名の一括変更</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="04_tidyverse.html"><a href="04_tidyverse.html#行のスライスとサンプリング"><i class="fa fa-check"></i><b>4.5</b> 行のスライスとサンプリング</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#行のスライス"><i class="fa fa-check"></i><b>4.5.1</b> 行のスライス</a></li>
<li class="chapter" data-level="4.5.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#サンプリング"><i class="fa fa-check"></i><b>4.5.2</b> サンプリング</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="04_tidyverse.html"><a href="04_tidyverse.html#行のフィルタ"><i class="fa fa-check"></i><b>4.6</b> 行のフィルタ</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#条件に一致する行"><i class="fa fa-check"></i><b>4.6.1</b> 条件に一致する行</a></li>
<li class="chapter" data-level="4.6.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#条件に一致しない行not条件"><i class="fa fa-check"></i><b>4.6.2</b> 条件に一致しない行（NOT条件）</a></li>
<li class="chapter" data-level="4.6.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#複数条件"><i class="fa fa-check"></i><b>4.6.3</b> 複数条件</a></li>
<li class="chapter" data-level="4.6.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#andor条件を明示的に指定した複数条件"><i class="fa fa-check"></i><b>4.6.4</b> AND・OR条件を明示的に指定した複数条件</a></li>
<li class="chapter" data-level="4.6.5" data-path="04_tidyverse.html"><a href="04_tidyverse.html#in演算子によるor条件"><i class="fa fa-check"></i><b>4.6.5</b> <code>%in%</code>演算子によるOR条件</a></li>
<li class="chapter" data-level="4.6.6" data-path="04_tidyverse.html"><a href="04_tidyverse.html#or条件の否定"><i class="fa fa-check"></i><b>4.6.6</b> OR条件の否定</a></li>
<li class="chapter" data-level="4.6.7" data-path="04_tidyverse.html"><a href="04_tidyverse.html#関数による条件指定"><i class="fa fa-check"></i><b>4.6.7</b> 関数による条件指定</a></li>
<li class="chapter" data-level="4.6.8" data-path="04_tidyverse.html"><a href="04_tidyverse.html#論理値を返す関数による条件指定"><i class="fa fa-check"></i><b>4.6.8</b> 論理値を返す関数による条件指定</a></li>
<li class="chapter" data-level="4.6.9" data-path="04_tidyverse.html"><a href="04_tidyverse.html#複数列の一括条件指定"><i class="fa fa-check"></i><b>4.6.9</b> 複数列の一括条件指定</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="04_tidyverse.html"><a href="04_tidyverse.html#行の並べ替え"><i class="fa fa-check"></i><b>4.7</b> 行の並べ替え</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#昇順ソート"><i class="fa fa-check"></i><b>4.7.1</b> 昇順ソート</a></li>
<li class="chapter" data-level="4.7.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#降順ソート"><i class="fa fa-check"></i><b>4.7.2</b> 降順ソート</a></li>
<li class="chapter" data-level="4.7.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#降順ソート日付型"><i class="fa fa-check"></i><b>4.7.3</b> 降順ソート（日付型）</a></li>
<li class="chapter" data-level="4.7.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#複数条件によるソート"><i class="fa fa-check"></i><b>4.7.4</b> 複数条件によるソート</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="04_tidyverse.html"><a href="04_tidyverse.html#列の作成修正"><i class="fa fa-check"></i><b>4.8</b> 列の作成・修正</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#新たな列の作成"><i class="fa fa-check"></i><b>4.8.1</b> 新たな列の作成</a></li>
<li class="chapter" data-level="4.8.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#既存の列の修正"><i class="fa fa-check"></i><b>4.8.2</b> 既存の列の修正</a></li>
<li class="chapter" data-level="4.8.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#条件付き系列の作成"><i class="fa fa-check"></i><b>4.8.3</b> 条件付き系列の作成</a></li>
<li class="chapter" data-level="4.8.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#複数列の一括処理"><i class="fa fa-check"></i><b>4.8.4</b> 複数列の一括処理</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="04_tidyverse.html"><a href="04_tidyverse.html#グループ化"><i class="fa fa-check"></i><b>4.9</b> グループ化</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#単一の列でグループ化"><i class="fa fa-check"></i><b>4.9.1</b> 単一の列でグループ化</a></li>
<li class="chapter" data-level="4.9.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#複数の列でグループ化"><i class="fa fa-check"></i><b>4.9.2</b> 複数の列でグループ化</a></li>
<li class="chapter" data-level="4.9.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#グループ化フィルタ"><i class="fa fa-check"></i><b>4.9.3</b> グループ化＆フィルタ</a></li>
<li class="chapter" data-level="4.9.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#グループ化の解除"><i class="fa fa-check"></i><b>4.9.4</b> グループ化の解除</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="04_tidyverse.html"><a href="04_tidyverse.html#集計"><i class="fa fa-check"></i><b>4.10</b> 集計</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#グループ別の集計"><i class="fa fa-check"></i><b>4.10.1</b> グループ別の集計</a></li>
<li class="chapter" data-level="4.10.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#クロス集計"><i class="fa fa-check"></i><b>4.10.2</b> クロス集計</a></li>
<li class="chapter" data-level="4.10.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#複数列の一括処理-1"><i class="fa fa-check"></i><b>4.10.3</b> 複数列の一括処理</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="04_tidyverse.html"><a href="04_tidyverse.html#カウント"><i class="fa fa-check"></i><b>4.11</b> カウント</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#変数のカウント"><i class="fa fa-check"></i><b>4.11.1</b> 1変数のカウント</a></li>
<li class="chapter" data-level="4.11.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#多変数のカウント"><i class="fa fa-check"></i><b>4.11.2</b> 多変数のカウント</a></li>
<li class="chapter" data-level="4.11.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#条件付きカウント"><i class="fa fa-check"></i><b>4.11.3</b> 条件付きカウント</a></li>
<li class="chapter" data-level="4.11.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#要素の種類をカウント"><i class="fa fa-check"></i><b>4.11.4</b> 要素の種類をカウント</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="04_tidyverse.html"><a href="04_tidyverse.html#縦型横型の変換"><i class="fa fa-check"></i><b>4.12</b> 縦型・横型の変換</a>
<ul>
<li class="chapter" data-level="4.12.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#横型データを縦型データに変換"><i class="fa fa-check"></i><b>4.12.1</b> 横型データを縦型データに変換</a></li>
<li class="chapter" data-level="4.12.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#縦型データを横型データに変換"><i class="fa fa-check"></i><b>4.12.2</b> 縦型データを横型データに変換</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="04_tidyverse.html"><a href="04_tidyverse.html#データの結合"><i class="fa fa-check"></i><b>4.13</b> データの結合</a>
<ul>
<li class="chapter" data-level="4.13.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#内部結合"><i class="fa fa-check"></i><b>4.13.1</b> 内部結合</a></li>
<li class="chapter" data-level="4.13.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#左外部結合"><i class="fa fa-check"></i><b>4.13.2</b> 左外部結合</a></li>
<li class="chapter" data-level="4.13.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#右外部結合"><i class="fa fa-check"></i><b>4.13.3</b> 右外部結合</a></li>
<li class="chapter" data-level="4.13.4" data-path="04_tidyverse.html"><a href="04_tidyverse.html#完全外部結合"><i class="fa fa-check"></i><b>4.13.4</b> 完全外部結合</a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="04_tidyverse.html"><a href="04_tidyverse.html#重複処理"><i class="fa fa-check"></i><b>4.14</b> 重複処理</a>
<ul>
<li class="chapter" data-level="4.14.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#重複行の削除"><i class="fa fa-check"></i><b>4.14.1</b> 重複行の削除</a></li>
<li class="chapter" data-level="4.14.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#重複行の抽出"><i class="fa fa-check"></i><b>4.14.2</b> 重複行の抽出</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="04_tidyverse.html"><a href="04_tidyverse.html#欠損値処理"><i class="fa fa-check"></i><b>4.15</b> 欠損値処理</a>
<ul>
<li class="chapter" data-level="4.15.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#naの削除"><i class="fa fa-check"></i><b>4.15.1</b> NAの削除</a></li>
<li class="chapter" data-level="4.15.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#naの置換"><i class="fa fa-check"></i><b>4.15.2</b> NAの置換</a></li>
<li class="chapter" data-level="4.15.3" data-path="04_tidyverse.html"><a href="04_tidyverse.html#naのフィル"><i class="fa fa-check"></i><b>4.15.3</b> NAのフィル</a></li>
</ul></li>
<li class="chapter" data-level="4.16" data-path="04_tidyverse.html"><a href="04_tidyverse.html#補完処理"><i class="fa fa-check"></i><b>4.16</b> 補完処理</a>
<ul>
<li class="chapter" data-level="4.16.1" data-path="04_tidyverse.html"><a href="04_tidyverse.html#組み合わせ候補の補完"><i class="fa fa-check"></i><b>4.16.1</b> 組み合わせ候補の補完</a></li>
<li class="chapter" data-level="4.16.2" data-path="04_tidyverse.html"><a href="04_tidyverse.html#時系列データの補完"><i class="fa fa-check"></i><b>4.16.2</b> 時系列データの補完</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05_plot.html"><a href="05_plot.html"><i class="fa fa-check"></i><b>5</b> ggplot2によるグラフ作成</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05_plot.html"><a href="05_plot.html#第5章の準備"><i class="fa fa-check"></i><b>5.1</b> 第5章の準備</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="05_plot.html"><a href="05_plot.html#パッケージのインポート-2"><i class="fa fa-check"></i><b>5.1.1</b> パッケージのインポート</a></li>
<li class="chapter" data-level="5.1.2" data-path="05_plot.html"><a href="05_plot.html#外部データセットの取得-1"><i class="fa fa-check"></i><b>5.1.2</b> 外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="05_plot.html"><a href="05_plot.html#ggplot2とは"><i class="fa fa-check"></i><b>5.2</b> ggplot2とは</a></li>
<li class="chapter" data-level="5.3" data-path="05_plot.html"><a href="05_plot.html#ggplot2の設定"><i class="fa fa-check"></i><b>5.3</b> ggplot2の設定</a></li>
<li class="chapter" data-level="5.4" data-path="05_plot.html"><a href="05_plot.html#gui形式の直感的なグラフ作成"><i class="fa fa-check"></i><b>5.4</b> GUI形式の直感的なグラフ作成</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="05_plot.html"><a href="05_plot.html#esquisseパッケージ"><i class="fa fa-check"></i><b>5.4.1</b> esquisseパッケージ</a></li>
<li class="chapter" data-level="5.4.2" data-path="05_plot.html"><a href="05_plot.html#ggplotguiパッケージ"><i class="fa fa-check"></i><b>5.4.2</b> ggplotguiパッケージ</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="05_plot.html"><a href="05_plot.html#次元の度数分布離散型"><i class="fa fa-check"></i><b>5.5</b> 1次元の度数分布（離散型）</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="05_plot.html"><a href="05_plot.html#度数棒グラフの基本形"><i class="fa fa-check"></i><b>5.5.1</b> 度数棒グラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="05_plot.html"><a href="05_plot.html#次元の度数分布連続型"><i class="fa fa-check"></i><b>5.6</b> 1次元の度数分布（連続型）</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="05_plot.html"><a href="05_plot.html#ヒストグラムの基本形"><i class="fa fa-check"></i><b>5.6.1</b> ヒストグラムの基本形</a></li>
<li class="chapter" data-level="5.6.2" data-path="05_plot.html"><a href="05_plot.html#横並びヒストグラム"><i class="fa fa-check"></i><b>5.6.2</b> 横並びヒストグラム</a></li>
<li class="chapter" data-level="5.6.3" data-path="05_plot.html"><a href="05_plot.html#積上ヒストグラム"><i class="fa fa-check"></i><b>5.6.3</b> 積上ヒストグラム</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="05_plot.html"><a href="05_plot.html#次元の密度グラフ"><i class="fa fa-check"></i><b>5.7</b> 1次元の密度グラフ</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="05_plot.html"><a href="05_plot.html#密度グラフの基本形"><i class="fa fa-check"></i><b>5.7.1</b> 密度グラフの基本形</a></li>
<li class="chapter" data-level="5.7.2" data-path="05_plot.html"><a href="05_plot.html#横並び密度グラフ"><i class="fa fa-check"></i><b>5.7.2</b> 横並び密度グラフ</a></li>
<li class="chapter" data-level="5.7.3" data-path="05_plot.html"><a href="05_plot.html#積上密度グラフ"><i class="fa fa-check"></i><b>5.7.3</b> 積上密度グラフ</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="05_plot.html"><a href="05_plot.html#次元の度数分布離散型-1"><i class="fa fa-check"></i><b>5.8</b> 2次元の度数分布（離散型）</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="05_plot.html"><a href="05_plot.html#度数バブルチャートの基本形"><i class="fa fa-check"></i><b>5.8.1</b> 度数バブルチャートの基本形</a></li>
<li class="chapter" data-level="5.8.2" data-path="05_plot.html"><a href="05_plot.html#度数ヒートマップの基本形"><i class="fa fa-check"></i><b>5.8.2</b> 度数ヒートマップの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="05_plot.html"><a href="05_plot.html#次元の度数分布連続型-1"><i class="fa fa-check"></i><b>5.9</b> 2次元の度数分布（連続型）</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="05_plot.html"><a href="05_plot.html#度数ヒートマップの基本形-1"><i class="fa fa-check"></i><b>5.9.1</b> 度数ヒートマップの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="05_plot.html"><a href="05_plot.html#次元の密度グラフ-1"><i class="fa fa-check"></i><b>5.10</b> 2次元の密度グラフ</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="05_plot.html"><a href="05_plot.html#次元密度グラフの基本形"><i class="fa fa-check"></i><b>5.10.1</b> 2次元密度グラフの基本形</a></li>
<li class="chapter" data-level="5.10.2" data-path="05_plot.html"><a href="05_plot.html#次元密度グラフの塗りつぶし版"><i class="fa fa-check"></i><b>5.10.2</b> 2次元密度グラフの塗りつぶし版</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="05_plot.html"><a href="05_plot.html#qqプロット"><i class="fa fa-check"></i><b>5.11</b> QQプロット</a></li>
<li class="chapter" data-level="5.12" data-path="05_plot.html"><a href="05_plot.html#散布図バブルチャート"><i class="fa fa-check"></i><b>5.12</b> 散布図・バブルチャート</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="05_plot.html"><a href="05_plot.html#散布図の基本形"><i class="fa fa-check"></i><b>5.12.1</b> 散布図の基本形</a></li>
<li class="chapter" data-level="5.12.2" data-path="05_plot.html"><a href="05_plot.html#バブルチャートの基本形"><i class="fa fa-check"></i><b>5.12.2</b> バブルチャートの基本形</a></li>
<li class="chapter" data-level="5.12.3" data-path="05_plot.html"><a href="05_plot.html#散布図にコネクタ線を追加"><i class="fa fa-check"></i><b>5.12.3</b> 散布図にコネクタ線を追加</a></li>
<li class="chapter" data-level="5.12.4" data-path="05_plot.html"><a href="05_plot.html#散布図に近似曲線を追加"><i class="fa fa-check"></i><b>5.12.4</b> 散布図に近似曲線を追加</a></li>
<li class="chapter" data-level="5.12.5" data-path="05_plot.html"><a href="05_plot.html#散布図にラベルを追加"><i class="fa fa-check"></i><b>5.12.5</b> 散布図にラベルを追加</a></li>
<li class="chapter" data-level="5.12.6" data-path="05_plot.html"><a href="05_plot.html#バブルチャートにラベルを追加"><i class="fa fa-check"></i><b>5.12.6</b> バブルチャートにラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="05_plot.html"><a href="05_plot.html#棒グラフ"><i class="fa fa-check"></i><b>5.13</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="5.13.1" data-path="05_plot.html"><a href="05_plot.html#縦棒グラフの基本形"><i class="fa fa-check"></i><b>5.13.1</b> 縦棒グラフの基本形</a></li>
<li class="chapter" data-level="5.13.2" data-path="05_plot.html"><a href="05_plot.html#横棒グラフ"><i class="fa fa-check"></i><b>5.13.2</b> 横棒グラフ</a></li>
<li class="chapter" data-level="5.13.3" data-path="05_plot.html"><a href="05_plot.html#縦棒グラフの順序並べ替え"><i class="fa fa-check"></i><b>5.13.3</b> 縦棒グラフの順序並べ替え</a></li>
<li class="chapter" data-level="5.13.4" data-path="05_plot.html"><a href="05_plot.html#縦棒グラフにラベルを追加"><i class="fa fa-check"></i><b>5.13.4</b> 縦棒グラフにラベルを追加</a></li>
<li class="chapter" data-level="5.13.5" data-path="05_plot.html"><a href="05_plot.html#横並び縦棒グラフ"><i class="fa fa-check"></i><b>5.13.5</b> 横並び縦棒グラフ</a></li>
<li class="chapter" data-level="5.13.6" data-path="05_plot.html"><a href="05_plot.html#積上縦棒グラフ"><i class="fa fa-check"></i><b>5.13.6</b> 積上縦棒グラフ</a></li>
<li class="chapter" data-level="5.13.7" data-path="05_plot.html"><a href="05_plot.html#積上縦棒グラフにラベルを追加"><i class="fa fa-check"></i><b>5.13.7</b> 積上縦棒グラフにラベルを追加</a></li>
<li class="chapter" data-level="5.13.8" data-path="05_plot.html"><a href="05_plot.html#積上縦棒グラフ-1"><i class="fa fa-check"></i><b>5.13.8</b> 100％積上縦棒グラフ</a></li>
<li class="chapter" data-level="5.13.9" data-path="05_plot.html"><a href="05_plot.html#積上縦棒グラフにラベルを追加-1"><i class="fa fa-check"></i><b>5.13.9</b> 100％積上縦棒グラフにラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="05_plot.html"><a href="05_plot.html#円グラフ"><i class="fa fa-check"></i><b>5.14</b> 円グラフ</a>
<ul>
<li class="chapter" data-level="5.14.1" data-path="05_plot.html"><a href="05_plot.html#円グラフの基本形"><i class="fa fa-check"></i><b>5.14.1</b> 円グラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.15" data-path="05_plot.html"><a href="05_plot.html#折れ線グラフ"><i class="fa fa-check"></i><b>5.15</b> 折れ線グラフ</a>
<ul>
<li class="chapter" data-level="5.15.1" data-path="05_plot.html"><a href="05_plot.html#折れ線グラフの基本形"><i class="fa fa-check"></i><b>5.15.1</b> 折れ線グラフの基本形</a></li>
<li class="chapter" data-level="5.15.2" data-path="05_plot.html"><a href="05_plot.html#折れ線グラフにマーカーを追加"><i class="fa fa-check"></i><b>5.15.2</b> 折れ線グラフにマーカーを追加</a></li>
<li class="chapter" data-level="5.15.3" data-path="05_plot.html"><a href="05_plot.html#折れ線グラフに系列ラベルを追加"><i class="fa fa-check"></i><b>5.15.3</b> 折れ線グラフに系列ラベルを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.16" data-path="05_plot.html"><a href="05_plot.html#ステップグラフ"><i class="fa fa-check"></i><b>5.16</b> ステップグラフ</a>
<ul>
<li class="chapter" data-level="5.16.1" data-path="05_plot.html"><a href="05_plot.html#ステップグラフの基本形"><i class="fa fa-check"></i><b>5.16.1</b> ステップグラフの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.17" data-path="05_plot.html"><a href="05_plot.html#面グラフ"><i class="fa fa-check"></i><b>5.17</b> 面グラフ</a>
<ul>
<li class="chapter" data-level="5.17.1" data-path="05_plot.html"><a href="05_plot.html#面グラフの基本形"><i class="fa fa-check"></i><b>5.17.1</b> 面グラフの基本形</a></li>
<li class="chapter" data-level="5.17.2" data-path="05_plot.html"><a href="05_plot.html#積上面グラフ"><i class="fa fa-check"></i><b>5.17.2</b> 積上面グラフ</a></li>
<li class="chapter" data-level="5.17.3" data-path="05_plot.html"><a href="05_plot.html#リボングラフの基本形"><i class="fa fa-check"></i><b>5.17.3</b> リボングラフの基本形</a></li>
<li class="chapter" data-level="5.17.4" data-path="05_plot.html"><a href="05_plot.html#リボングラフに折れ線グラフを追加"><i class="fa fa-check"></i><b>5.17.4</b> リボングラフに折れ線グラフを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.18" data-path="05_plot.html"><a href="05_plot.html#箱ひげ図ヴァイオリングラフ"><i class="fa fa-check"></i><b>5.18</b> 箱ひげ図・ヴァイオリングラフ</a>
<ul>
<li class="chapter" data-level="5.18.1" data-path="05_plot.html"><a href="05_plot.html#箱ひげ図の基本形"><i class="fa fa-check"></i><b>5.18.1</b> 箱ひげ図の基本形</a></li>
<li class="chapter" data-level="5.18.2" data-path="05_plot.html"><a href="05_plot.html#箱ひげ図に個別データを追加"><i class="fa fa-check"></i><b>5.18.2</b> 箱ひげ図に個別データを追加</a></li>
<li class="chapter" data-level="5.18.3" data-path="05_plot.html"><a href="05_plot.html#横並び箱ひげ図"><i class="fa fa-check"></i><b>5.18.3</b> 横並び箱ひげ図</a></li>
<li class="chapter" data-level="5.18.4" data-path="05_plot.html"><a href="05_plot.html#ヴァイオリングラフの基本形"><i class="fa fa-check"></i><b>5.18.4</b> ヴァイオリングラフの基本形</a></li>
<li class="chapter" data-level="5.18.5" data-path="05_plot.html"><a href="05_plot.html#ヴァイオリングラフに個別データを追加"><i class="fa fa-check"></i><b>5.18.5</b> ヴァイオリングラフに個別データを追加</a></li>
</ul></li>
<li class="chapter" data-level="5.19" data-path="05_plot.html"><a href="05_plot.html#ドットプロット"><i class="fa fa-check"></i><b>5.19</b> ドットプロット</a>
<ul>
<li class="chapter" data-level="5.19.1" data-path="05_plot.html"><a href="05_plot.html#ドットプロットの基本形"><i class="fa fa-check"></i><b>5.19.1</b> ドットプロットの基本形</a></li>
</ul></li>
<li class="chapter" data-level="5.20" data-path="05_plot.html"><a href="05_plot.html#複合グラフファセット"><i class="fa fa-check"></i><b>5.20</b> 複合グラフ（ファセット）</a>
<ul>
<li class="chapter" data-level="5.20.1" data-path="05_plot.html"><a href="05_plot.html#行方向の複合グラフ"><i class="fa fa-check"></i><b>5.20.1</b> 行方向の複合グラフ</a></li>
<li class="chapter" data-level="5.20.2" data-path="05_plot.html"><a href="05_plot.html#列方向の複合グラフ"><i class="fa fa-check"></i><b>5.20.2</b> 列方向の複合グラフ</a></li>
<li class="chapter" data-level="5.20.3" data-path="05_plot.html"><a href="05_plot.html#行列方向の複合グラフ"><i class="fa fa-check"></i><b>5.20.3</b> 行・列方向の複合グラフ</a></li>
<li class="chapter" data-level="5.20.4" data-path="05_plot.html"><a href="05_plot.html#行数列数を指定した複合グラフ"><i class="fa fa-check"></i><b>5.20.4</b> 行数・列数を指定した複合グラフ</a></li>
<li class="chapter" data-level="5.20.5" data-path="05_plot.html"><a href="05_plot.html#複合グラフの設定"><i class="fa fa-check"></i><b>5.20.5</b> 複合グラフの設定</a></li>
</ul></li>
<li class="chapter" data-level="5.21" data-path="05_plot.html"><a href="05_plot.html#地図ファセット"><i class="fa fa-check"></i><b>5.21</b> 地図ファセット</a></li>
<li class="chapter" data-level="5.22" data-path="05_plot.html"><a href="05_plot.html#補助線"><i class="fa fa-check"></i><b>5.22</b> 補助線</a></li>
<li class="chapter" data-level="5.23" data-path="05_plot.html"><a href="05_plot.html#設定色"><i class="fa fa-check"></i><b>5.23</b> 設定：色</a>
<ul>
<li class="chapter" data-level="5.23.1" data-path="05_plot.html"><a href="05_plot.html#離散型手動指定"><i class="fa fa-check"></i><b>5.23.1</b> 離散型：手動指定</a></li>
<li class="chapter" data-level="5.23.2" data-path="05_plot.html"><a href="05_plot.html#離散型brewer"><i class="fa fa-check"></i><b>5.23.2</b> 離散型：Brewer</a></li>
<li class="chapter" data-level="5.23.3" data-path="05_plot.html"><a href="05_plot.html#離散型viridis"><i class="fa fa-check"></i><b>5.23.3</b> 離散型：Viridis</a></li>
<li class="chapter" data-level="5.23.4" data-path="05_plot.html"><a href="05_plot.html#離散型ggsci"><i class="fa fa-check"></i><b>5.23.4</b> 離散型：ggsci</a></li>
<li class="chapter" data-level="5.23.5" data-path="05_plot.html"><a href="05_plot.html#連続型distiller"><i class="fa fa-check"></i><b>5.23.5</b> 連続型：distiller</a></li>
<li class="chapter" data-level="5.23.6" data-path="05_plot.html"><a href="05_plot.html#連続型viridis"><i class="fa fa-check"></i><b>5.23.6</b> 連続型：Viridis</a></li>
<li class="chapter" data-level="5.23.7" data-path="05_plot.html"><a href="05_plot.html#連続型gradient"><i class="fa fa-check"></i><b>5.23.7</b> 連続型：gradient</a></li>
</ul></li>
<li class="chapter" data-level="5.24" data-path="05_plot.html"><a href="05_plot.html#設定軸"><i class="fa fa-check"></i><b>5.24</b> 設定：軸</a>
<ul>
<li class="chapter" data-level="5.24.1" data-path="05_plot.html"><a href="05_plot.html#x軸連続型y軸連続型"><i class="fa fa-check"></i><b>5.24.1</b> X軸：連続型、Y軸：連続型</a></li>
<li class="chapter" data-level="5.24.2" data-path="05_plot.html"><a href="05_plot.html#対数目盛"><i class="fa fa-check"></i><b>5.24.2</b> 対数目盛</a></li>
<li class="chapter" data-level="5.24.3" data-path="05_plot.html"><a href="05_plot.html#x軸日付型y軸連続型"><i class="fa fa-check"></i><b>5.24.3</b> X軸：日付型、Y軸：連続型</a></li>
</ul></li>
<li class="chapter" data-level="5.25" data-path="05_plot.html"><a href="05_plot.html#設定パネル目盛線"><i class="fa fa-check"></i><b>5.25</b> 設定：パネル目盛線</a></li>
<li class="chapter" data-level="5.26" data-path="05_plot.html"><a href="05_plot.html#設定凡例"><i class="fa fa-check"></i><b>5.26</b> 設定：凡例</a></li>
<li class="chapter" data-level="5.27" data-path="05_plot.html"><a href="05_plot.html#設定タイトルキャプション"><i class="fa fa-check"></i><b>5.27</b> 設定：タイトル・キャプション</a></li>
<li class="chapter" data-level="5.28" data-path="05_plot.html"><a href="05_plot.html#設定フォントマージン"><i class="fa fa-check"></i><b>5.28</b> 設定：フォント・マージン</a></li>
<li class="chapter" data-level="5.29" data-path="05_plot.html"><a href="05_plot.html#グラフの保存"><i class="fa fa-check"></i><b>5.29</b> グラフの保存</a></li>
<li class="chapter" data-level="5.30" data-path="05_plot.html"><a href="05_plot.html#実例"><i class="fa fa-check"></i><b>5.30</b> 実例</a>
<ul>
<li class="chapter" data-level="5.30.1" data-path="05_plot.html"><a href="05_plot.html#実例1折れ線グラフ"><i class="fa fa-check"></i><b>5.30.1</b> 実例1：折れ線グラフ</a></li>
<li class="chapter" data-level="5.30.2" data-path="05_plot.html"><a href="05_plot.html#実例2積上棒グラフ"><i class="fa fa-check"></i><b>5.30.2</b> 実例2：積上棒グラフ</a></li>
<li class="chapter" data-level="5.30.3" data-path="05_plot.html"><a href="05_plot.html#実例3箱ひげ図"><i class="fa fa-check"></i><b>5.30.3</b> 実例3：箱ひげ図</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06_eda.html"><a href="06_eda.html"><i class="fa fa-check"></i><b>6</b> 探索的データ分析</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06_eda.html"><a href="06_eda.html#第6章の準備"><i class="fa fa-check"></i><b>6.1</b> 第6章の準備</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="06_eda.html"><a href="06_eda.html#パッケージのインポート-3"><i class="fa fa-check"></i><b>6.1.1</b> パッケージのインポート</a></li>
<li class="chapter" data-level="6.1.2" data-path="06_eda.html"><a href="06_eda.html#ggplot2の設定-1"><i class="fa fa-check"></i><b>6.1.2</b> ggplot2の設定</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="06_eda.html"><a href="06_eda.html#データの中身"><i class="fa fa-check"></i><b>6.2</b> データの中身</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="06_eda.html"><a href="06_eda.html#str関数"><i class="fa fa-check"></i><b>6.2.1</b> str関数</a></li>
<li class="chapter" data-level="6.2.2" data-path="06_eda.html"><a href="06_eda.html#summary関数"><i class="fa fa-check"></i><b>6.2.2</b> summary関数</a></li>
<li class="chapter" data-level="6.2.3" data-path="06_eda.html"><a href="06_eda.html#summmarytoolsパッケージ"><i class="fa fa-check"></i><b>6.2.3</b> summmarytoolsパッケージ</a></li>
<li class="chapter" data-level="6.2.4" data-path="06_eda.html"><a href="06_eda.html#psychパッケージ"><i class="fa fa-check"></i><b>6.2.4</b> psychパッケージ</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="06_eda.html"><a href="06_eda.html#データの分布"><i class="fa fa-check"></i><b>6.3</b> データの分布</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="06_eda.html"><a href="06_eda.html#離散型変数の度数分布"><i class="fa fa-check"></i><b>6.3.1</b> 離散型変数の度数分布</a></li>
<li class="chapter" data-level="6.3.2" data-path="06_eda.html"><a href="06_eda.html#連続型変数の度数分布"><i class="fa fa-check"></i><b>6.3.2</b> 連続型変数の度数分布</a></li>
<li class="chapter" data-level="6.3.3" data-path="06_eda.html"><a href="06_eda.html#外れ値"><i class="fa fa-check"></i><b>6.3.3</b> 外れ値</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="06_eda.html"><a href="06_eda.html#データの関係性"><i class="fa fa-check"></i><b>6.4</b> データの関係性</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="06_eda.html"><a href="06_eda.html#離散型変数の関係性"><i class="fa fa-check"></i><b>6.4.1</b> 離散型変数の関係性</a></li>
<li class="chapter" data-level="6.4.2" data-path="06_eda.html"><a href="06_eda.html#連続型変数の関係性"><i class="fa fa-check"></i><b>6.4.2</b> 連続型変数の関係性</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="06_eda.html"><a href="06_eda.html#相関関係ペアプロット"><i class="fa fa-check"></i><b>6.5</b> 相関関係・ペアプロット</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="06_eda.html"><a href="06_eda.html#相関係数行列"><i class="fa fa-check"></i><b>6.5.1</b> 相関係数行列</a></li>
<li class="chapter" data-level="6.5.2" data-path="06_eda.html"><a href="06_eda.html#corrplotパッケージ"><i class="fa fa-check"></i><b>6.5.2</b> corrplotパッケージ</a></li>
<li class="chapter" data-level="6.5.3" data-path="06_eda.html"><a href="06_eda.html#corrrパッケージ"><i class="fa fa-check"></i><b>6.5.3</b> corrrパッケージ</a></li>
<li class="chapter" data-level="6.5.4" data-path="06_eda.html"><a href="06_eda.html#ggallyパッケージ"><i class="fa fa-check"></i><b>6.5.4</b> GGallyパッケージ</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="06_eda.html"><a href="06_eda.html#探索的データ分析の一括実行"><i class="fa fa-check"></i><b>6.6</b> 探索的データ分析の一括実行</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="06_eda.html"><a href="06_eda.html#dataexplorerパッケージ"><i class="fa fa-check"></i><b>6.6.1</b> DataExplorerパッケージ</a></li>
<li class="chapter" data-level="6.6.2" data-path="06_eda.html"><a href="06_eda.html#smartedaパッケージ"><i class="fa fa-check"></i><b>6.6.2</b> SmartEDAパッケージ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07_ols.html"><a href="07_ols.html"><i class="fa fa-check"></i><b>7</b> 線形回帰</a>
<ul>
<li class="chapter" data-level="7.1" data-path="07_ols.html"><a href="07_ols.html#第7章の準備"><i class="fa fa-check"></i><b>7.1</b> 第7章の準備</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="07_ols.html"><a href="07_ols.html#パッケージのインポート-4"><i class="fa fa-check"></i><b>7.1.1</b> パッケージのインポート</a></li>
<li class="chapter" data-level="7.1.2" data-path="07_ols.html"><a href="07_ols.html#外部データセットの取得-2"><i class="fa fa-check"></i><b>7.1.2</b> 外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="07_ols.html"><a href="07_ols.html#用語の説明"><i class="fa fa-check"></i><b>7.2</b> 用語の説明</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="07_ols.html"><a href="07_ols.html#標本と推定"><i class="fa fa-check"></i><b>7.2.1</b> 標本と推定</a></li>
<li class="chapter" data-level="7.2.2" data-path="07_ols.html"><a href="07_ols.html#推定量の望ましい性質"><i class="fa fa-check"></i><b>7.2.2</b> 推定量の望ましい性質</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="07_ols.html"><a href="07_ols.html#最小2乗法ols"><i class="fa fa-check"></i><b>7.3</b> 最小2乗法（OLS）</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="07_ols.html"><a href="07_ols.html#最小2乗法の仮定"><i class="fa fa-check"></i><b>7.3.1</b> 最小2乗法の仮定</a></li>
<li class="chapter" data-level="7.3.2" data-path="07_ols.html"><a href="07_ols.html#検定と信頼区間"><i class="fa fa-check"></i><b>7.3.2</b> 検定と信頼区間</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="07_ols.html"><a href="07_ols.html#モデルの種類と係数の解釈"><i class="fa fa-check"></i><b>7.4</b> モデルの種類と係数の解釈</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="07_ols.html"><a href="07_ols.html#水準モデル"><i class="fa fa-check"></i><b>7.4.1</b> 水準モデル</a></li>
<li class="chapter" data-level="7.4.2" data-path="07_ols.html"><a href="07_ols.html#対数モデル"><i class="fa fa-check"></i><b>7.4.2</b> 対数モデル</a></li>
<li class="chapter" data-level="7.4.3" data-path="07_ols.html"><a href="07_ols.html#変化率モデル"><i class="fa fa-check"></i><b>7.4.3</b> 変化率モデル</a></li>
<li class="chapter" data-level="7.4.4" data-path="07_ols.html"><a href="07_ols.html#多項式モデル"><i class="fa fa-check"></i><b>7.4.4</b> 多項式モデル</a></li>
<li class="chapter" data-level="7.4.5" data-path="07_ols.html"><a href="07_ols.html#交互作用モデル"><i class="fa fa-check"></i><b>7.4.5</b> 交互作用モデル</a></li>
<li class="chapter" data-level="7.4.6" data-path="07_ols.html"><a href="07_ols.html#ダミー変数"><i class="fa fa-check"></i><b>7.4.6</b> ダミー変数</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="07_ols.html"><a href="07_ols.html#重回帰モデルの役割と注意点"><i class="fa fa-check"></i><b>7.5</b> 重回帰モデルの役割と注意点</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="07_ols.html"><a href="07_ols.html#欠落変数バイアス"><i class="fa fa-check"></i><b>7.5.1</b> 欠落変数バイアス</a></li>
<li class="chapter" data-level="7.5.2" data-path="07_ols.html"><a href="07_ols.html#多重共線性"><i class="fa fa-check"></i><b>7.5.2</b> 多重共線性</a></li>
<li class="chapter" data-level="7.5.3" data-path="07_ols.html"><a href="07_ols.html#変数選択の指針"><i class="fa fa-check"></i><b>7.5.3</b> 変数選択の指針</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="07_ols.html"><a href="07_ols.html#rの単回帰モデル推定"><i class="fa fa-check"></i><b>7.6</b> Rの単回帰モデル推定</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="07_ols.html"><a href="07_ols.html#実例線形単回帰"><i class="fa fa-check"></i><b>7.6.1</b> 実例：線形単回帰</a></li>
<li class="chapter" data-level="7.6.2" data-path="07_ols.html"><a href="07_ols.html#実例回帰診断プロット"><i class="fa fa-check"></i><b>7.6.2</b> 実例：回帰診断プロット</a></li>
<li class="chapter" data-level="7.6.3" data-path="07_ols.html"><a href="07_ols.html#実例対数変化率モデルの推定"><i class="fa fa-check"></i><b>7.6.3</b> 実例：対数・変化率モデルの推定</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="07_ols.html"><a href="07_ols.html#rの重回帰モデル推定"><i class="fa fa-check"></i><b>7.7</b> Rの重回帰モデル推定</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="07_ols.html"><a href="07_ols.html#実例線形重回帰"><i class="fa fa-check"></i><b>7.7.1</b> 実例：線形重回帰</a></li>
<li class="chapter" data-level="7.7.2" data-path="07_ols.html"><a href="07_ols.html#実例多項式モデル"><i class="fa fa-check"></i><b>7.7.2</b> 実例：多項式モデル</a></li>
<li class="chapter" data-level="7.7.3" data-path="07_ols.html"><a href="07_ols.html#実例ダミー交互作用モデル"><i class="fa fa-check"></i><b>7.7.3</b> 実例：ダミー・交互作用モデル</a></li>
<li class="chapter" data-level="7.7.4" data-path="07_ols.html"><a href="07_ols.html#実例ダミー変数同士の交互作用モデル"><i class="fa fa-check"></i><b>7.7.4</b> 実例：ダミー変数同士の交互作用モデル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08_ts.html"><a href="08_ts.html"><i class="fa fa-check"></i><b>8</b> 時系列データ操作</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08_ts.html"><a href="08_ts.html#第8章の準備"><i class="fa fa-check"></i><b>8.1</b> 第8章の準備</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="08_ts.html"><a href="08_ts.html#パッケージのインポート-5"><i class="fa fa-check"></i><b>8.1.1</b> パッケージのインポート</a></li>
<li class="chapter" data-level="8.1.2" data-path="08_ts.html"><a href="08_ts.html#外部データセットの取得-3"><i class="fa fa-check"></i><b>8.1.2</b> 外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="08_ts.html"><a href="08_ts.html#時系列データとは"><i class="fa fa-check"></i><b>8.2</b> 時系列データとは</a></li>
<li class="chapter" data-level="8.3" data-path="08_ts.html"><a href="08_ts.html#ts形式データ"><i class="fa fa-check"></i><b>8.3</b> ts形式データ</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="08_ts.html"><a href="08_ts.html#ts形式データの表示"><i class="fa fa-check"></i><b>8.3.1</b> ts形式データの表示</a></li>
<li class="chapter" data-level="8.3.2" data-path="08_ts.html"><a href="08_ts.html#ts形式データ情報の取得"><i class="fa fa-check"></i><b>8.3.2</b> ts形式データ情報の取得</a></li>
<li class="chapter" data-level="8.3.3" data-path="08_ts.html"><a href="08_ts.html#ts形式データのフィルタ"><i class="fa fa-check"></i><b>8.3.3</b> ts形式データのフィルタ</a></li>
<li class="chapter" data-level="8.3.4" data-path="08_ts.html"><a href="08_ts.html#ts形式データのプロット"><i class="fa fa-check"></i><b>8.3.4</b> ts形式データのプロット</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="08_ts.html"><a href="08_ts.html#ts形式データの変換"><i class="fa fa-check"></i><b>8.4</b> ts形式データの変換</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="08_ts.html"><a href="08_ts.html#ts形式に変換ts"><i class="fa fa-check"></i><b>8.4.1</b> ts形式に変換：ts()</a></li>
<li class="chapter" data-level="8.4.2" data-path="08_ts.html"><a href="08_ts.html#ts形式に変換as_tsibble"><i class="fa fa-check"></i><b>8.4.2</b> ts形式に変換：as_tsibble()</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="08_ts.html"><a href="08_ts.html#日付型データ関数"><i class="fa fa-check"></i><b>8.5</b> 日付型データ関数</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="08_ts.html"><a href="08_ts.html#日付型データの生成"><i class="fa fa-check"></i><b>8.5.1</b> 日付型データの生成</a></li>
<li class="chapter" data-level="8.5.2" data-path="08_ts.html"><a href="08_ts.html#日付型データの計算"><i class="fa fa-check"></i><b>8.5.2</b> 日付型データの計算</a></li>
<li class="chapter" data-level="8.5.3" data-path="08_ts.html"><a href="08_ts.html#日付型と文字列型の変換"><i class="fa fa-check"></i><b>8.5.3</b> 日付型と文字列型の変換</a></li>
<li class="chapter" data-level="8.5.4" data-path="08_ts.html"><a href="08_ts.html#日付情報の抽出"><i class="fa fa-check"></i><b>8.5.4</b> 日付情報の抽出</a></li>
<li class="chapter" data-level="8.5.5" data-path="08_ts.html"><a href="08_ts.html#四半期ベースの時系列インデックス"><i class="fa fa-check"></i><b>8.5.5</b> 四半期ベースの時系列インデックス</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="08_ts.html"><a href="08_ts.html#様々な時系列データ系列の作成"><i class="fa fa-check"></i><b>8.6</b> 様々な時系列データ系列の作成</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="08_ts.html"><a href="08_ts.html#ラグリード系列の作成"><i class="fa fa-check"></i><b>8.6.1</b> ラグ・リード系列の作成</a></li>
<li class="chapter" data-level="8.6.2" data-path="08_ts.html"><a href="08_ts.html#変化率系列の作成"><i class="fa fa-check"></i><b>8.6.2</b> 変化率系列の作成</a></li>
<li class="chapter" data-level="8.6.3" data-path="08_ts.html"><a href="08_ts.html#移動平均系列の作成"><i class="fa fa-check"></i><b>8.6.3</b> 移動平均系列の作成</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="08_ts.html"><a href="08_ts.html#時系列データの頻度変換"><i class="fa fa-check"></i><b>8.7</b> 時系列データの頻度変換</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="08_ts.html"><a href="08_ts.html#日次データを週次データに変換"><i class="fa fa-check"></i><b>8.7.1</b> 日次データを週次データに変換</a></li>
<li class="chapter" data-level="8.7.2" data-path="08_ts.html"><a href="08_ts.html#日次データを月次データに変換"><i class="fa fa-check"></i><b>8.7.2</b> 日次データを月次データに変換</a></li>
<li class="chapter" data-level="8.7.3" data-path="08_ts.html"><a href="08_ts.html#日次データを四半期データに変換"><i class="fa fa-check"></i><b>8.7.3</b> 日次データを四半期データに変換</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="08_ts.html"><a href="08_ts.html#季節調整x-13"><i class="fa fa-check"></i><b>8.8</b> 季節調整（X-13）</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="08_ts.html"><a href="08_ts.html#ts形式データの可視化"><i class="fa fa-check"></i><b>8.8.1</b> ts形式データの可視化</a></li>
<li class="chapter" data-level="8.8.2" data-path="08_ts.html"><a href="08_ts.html#x-13arima-seatsの実施方法"><i class="fa fa-check"></i><b>8.8.2</b> X-13ARIMA-SEATSの実施方法</a></li>
<li class="chapter" data-level="8.8.3" data-path="08_ts.html"><a href="08_ts.html#実例月次データの季節調整"><i class="fa fa-check"></i><b>8.8.3</b> 実例：月次データの季節調整</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="08_ts.html"><a href="08_ts.html#季節調整stl分解"><i class="fa fa-check"></i><b>8.9</b> 季節調整（STL分解）</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="08_ts.html"><a href="08_ts.html#stl分解の実施方法"><i class="fa fa-check"></i><b>8.9.1</b> STL分解の実施方法</a></li>
<li class="chapter" data-level="8.9.2" data-path="08_ts.html"><a href="08_ts.html#週次データのstl分解"><i class="fa fa-check"></i><b>8.9.2</b> 週次データのSTL分解</a></li>
<li class="chapter" data-level="8.9.3" data-path="08_ts.html"><a href="08_ts.html#日次データのstl分解単一周期"><i class="fa fa-check"></i><b>8.9.3</b> 日次データのSTL分解（単一周期）</a></li>
<li class="chapter" data-level="8.9.4" data-path="08_ts.html"><a href="08_ts.html#日次データのstl分解複数周期"><i class="fa fa-check"></i><b>8.9.4</b> 日次データのSTL分解（複数周期）</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="08_ts.html"><a href="08_ts.html#トレンド"><i class="fa fa-check"></i><b>8.10</b> トレンド</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="08_ts.html"><a href="08_ts.html#線形トレンド"><i class="fa fa-check"></i><b>8.10.1</b> 線形トレンド</a></li>
<li class="chapter" data-level="8.10.2" data-path="08_ts.html"><a href="08_ts.html#区分線形トレンド"><i class="fa fa-check"></i><b>8.10.2</b> 区分線形トレンド</a></li>
<li class="chapter" data-level="8.10.3" data-path="08_ts.html"><a href="08_ts.html#hpフィルタ"><i class="fa fa-check"></i><b>8.10.3</b> HPフィルタ</a></li>
<li class="chapter" data-level="8.10.4" data-path="08_ts.html"><a href="08_ts.html#一般化加法モデルgam"><i class="fa fa-check"></i><b>8.10.4</b> 一般化加法モデル（GAM）</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="08_ts.html"><a href="08_ts.html#構造変化"><i class="fa fa-check"></i><b>8.11</b> 構造変化</a>
<ul>
<li class="chapter" data-level="8.11.1" data-path="08_ts.html"><a href="08_ts.html#構造変化点が既知の場合"><i class="fa fa-check"></i><b>8.11.1</b> 構造変化点が既知の場合</a></li>
<li class="chapter" data-level="8.11.2" data-path="08_ts.html"><a href="08_ts.html#構造変化点が未知の場合"><i class="fa fa-check"></i><b>8.11.2</b> 構造変化点が未知の場合</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09_var.html"><a href="09_var.html"><i class="fa fa-check"></i><b>9</b> 時系列分析</a>
<ul>
<li class="chapter" data-level="9.1" data-path="09_var.html"><a href="09_var.html#第9章の準備"><i class="fa fa-check"></i><b>9.1</b> 第9章の準備</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="09_var.html"><a href="09_var.html#パッケージのインポート-6"><i class="fa fa-check"></i><b>9.1.1</b> パッケージのインポート</a></li>
<li class="chapter" data-level="9.1.2" data-path="09_var.html"><a href="09_var.html#外部データセットの取得-4"><i class="fa fa-check"></i><b>9.1.2</b> 外部データセットの取得</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="09_var.html"><a href="09_var.html#定常性"><i class="fa fa-check"></i><b>9.2</b> 定常性</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="09_var.html"><a href="09_var.html#定常性の定義"><i class="fa fa-check"></i><b>9.2.1</b> 定常性の定義</a></li>
<li class="chapter" data-level="9.2.2" data-path="09_var.html"><a href="09_var.html#ホワイトノイズ"><i class="fa fa-check"></i><b>9.2.2</b> ホワイトノイズ</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="09_var.html"><a href="09_var.html#非定常過程"><i class="fa fa-check"></i><b>9.3</b> 非定常過程</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="09_var.html"><a href="09_var.html#単位根"><i class="fa fa-check"></i><b>9.3.1</b> 単位根</a></li>
<li class="chapter" data-level="9.3.2" data-path="09_var.html"><a href="09_var.html#階差定常過程和分過程"><i class="fa fa-check"></i><b>9.3.2</b> 階差定常過程・和分過程</a></li>
<li class="chapter" data-level="9.3.3" data-path="09_var.html"><a href="09_var.html#ランダムウォーク"><i class="fa fa-check"></i><b>9.3.3</b> ランダムウォーク</a></li>
<li class="chapter" data-level="9.3.4" data-path="09_var.html"><a href="09_var.html#トレンド定常過程"><i class="fa fa-check"></i><b>9.3.4</b> トレンド定常過程</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="09_var.html"><a href="09_var.html#単位根検定adf検定"><i class="fa fa-check"></i><b>9.4</b> 単位根検定（ADF検定）</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="09_var.html"><a href="09_var.html#adf検定フロー自作関数"><i class="fa fa-check"></i><b>9.4.1</b> ADF検定フロー自作関数</a></li>
<li class="chapter" data-level="9.4.2" data-path="09_var.html"><a href="09_var.html#実例adf検定フロー"><i class="fa fa-check"></i><b>9.4.2</b> 実例：ADF検定フロー</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="09_var.html"><a href="09_var.html#系列相関自己相関"><i class="fa fa-check"></i><b>9.5</b> 系列相関・自己相関</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="09_var.html"><a href="09_var.html#自己相関acf"><i class="fa fa-check"></i><b>9.5.1</b> 自己相関（ACF）</a></li>
<li class="chapter" data-level="9.5.2" data-path="09_var.html"><a href="09_var.html#偏自己相関pacf"><i class="fa fa-check"></i><b>9.5.2</b> 偏自己相関（PACF）</a></li>
<li class="chapter" data-level="9.5.3" data-path="09_var.html"><a href="09_var.html#リュンボックス検定"><i class="fa fa-check"></i><b>9.5.3</b> リュン＝ボックス検定</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="09_var.html"><a href="09_var.html#ボックスジェンキンス法"><i class="fa fa-check"></i><b>9.6</b> ボックス＝ジェンキンス法</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="09_var.html"><a href="09_var.html#armaモデル"><i class="fa fa-check"></i><b>9.6.1</b> ARMAモデル</a></li>
<li class="chapter" data-level="9.6.2" data-path="09_var.html"><a href="09_var.html#arimaモデル"><i class="fa fa-check"></i><b>9.6.2</b> ARIMAモデル</a></li>
<li class="chapter" data-level="9.6.3" data-path="09_var.html"><a href="09_var.html#ボックスジェンキンス法の分析フロー"><i class="fa fa-check"></i><b>9.6.3</b> ボックス＝ジェンキンス法の分析フロー</a></li>
<li class="chapter" data-level="9.6.4" data-path="09_var.html"><a href="09_var.html#実例ボックスジェンキンス法"><i class="fa fa-check"></i><b>9.6.4</b> 実例：ボックス＝ジェンキンス法</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="09_var.html"><a href="09_var.html#共和分"><i class="fa fa-check"></i><b>9.7</b> 共和分</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="09_var.html"><a href="09_var.html#見せかけの回帰"><i class="fa fa-check"></i><b>9.7.1</b> 見せかけの回帰</a></li>
<li class="chapter" data-level="9.7.2" data-path="09_var.html"><a href="09_var.html#共和分関係"><i class="fa fa-check"></i><b>9.7.2</b> 共和分関係</a></li>
<li class="chapter" data-level="9.7.3" data-path="09_var.html"><a href="09_var.html#エングルグレンジャー検定"><i class="fa fa-check"></i><b>9.7.3</b> エングル＝グレンジャー検定</a></li>
<li class="chapter" data-level="9.7.4" data-path="09_var.html"><a href="09_var.html#実例見せかけの回帰"><i class="fa fa-check"></i><b>9.7.4</b> 実例：見せかけの回帰</a></li>
<li class="chapter" data-level="9.7.5" data-path="09_var.html"><a href="09_var.html#実例共和分"><i class="fa fa-check"></i><b>9.7.5</b> 実例：共和分</a></li>
<li class="chapter" data-level="9.7.6" data-path="09_var.html"><a href="09_var.html#ヨハンセン検定"><i class="fa fa-check"></i><b>9.7.6</b> ヨハンセン検定</a></li>
<li class="chapter" data-level="9.7.7" data-path="09_var.html"><a href="09_var.html#ヨハンセン検定フロー自作関数"><i class="fa fa-check"></i><b>9.7.7</b> ヨハンセン検定フロー自作関数</a></li>
<li class="chapter" data-level="9.7.8" data-path="09_var.html"><a href="09_var.html#実例ヨハンセン検定"><i class="fa fa-check"></i><b>9.7.8</b> 実例：ヨハンセン検定</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="09_var.html"><a href="09_var.html#varモデル"><i class="fa fa-check"></i><b>9.8</b> VARモデル</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="09_var.html"><a href="09_var.html#レベルvarモデル"><i class="fa fa-check"></i><b>9.8.1</b> レベルVARモデル</a></li>
<li class="chapter" data-level="9.8.2" data-path="09_var.html"><a href="09_var.html#階差varモデル"><i class="fa fa-check"></i><b>9.8.2</b> 階差VARモデル</a></li>
<li class="chapter" data-level="9.8.3" data-path="09_var.html"><a href="09_var.html#vecモデル"><i class="fa fa-check"></i><b>9.8.3</b> VECモデル</a></li>
<li class="chapter" data-level="9.8.4" data-path="09_var.html"><a href="09_var.html#構造varモデル"><i class="fa fa-check"></i><b>9.8.4</b> 構造VARモデル</a></li>
<li class="chapter" data-level="9.8.5" data-path="09_var.html"><a href="09_var.html#構造vecモデル"><i class="fa fa-check"></i><b>9.8.5</b> 構造VECモデル</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="09_var.html"><a href="09_var.html#varモデルに関連する分析"><i class="fa fa-check"></i><b>9.9</b> VARモデルに関連する分析</a>
<ul>
<li class="chapter" data-level="9.9.1" data-path="09_var.html"><a href="09_var.html#グレンジャー因果性"><i class="fa fa-check"></i><b>9.9.1</b> グレンジャー因果性</a></li>
<li class="chapter" data-level="9.9.2" data-path="09_var.html"><a href="09_var.html#インパルス応答"><i class="fa fa-check"></i><b>9.9.2</b> インパルス応答</a></li>
<li class="chapter" data-level="9.9.3" data-path="09_var.html"><a href="09_var.html#予測誤差の分散分解"><i class="fa fa-check"></i><b>9.9.3</b> 予測誤差の分散分解</a></li>
</ul></li>
<li class="chapter" data-level="9.10" data-path="09_var.html"><a href="09_var.html#varモデルの分析フロー"><i class="fa fa-check"></i><b>9.10</b> VARモデルの分析フロー</a>
<ul>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#探索的データ分析-2"><i class="fa fa-check"></i>1. 探索的データ分析</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#変数選択"><i class="fa fa-check"></i>2. 変数選択</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#ラグ次数の選択"><i class="fa fa-check"></i>3. ラグ次数の選択</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#単位根検定-1"><i class="fa fa-check"></i>4. 単位根検定</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#共和分検定"><i class="fa fa-check"></i>5. 共和分検定</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#データ分割-1"><i class="fa fa-check"></i>6. データ分割</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#誘導varvecモデルの推定"><i class="fa fa-check"></i>7. 誘導VAR・VECモデルの推定</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#構造varvecモデルの識別"><i class="fa fa-check"></i>8. 構造VAR・VECモデルの識別</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#誤差項の検定"><i class="fa fa-check"></i>9. 誤差項の検定</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#モデル推定後の分析"><i class="fa fa-check"></i>10. モデル推定後の分析</a></li>
<li class="chapter" data-level="" data-path="09_var.html"><a href="09_var.html#予測"><i class="fa fa-check"></i>11. 予測</a></li>
</ul></li>
<li class="chapter" data-level="9.11" data-path="09_var.html"><a href="09_var.html#varモデルの実例"><i class="fa fa-check"></i><b>9.11</b> VARモデルの実例</a>
<ul>
<li class="chapter" data-level="9.11.1" data-path="09_var.html"><a href="09_var.html#実例探索的データ分析"><i class="fa fa-check"></i><b>9.11.1</b> 実例：探索的データ分析</a></li>
<li class="chapter" data-level="9.11.2" data-path="09_var.html"><a href="09_var.html#実例変数選択グレンジャー因果性検定"><i class="fa fa-check"></i><b>9.11.2</b> 実例：変数選択（グレンジャー因果性検定）</a></li>
<li class="chapter" data-level="9.11.3" data-path="09_var.html"><a href="09_var.html#実例ラグ次数選択"><i class="fa fa-check"></i><b>9.11.3</b> 実例：ラグ次数選択</a></li>
<li class="chapter" data-level="9.11.4" data-path="09_var.html"><a href="09_var.html#実例adf検定"><i class="fa fa-check"></i><b>9.11.4</b> 実例：ADF検定</a></li>
<li class="chapter" data-level="9.11.5" data-path="09_var.html"><a href="09_var.html#実例ヨハンセン検定-1"><i class="fa fa-check"></i><b>9.11.5</b> 実例：ヨハンセン検定</a></li>
<li class="chapter" data-level="9.11.6" data-path="09_var.html"><a href="09_var.html#実例varモデルの推定"><i class="fa fa-check"></i><b>9.11.6</b> 実例：VARモデルの推定</a></li>
<li class="chapter" data-level="9.11.7" data-path="09_var.html"><a href="09_var.html#実例vecモデルの推定"><i class="fa fa-check"></i><b>9.11.7</b> 実例：VECモデルの推定</a></li>
<li class="chapter" data-level="9.11.8" data-path="09_var.html"><a href="09_var.html#実例構造varモデルの推定"><i class="fa fa-check"></i><b>9.11.8</b> 実例：構造VARモデルの推定</a></li>
<li class="chapter" data-level="9.11.9" data-path="09_var.html"><a href="09_var.html#実例構造vecモデルの推定"><i class="fa fa-check"></i><b>9.11.9</b> 実例：構造VECモデルの推定</a></li>
<li class="chapter" data-level="9.11.10" data-path="09_var.html"><a href="09_var.html#実例誤差項の検定"><i class="fa fa-check"></i><b>9.11.10</b> 実例：誤差項の検定</a></li>
<li class="chapter" data-level="9.11.11" data-path="09_var.html"><a href="09_var.html#実例インパルス応答"><i class="fa fa-check"></i><b>9.11.11</b> 実例：インパルス応答</a></li>
<li class="chapter" data-level="9.11.12" data-path="09_var.html"><a href="09_var.html#実例予測誤差の分散分解"><i class="fa fa-check"></i><b>9.11.12</b> 実例：予測誤差の分散分解</a></li>
<li class="chapter" data-level="9.11.13" data-path="09_var.html"><a href="09_var.html#実例グレンジャー因果性検定"><i class="fa fa-check"></i><b>9.11.13</b> 実例：グレンジャー因果性検定</a></li>
<li class="chapter" data-level="9.11.14" data-path="09_var.html"><a href="09_var.html#実例予測"><i class="fa fa-check"></i><b>9.11.14</b> 実例：予測</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html"><i class="fa fa-check"></i>付録 寄与度の計算方法</a>
<ul>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#記号法"><i class="fa fa-check"></i>記号法</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#和差の指標"><i class="fa fa-check"></i>和・差の指標</a>
<ul>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#公式"><i class="fa fa-check"></i>公式</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#実例gdp"><i class="fa fa-check"></i>実例：GDP</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#積の指標"><i class="fa fa-check"></i>積の指標</a>
<ul>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#公式-1"><i class="fa fa-check"></i>公式</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#実例貿易指数金額指数"><i class="fa fa-check"></i>実例：貿易指数（金額指数）</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#実例経常利益"><i class="fa fa-check"></i>実例：経常利益</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#商の指標"><i class="fa fa-check"></i>商の指標</a>
<ul>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#公式-2"><i class="fa fa-check"></i>公式</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#実例貿易指数数量指数"><i class="fa fa-check"></i>実例：貿易指数（数量指数）</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#実例失業率"><i class="fa fa-check"></i>実例：失業率</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#固定加重平均の指標"><i class="fa fa-check"></i>固定加重平均の指標</a>
<ul>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#公式-3"><i class="fa fa-check"></i>公式</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#実例ラスパイレス指数"><i class="fa fa-check"></i>実例：ラスパイレス指数</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#可変加重平均の指標"><i class="fa fa-check"></i>可変加重平均の指標</a>
<ul>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#公式-4"><i class="fa fa-check"></i>公式</a></li>
<li class="chapter" data-level="" data-path="appendix_cont.html"><a href="appendix_cont.html#実例現金給与総額"><i class="fa fa-check"></i>実例：現金給与総額</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">エコノミストのためのR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="時系列分析" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> 時系列分析<a href="09_var.html#時系列分析" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>第9章「時系列分析」では、時系列データを対象とする分析手法について解説します。</p>
<p><strong>時系列データ（time series data）</strong>とは、<u>ある観測対象個体</u>について、<u>複数の時点</u>で情報を観測したデータです。例えば、日本を対象に10年間の四半期別GDPの値を収集したデータが、時系列データに該当します。これに対し、<u>複数の観測対象個体</u>について<u>単一の時点</u>で情報を観測したデータを<strong>横断面データ（cross section data）</strong>と言います。</p>
<p>時系列分析は、時系列データを用い、観測時点間のデータの関係性（データの並び順や前後関係に関する性質）を明らかにしたり、過去のデータの特徴から将来の値を予測したりすることを目的としています。</p>
<p>なお、この章の説明は、エンダース（2019）、北岡 他（2013）、西山 他（2019）、ニールセン（2021）、馬場（2018）、宮尾（2006）、村尾（2019）、横内・青木（2014）を参考にしています。詳細は各参考文献を参照してください。</p>
<div id="第9章の準備" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> 第9章の準備<a href="09_var.html#第9章の準備" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="パッケージのインポート-6" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> パッケージのインポート<a href="09_var.html#パッケージのインポート-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="09_var.html#cb876-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)</span>
<span id="cb876-2"><a href="09_var.html#cb876-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb876-3"><a href="09_var.html#cb876-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp)</span>
<span id="cb876-4"><a href="09_var.html#cb876-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb876-5"><a href="09_var.html#cb876-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb876-6"><a href="09_var.html#cb876-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb876-7"><a href="09_var.html#cb876-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb876-8"><a href="09_var.html#cb876-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb876-9"><a href="09_var.html#cb876-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vars)</span>
<span id="cb876-10"><a href="09_var.html#cb876-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urca)</span></code></pre></div>
</div>
<div id="外部データセットの取得-4" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> 外部データセットの取得<a href="09_var.html#外部データセットの取得-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>この章では、西山 他（2019）のデータセットを使用します。<a href="http://www.yuhikaku.co.jp/books/detail/9784641053854">西山 他（2019）のサポートウェブサイト</a>からデータファイルを取得し、各自の実行環境のワーキングディレクトリ直下に<code>data_nishiyama</code>フォルダを作成して、その中に格納してください。</p>
</div>
</div>
<div id="定常性" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> 定常性<a href="09_var.html#定常性" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>時系列分析の目的は時系列データの特徴を明らかにし、将来の予測に役立てることです。そのためには、分析対象である時系列データの特徴が時間を通じて安定している必要があります。時系列データの安定性を担保する前提条件を、<strong>定常性（stationarity）</strong>と言います。</p>
<div id="定常性の定義" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> 定常性の定義<a href="09_var.html#定常性の定義" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>本書では、定常性を次のように「平均<span class="math inline">\(E(Y_t)\)</span>、分散<span class="math inline">\(\mathit{Var}(Y_t)\)</span>、自己共分散<span class="math inline">\(\mathit{Cov}(Y_t, Y_{t-p})\)</span>が時間<span class="math inline">\(t\)</span>を通じて変わらないこと」と定義します。このような性質をもつ時系列データを<strong>定常過程（stationary process）</strong>と言います。</p>
<p><span class="math display">\[
\begin{aligned}
&amp; E(Y_t) = \mu \lt \infty \\
&amp; \mathit{Var}(Y_t) = E[(Y_t - \mu)^2] = \sigma^2 \lt \infty \\
&amp; \mathit{Cov}(Y_t, Y_{t-s}) = E[(Y_t - \mu)(Y_{t-s} - \mu)] = \gamma_s, \quad s \gt 0
\end{aligned}
\]</span></p>
<p>特に、原系列に何ら変換を加えない状態で定常である時系列データを<strong>レベル定常過程</strong>と呼びます。レベル定常過程のデータは、ある水準の周りで安定的に推移し、一定の幅をもって変動します。</p>
<p>なお、定常性にはいくつかの定義があり、本書では「弱定常」や「共分散定常」と呼ばれる定常性の定義を採用しています。定常性の詳細については、ニールセン（2021）P.77、西山 他（2019）P.476、村尾（2019）P.36、横内・青木（2014）P.82を参照してください。</p>
</div>
<div id="ホワイトノイズ" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> ホワイトノイズ<a href="09_var.html#ホワイトノイズ" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>定常な時系列データの中で、最も簡単かつ重要な系列が<strong>ホワイトノイズ（white noise）</strong>です。ホワイトノイズは、「平均が0、分散がある一定の値、自己共分散が0」が成立する時系列データと定義され、ここでは<span class="math inline">\(u_t\)</span>と表します。ホワイトノイズの厳密な定義については、村尾（2019）P.32を参照してください。</p>
<p><span class="math display">\[
\begin{aligned}
&amp; E(u_t) = 0 \\
&amp; \mathit{Var}(u_t) = E(u_t u_t) = \sigma^2 \lt \infty \\
&amp; \mathit{Cov}(u_t, u_s) = E(u_t, u_s) = 0, \quad t \ne s
\end{aligned}
\]</span></p>
<p>例えば、平均が0の正規分布（標準正規分布など）に従う時系列データはホワイトノイズの一種です。ホワイトノイズを生成する場合は、<code>rnorm()</code>関数などを用いて正規乱数を生成し、ホワイトノイズとして利用することが一般的です。</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="09_var.html#cb877-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 標準正規分布に従うサンプルサイズ400の乱数を生成し、折れ線グラフをプロット</span></span>
<span id="cb877-2"><a href="09_var.html#cb877-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">400</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb877-3"><a href="09_var.html#cb877-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-389-1.png" width="672" /></p>
</div>
</div>
<div id="非定常過程" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> 非定常過程<a href="09_var.html#非定常過程" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>定常性を満たさない時系列データを<strong>非定常過程（non-stationary process）</strong>と言います。</p>
<p>ここでは、定常過程と非定常過程を区別する方法である<strong>単位根</strong>や、代表的な非定常過程の例である<strong>階差定常過程（和分過程）</strong>と<strong>トレンド定常過程</strong>について解説します。</p>
<div id="単位根" class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> 単位根<a href="09_var.html#単位根" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>時系列データの安定性を示す定常性とコインの裏表の関係にある概念が、<strong>単位根（unit root）</strong>です。時系列データが定常か非定常かを判断するうえでは、単位根の有無が重要です。</p>
<p>ある時系列データ<span class="math inline">\(Y_t\)</span>の当期の値<span class="math inline">\(Y_t\)</span>と1期前の値<span class="math inline">\(Y_{t-1}\)</span>について、次のような関係を考えます。なお、<span class="math inline">\(u_t\)</span>はホワイトノイズです。</p>
<p><span class="math display">\[
Y_t = \rho Y_{t-1} + u_t
\]</span></p>
<p>ここで、ある時に変数<span class="math inline">\(u_t\)</span>に生じたショックがその後の時系列データ<span class="math inline">\(Y_t\)</span>に与える波及効果は、データの時間を通じた影響力を表す係数<span class="math inline">\(\rho\)</span>の絶対値<span class="math inline">\(|\rho|\)</span>が取りうる範囲によって、次の3つに分類できます。</p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(|\rho| \lt 1\)</span>のケース</p>
<p>データの時間を通じた影響力が1より小さく、変数<span class="math inline">\(u_t\)</span>に生じたショックは時間の経過に伴って減衰します。すなわち、<u>波及効果は過渡的・一時的であり、このケースは定常過程になります</u>。</p></li>
<li><p><span class="math inline">\(|\rho| = 1\)</span>のケース</p>
<p>データの時間を通じた影響力が1であり、変数<span class="math inline">\(u_t\)</span>に生じたショックは時間の経過に伴って減衰することなく一定で永遠に続きます。すなわち、<u>波及効果は恒久的であり、このケースは非定常過程になります</u>。このように<span class="math inline">\(|\rho| = 1\)</span>となる<span class="math inline">\(\rho\)</span>を<strong>単位根</strong>と言います。このケースは<strong>ランダムウォーク（random walk）</strong>とも呼ばれます。</p></li>
<li><p><span class="math inline">\(|\rho| \gt 1\)</span>のケース</p>
<p>データの時間を通じた影響力が1より大きく、変数<span class="math inline">\(u_t\)</span>に生じたショックは時間の経過に伴って拡大します。すなわち、<u>波及効果は爆発的（発散）であり、このケースも非定常過程になります</u>。</p></li>
</ol>
<p>本書では2のケースと3のケースが成立するとき、すなわち<span class="math inline">\(|\rho| \ge 1\)</span>の場合に、当該データが<strong>単位根過程（unit root process）</strong>であると呼びます。単位根過程は非定常過程の十分条件です。また、単位根過程はこの後に示す階差定常過程（和分過程）と同義です。</p>
<p>ケース1〜3のデータ例をRで作成して図示すると、次のようになります。</p>
<p>定常過程のケース1（<span class="math inline">\(Y^1_t = 0.1 \times Y^1_{t-1} + u_t\)</span>）では<span class="math inline">\(Y=0\)</span>から離れてもすぐに回帰し、<span class="math inline">\(Y=0\)</span>の周りで安定的に変動しています。一方、ケース2（<span class="math inline">\(Y^2_t = Y^2_{t-1} + u_t\)</span>）ではデータがすぐ<span class="math inline">\(Y=0\)</span>に戻らずに一定期間プラスやマイナスの領域で推移し続け、不安定な千鳥足的変動になっています。最後のケース3（<span class="math inline">\(Y^3_t = 1.03 \times Y^3_{t-1} + u_t\)</span>）ではデータが<span class="math inline">\(Y=0\)</span>に戻ることなく、加速度的に<span class="math inline">\(Y=0\)</span>から離れていきます。</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="09_var.html#cb878-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データを格納する要素数100の数値ベクトル</span></span>
<span id="cb878-2"><a href="09_var.html#cb878-2" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb878-3"><a href="09_var.html#cb878-3" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb878-4"><a href="09_var.html#cb878-4" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb878-5"><a href="09_var.html#cb878-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-6"><a href="09_var.html#cb878-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 要素数100のホワイトノイズ（標準正規乱数）</span></span>
<span id="cb878-7"><a href="09_var.html#cb878-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb878-8"><a href="09_var.html#cb878-8" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb878-9"><a href="09_var.html#cb878-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-10"><a href="09_var.html#cb878-10" aria-hidden="true" tabindex="-1"></a><span class="co"># y1〜y3の初期値（t=1）にu[1]を代入しておく</span></span>
<span id="cb878-11"><a href="09_var.html#cb878-11" aria-hidden="true" tabindex="-1"></a>y1[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb878-12"><a href="09_var.html#cb878-12" aria-hidden="true" tabindex="-1"></a>y2[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb878-13"><a href="09_var.html#cb878-13" aria-hidden="true" tabindex="-1"></a>y3[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb878-14"><a href="09_var.html#cb878-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-15"><a href="09_var.html#cb878-15" aria-hidden="true" tabindex="-1"></a><span class="co"># forループでt=2以降のデータを作成</span></span>
<span id="cb878-16"><a href="09_var.html#cb878-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb878-17"><a href="09_var.html#cb878-17" aria-hidden="true" tabindex="-1"></a>  y1[t] <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="sc">*</span> y1[t<span class="dv">-1</span>] <span class="sc">+</span> u[t] <span class="co"># ケース1</span></span>
<span id="cb878-18"><a href="09_var.html#cb878-18" aria-hidden="true" tabindex="-1"></a>  y2[t] <span class="ot">&lt;-</span> <span class="fl">1.0</span> <span class="sc">*</span> y2[t<span class="dv">-1</span>] <span class="sc">+</span> u[t] <span class="co"># ケース2</span></span>
<span id="cb878-19"><a href="09_var.html#cb878-19" aria-hidden="true" tabindex="-1"></a>  y3[t] <span class="ot">&lt;-</span> <span class="fl">1.03</span> <span class="sc">*</span> y3[t<span class="dv">-1</span>] <span class="sc">+</span> u[t] <span class="co"># ケース3</span></span>
<span id="cb878-20"><a href="09_var.html#cb878-20" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb878-21"><a href="09_var.html#cb878-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-22"><a href="09_var.html#cb878-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 折れ線グラフをプロット</span></span>
<span id="cb878-23"><a href="09_var.html#cb878-23" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb878-24"><a href="09_var.html#cb878-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb878-25"><a href="09_var.html#cb878-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y1 =</span> y1,</span>
<span id="cb878-26"><a href="09_var.html#cb878-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y2 =</span> y2,</span>
<span id="cb878-27"><a href="09_var.html#cb878-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y3 =</span> y3</span>
<span id="cb878-28"><a href="09_var.html#cb878-28" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb878-29"><a href="09_var.html#cb878-29" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>X, <span class="at">values_to =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">names_to =</span> <span class="st">&quot;series&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb878-30"><a href="09_var.html#cb878-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">color =</span> series)) <span class="sc">+</span></span>
<span id="cb878-31"><a href="09_var.html#cb878-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-390-1.png" width="672" /></p>
<p>上の例において、<span class="math inline">\(t=25\)</span>時点で一時的なショックを発生させると、次のような結果になります。ケース1ではショックが次第に消失し<span class="math inline">\(Y=0\)</span>に回帰します。一方、ケース2ではショックが消失せずに残り、ショック発生後に水準がシフトします。ケース3ではショックが増幅され、ショックがない場合に比べ増加ペースが加速します。</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="09_var.html#cb879-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データを格納する要素数100の数値ベクトル</span></span>
<span id="cb879-2"><a href="09_var.html#cb879-2" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb879-3"><a href="09_var.html#cb879-3" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb879-4"><a href="09_var.html#cb879-4" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb879-5"><a href="09_var.html#cb879-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-6"><a href="09_var.html#cb879-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 要素数100のホワイトノイズ（標準正規乱数）</span></span>
<span id="cb879-7"><a href="09_var.html#cb879-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb879-8"><a href="09_var.html#cb879-8" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb879-9"><a href="09_var.html#cb879-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-10"><a href="09_var.html#cb879-10" aria-hidden="true" tabindex="-1"></a><span class="co"># y1〜y3の初期値（t=1）にu[1]を代入しておく</span></span>
<span id="cb879-11"><a href="09_var.html#cb879-11" aria-hidden="true" tabindex="-1"></a>y1[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb879-12"><a href="09_var.html#cb879-12" aria-hidden="true" tabindex="-1"></a>y2[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb879-13"><a href="09_var.html#cb879-13" aria-hidden="true" tabindex="-1"></a>y3[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb879-14"><a href="09_var.html#cb879-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-15"><a href="09_var.html#cb879-15" aria-hidden="true" tabindex="-1"></a><span class="co"># forループでt=2以降のデータを作成。t=25にshockが発生</span></span>
<span id="cb879-16"><a href="09_var.html#cb879-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb879-17"><a href="09_var.html#cb879-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="sc">==</span> <span class="dv">25</span>) {shock <span class="ot">&lt;-</span> <span class="dv">10</span>} <span class="cf">else</span> {shock <span class="ot">&lt;-</span> <span class="dv">0</span>}</span>
<span id="cb879-18"><a href="09_var.html#cb879-18" aria-hidden="true" tabindex="-1"></a>  y1[t] <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="sc">*</span> y1[t<span class="dv">-1</span>] <span class="sc">+</span> u[t] <span class="sc">+</span> shock <span class="co"># ケース1</span></span>
<span id="cb879-19"><a href="09_var.html#cb879-19" aria-hidden="true" tabindex="-1"></a>  y2[t] <span class="ot">&lt;-</span> <span class="fl">1.0</span> <span class="sc">*</span> y2[t<span class="dv">-1</span>] <span class="sc">+</span> u[t] <span class="sc">+</span> shock <span class="co"># ケース2</span></span>
<span id="cb879-20"><a href="09_var.html#cb879-20" aria-hidden="true" tabindex="-1"></a>  y3[t] <span class="ot">&lt;-</span> <span class="fl">1.03</span> <span class="sc">*</span> y3[t<span class="dv">-1</span>] <span class="sc">+</span> u[t] <span class="sc">+</span> shock <span class="co"># ケース3</span></span>
<span id="cb879-21"><a href="09_var.html#cb879-21" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb879-22"><a href="09_var.html#cb879-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb879-23"><a href="09_var.html#cb879-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 折れ線グラフをプロット</span></span>
<span id="cb879-24"><a href="09_var.html#cb879-24" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb879-25"><a href="09_var.html#cb879-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb879-26"><a href="09_var.html#cb879-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y1 =</span> y1,</span>
<span id="cb879-27"><a href="09_var.html#cb879-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y2 =</span> y2,</span>
<span id="cb879-28"><a href="09_var.html#cb879-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y3 =</span> y3</span>
<span id="cb879-29"><a href="09_var.html#cb879-29" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb879-30"><a href="09_var.html#cb879-30" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>X, <span class="at">values_to =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">names_to =</span> <span class="st">&quot;series&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb879-31"><a href="09_var.html#cb879-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">color =</span> series)) <span class="sc">+</span></span>
<span id="cb879-32"><a href="09_var.html#cb879-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-391-1.png" width="672" /></p>
</div>
<div id="階差定常過程和分過程" class="section level3 hasAnchor" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> 階差定常過程・和分過程<a href="09_var.html#階差定常過程和分過程" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>非定常過程のデータは平均や分散といった性質が時間を通じて変化するため、そのままでは定常過程のデータと同様の分析を行うことができません。しかし、一定の処置を行なって定常過程に変換（定常化）すれば、定常過程のデータと同じように扱うことができます。</p>
<p>そうした特定の方法で定常化できる非定常過程の代表例として、原系列の階差を取ることで定常になる<strong>階差定常過程（和分過程）</strong>と、タイムトレンドを除去することで定常になる<strong>トレンド定常過程</strong>があります。</p>
<p><strong>階差定常過程（difference stationary）</strong>は、原系列の階差を取ることで定常になる非定常過程であり、<span class="math inline">\(|\rho| \ge 1\)</span>のケースに該当します。</p>
<p>階差定常過程は「何回階差を取れば定常過程になるか」が重要です。非定常過程<span class="math inline">\(Y_t\)</span>が1次の階差変換で定常になるとき、<span class="math inline">\(Y_t\)</span>は1次の<strong>和分過程（integrated process）</strong>であるといい、<span class="math inline">\(Y_t \sim I(1)\)</span>と表記します。同様に2次の階差変換で定常になる場合は2次の和分過程と呼び、<span class="math inline">\(Y_t \sim I(2)\)</span>と表記します。なお、原系列のままで定常なレベル定常過程は<span class="math inline">\(I(0)\)</span>過程に分類されます。</p>
<p>経済・金融分野では一般的に多くの時系列データが<span class="math inline">\(I(0)\)</span>過程もしくは<span class="math inline">\(I(1)\)</span>過程であり、<span class="math inline">\(I(2)\)</span>過程はきわめて稀です。したがって実務的には<span class="math inline">\(I(0)\)</span>過程と<span class="math inline">\(I(1)\)</span>過程を見分けることが重要です。</p>
</div>
<div id="ランダムウォーク" class="section level3 hasAnchor" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> ランダムウォーク<a href="09_var.html#ランダムウォーク" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>階差定常過程の代表例がランダムウォークです。ランダムウォークは<span class="math inline">\(Y_t = c + Y_{t-1} + u_t\)</span>の形を取ります。<span class="math inline">\(c\)</span>はドリフト項といい、ランダムウォークなどの<span class="math inline">\(I(1)\)</span>過程ではタイムトレンドを表現します（村尾（2019）P.66）。</p>
<p>次の例はドリフト項がない最も基本的なランダムウォーク<span class="math inline">\(Y_t = Y_{t-1} + u_t\)</span>であり、<span class="math inline">\(Y=0\)</span>の周りで不安定な千鳥足的変動になっています。</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="09_var.html#cb880-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データを格納する要素数100の数値ベクトル</span></span>
<span id="cb880-2"><a href="09_var.html#cb880-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb880-3"><a href="09_var.html#cb880-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-4"><a href="09_var.html#cb880-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 要素数100のホワイトノイズ（標準正規乱数）</span></span>
<span id="cb880-5"><a href="09_var.html#cb880-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb880-6"><a href="09_var.html#cb880-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb880-7"><a href="09_var.html#cb880-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-8"><a href="09_var.html#cb880-8" aria-hidden="true" tabindex="-1"></a><span class="co"># yの初期値（t=1）にu[1]を代入しておく</span></span>
<span id="cb880-9"><a href="09_var.html#cb880-9" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb880-10"><a href="09_var.html#cb880-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-11"><a href="09_var.html#cb880-11" aria-hidden="true" tabindex="-1"></a><span class="co"># forループでt=2以降のデータを作成</span></span>
<span id="cb880-12"><a href="09_var.html#cb880-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">100</span>) {y[t] <span class="ot">&lt;-</span> y[t<span class="dv">-1</span>] <span class="sc">+</span> u[t]}</span>
<span id="cb880-13"><a href="09_var.html#cb880-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-14"><a href="09_var.html#cb880-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 折れ線グラフにプロット</span></span>
<span id="cb880-15"><a href="09_var.html#cb880-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-392-1.png" width="672" /></p>
<p>一方、次の例はドリフト項があるランダムウォーク<span class="math inline">\(Y_t = c + Y_{t-1} + u_t\)</span>であり、タイムトレンド（ここでは<span class="math inline">\(c=0.2\)</span>）の周りで不安定な千鳥足的変動になっています。一見すると次に示すトレンド定常過程と似ていますが、ランダムウォークはタイムトレンドを除去（ディトレンド）しても非定常過程のままであり、それだけでは定常過程に変換できません。</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="09_var.html#cb881-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データを格納する要素数100の数値ベクトル</span></span>
<span id="cb881-2"><a href="09_var.html#cb881-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb881-3"><a href="09_var.html#cb881-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb881-4"><a href="09_var.html#cb881-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 要素数100のホワイトノイズ（標準正規乱数）</span></span>
<span id="cb881-5"><a href="09_var.html#cb881-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb881-6"><a href="09_var.html#cb881-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb881-7"><a href="09_var.html#cb881-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb881-8"><a href="09_var.html#cb881-8" aria-hidden="true" tabindex="-1"></a><span class="co"># yの初期値（t=1）にu[1]を代入しておく</span></span>
<span id="cb881-9"><a href="09_var.html#cb881-9" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb881-10"><a href="09_var.html#cb881-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb881-11"><a href="09_var.html#cb881-11" aria-hidden="true" tabindex="-1"></a><span class="co"># forループでt=2以降のデータを作成</span></span>
<span id="cb881-12"><a href="09_var.html#cb881-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">100</span>) {y[t] <span class="ot">&lt;-</span> <span class="fl">0.2</span> <span class="sc">+</span> y[t<span class="dv">-1</span>] <span class="sc">+</span> u[t]}</span>
<span id="cb881-13"><a href="09_var.html#cb881-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb881-14"><a href="09_var.html#cb881-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 折れ線グラフにプロット</span></span>
<span id="cb881-15"><a href="09_var.html#cb881-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-393-1.png" width="672" /></p>
</div>
<div id="トレンド定常過程" class="section level3 hasAnchor" number="9.3.4">
<h3><span class="header-section-number">9.3.4</span> トレンド定常過程<a href="09_var.html#トレンド定常過程" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>トレンド定常過程（trend stationary）</strong>は、タイムトレンド（時間のみの関数）を取り除くことによって定常になる非定常過程です。タイムトレンドを除去するには、1階の階差変換を行なったり、線形トレンドを当てはめてトレンドラインからの乖離幅を求めたりする方法があります。</p>
<p>トレンド定常過程は、レベル定常過程にタイムトレンド項を加えた構造をしています。平均値が時間を通じて一定でないため、厳密には定常性の条件を満たしませんが、タイムトレンドの周りで一定の幅をもって安定的に変動するため、定常過程に近い性質があります。</p>
<p>トレンド定常過程のデータを扱う際の注意点は次のとおりです。</p>
<ul>
<li><p><u>単位根の有無だけでは、定常過程とトレンド定常過程を区別できません</u>。定常過程とトレンド定常過程はどちらも単位根をもたず、ともに<span class="math inline">\(I(0)\)</span>過程に分類されます。定常過程とトレンド定常過程を見分けるには、データを図示してトレンドの有無をチェックするか、次に示すADF検定フローで「トレンド項がある<span class="math inline">\(I(0)\)</span>過程」であることを確認する必要があります。</p></li>
<li><p><u>トレンド定常過程のデータに定常性を前提とする時系列分析手法は使えません</u>。トレンド定常過程は単位根を持たない<span class="math inline">\(I(0)\)</span>過程である点が定常過程と共通していますが、平均値が一定でなく定常性の条件を満たしていないため、後述するボックス＝ジェンキンス法のARMAモデルのように、定常性を前提とする時系列分析手法を使うことはできず、階差変換を行うARIMAモデルを用いる必要があります。</p></li>
<li><p><u>1階の階差変換による定常化だけでは、階差定常過程（1次の和分過程）とトレンド定常過程を区別できません</u>。1階の階差変換はタイムトレンドを除去する手段でもあるため、1階の階差変換により階差定常過程（1次の和分過程）とトレンド定常過程をどちらも定常化することができます。一方、それ以外のタイムトレンド除去方法（例えば線形トレンドの当てはめなど）を階差定常過程データに用いても定常化することはできません。<span class="math inline">\(I(1)\)</span>過程データと<span class="math inline">\(I(0)\)</span>過程データは、後述する共和分の有無の確認などで取り扱いが異なるため、次に示すADF検定フローを通じて区別する必要があります。</p></li>
</ul>
<p>最も単純なトレンド定常過程の例が、ホワイトノイズ<span class="math inline">\(u_t\)</span>にタイムトレンド項<span class="math inline">\(\delta t\)</span>を加えた<span class="math inline">\(Y_t = \delta t + u_t\)</span>です。ここでは例として<span class="math inline">\(\delta = 0.1\)</span>とします。</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="09_var.html#cb882-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データを格納する要素数100の数値ベクトル</span></span>
<span id="cb882-2"><a href="09_var.html#cb882-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb882-3"><a href="09_var.html#cb882-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-4"><a href="09_var.html#cb882-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 要素数100のホワイトノイズ（標準正規乱数）</span></span>
<span id="cb882-5"><a href="09_var.html#cb882-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb882-6"><a href="09_var.html#cb882-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb882-7"><a href="09_var.html#cb882-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-8"><a href="09_var.html#cb882-8" aria-hidden="true" tabindex="-1"></a><span class="co"># forループでタイムトレンド項1〜100のデータを作成</span></span>
<span id="cb882-9"><a href="09_var.html#cb882-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {y[t] <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="sc">*</span> t <span class="sc">+</span> u[t]}</span>
<span id="cb882-10"><a href="09_var.html#cb882-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-11"><a href="09_var.html#cb882-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 折れ線グラフにプロット</span></span>
<span id="cb882-12"><a href="09_var.html#cb882-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-394-1.png" width="672" /></p>
<p>また、<span class="math inline">\(|\rho| \lt 1\)</span>のケースのレベル定常過程データにタイムトレンド項を加えた<span class="math inline">\(Y_t = \rho Y_{t-1} + \delta t + u_t \; (|\rho| \lt 1)\)</span>もトレンド定常過程になります。ここでは例として<span class="math inline">\(\rho = 0.8\)</span>、<span class="math inline">\(\delta = 0.1\)</span>とします。</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="09_var.html#cb883-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データを格納する要素数100の数値ベクトル</span></span>
<span id="cb883-2"><a href="09_var.html#cb883-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb883-3"><a href="09_var.html#cb883-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb883-4"><a href="09_var.html#cb883-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 要素数100のホワイトノイズ（標準正規乱数）</span></span>
<span id="cb883-5"><a href="09_var.html#cb883-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb883-6"><a href="09_var.html#cb883-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb883-7"><a href="09_var.html#cb883-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb883-8"><a href="09_var.html#cb883-8" aria-hidden="true" tabindex="-1"></a><span class="co"># yの初期値（t=1）にu[1]を代入しておく</span></span>
<span id="cb883-9"><a href="09_var.html#cb883-9" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb883-10"><a href="09_var.html#cb883-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb883-11"><a href="09_var.html#cb883-11" aria-hidden="true" tabindex="-1"></a><span class="co"># forループでt=2以降のデータを作成</span></span>
<span id="cb883-12"><a href="09_var.html#cb883-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">100</span>) {y[t] <span class="ot">&lt;-</span> <span class="fl">0.8</span> <span class="sc">*</span> y[t<span class="dv">-1</span>] <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> t <span class="sc">+</span> u[t]}</span>
<span id="cb883-13"><a href="09_var.html#cb883-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb883-14"><a href="09_var.html#cb883-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 折れ線グラフにプロット</span></span>
<span id="cb883-15"><a href="09_var.html#cb883-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-395-1.png" width="672" /></p>
<p>上記式にドリフト項<span class="math inline">\(c\)</span>を加えた<span class="math inline">\(Y_t = c + \rho Y_{t-1} + \delta t + u_t \; (|\rho| \lt 1)\)</span>も、トレンド定常過程になります。ここでは例として<span class="math inline">\(c = 5\)</span>とします。トレンド定常過程におけるドリフト項<span class="math inline">\(c\)</span>は初期時点の一時的なショックを表現し、ショックの消化に伴いトレンド定常過程全体が<span class="math inline">\(Y=0\)</span>からレベルシフトします。ショックの消化に要する期間は<span class="math inline">\(Y_{t-1}\)</span>の係数<span class="math inline">\(\rho\)</span>に、レベルシフトの幅はドリフト項<span class="math inline">\(c\)</span>と<span class="math inline">\(Y_{t-1}\)</span>の係数<span class="math inline">\(\rho\)</span>両方に依存します。</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="09_var.html#cb884-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データを格納する要素数100の数値ベクトル</span></span>
<span id="cb884-2"><a href="09_var.html#cb884-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb884-3"><a href="09_var.html#cb884-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb884-4"><a href="09_var.html#cb884-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 要素数100のホワイトノイズ（標準正規乱数）</span></span>
<span id="cb884-5"><a href="09_var.html#cb884-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb884-6"><a href="09_var.html#cb884-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb884-7"><a href="09_var.html#cb884-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb884-8"><a href="09_var.html#cb884-8" aria-hidden="true" tabindex="-1"></a><span class="co"># yの初期値（t=1）にu[1]を代入しておく</span></span>
<span id="cb884-9"><a href="09_var.html#cb884-9" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> u[<span class="dv">1</span>]</span>
<span id="cb884-10"><a href="09_var.html#cb884-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb884-11"><a href="09_var.html#cb884-11" aria-hidden="true" tabindex="-1"></a><span class="co"># forループでt=2以降のデータを作成</span></span>
<span id="cb884-12"><a href="09_var.html#cb884-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">100</span>) {y[t] <span class="ot">&lt;-</span> 5　<span class="sc">+</span>　<span class="fl">0.8</span> <span class="sc">*</span> y[t<span class="dv">-1</span>] <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> t <span class="sc">+</span> u[t]}</span>
<span id="cb884-13"><a href="09_var.html#cb884-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb884-14"><a href="09_var.html#cb884-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 折れ線グラフにプロット</span></span>
<span id="cb884-15"><a href="09_var.html#cb884-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-396-1.png" width="672" /></p>
</div>
</div>
<div id="単位根検定adf検定" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> 単位根検定（ADF検定）<a href="09_var.html#単位根検定adf検定" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>単位根が分析対象の時系列データにあるかどうかを判断するための方法が、<strong>単位根検定（unit root test）</strong>です。単位根検定にはいくつかの種類がありますが、ここでは最も一般的な<strong>拡張ディッキー＝フラー検定（Augmented Dickey-Fuller test、ADF検定）</strong>を用います。ADF検定の最終的な目的は、単位根の有無をもとに、分析対象である時系列データの和分次数（<span class="math inline">\(I(0)\)</span>、<span class="math inline">\(I(1)\)</span>、<span class="math inline">\(I(2)\)</span>など）を判断することです。</p>
<p>ADF検定では、分析対象の時系列データが定数項やタイムトレンド項をもつ可能性を考慮し、次の3種類のモデルについて「単位根がある（<span class="math inline">\(\rho = 1\)</span>）」ことを帰無仮説とする検定を行います。ここで、定数項は<span class="math inline">\(\beta_1\)</span>、タイムトレンド項は<span class="math inline">\(\beta_2t\)</span>です。また、<span class="math inline">\(\sum^{p-1}_{s=1}{\gamma_sY_{t-s}}\)</span>はラグ次数<span class="math inline">\(p\)</span>の系列相関の影響を制御（除去）する役割があります。</p>
<ol style="list-style-type: decimal">
<li><p>trendモデル</p>
<p>trendモデルは定数項<span class="math inline">\(\beta_1\)</span>とタイムトレンド項<span class="math inline">\(\beta_2t\)</span>の両方を含む回帰モデルです。</p></li>
</ol>
<p><span class="math display">\[
\Delta{Y_t} = \beta_1 + \beta_2t + (\rho - 1)Y_{t-1} + \sum^{p-1}_{s=1}{\gamma_sY_{t-s}} + u_t
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li><p>driftモデル</p>
<p>driftモデルは定数項<span class="math inline">\(\beta_1\)</span>を含む回帰モデルです。</p></li>
</ol>
<p><span class="math display">\[
\Delta{Y_t} = \beta_1 + (\rho - 1)Y_{t-1} + \sum^{p-1}_{s=1}{\gamma_sY_{t-s}} + u_t
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li><p>noneモデル</p>
<p>noneモデルは定数項もタイムトレンド項も含まない回帰モデルです。</p></li>
</ol>
<p><span class="math display">\[
\Delta{Y_t} = (\rho - 1)Y_{t-1} + \sum^{p-1}_{s=1}{\gamma_sY_{t-s}} + u_t
\]</span></p>
<p>ADF検定の具体的なフローは次のとおりです。</p>
<p>まず、時系列データの原系列に対し、trendモデル、driftモデル、noneモデルの順番で「単位根がある（<span class="math inline">\(\rho = 1\)</span>）」ことを帰無仮説とする検定を行います。帰無仮説が棄却できればそこでADF検定が終了し、時系列データが<span class="math inline">\(I(0)\)</span>過程であると判断します。</p>
<p>一方、3つのモデル全てにおいて帰無仮説が棄却できなければ、時系列データを階差変換し、再びtrendモデル、driftモデル、noneモデルの順番で検定を繰り返します。1次の階差変換で帰無仮説が棄却できれば時系列データは<span class="math inline">\(I(1)\)</span>過程、2次の階差変換で帰無仮説が棄却できれば時系列データは<span class="math inline">\(I(2)\)</span>過程と判断します。</p>
<p>なお、上記のフローは単純化したもので、実際には3つのモデルそれぞれについて複数の帰無仮説を検定し、その結果によって手順が変わる枝分かれのフロー構造になっています。ADF検定フローの詳細については、村尾（2019）P.137を参照してください。</p>
<div id="adf検定フロー自作関数" class="section level3 hasAnchor" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> ADF検定フロー自作関数<a href="09_var.html#adf検定フロー自作関数" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>上記のように、ADF検定を用いた和分次数の判断はシステマチックに実施することができます。本書では、ADF検定フローを分析対象の時系列データに自動で適用する自作関数<code>adf_test_flow()</code>を定義します。</p>
<p><code>adf_test_flow()</code>自作関数の引数は次のとおりです。</p>
<ul>
<li><code>y</code>：ADF検定を適用する時系列データ。数値型ベクトルもしくはts形式データを指定します。</li>
<li><code>lag_criterion</code>：ラグ次数の選択基準。<code>"AIC"</code>、<code>"BIC"</code>、<code>"Fixed"</code>の3つのうち1つを指定します。<code>"AIC"</code>もしくは<code>"BIC"</code>を指定すると、それぞれ赤池情報量規準（Akaike Information Criterion）とベイズ情報量規準（Bayesian Information Criterion）に基づき最適なラグ次数が自動で選択されます（このとき<code>lags_max</code>引数に指定した値が自動で選択されるラグ次数の上限になります）。<code>"Fixed"</code>を指定する場合は、適用するラグ次数を<code>lags_fixed</code>引数に手動で指定します。</li>
<li><code>lags_max</code>：ラグ次数の最大値（正の整数、デフォルト値は12）。<code>lag_criterion</code>引数に<code>"AIC"</code>か<code>"BIC"</code>を指定した場合に使用します。</li>
<li><code>lags_fixed</code>：ラグ次数（正の整数、デフォルト値は1）。<code>lag_criterion</code>引数に<code>"Fixed"</code>を指定した場合に使用します。</li>
<li><code>sig_level</code>：有意水準。0.01、0.05、0.1の3つのうち1つを指定します。</li>
</ul>
<p>これらの引数を設定して<code>adf_test_flow()</code>自作関数を実行すると、ADF検定フローの結果を記載したtibble形式のデータフレームが出力されます。trendモデル3種類、driftモデル3種類、noneモデル1種類の合計7種類のADF検定について、<code>y</code>に指定した時系列データが<span class="math inline">\(I(0)\)</span>過程、<span class="math inline">\(I(1)\)</span>過程、<span class="math inline">\(I(2)\)</span>過程のどれに従うかが判断できるまで階差次数を増やして検定を繰り返し、各検定の結果に基づく判断経路を「＊」で示します。最後に「＊」が記載されている箇所が最終的な判断になります。</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="09_var.html#cb885-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(docstring)</span>
<span id="cb885-2"><a href="09_var.html#cb885-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb885-3"><a href="09_var.html#cb885-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データに対しADF検定フローを自動で適用する関数</span></span>
<span id="cb885-4"><a href="09_var.html#cb885-4" aria-hidden="true" tabindex="-1"></a>adf_test_flow <span class="ot">&lt;-</span> <span class="cf">function</span>(y, <span class="at">lag_criterion =</span> <span class="fu">c</span>(<span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;BIC&quot;</span>, <span class="st">&quot;Fixed&quot;</span>), <span class="at">lags_max =</span> <span class="dv">12</span>, <span class="at">lags_fixed =</span> <span class="dv">1</span>, <span class="at">sig_level =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>)) {</span>
<span id="cb885-5"><a href="09_var.html#cb885-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-6"><a href="09_var.html#cb885-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; Automatic Augmented Dickey-Fuller Unit Root Test Flow</span></span>
<span id="cb885-7"><a href="09_var.html#cb885-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; </span></span>
<span id="cb885-8"><a href="09_var.html#cb885-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @description</span></span>
<span id="cb885-9"><a href="09_var.html#cb885-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; This function automatically performs the test flow of the Augmented Dickey-Fuller (ADF) unit root test. Written by Naoki Hattori.</span></span>
<span id="cb885-10"><a href="09_var.html#cb885-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; </span></span>
<span id="cb885-11"><a href="09_var.html#cb885-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param y Numeric vector or ts. Time series data for ADF test.</span></span>
<span id="cb885-12"><a href="09_var.html#cb885-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param lag_criterion Character. Specifies how the lag order is set. &quot;AIC&quot; for Akaike Information Criterion, &quot;BIC&quot; for Bayesian Information Criterion. The maximum number of lags considered is set by lags_max. &quot;Fixed&quot; for manually set by lags_fixed.</span></span>
<span id="cb885-13"><a href="09_var.html#cb885-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param lags_max Integer. Specifies maximum number of lags considered when choose &quot;AIC&quot; or &quot;BIC&quot; for lag_criterion. Default is 12.</span></span>
<span id="cb885-14"><a href="09_var.html#cb885-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param lags_fixed Integer. Specifies the lag order manually when choose &quot;Fixed&quot; for lag_criterion. Default is 1.</span></span>
<span id="cb885-15"><a href="09_var.html#cb885-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param sig_level Numeric. Significance level, either 0.01, 0.05, 0.1.</span></span>
<span id="cb885-16"><a href="09_var.html#cb885-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-17"><a href="09_var.html#cb885-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 引数sig_levelをurca::ur_df()関数用に文字列へ変換</span></span>
<span id="cb885-18"><a href="09_var.html#cb885-18" aria-hidden="true" tabindex="-1"></a>    sig_level_str <span class="ot">&lt;-</span> <span class="fu">str_c</span>(sig_level <span class="sc">*</span> <span class="dv">100</span>, <span class="st">&quot;pct&quot;</span>)</span>
<span id="cb885-19"><a href="09_var.html#cb885-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-20"><a href="09_var.html#cb885-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 出力用tibble</span></span>
<span id="cb885-21"><a href="09_var.html#cb885-21" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb885-22"><a href="09_var.html#cb885-22" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span>,</span>
<span id="cb885-23"><a href="09_var.html#cb885-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span>,</span>
<span id="cb885-24"><a href="09_var.html#cb885-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>,</span>
<span id="cb885-25"><a href="09_var.html#cb885-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span>,</span>
<span id="cb885-26"><a href="09_var.html#cb885-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>,</span>
<span id="cb885-27"><a href="09_var.html#cb885-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>,</span>
<span id="cb885-28"><a href="09_var.html#cb885-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>,</span>
<span id="cb885-29"><a href="09_var.html#cb885-29" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span>,</span>
<span id="cb885-30"><a href="09_var.html#cb885-30" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span>,</span>
<span id="cb885-31"><a href="09_var.html#cb885-31" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">結果</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>,</span>
<span id="cb885-32"><a href="09_var.html#cb885-32" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">判断</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>,</span>
<span id="cb885-33"><a href="09_var.html#cb885-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>,</span>
<span id="cb885-34"><a href="09_var.html#cb885-34" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb885-35"><a href="09_var.html#cb885-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-36"><a href="09_var.html#cb885-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># フローカウンタ</span></span>
<span id="cb885-37"><a href="09_var.html#cb885-37" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb885-38"><a href="09_var.html#cb885-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-39"><a href="09_var.html#cb885-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 判断経路記入用ベクトル（最大21要素＝7フロー × 3ループ）</span></span>
<span id="cb885-40"><a href="09_var.html#cb885-40" aria-hidden="true" tabindex="-1"></a>  flow_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">21</span>)</span>
<span id="cb885-41"><a href="09_var.html#cb885-41" aria-hidden="true" tabindex="-1"></a>  flow_vec[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb885-42"><a href="09_var.html#cb885-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#flow_vec[c(1, 8, 15)] &lt;- TRUE</span></span>
<span id="cb885-43"><a href="09_var.html#cb885-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-44"><a href="09_var.html#cb885-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 判断経路記入可否フラグ</span></span>
<span id="cb885-45"><a href="09_var.html#cb885-45" aria-hidden="true" tabindex="-1"></a>  flow_cont_flag <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb885-46"><a href="09_var.html#cb885-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-47"><a href="09_var.html#cb885-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ラグ次数の指定</span></span>
<span id="cb885-48"><a href="09_var.html#cb885-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lag_criterion <span class="sc">==</span> <span class="st">&quot;Fixed&quot;</span>) {</span>
<span id="cb885-49"><a href="09_var.html#cb885-49" aria-hidden="true" tabindex="-1"></a>    lags <span class="ot">&lt;-</span> lags_fixed</span>
<span id="cb885-50"><a href="09_var.html#cb885-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb885-51"><a href="09_var.html#cb885-51" aria-hidden="true" tabindex="-1"></a>    lags <span class="ot">&lt;-</span> lags_max</span>
<span id="cb885-52"><a href="09_var.html#cb885-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb885-53"><a href="09_var.html#cb885-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb885-54"><a href="09_var.html#cb885-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 階差次数dのループ（0〜2次）</span></span>
<span id="cb885-55"><a href="09_var.html#cb885-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (d <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb885-56"><a href="09_var.html#cb885-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb885-57"><a href="09_var.html#cb885-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># データの階差変換</span></span>
<span id="cb885-58"><a href="09_var.html#cb885-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d <span class="sc">&gt;=</span> <span class="dv">1</span>) {y <span class="ot">&lt;-</span> <span class="fu">diff</span>(y, <span class="at">lag =</span> <span class="dv">1</span>)}</span>
<span id="cb885-59"><a href="09_var.html#cb885-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb885-60"><a href="09_var.html#cb885-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 正規分布の棄却点</span></span>
<span id="cb885-61"><a href="09_var.html#cb885-61" aria-hidden="true" tabindex="-1"></a>    norm_cval <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="at">p =</span> sig_level, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb885-62"><a href="09_var.html#cb885-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb885-63"><a href="09_var.html#cb885-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定</span></span>
<span id="cb885-64"><a href="09_var.html#cb885-64" aria-hidden="true" tabindex="-1"></a>    urdf_trend <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">ur.df</span>(y, <span class="at">type =</span> <span class="st">&quot;trend&quot;</span>, <span class="at">lags =</span> lags, <span class="at">selectlags =</span> lag_criterion)</span>
<span id="cb885-65"><a href="09_var.html#cb885-65" aria-hidden="true" tabindex="-1"></a>    urdf_drift <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">ur.df</span>(y, <span class="at">type =</span> <span class="st">&quot;drift&quot;</span>, <span class="at">lags =</span> lags, <span class="at">selectlags =</span> lag_criterion)</span>
<span id="cb885-66"><a href="09_var.html#cb885-66" aria-hidden="true" tabindex="-1"></a>    urdf_none <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">ur.df</span>(y, <span class="at">type =</span> <span class="st">&quot;none&quot;</span>, <span class="at">lags =</span> lags, <span class="at">selectlags =</span> lag_criterion)</span>
<span id="cb885-67"><a href="09_var.html#cb885-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb885-68"><a href="09_var.html#cb885-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ループ継続判断用ベクトル</span></span>
<span id="cb885-69"><a href="09_var.html#cb885-69" aria-hidden="true" tabindex="-1"></a>    continue_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="dv">3</span>)</span>
<span id="cb885-70"><a href="09_var.html#cb885-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb885-71"><a href="09_var.html#cb885-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定フロー1 trendモデル H0：ρ - 1 = 0</span></span>
<span id="cb885-72"><a href="09_var.html#cb885-72" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb885-73"><a href="09_var.html#cb885-73" aria-hidden="true" tabindex="-1"></a>    res <span class="sc">%&lt;&gt;%</span> tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> i,</span>
<span id="cb885-74"><a href="09_var.html#cb885-74" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> d,</span>
<span id="cb885-75"><a href="09_var.html#cb885-75" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;trend 第1検定&quot;</span>,</span>
<span id="cb885-76"><a href="09_var.html#cb885-76" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(urdf_trend<span class="sc">@</span>testreg<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb885-77"><a href="09_var.html#cb885-77" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;単位根あり&quot;</span>,</span>
<span id="cb885-78"><a href="09_var.html#cb885-78" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau3&quot;</span>,</span>
<span id="cb885-79"><a href="09_var.html#cb885-79" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau3&quot;</span>,</span>
<span id="cb885-80"><a href="09_var.html#cb885-80" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> urdf_trend<span class="sc">@</span>cval[<span class="st">&quot;tau3&quot;</span>, sig_level_str],</span>
<span id="cb885-81"><a href="09_var.html#cb885-81" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> urdf_trend<span class="sc">@</span>teststat[, <span class="st">&quot;tau3&quot;</span>],</span>
<span id="cb885-82"><a href="09_var.html#cb885-82" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">if_else</span>(flow_vec[i], <span class="st">&quot;＊&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb885-83"><a href="09_var.html#cb885-83" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb885-84"><a href="09_var.html#cb885-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (urdf_trend<span class="sc">@</span>teststat[, <span class="st">&quot;tau3&quot;</span>] <span class="sc">&lt;</span> urdf_trend<span class="sc">@</span>cval[<span class="st">&quot;tau3&quot;</span>, sig_level_str]) {</span>
<span id="cb885-85"><a href="09_var.html#cb885-85" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却&quot;</span></span>
<span id="cb885-86"><a href="09_var.html#cb885-86" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;単位根なし：I(&quot;</span>, d, <span class="st">&quot;)過程&quot;</span>)</span>
<span id="cb885-87"><a href="09_var.html#cb885-87" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_vec[i]) {flow_cont_flag <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb885-88"><a href="09_var.html#cb885-88" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb885-89"><a href="09_var.html#cb885-89" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却できない&quot;</span></span>
<span id="cb885-90"><a href="09_var.html#cb885-90" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;単位根の判断保留：フロー&quot;</span>, <span class="dv">2</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> d, <span class="st">&quot;へ&quot;</span>)</span>
<span id="cb885-91"><a href="09_var.html#cb885-91" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag) {flow_vec[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}</span>
<span id="cb885-92"><a href="09_var.html#cb885-92" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb885-93"><a href="09_var.html#cb885-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb885-94"><a href="09_var.html#cb885-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定フロー2 trendモデル H0：β2 = 0 and ρ - 1 = 0</span></span>
<span id="cb885-95"><a href="09_var.html#cb885-95" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb885-96"><a href="09_var.html#cb885-96" aria-hidden="true" tabindex="-1"></a>    res <span class="sc">%&lt;&gt;%</span> tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> i,</span>
<span id="cb885-97"><a href="09_var.html#cb885-97" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> d,</span>
<span id="cb885-98"><a href="09_var.html#cb885-98" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;trend 複合検定&quot;</span>,</span>
<span id="cb885-99"><a href="09_var.html#cb885-99" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(urdf_trend<span class="sc">@</span>testreg<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb885-100"><a href="09_var.html#cb885-100" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;トレンド項なし＆単位根あり&quot;</span>,</span>
<span id="cb885-101"><a href="09_var.html#cb885-101" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;phi3&quot;</span>,</span>
<span id="cb885-102"><a href="09_var.html#cb885-102" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;phi3&quot;</span>,</span>
<span id="cb885-103"><a href="09_var.html#cb885-103" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> urdf_trend<span class="sc">@</span>cval[<span class="st">&quot;phi3&quot;</span>, sig_level_str],</span>
<span id="cb885-104"><a href="09_var.html#cb885-104" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> urdf_trend<span class="sc">@</span>teststat[, <span class="st">&quot;phi3&quot;</span>],</span>
<span id="cb885-105"><a href="09_var.html#cb885-105" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">if_else</span>(flow_vec[i], <span class="st">&quot;＊&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb885-106"><a href="09_var.html#cb885-106" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb885-107"><a href="09_var.html#cb885-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (urdf_trend<span class="sc">@</span>teststat[, <span class="st">&quot;phi3&quot;</span>] <span class="sc">&gt;</span> urdf_trend<span class="sc">@</span>cval[<span class="st">&quot;phi3&quot;</span>, sig_level_str]) {</span>
<span id="cb885-108"><a href="09_var.html#cb885-108" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;複合帰無仮説を棄却&quot;</span></span>
<span id="cb885-109"><a href="09_var.html#cb885-109" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;トレンド項あり：フロー&quot;</span>, <span class="dv">3</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> d, <span class="st">&quot;へ&quot;</span>)</span>
<span id="cb885-110"><a href="09_var.html#cb885-110" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag) {flow_vec[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}</span>
<span id="cb885-111"><a href="09_var.html#cb885-111" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb885-112"><a href="09_var.html#cb885-112" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;複合帰無仮説を棄却できない&quot;</span></span>
<span id="cb885-113"><a href="09_var.html#cb885-113" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;トレンド項なし：フロー&quot;</span>, <span class="dv">4</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> d, <span class="st">&quot;へ&quot;</span>)</span>
<span id="cb885-114"><a href="09_var.html#cb885-114" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag) {flow_vec[i <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}</span>
<span id="cb885-115"><a href="09_var.html#cb885-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb885-116"><a href="09_var.html#cb885-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-117"><a href="09_var.html#cb885-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定フロー3 trendモデル H0：ρ - 1 = 0</span></span>
<span id="cb885-118"><a href="09_var.html#cb885-118" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb885-119"><a href="09_var.html#cb885-119" aria-hidden="true" tabindex="-1"></a>    res <span class="sc">%&lt;&gt;%</span> tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> i,</span>
<span id="cb885-120"><a href="09_var.html#cb885-120" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> d,</span>
<span id="cb885-121"><a href="09_var.html#cb885-121" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;trend 第2検定&quot;</span>,</span>
<span id="cb885-122"><a href="09_var.html#cb885-122" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(urdf_trend<span class="sc">@</span>testreg<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">3</span>,</span>
<span id="cb885-123"><a href="09_var.html#cb885-123" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;単位根あり&quot;</span>,</span>
<span id="cb885-124"><a href="09_var.html#cb885-124" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau3&quot;</span>,</span>
<span id="cb885-125"><a href="09_var.html#cb885-125" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;正規分布&quot;</span>,</span>
<span id="cb885-126"><a href="09_var.html#cb885-126" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> norm_cval,</span>
<span id="cb885-127"><a href="09_var.html#cb885-127" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> urdf_trend<span class="sc">@</span>teststat[, <span class="st">&quot;tau3&quot;</span>],</span>
<span id="cb885-128"><a href="09_var.html#cb885-128" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">if_else</span>(flow_vec[i], <span class="st">&quot;＊&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb885-129"><a href="09_var.html#cb885-129" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb885-130"><a href="09_var.html#cb885-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (urdf_trend<span class="sc">@</span>teststat[, <span class="st">&quot;tau3&quot;</span>] <span class="sc">&lt;</span> norm_cval) {</span>
<span id="cb885-131"><a href="09_var.html#cb885-131" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却&quot;</span></span>
<span id="cb885-132"><a href="09_var.html#cb885-132" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;単位根なし：I(&quot;</span>, d, <span class="st">&quot;)過程&quot;</span>)</span>
<span id="cb885-133"><a href="09_var.html#cb885-133" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_vec[i]) {flow_cont_flag <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb885-134"><a href="09_var.html#cb885-134" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb885-135"><a href="09_var.html#cb885-135" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却できない&quot;</span></span>
<span id="cb885-136"><a href="09_var.html#cb885-136" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="st">&quot;階差変換し再検定&quot;</span></span>
<span id="cb885-137"><a href="09_var.html#cb885-137" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag <span class="sc">&amp;</span> (d <span class="sc">&lt;=</span> <span class="dv">1</span>)) {flow_vec[(d <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">7</span> <span class="sc">+</span> <span class="dv">1</span>]}</span>
<span id="cb885-138"><a href="09_var.html#cb885-138" aria-hidden="true" tabindex="-1"></a>      continue_vec[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb885-139"><a href="09_var.html#cb885-139" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb885-140"><a href="09_var.html#cb885-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-141"><a href="09_var.html#cb885-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定フロー4 driftモデル H0：ρ - 1 = 0</span></span>
<span id="cb885-142"><a href="09_var.html#cb885-142" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb885-143"><a href="09_var.html#cb885-143" aria-hidden="true" tabindex="-1"></a>    res <span class="sc">%&lt;&gt;%</span> tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> i,</span>
<span id="cb885-144"><a href="09_var.html#cb885-144" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> d,</span>
<span id="cb885-145"><a href="09_var.html#cb885-145" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;drift 第1検定&quot;</span>,</span>
<span id="cb885-146"><a href="09_var.html#cb885-146" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(urdf_drift<span class="sc">@</span>testreg<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">2</span>,</span>
<span id="cb885-147"><a href="09_var.html#cb885-147" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;単位根あり&quot;</span>,</span>
<span id="cb885-148"><a href="09_var.html#cb885-148" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau2&quot;</span>,</span>
<span id="cb885-149"><a href="09_var.html#cb885-149" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau2&quot;</span>,</span>
<span id="cb885-150"><a href="09_var.html#cb885-150" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> urdf_drift<span class="sc">@</span>cval[<span class="st">&quot;tau2&quot;</span>, sig_level_str],</span>
<span id="cb885-151"><a href="09_var.html#cb885-151" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> urdf_drift<span class="sc">@</span>teststat[, <span class="st">&quot;tau2&quot;</span>],</span>
<span id="cb885-152"><a href="09_var.html#cb885-152" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">if_else</span>(flow_vec[i], <span class="st">&quot;＊&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb885-153"><a href="09_var.html#cb885-153" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb885-154"><a href="09_var.html#cb885-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (urdf_drift<span class="sc">@</span>teststat[, <span class="st">&quot;tau2&quot;</span>] <span class="sc">&lt;</span> urdf_drift<span class="sc">@</span>cval[<span class="st">&quot;tau2&quot;</span>, sig_level_str]) {</span>
<span id="cb885-155"><a href="09_var.html#cb885-155" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却&quot;</span></span>
<span id="cb885-156"><a href="09_var.html#cb885-156" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;単位根なし：I(&quot;</span>, d, <span class="st">&quot;)過程&quot;</span>)</span>
<span id="cb885-157"><a href="09_var.html#cb885-157" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_vec[i]) {flow_cont_flag <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb885-158"><a href="09_var.html#cb885-158" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb885-159"><a href="09_var.html#cb885-159" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却できない&quot;</span></span>
<span id="cb885-160"><a href="09_var.html#cb885-160" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;単位根の判断保留：フロー&quot;</span>, <span class="dv">5</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> d, <span class="st">&quot;へ&quot;</span>)</span>
<span id="cb885-161"><a href="09_var.html#cb885-161" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag) {flow_vec[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span><span class="cn">TRUE</span>}</span>
<span id="cb885-162"><a href="09_var.html#cb885-162" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb885-163"><a href="09_var.html#cb885-163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-164"><a href="09_var.html#cb885-164" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定フロー5 driftモデル H0：β1 = 0 and ρ - 1 = 0</span></span>
<span id="cb885-165"><a href="09_var.html#cb885-165" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb885-166"><a href="09_var.html#cb885-166" aria-hidden="true" tabindex="-1"></a>    res <span class="sc">%&lt;&gt;%</span> tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> i,</span>
<span id="cb885-167"><a href="09_var.html#cb885-167" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> d,</span>
<span id="cb885-168"><a href="09_var.html#cb885-168" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;drift 複合検定&quot;</span>,</span>
<span id="cb885-169"><a href="09_var.html#cb885-169" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(urdf_drift<span class="sc">@</span>testreg<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">2</span>,</span>
<span id="cb885-170"><a href="09_var.html#cb885-170" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;定数項なし＆単位根あり&quot;</span>,</span>
<span id="cb885-171"><a href="09_var.html#cb885-171" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;phi1&quot;</span>,</span>
<span id="cb885-172"><a href="09_var.html#cb885-172" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;phi1&quot;</span>,</span>
<span id="cb885-173"><a href="09_var.html#cb885-173" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> urdf_drift<span class="sc">@</span>cval[<span class="st">&quot;phi1&quot;</span>, sig_level_str],</span>
<span id="cb885-174"><a href="09_var.html#cb885-174" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> urdf_drift<span class="sc">@</span>teststat[, <span class="st">&quot;phi1&quot;</span>],</span>
<span id="cb885-175"><a href="09_var.html#cb885-175" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">if_else</span>(flow_vec[i], <span class="st">&quot;＊&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb885-176"><a href="09_var.html#cb885-176" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb885-177"><a href="09_var.html#cb885-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (urdf_drift<span class="sc">@</span>teststat[, <span class="st">&quot;phi1&quot;</span>] <span class="sc">&gt;</span> urdf_drift<span class="sc">@</span>cval[<span class="st">&quot;phi1&quot;</span>, sig_level_str]) {</span>
<span id="cb885-178"><a href="09_var.html#cb885-178" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;複合帰無仮説を棄却&quot;</span></span>
<span id="cb885-179"><a href="09_var.html#cb885-179" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;定数項あり：フロー&quot;</span>, <span class="dv">6</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> d, <span class="st">&quot;へ&quot;</span>)</span>
<span id="cb885-180"><a href="09_var.html#cb885-180" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag) {flow_vec[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}</span>
<span id="cb885-181"><a href="09_var.html#cb885-181" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb885-182"><a href="09_var.html#cb885-182" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;複合帰無仮説を棄却できない&quot;</span></span>
<span id="cb885-183"><a href="09_var.html#cb885-183" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;定数項なし：フロー&quot;</span>, <span class="dv">7</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">*</span> d, <span class="st">&quot;へ&quot;</span>)</span>
<span id="cb885-184"><a href="09_var.html#cb885-184" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag) {flow_vec[i <span class="sc">+</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}</span>
<span id="cb885-185"><a href="09_var.html#cb885-185" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb885-186"><a href="09_var.html#cb885-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-187"><a href="09_var.html#cb885-187" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定フロー6 driftモデル H0：ρ - 1 = 0</span></span>
<span id="cb885-188"><a href="09_var.html#cb885-188" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb885-189"><a href="09_var.html#cb885-189" aria-hidden="true" tabindex="-1"></a>    res <span class="sc">%&lt;&gt;%</span> tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> i,</span>
<span id="cb885-190"><a href="09_var.html#cb885-190" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> d,</span>
<span id="cb885-191"><a href="09_var.html#cb885-191" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;drift 第2検定&quot;</span>,</span>
<span id="cb885-192"><a href="09_var.html#cb885-192" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(urdf_drift<span class="sc">@</span>testreg<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">2</span>,</span>
<span id="cb885-193"><a href="09_var.html#cb885-193" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;単位根あり&quot;</span>,</span>
<span id="cb885-194"><a href="09_var.html#cb885-194" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau2&quot;</span>,</span>
<span id="cb885-195"><a href="09_var.html#cb885-195" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;正規分布&quot;</span>,</span>
<span id="cb885-196"><a href="09_var.html#cb885-196" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> norm_cval,</span>
<span id="cb885-197"><a href="09_var.html#cb885-197" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> urdf_drift<span class="sc">@</span>teststat[, <span class="st">&quot;tau2&quot;</span>],</span>
<span id="cb885-198"><a href="09_var.html#cb885-198" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">if_else</span>(flow_vec[i], <span class="st">&quot;＊&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb885-199"><a href="09_var.html#cb885-199" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb885-200"><a href="09_var.html#cb885-200" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (urdf_drift<span class="sc">@</span>teststat[, <span class="st">&quot;tau2&quot;</span>] <span class="sc">&lt;</span> norm_cval) {</span>
<span id="cb885-201"><a href="09_var.html#cb885-201" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却&quot;</span></span>
<span id="cb885-202"><a href="09_var.html#cb885-202" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;単位根なし：I(&quot;</span>, d, <span class="st">&quot;)過程&quot;</span>)</span>
<span id="cb885-203"><a href="09_var.html#cb885-203" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_vec[i]) {flow_cont_flag <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb885-204"><a href="09_var.html#cb885-204" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb885-205"><a href="09_var.html#cb885-205" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却できない&quot;</span></span>
<span id="cb885-206"><a href="09_var.html#cb885-206" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="st">&quot;階差変換し再検定&quot;</span></span>
<span id="cb885-207"><a href="09_var.html#cb885-207" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag <span class="sc">&amp;</span> (d <span class="sc">&lt;=</span> <span class="dv">1</span>)) {flow_vec[(d <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">7</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}</span>
<span id="cb885-208"><a href="09_var.html#cb885-208" aria-hidden="true" tabindex="-1"></a>      continue_vec[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb885-209"><a href="09_var.html#cb885-209" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb885-210"><a href="09_var.html#cb885-210" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb885-211"><a href="09_var.html#cb885-211" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ADF検定フロー7 noneモデル H0：ρ - 1 = 0</span></span>
<span id="cb885-212"><a href="09_var.html#cb885-212" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb885-213"><a href="09_var.html#cb885-213" aria-hidden="true" tabindex="-1"></a>    res <span class="sc">%&lt;&gt;%</span> tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span> <span class="ot">=</span> i,</span>
<span id="cb885-214"><a href="09_var.html#cb885-214" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span> <span class="ot">=</span> d,</span>
<span id="cb885-215"><a href="09_var.html#cb885-215" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">モデル</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb885-216"><a href="09_var.html#cb885-216" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(urdf_none<span class="sc">@</span>testreg<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb885-217"><a href="09_var.html#cb885-217" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">帰無仮説</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;単位根あり&quot;</span>,</span>
<span id="cb885-218"><a href="09_var.html#cb885-218" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau1&quot;</span>,</span>
<span id="cb885-219"><a href="09_var.html#cb885-219" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;tau1&quot;</span>,</span>
<span id="cb885-220"><a href="09_var.html#cb885-220" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> urdf_none<span class="sc">@</span>cval[<span class="st">&quot;tau1&quot;</span>, sig_level_str],</span>
<span id="cb885-221"><a href="09_var.html#cb885-221" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> urdf_none<span class="sc">@</span>teststat[, <span class="st">&quot;tau1&quot;</span>],</span>
<span id="cb885-222"><a href="09_var.html#cb885-222" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">if_else</span>(flow_vec[i], <span class="st">&quot;＊&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb885-223"><a href="09_var.html#cb885-223" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb885-224"><a href="09_var.html#cb885-224" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (urdf_none<span class="sc">@</span>teststat[, <span class="st">&quot;tau1&quot;</span>] <span class="sc">&lt;</span> urdf_none<span class="sc">@</span>cval[<span class="st">&quot;tau1&quot;</span>, sig_level_str]) {</span>
<span id="cb885-225"><a href="09_var.html#cb885-225" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却&quot;</span></span>
<span id="cb885-226"><a href="09_var.html#cb885-226" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;単位根なし：I(&quot;</span>, d, <span class="st">&quot;)過程&quot;</span>)</span>
<span id="cb885-227"><a href="09_var.html#cb885-227" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_vec[i]) {flow_cont_flag <span class="ot">&lt;-</span> <span class="cn">FALSE</span>}</span>
<span id="cb885-228"><a href="09_var.html#cb885-228" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb885-229"><a href="09_var.html#cb885-229" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>結果[i] <span class="ot">&lt;-</span> <span class="st">&quot;帰無仮説を棄却できない&quot;</span></span>
<span id="cb885-230"><a href="09_var.html#cb885-230" aria-hidden="true" tabindex="-1"></a>      res<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="st">&quot;階差変換し再検定&quot;</span></span>
<span id="cb885-231"><a href="09_var.html#cb885-231" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (flow_cont_flag <span class="sc">&amp;</span> (d <span class="sc">&lt;=</span> <span class="dv">1</span>)) {flow_vec[(d <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">7</span> <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span>}</span>
<span id="cb885-232"><a href="09_var.html#cb885-232" aria-hidden="true" tabindex="-1"></a>      continue_vec[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb885-233"><a href="09_var.html#cb885-233" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb885-234"><a href="09_var.html#cb885-234" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb885-235"><a href="09_var.html#cb885-235" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ループ継続を判断（continue_vecの中に一つでもTRUEがあればbreakしない）</span></span>
<span id="cb885-236"><a href="09_var.html#cb885-236" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">any</span>(continue_vec)) {<span class="cf">break</span>}</span>
<span id="cb885-237"><a href="09_var.html#cb885-237" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb885-238"><a href="09_var.html#cb885-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb885-239"><a href="09_var.html#cb885-239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 結果</span></span>
<span id="cb885-240"><a href="09_var.html#cb885-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res <span class="sc">%&gt;%</span> </span>
<span id="cb885-241"><a href="09_var.html#cb885-241" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">検定統計量</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">棄却点の分布</span><span class="st">`</span>)</span>
<span id="cb885-242"><a href="09_var.html#cb885-242" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb885-243"><a href="09_var.html#cb885-243" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb885-244"><a href="09_var.html#cb885-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb885-245"><a href="09_var.html#cb885-245" aria-hidden="true" tabindex="-1"></a><span class="co"># docstring::docstring(adf_test_flow)</span></span></code></pre></div>
</div>
<div id="実例adf検定フロー" class="section level3 hasAnchor" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> 実例：ADF検定フロー<a href="09_var.html#実例adf検定フロー" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>定義した自作関数<code>adf_test_flow()</code>を用い、村尾（2019）「6.7 拡張ディッキー＝フラー検定の例」（P.141）及び、「6.10 Rによる拡張ディッキー＝フラー検定」（P.147）の例を再現します。</p>
<p>村尾（2019）6.7及び6.10では、<code>vars</code>パッケージの<code>Canada</code>データセットに含まれるカナダの実質労働生産性（<code>prod</code>）データに対してADF検定フローを適用しています。データ頻度は四半期、期間は1980年1-3月期〜2000年10-12月期です。</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="09_var.html#cb886-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb886-2"><a href="09_var.html#cb886-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb886-3"><a href="09_var.html#cb886-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-4"><a href="09_var.html#cb886-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 実質労働生産性データを変数yに格納しプロット</span></span>
<span id="cb886-5"><a href="09_var.html#cb886-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> Canada[, <span class="st">&quot;prod&quot;</span>]</span>
<span id="cb886-6"><a href="09_var.html#cb886-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-398-1.png" width="672" /></p>
<p>ここでは、ラグ次数選択基準の<code>lag_criterion</code>に、赤池情報量規準を意味する<code>"AIC"</code>を指定します。</p>
<p><code>adf_test_flow()</code>自作関数を実行した結果、実質労働生産性の原系列（階差次数＝0）では単位根の存在が示唆され、1次の階差系列では単位根がないことが確認できました。したがって実質労働生産性は<span class="math inline">\(I(1)\)</span>過程であると判断できます。</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="09_var.html#cb887-1" aria-hidden="true" tabindex="-1"></a><span class="co"># yにadf_test_flow()関数を適用</span></span>
<span id="cb887-2"><a href="09_var.html#cb887-2" aria-hidden="true" tabindex="-1"></a>adf_prod <span class="ot">&lt;-</span> <span class="fu">adf_test_flow</span>(<span class="at">y =</span> y, <span class="co"># 検定対象の時系列データ</span></span>
<span id="cb887-3"><a href="09_var.html#cb887-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lag_criterion =</span> <span class="st">&quot;AIC&quot;</span>, <span class="co"># ラグ次数選択基準</span></span>
<span id="cb887-4"><a href="09_var.html#cb887-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lags_max =</span> <span class="dv">10</span>, <span class="co"># AICで自動選択する最大ラグ次数</span></span>
<span id="cb887-5"><a href="09_var.html#cb887-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb887-6"><a href="09_var.html#cb887-6" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb887-7"><a href="09_var.html#cb887-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb887-8"><a href="09_var.html#cb887-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果をコンソールに出力</span></span>
<span id="cb887-9"><a href="09_var.html#cb887-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 実際に使用する際は、View(adf_prod) で別ウィンドウに結果を表示する方が結果が確認しやすい</span></span>
<span id="cb887-10"><a href="09_var.html#cb887-10" aria-hidden="true" tabindex="-1"></a>adf_prod</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["フロー"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["階差次数"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["モデル"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["帰無仮説"],"name":[5],"type":["chr"],"align":["left"]},{"label":["棄却点"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["結果"],"name":[8],"type":["chr"],"align":["left"]},{"label":["判断"],"name":[9],"type":["chr"],"align":["left"]},{"label":["判断経路"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"0","3":"trend 第1検定","4":"1","5":"単位根あり","6":"-3.450000","7":"-1.6557361","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー2へ","10":"＊"},{"1":"2","2":"0","3":"trend 複合検定","4":"1","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"1.4544699","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー4へ","10":"＊"},{"1":"3","2":"0","3":"trend 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-1.6557361","8":"帰無仮説を棄却","9":"単位根なし：I(0)過程","10":""},{"1":"4","2":"0","3":"drift 第1検定","4":"1","5":"単位根あり","6":"-2.890000","7":"-0.5159142","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー5へ","10":"＊"},{"1":"5","2":"0","3":"drift 複合検定","4":"1","5":"定数項なし＆単位根あり","6":"4.710000","7":"1.8177585","8":"複合帰無仮説を棄却できない","9":"定数項なし：フロー7へ","10":"＊"},{"1":"6","2":"0","3":"drift 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-0.5159142","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"7","2":"0","3":"none","4":"1","5":"単位根あり","6":"-1.950000","7":"1.8395366","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":"＊"},{"1":"8","2":"1","3":"trend 第1検定","4":"1","5":"単位根あり","6":"-3.450000","7":"-4.5297574","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":"＊"},{"1":"9","2":"1","3":"trend 複合検定","4":"1","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"10.3162386","8":"複合帰無仮説を棄却","9":"トレンド項あり：フロー10へ","10":""},{"1":"10","2":"1","3":"trend 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-4.5297574","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"11","2":"1","3":"drift 第1検定","4":"1","5":"単位根あり","6":"-2.890000","7":"-4.5655763","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"12","2":"1","3":"drift 複合検定","4":"1","5":"定数項なし＆単位根あり","6":"4.710000","7":"10.4283436","8":"複合帰無仮説を棄却","9":"定数項あり：フロー13へ","10":""},{"1":"13","2":"1","3":"drift 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-4.5655763","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"14","2":"1","3":"none","4":"1","5":"単位根あり","6":"-1.950000","7":"-4.2078822","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="系列相関自己相関" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> 系列相関・自己相関<a href="09_var.html#系列相関自己相関" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>時系列データ<span class="math inline">\(Y\)</span>について、現在の値<span class="math inline">\(Y_t\)</span>と過去の値<span class="math inline">\(Y_{t-1}\)</span>の間の相関を<strong>系列相関（serial correlation）</strong>もしくは<strong>自己相関（autocorrelation）</strong>と言います。</p>
<p>多くのマクロ経済データでは、正の系列相関（前期が正であれば今期も正である可能性が高い）が観察されます。系列相関がないデータは何らかのショックで平均値から乖離してもすぐにまた平均値へ戻りますが、正の系列相関があるデータは一度平均値を離れると戻るまでに一定期間を要する傾向があります。マクロ経済の活動が活発になる期間と停滞する期間が交互に繰り返される「景気循環」の現象は、マクロ時系列データ上では正の系列相関として表現されます（西山 他（2019）P.471）。</p>
<p>系列相関の有無やその構造を確認することは、分析対象である時系列データのモデリングやラグ次数の選択を行う上で重要です。また、最小2乗法（OLS）では誤差項に系列相関があると最小2条推定量の望ましい性質が得られないため、誤差項に対し系列相関の検定が行われます。これは後述するベクトル自己回帰（VAR）モデルでも同様です。</p>
<div id="自己相関acf" class="section level3 hasAnchor" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> 自己相関（ACF）<a href="09_var.html#自己相関acf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ラグ次数<span class="math inline">\(p\)</span>の（標本）<strong>自己相関係数</strong><span class="math inline">\(\hat{\rho}_p\)</span>は、標本平均<span class="math inline">\(\bar{Y} = (1/T)\sum^{T}_{t=1}{Y_t}\)</span>として、次のように計算できます。</p>
<p><span class="math display">\[
\hat{\rho}_{p} = \frac{\hat{\gamma}_{p}}{\hat{\gamma}_{0}} = \frac{\sum^{T}_{t=p+1}{(Y_t-\bar{Y})(Y_{t-p}-\bar{Y})}}{\sum^{T}_{t=1}{(Y_t-\bar{Y})^2}}
\]</span></p>
<p><strong>コレログラム（自己相関プロット）</strong>は、横軸にラグ次数<span class="math inline">\(p\)</span>、縦軸に自己相関係数の値をプロットした図で、<code>stats::acf()</code>関数で作成します。ACFは<strong>Auto Correlation Function（自己相関関数）</strong>を意味します。</p>
<p>コレログラム内に表示されている波線は「自己相関係数が0である」との帰無仮説をラグ次数<span class="math inline">\(p = 1\)</span>から順番に逐次検定するための95％信頼区間を示しています。いずれかのラグ次数<span class="math inline">\(p\)</span>において自己相関係数の値が信頼区間の外側にあれば、系列相関があると判断できます。</p>
<p>ここでは、西山 他（2019）P.478の図10-14で使用されている日本のGDPギャップ（内閣府、1980〜2016年）のデータでコレログラムを作成します。</p>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="09_var.html#cb888-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XLSXデータを読み込み</span></span>
<span id="cb888-2"><a href="09_var.html#cb888-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data_nishiyama/ch10/Fig_12_GDPgap_quarterly.xlsx&quot;</span>, <span class="co"># ファイルパス（拡張子が必要、URLは不可）</span></span>
<span id="cb888-3"><a href="09_var.html#cb888-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="co"># シートインデックス／シート名</span></span>
<span id="cb888-4"><a href="09_var.html#cb888-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;quarter&quot;</span>, <span class="st">&quot;date&quot;</span>, <span class="st">&quot;cao&quot;</span>, <span class="st">&quot;boj&quot;</span>), <span class="co"># ヘッダー（列名データ）の有無／列名指定</span></span>
<span id="cb888-5"><a href="09_var.html#cb888-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）</span></span>
<span id="cb888-6"><a href="09_var.html#cb888-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span> <span class="co"># 読み込み時に上からスキップする行数</span></span>
<span id="cb888-7"><a href="09_var.html#cb888-7" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb888-8"><a href="09_var.html#cb888-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-9"><a href="09_var.html#cb888-9" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb888-10"><a href="09_var.html#cb888-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date, cao, boj) <span class="sc">%&gt;%</span> </span>
<span id="cb888-11"><a href="09_var.html#cb888-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">date</span>(zoo<span class="sc">::</span><span class="fu">as.yearqtr</span>(date, <span class="at">format =</span> <span class="st">&quot;%YQ%q&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb888-12"><a href="09_var.html#cb888-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(date <span class="sc">&lt;=</span> <span class="st">&quot;2016-12-31&quot;</span>)</span></code></pre></div>
<p><code>stats::acf()</code>関数でコレログラムを作成すると、ラグ次数が5次以下の低次の自己相関係数が有意であることが確認できます。このように、低次ラグの自己相関係数が正であり、ラグ次数1次をピークに単調に減少する性質は、正の系列相関がある典型的なマクロ経済変数のコレログラムの例です。</p>
<p>しかし、これをもって、5四半期前までのGDPギャップが全て当該四半期のGDPギャップに関係しているとは判断できません。自己相関係数の計算では、ラグの積み重ねによる間接的な関係が含まれているためです。そうした間接的な影響を排除して、過去のデータと当月のデータの直接的な関係を調べる方法が、次の偏自己相関です。</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="09_var.html#cb889-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">acf</span>(data<span class="sc">$</span>cao, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-401-1.png" width="672" /></p>
</div>
<div id="偏自己相関pacf" class="section level3 hasAnchor" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> 偏自己相関（PACF）<a href="09_var.html#偏自己相関pacf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>偏自己相関プロットを作成するには、<code>stats::pacf()</code>関数を使用します。PACFは<strong>Partial Auto Correlation Function（偏自己相関関数）</strong>を意味します。</p>
<p>自己相関プロットと同様に、日本のGDPギャップ（内閣府、1980〜2016年）のデータで偏自己相関プロットを作成すると、ラグ次数1次の偏自己相関係数が有意である一方、2〜5次の偏自己相関係数は有意ではなくなりました。この結果は、当該四半期のGDPギャップと関係しているのは1四半期前のGDPギャップのみであることを示しています。</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="09_var.html#cb890-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">pacf</span>(data<span class="sc">$</span>cao, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-402-1.png" width="672" /></p>
</div>
<div id="リュンボックス検定" class="section level3 hasAnchor" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> リュン＝ボックス検定<a href="09_var.html#リュンボックス検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>自己相関プロットや偏自己相関プロットは系列相関の有無を視覚的に判断できる便利な方法ですが、プロット上に表示される95％信頼区間は逐次検定用であり、自己相関の数が大きくなると多重検定の問題（t検定を複数回行うと設定された有意水準5％よりも高い頻度で第1種の過誤が発生すること）が生じます。つまり、実際には系列相関がないにも関わらず、どこかのラグ次数で帰無仮説（自己相関係数が0）を棄却してしまう確率が増加します（西山 他（2019））。</p>
<p>この問題を避けるには「複数の自己相関係数が0である」という結合帰無仮説</p>
<p><span class="math display">\[
H_0 : \rho_1 = \rho_2 = \cdots = \rho_m = 0
\]</span></p>
<p>を一度に検定する必要があります。対立仮説は「少なくとも一つの自己相関係数が0ではない」です。この結合帰無仮説の検定が、<strong>リュン＝ボックス検定（Ljung-Box test）</strong>です。なお、過去には「ダービン＝ワトソン比」で系列相関の有無を判断する方法が用いられていましたが、現在ではリュン＝ボックス検定を用いるのが一般的です（西山 他（2019）P.484）。</p>
<p>リュン＝ボックス検定を行うには<code>stats::Box.test()</code>関数を使用し、<code>type</code>引数に<code>"Ljung-Box"</code>を、<code>lag</code>引数にラグ次数を指定します。ここでは、偏自己相関プロット（PACF）の結果に基づきラグ次数に1を指定します。</p>
<p>実行すると、<code>X-squared</code>に修正Q統計量、<code>p-value</code>にp値が出力されます。この例ではp値が5％を下回り、ラグ次数が1のとき「系列相関がない」という帰無仮説が5％の有意水準で棄却されます。すなわち、日本のGDPギャップはラグ次数が1次のとき系列相関を持つと判断できます。</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="09_var.html#cb891-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">Box.test</span>(data<span class="sc">$</span>cao, <span class="co"># 帰無仮説「自己相関なし」を検定する系列</span></span>
<span id="cb891-2"><a href="09_var.html#cb891-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">lag =</span> <span class="dv">1</span>, <span class="co"># ラグ次数</span></span>
<span id="cb891-3"><a href="09_var.html#cb891-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span></span>
<span id="cb891-4"><a href="09_var.html#cb891-4" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  data$cao
## X-squared = 105.01, df = 1, p-value &lt; 2.2e-16</code></pre>
<p>一方、<code>rnorm()</code>関数で標準正規分布に従うホワイトノイズを生成してリュン＝ボックス検定を実行すると、p値が5％を上回り「系列相関がない」との帰無仮説が5％の有意水準で棄却されません。この結果は、ホワイトノイズには有意な系列相関が確認できないことを意味しています。なお、これは帰無仮説の「系列相関がない」を採択しているわけではなく、統計的に明確な系列相関があるとは言えない、ということです。</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="09_var.html#cb893-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">Box.test</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">400</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="co"># 帰無仮説「自己相関なし」を検定する系列</span></span>
<span id="cb893-2"><a href="09_var.html#cb893-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">lag =</span> <span class="dv">1</span>, <span class="co"># ラグ次数</span></span>
<span id="cb893-3"><a href="09_var.html#cb893-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span></span>
<span id="cb893-4"><a href="09_var.html#cb893-4" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  rnorm(n = 400, mean = 0, sd = 1)
## X-squared = 0.012777, df = 1, p-value = 0.91</code></pre>
</div>
</div>
<div id="ボックスジェンキンス法" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> ボックス＝ジェンキンス法<a href="09_var.html#ボックスジェンキンス法" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>ボックス＝ジェンキンス法（Box-Jenkins method）</strong>は、ARMAモデルやARIMAモデルといった最も基本的な時系列分析の手法です。</p>
<p>ボックス＝ジェンキンス法には、原系列のままで定常な「レベル定常データ」に適用できる<strong>ARMAモデル</strong>と、階差変換によって定常になる「トレンド定常過程」や「階差定常過程」（単位根過程、和分過程）に適用する<strong>ARIMAモデル</strong>があります。</p>
<div id="armaモデル" class="section level3 hasAnchor" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> ARMAモデル<a href="09_var.html#armaモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ARMAモデルには、<strong>ARモデル</strong>、<strong>MAモデル</strong>、ARモデルとMAモデルを組み合わせた<strong>ARMAモデル</strong>があります。ARモデルとMAモデルはARMAモデルの一部です。ARMAモデルを適用可能な時系列データは、原系列のままで定常な「レベル定常過程」データです。</p>
<div id="arモデル" class="section level4 unnumbered hasAnchor">
<h4>ARモデル<a href="09_var.html#arモデル" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>自己回帰（Autoregressive、AR）モデル</strong>は、過去の自分のデータを説明変数とする回帰モデルです。<span class="math inline">\(p\)</span>時点前までのデータを使う自己回帰モデルを<span class="math inline">\(\mathit{AR}(p)\)</span>と表記します。</p>
<p><span class="math display">\[
Y_t = c + \phi_1Y_{t-1} + \phi_2Y_{t-2} + \phi_3Y_{t-3} + \dots + \phi_pY_{t-p} + u_t
\]</span></p>
<p>なお、<span class="math inline">\(u_t\)</span>は平均が0、分散が<span class="math inline">\(\sigma^2\)</span>の正規分布<span class="math inline">\(N(0,\sigma^2)\)</span>に従うホワイトノイズ（平均が0、分散がある一定の値、自己共分散が0）です。</p>
</div>
<div id="maモデル" class="section level4 unnumbered hasAnchor">
<h4>MAモデル<a href="09_var.html#maモデル" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>移動平均（Moving Average、MA）モデル</strong>は、過去の<span class="math inline">\(q\)</span>時点前までの誤差項<span class="math inline">\(u_t\)</span>を説明変数とする回帰モデルで、<span class="math inline">\(\mathit{MA}(q)\)</span>と表記します。</p>
<p><span class="math display">\[
Y_t = c + \theta_1u_{t-1} + \theta_2u_{t-2} + \theta_3u_{t-3} + \dots + \theta_qu_{t-q} + u_t
\]</span></p>
</div>
<div id="armaモデル-1" class="section level4 unnumbered hasAnchor">
<h4>ARMAモデル<a href="09_var.html#armaモデル-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>自己回帰移動平均（Autoregressive Moving Average、ARMA）モデル</strong>は、ARモデルとMAモデルを組み合わせたモデルです。<span class="math inline">\(p\)</span>次のARモデルと<span class="math inline">\(q\)</span>次のMAモデルを組み合わせたARMAモデルを<span class="math inline">\(\mathit{ARMA}(p,q)\)</span>と表記します。</p>
<p><span class="math display">\[
\small
\begin{aligned}
Y_t &amp;= c + \phi_1Y_{t-1} + \phi_2Y_{t-2} + \phi_3Y_{t-3} + \cdots + \phi_pY_{t-p} + \theta_1u_{t-1} + \theta_2u_{t-2} + \theta_3u_{t-3} + \cdots + \theta_qu_{t-q} + u_t \\
&amp;= c + \sum^p_{i=1}(\phi_iY_{t-i}) + \sum^p_{j=1}(\theta_ju_{t-j}) + u_t
\end{aligned}
\]</span></p>
</div>
<div id="armaモデルの比較" class="section level4 unnumbered hasAnchor">
<h4>AR・MAモデルの比較<a href="09_var.html#armaモデルの比較" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>時系列データの特徴を観察することで、ARモデルとMAモデルのどちらを適用すべきか判断することができます。ここでは例として、<span class="math inline">\(\mathit{AR}(1)\)</span>過程に従うデータ<span class="math inline">\(Y^{\mathit{AR}}_t = 0.7Y^{\mathit{AR}}_{t-1} + u_t\)</span>、<span class="math inline">\(\mathit{MA}(1)\)</span>過程に従うデータ<span class="math inline">\(Y^{\mathit{MA}}_t = 0.7u_{t-1} + u_t\)</span>、<span class="math inline">\(\mathit{ARMA}(1,1)\)</span>過程に従うデータ<span class="math inline">\(Y^{\mathit{ARMA}}_t=0.7Y^{\mathit{ARMA}}_{t-1} + 0.7u_{t-1} + u_t\)</span>を生成し、折れ線グラフと自己相関・偏自己相関プロットを作成します。</p>
<p>プロットした結果を見ると、次のような特徴があることが確認できます（馬場（2018）P.46、村尾（2019）P.63、Nielsen（2021）P.180）。</p>
<ul>
<li>AR過程（ラグ次数<span class="math inline">\(p\)</span>）：自己相関（ACF）が緩やかに減衰　＆　偏自己相関（PACF）がラグ<span class="math inline">\(p+1\)</span>以降はゼロ</li>
<li>MA過程（ラグ次数<span class="math inline">\(q\)</span>）：自己相関（ACF）がラグ<span class="math inline">\(q+1\)</span>以降はゼロ　＆　偏自己相関（PACF）が緩やかに減衰</li>
<li>ARMA過程（ラグ次数<span class="math inline">\(p,q\)</span>）：自己相関（ACF）、偏自己相関（PACF）どちらも緩やかに減衰（プロットからはラグ次数が決定できない）</li>
</ul>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="09_var.html#cb895-1" aria-hidden="true" tabindex="-1"></a><span class="co">#stats::arima.sim()関数でts形式のサンプルデータを生成</span></span>
<span id="cb895-2"><a href="09_var.html#cb895-2" aria-hidden="true" tabindex="-1"></a>y_ar <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(<span class="fl">0.7</span>)), <span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb895-3"><a href="09_var.html#cb895-3" aria-hidden="true" tabindex="-1"></a>y_ma <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ma =</span> <span class="fu">c</span>(<span class="fl">0.7</span>)), <span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb895-4"><a href="09_var.html#cb895-4" aria-hidden="true" tabindex="-1"></a>y_arma <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(<span class="fl">0.7</span>), <span class="at">ma =</span> <span class="fu">c</span>(<span class="fl">0.7</span>)), <span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb895-5"><a href="09_var.html#cb895-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb895-6"><a href="09_var.html#cb895-6" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(y_ar, <span class="at">main =</span> <span class="st">&quot;AR(1)過程&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-405-1.png" width="672" /></p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="09_var.html#cb896-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(y_ma, <span class="at">main =</span> <span class="st">&quot;MA(1)過程&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-405-2.png" width="672" /></p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="09_var.html#cb897-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(y_arma, <span class="at">main =</span> <span class="st">&quot;ARMA(1)過程&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-405-3.png" width="672" /></p>
</div>
</div>
<div id="arimaモデル" class="section level3 hasAnchor" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> ARIMAモデル<a href="09_var.html#arimaモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ARIMAモデルは、データの階差をとってARMAモデルを適用する手法です。基本になるARIMAモデルに加え、季節変動があるデータに用いるSARIMAモデルや、外生変数を組み込むARIMAXモデルなどがあります。</p>
<p>ARIMAモデルを適用する時系列データは、階差変換によって定常化できる「トレンド定常過程」や「階差定常過程（単位根過程、和分過程）」です。</p>
<div id="arimaモデル-1" class="section level4 unnumbered hasAnchor">
<h4>ARIMAモデル<a href="09_var.html#arimaモデル-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>自己回帰和分移動平均（Autoregressive Integrated Moving Average、ARIMA）モデル</strong>は、時系列データを階差変換してARMAモデルを適用します。<span class="math inline">\(d\)</span>階の階差をとって<span class="math inline">\(\mathit{ARMA}(p,q)\)</span>を適用するARIMAモデルを、<span class="math inline">\(\mathit{ARIMA}(p,d,q)\)</span>と表記します。</p>
<p>ここで、ラグ演算子（lag operator）<span class="math inline">\(L\)</span>を<span class="math inline">\(LY_t = Y_{t-1}\)</span>、階差演算子（difference operator）<span class="math inline">\(\Delta\)</span>を<span class="math inline">\(\Delta Y_t = Y_t - Y_{t-1}\)</span>と定義します。例えば2次のラグは<span class="math inline">\(L(LY_t) = L^2Y_t = Y_{t-2}\)</span>、2階の階差は<span class="math inline">\(\Delta(\Delta Y_t) = \Delta^2 Y_t = \Delta(Y_t - Y_{t-1}) = (Y_t - Y_{t-1}) - (Y_{t-1} - Y_{t-2}) = Y_t - 2Y_{t-1} + Y_{t-2}\)</span>になります。</p>
<p>この表記法を用いると、<span class="math inline">\(\mathit{ARIMA}(p,d,q)\)</span>は、</p>
<p><span class="math display">\[
\Delta^d Y_t = \sum^p_{i=1}(\phi_iL^i\Delta^d Y_t) + \sum^q_{j=1}(\theta_jL^ju_t) + u_t
\]</span></p>
<p>と表記でき、これを変形すると次のように定式化できます。</p>
<p><span class="math display">\[
\bigl( 1-\sum^p_{i=1}(\phi_iL^i) \bigr) \Delta^d Y_t  = \bigl( 1+\sum^q_{j=1}(\theta_jL^j) \bigr) u_t
\]</span></p>
</div>
<div id="sarimaモデル" class="section level4 unnumbered hasAnchor">
<h4>SARIMAモデル<a href="09_var.html#sarimaモデル" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>季節性ARIMA（Seasonal ARIMA、SARIMA）モデル</strong>は、ARIMAモデルに季節成分を入れたモデルです。</p>
<p>例えば月次の時系列データの場合、通常のARIMAでは当月と1カ月前、2カ月前、3カ月前・・・の関係を<span class="math inline">\(\mathit{ARIMA}(p,d,q)\)</span>でモデル化しますが、SARIMAモデルではそれに加えて、当月と1年前の同月、2年前の同月、3年前の同月・・・の関係を季節性の次数<span class="math inline">\((P,D,Q)\)</span>でモデル化します。</p>
<p>1周期（年間）が<span class="math inline">\(s\)</span>のデータ（月次データであれば<span class="math inline">\(s=12\)</span>）について、ARIMAの次数<span class="math inline">\((p,d,q)\)</span>、季節性の次数<span class="math inline">\((P,D,Q)\)</span>をモデル化したSARIMAモデルを、<span class="math inline">\(\mathit{SARIMA}(p,d,q)(P,D,Q)[s]\)</span>と表記します。</p>
<p>ここで、1周期が<span class="math inline">\(s\)</span>である時系列データについて季節階差演算子<span class="math inline">\(\Delta_s\)</span>を<span class="math inline">\(\Delta_s Y_t = Y_t - Y_{t-s}\)</span>と定義します。例えば2階の季節階差は<span class="math inline">\(\Delta_s(\Delta_s Y_t) = \Delta_s^2 Y_t = \Delta_s(Y_t - Y_{t-s}) = (Y_t - Y_{t-s}) - (Y_{t-s} - Y_{t-2s}) = Y_t - 2Y_{t-s} + Y_{t-2s}\)</span>になります。</p>
<p>この表記法を用いると、<span class="math inline">\(\mathit{SARIMA}(p,d,q)(P,D,Q)[s]\)</span>は次のように定式化できます。</p>
<p><span class="math display">\[
\bigl( 1-\sum^p_{i=1}(\phi_iL^i) \bigr) \bigl( 1-\sum^P_{I=1}(\Phi_IL^{sI}) \bigr) \Delta^d \Delta^D_s Y_t  = \bigl( 1+\sum^q_{j=1}(\theta_jL^j) \bigr) \bigl( 1+\sum^Q_{J=1}(\Theta_JL^{sJ}) \bigr) u_t
\]</span></p>
</div>
<div id="arimaxモデル" class="section level4 unnumbered hasAnchor">
<h4>ARIMAXモデル<a href="09_var.html#arimaxモデル" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>外生変数付きARIMA（ARIMA with eXogenous variables、ARIMAX）モデル</strong>は、ARIMAに外生変数を加えたモデルです。</p>
<p>単変量時系列モデルであるARIMAモデルに回帰の要素を導入したものであり、主にイベント効果、曜日・祝日効果、異常値の補正などを考慮するために用いられます。</p>
<p>ここで、分析対象の非説明変数（目的変数、応答変数ともいう）を<span class="math inline">\(Y_t\)</span>、外性変数として導入する説明変数を<span class="math inline">\(X_t\)</span>とします。<span class="math inline">\(r\)</span>個の説明変数があり、時点<span class="math inline">\(t\)</span>における<span class="math inline">\(k\)</span>番目の説明変数を<span class="math inline">\(X_{k,t}\)</span>と表記すると、<span class="math inline">\(Y_t\)</span>を階差変換しない<span class="math inline">\(\mathit{ARIMAX}(p,0,q)\)</span>モデルは次のように定式化できます。</p>
<p><span class="math display">\[
Y_t = c + \sum^p_{i=1}(\phi_iY_{t-i}) + \sum^q_{j=1}(\theta_iu_{t-j}) + \sum^r_{k=1}(\beta_kX_{k,t}) + u_t
\]</span></p>
</div>
</div>
<div id="ボックスジェンキンス法の分析フロー" class="section level3 hasAnchor" number="9.6.3">
<h3><span class="header-section-number">9.6.3</span> ボックス＝ジェンキンス法の分析フロー<a href="09_var.html#ボックスジェンキンス法の分析フロー" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ボックス＝ジェンキンス法は、次のような一連のフローに基づいて分析を実施します。</p>
<ol style="list-style-type: decimal">
<li><p>探索的データ分析</p>
<p>データの折れ線グラフや自己相関・偏自己相関プロットを作成し、季節性やトレンドといったデータの特徴を把握します。</p></li>
<li><p>データ変換</p>
<p>データの特徴に応じてデータの変換を行います。特に、変動幅が徐々に拡大していくデータでは対数変換を、増加トレンドと変動幅の拡大が同時に見られるデータでは対数階差（変化率）変換などを行います。</p></li>
<li><p>単位根検定</p>
<p>ADF検定を行い、データの定常性を確認します。原系列のままで定常なレベル定常過程か、単位根はないがトレンドをもつトレンド定常過程か、単位根をもつ階差定常過程（和分過程）か判断します。階差定常過程（和分過程）の場合は、何階の階差変換で定常になるか（和分次数）を確認します。</p></li>
<li><p>データ分割</p>
<p>モデルの予測精度を評価するため、データを訓練データとテストデータに分割します。</p>
<p>一般的に、計量経済学の回帰分析では全てのデータを対象にモデルの推定が行われます。分析の目的がモデルの推定そのもの、すなわちデータの背景にあるメカニズムの把握にあればそれで構いませんが、分析の目的が将来予測の場合は、全てのデータを対象にモデルを推定すると未知の値に対する予測精度を評価することができません。</p>
<p>ボックス＝ジェンキンス法の目的はほとんどの場合将来予測であることから、分割した訓練データでモデルを推定し、残しておいた未知のテストデータ（）で予測精度を評価します。これは特に教師あり機械学習において一般的な分析手順であり、ホールドアウト法とも呼ばれます。</p></li>
<li><p>モデル同定・推定</p>
<p>ARIMAモデルの同定と推定を行います。同定とは<span class="math inline">\(\mathit{ARIMA}(p,d,q)\)</span>のラグ・階差次数<span class="math inline">\(p,d,q\)</span>といったモデルの構造を決めることを言います（機械学習でいうパイパーパラメータの決定）。推定とは、モデルの構造を決めた後に係数を求めることを指します。RではARIMAモデルの同定・推定を自動で実施する関数を用います。</p>
<p>なお、モデルを同定する際の指標の一つに<strong>尤度（likelihood）</strong>があります。尤度とは「パラメータが与えられた時に、手持ちのデータが得られる確率」であり、手持ちのデータに対するモデルの当てはまりの良さを定量化した指標です。通常、尤度は小さな値になるため、対数変換した<strong>対数尤度（log likelihood）</strong>が用いられます。なお、この尤度（対数尤度）を最大化するようにパラメータを決める方法を<strong>最尤推定法</strong>と言います。</p>
<p>パラメータの数（ARIMAモデルの場合はラグ次数の<span class="math inline">\(p,q\)</span>）を増やしてモデルを複雑化するほど尤度が大きくなるため、モデルを同定する際にはパラメータの数に対し一定の制約が必要です。その制約が<strong>赤池情報量規準（AIC）</strong>です。AICは「パラメータを増加させた以上に尤度が改善しているか」を示す指標であり、小さいほどモデルとして優れていることを意味します。</p></li>
<li><p>残差チェック</p>
<p>モデルを推定した結果として得られる残差について、系列無相関の検定（リュン＝ボックス検定）と、正規分布の検定（ジャック＝ベラ検定）を行います。ARIMAモデルを正しく推定した場合は残差がホワイトノイズになるため、系列無相関の検定では残差系列に自己相関が見られないこと、異常値がないことを確認します。また、時系列モデルの残差項として正規分布に従うホワイトノイズを仮定しているため、正規分布の検定では残差系列が正規分布と異なっていないことを確認します。</p></li>
<li><p>予測精度評価</p>
<p>分割しておいたテストデータで予測値を作成し、実績と比較して予測精度を評価します。評価指標にはRMSE（Root Mean Square Error）などが用いられます。加えて、過去の平均値や前期の値を予測値として用いるナイーブ予測（ARIMAなどの複雑なモデルを使わない予測）の精度を上回ることを確認します。</p></li>
</ol>
</div>
<div id="実例ボックスジェンキンス法" class="section level3 hasAnchor" number="9.6.4">
<h3><span class="header-section-number">9.6.4</span> 実例：ボックス＝ジェンキンス法<a href="09_var.html#実例ボックスジェンキンス法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここではボックス＝ジェンキンス法を実際のデータに適用した例として、馬場（2018）第2部7章「RによるARIMAモデル」（P.95〜116）の実例を再現します。</p>
<div id="探索的データ分析-1" class="section level4 unnumbered hasAnchor">
<h4>1. 探索的データ分析<a href="09_var.html#探索的データ分析-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Rの<code>Seatbelts</code>データセットに含まれる英国の交通事故死傷者数（前席）の月次時系列データ<code>front</code>を読み込み、<code>forecast</code>パッケージの<code>ggtsdisplay()</code>関数で折れ線グラフと自己相関・偏自己相関プロットを作成します。</p>
<p>折れ線グラフに明らかな周期性が見られます。自己相関プロット（ACF）で12・24・36カ月ラグに大きな自己相関があること、偏自己相関プロット（PACF）で12カ月ラグの前後に大きな自己相関があることから、1年周期の変動があると判断できます。</p>
<p>また、時間を通じて値が取る範囲が変化していることから、単位根をもつことが示唆されます。</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="09_var.html#cb898-1" aria-hidden="true" tabindex="-1"></a>front <span class="ot">&lt;-</span> Seatbelts[, <span class="st">&quot;front&quot;</span>]</span>
<span id="cb898-2"><a href="09_var.html#cb898-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb898-3"><a href="09_var.html#cb898-3" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(front, <span class="at">main =</span> <span class="st">&quot;原系列&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-406-1.png" width="672" /></p>
</div>
<div id="データ変換" class="section level4 unnumbered hasAnchor">
<h4>2. データ変換<a href="09_var.html#データ変換" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>個数や人数といったデータは対数変換するとうまくモデル化できる傾向があることから、<code>front</code>を<code>log()</code>関数で対数変換したデータについても同様に<code>ggtsdisplay()</code>関数でプロットします。</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="09_var.html#cb899-1" aria-hidden="true" tabindex="-1"></a>front_log <span class="ot">&lt;-</span> <span class="fu">log</span>(front)</span>
<span id="cb899-2"><a href="09_var.html#cb899-2" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(front_log, <span class="at">main =</span> <span class="st">&quot;対数系列&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-407-1.png" width="672" /></p>
<p>原系列（対数変換した系列も含む）は単位根を持っている可能性があるため、対数系列を<code>diff()</code>関数で差分をとって対数差分系列に変換し、定常化できるか確認します。</p>
<p>対数差分系列は長期にわたって平均値が変化せず、単位根が無くなっている可能性が示唆されます。短期の自己相関（ACF）は減りましたが、12・24・36カ月ラグではプラスの、6・18・30カ月ラグではマイナスの自己相関が残っており、対数差分系列にも周期性があることが確認できます。</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="09_var.html#cb900-1" aria-hidden="true" tabindex="-1"></a>front_log_diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(front_log)</span>
<span id="cb900-2"><a href="09_var.html#cb900-2" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(front_log_diff, <span class="at">main =</span> <span class="st">&quot;対数差分系列&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-408-1.png" width="672" /></p>
<p>12カ月単位の自己相関があるため、季節成分をもっていると判断できます。そこで、<code>forecast</code>パッケージの<code>ggsubseriesplot()</code>関数を用いて、原系列を月ごとに分けたグラフを作成します。</p>
<p>12月が最も交通事故死亡者数が多く、2月が最も少ない傾向があることが確認できます。</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="09_var.html#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsubseriesplot</span>(front)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-409-1.png" width="672" /></p>
<p>季節成分の影響を除去するため、先ほど作成した対数差分系列にさらに季節差分（ここでは12カ月前差）をとり、プロットします。季節階差は<code>diff()</code>関数の<code>lag</code>引数に周期（ここでは12）を指定して計算します。</p>
<p>自己相関プロット（ACF）、偏自己相関プロット（PACF）ともに12カ月単位の自己相関が残っており、季節階差をとっても季節成分の影響を全て除去することはできませんでした。</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="09_var.html#cb902-1" aria-hidden="true" tabindex="-1"></a>front_log_diff_seasdiff <span class="ot">&lt;-</span> <span class="fu">diff</span>(front_log_diff, <span class="at">lag =</span> <span class="dv">12</span>)</span>
<span id="cb902-2"><a href="09_var.html#cb902-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb902-3"><a href="09_var.html#cb902-3" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(front_log_diff_seasdiff, <span class="at">main =</span> <span class="st">&quot;対数差分系列の季節階差系列&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-410-1.png" width="672" /></p>
</div>
<div id="単位根検定" class="section level4 unnumbered hasAnchor">
<h4>3. 単位根検定<a href="09_var.html#単位根検定" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>折れ線グラフのプロットから原系列が単位根を持っていることはほぼ明らかですが、念のため<code>adf_test_flow()</code>自作関数で<code>front</code>単位根検定と和分次数の確認を行います。</p>
<p>原系列（階差次数0）に対しADF検定を適用したフロー1〜7では「単位根あり」の帰無仮説を棄却できず、最終的に1階の階差系列に対しtrend第1検定を行ったフロー8で<span class="math inline">\(I(1)\)</span>過程であると判断されました。これは折れ線グラフのプロットと整合的な結果です。</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="09_var.html#cb903-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adf_test_flow</span>(<span class="at">y =</span> front, <span class="co"># 検定対象の時系列データ</span></span>
<span id="cb903-2"><a href="09_var.html#cb903-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">lag_criterion =</span> <span class="st">&quot;AIC&quot;</span>, <span class="co"># ラグ次数選択基準</span></span>
<span id="cb903-3"><a href="09_var.html#cb903-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">lags_max =</span> <span class="dv">12</span>, <span class="co"># AICで自動選択する最大ラグ次数</span></span>
<span id="cb903-4"><a href="09_var.html#cb903-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb903-5"><a href="09_var.html#cb903-5" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["フロー"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["階差次数"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["モデル"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["帰無仮説"],"name":[5],"type":["chr"],"align":["left"]},{"label":["棄却点"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["結果"],"name":[8],"type":["chr"],"align":["left"]},{"label":["判断"],"name":[9],"type":["chr"],"align":["left"]},{"label":["判断経路"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"0","3":"trend 第1検定","4":"12","5":"単位根あり","6":"-3.430000","7":"-2.0697261","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー2へ","10":"＊"},{"1":"2","2":"0","3":"trend 複合検定","4":"12","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"2.3860373","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー4へ","10":"＊"},{"1":"3","2":"0","3":"trend 第2検定","4":"12","5":"単位根あり","6":"-1.644854","7":"-2.0697261","8":"帰無仮説を棄却","9":"単位根なし：I(0)過程","10":""},{"1":"4","2":"0","3":"drift 第1検定","4":"12","5":"単位根あり","6":"-2.880000","7":"-0.4025301","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー5へ","10":"＊"},{"1":"5","2":"0","3":"drift 複合検定","4":"12","5":"定数項なし＆単位根あり","6":"4.630000","7":"0.9236715","8":"複合帰無仮説を棄却できない","9":"定数項なし：フロー7へ","10":"＊"},{"1":"6","2":"0","3":"drift 第2検定","4":"12","5":"単位根あり","6":"-1.644854","7":"-0.4025301","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"7","2":"0","3":"none","4":"12","5":"単位根あり","6":"-1.950000","7":"-1.3488053","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":"＊"},{"1":"8","2":"1","3":"trend 第1検定","4":"12","5":"単位根あり","6":"-3.430000","7":"-4.6485276","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":"＊"},{"1":"9","2":"1","3":"trend 複合検定","4":"12","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"10.9694522","8":"複合帰無仮説を棄却","9":"トレンド項あり：フロー10へ","10":""},{"1":"10","2":"1","3":"trend 第2検定","4":"12","5":"単位根あり","6":"-1.644854","7":"-4.6485276","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"11","2":"1","3":"drift 第1検定","4":"12","5":"単位根あり","6":"-2.880000","7":"-4.6803032","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"12","2":"1","3":"drift 複合検定","4":"12","5":"定数項なし＆単位根あり","6":"4.630000","7":"10.9596028","8":"複合帰無仮説を棄却","9":"定数項あり：フロー13へ","10":""},{"1":"13","2":"1","3":"drift 第2検定","4":"12","5":"単位根あり","6":"-1.644854","7":"-4.6803032","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"14","2":"1","3":"none","4":"12","5":"単位根あり","6":"-1.950000","7":"-4.5522748","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="データ分割" class="section level4 unnumbered hasAnchor">
<h4>4. データ分割<a href="09_var.html#データ分割" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>モデルの予測精度を評価するため、データを訓練データとテストデータに分割します。</p>
<p>まず、Rの<code>Seatbelts</code>データセットから、前席における死傷者数（<code>front</code>）、ガソリン価格（<code>PetrolPrice</code>）、前席のシートベルト着用を義務付ける法律の施行有無を表すフラグ（<code>law</code>）を抽出し、対数変換したデータを作成します。</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="09_var.html#cb904-1" aria-hidden="true" tabindex="-1"></a>Seatbelts_log <span class="ot">&lt;-</span> Seatbelts[, <span class="fu">c</span>(<span class="st">&quot;front&quot;</span>, <span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;law&quot;</span>)]</span>
<span id="cb904-2"><a href="09_var.html#cb904-2" aria-hidden="true" tabindex="-1"></a>Seatbelts_log[, <span class="st">&quot;front&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">log</span>(Seatbelts_log[, <span class="st">&quot;front&quot;</span>])</span>
<span id="cb904-3"><a href="09_var.html#cb904-3" aria-hidden="true" tabindex="-1"></a>Seatbelts_log[, <span class="st">&quot;PetrolPrice&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">log</span>(Seatbelts_log[, <span class="st">&quot;PetrolPrice&quot;</span>])</span></code></pre></div>
<p>データ期間（1969年1月〜1984年12月）のうち最後の1年（1984年）をテストデータ、それ以前を訓練データとして分割します。ts形式のデータを分割するには<code>stats::window()</code>関数を使用して<code>start</code>引数と<code>end</code>引数に時点を指定します。詳細は、第8章の「ts形式データ」を参照してください。</p>
<p>なお、tibble形式などデータフレーム形式のデータを分割する場合は、<code>dplyr::slice()</code>関数で行インデックスを指定するか、データフレームに含まれる日付などの時点情報を条件にして<code>dplyr::filter()</code>関数で行をフィルタします。詳細は、第4章の「行のスライスとサンプリング」と「行のフィルタ」を参照してください。</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="09_var.html#cb905-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 訓練データ（1983年12月以前）</span></span>
<span id="cb905-2"><a href="09_var.html#cb905-2" aria-hidden="true" tabindex="-1"></a>data_train <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">window</span>(Seatbelts_log, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1983</span>, <span class="dv">12</span>))</span>
<span id="cb905-3"><a href="09_var.html#cb905-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb905-4"><a href="09_var.html#cb905-4" aria-hidden="true" tabindex="-1"></a><span class="co"># テストデータ（1984年1月以降）</span></span>
<span id="cb905-5"><a href="09_var.html#cb905-5" aria-hidden="true" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">window</span>(Seatbelts_log, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1984</span>, <span class="dv">1</span>))</span></code></pre></div>
</div>
<div id="モデル同定推定" class="section level4 unnumbered hasAnchor">
<h4>5. モデル同定・推定<a href="09_var.html#モデル同定推定" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>分割した訓練データを用い、モデルの同定・推定を行います。</p>
<p>まず、<code>forecast</code>パッケージの<code>Arima()</code>関数を用いて手動でモデルを同定します。ここでは暫定的に、モデルを<span class="math inline">\(\mathit{SARIMA}(1,1,1)(1,0,0)\)</span>と同定してパラメータを推定します。</p>
<p>モデルの推定結果の係数を見ると、外生変数の<code>PetrolPrice</code>と<code>law</code>の係数がともにマイナスになっています。これは、ガソリン価格が上がるか、シートベルト着用義務化法が施行されると交通事故死傷者数が減少することを意味しています。</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="09_var.html#cb906-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb906-2"><a href="09_var.html#cb906-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-3"><a href="09_var.html#cb906-3" aria-hidden="true" tabindex="-1"></a>model_sarimax <span class="ot">&lt;-</span> <span class="fu">Arima</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;front&quot;</span>], <span class="co"># 分析対象のデータ</span></span>
<span id="cb906-4"><a href="09_var.html#cb906-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="co"># ラグ・階差次数(p,d,q)</span></span>
<span id="cb906-5"><a href="09_var.html#cb906-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)), <span class="co"># 季節成分のラグ・階差次数(P,D,Q)</span></span>
<span id="cb906-6"><a href="09_var.html#cb906-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xreg =</span> data_train[, <span class="fu">c</span>(<span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;law&quot;</span>)] <span class="co"># 外生変数</span></span>
<span id="cb906-7"><a href="09_var.html#cb906-7" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb906-8"><a href="09_var.html#cb906-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-9"><a href="09_var.html#cb906-9" aria-hidden="true" tabindex="-1"></a>model_sarimax</span></code></pre></div>
<pre><code>## Series: data_train[, &quot;front&quot;] 
## Regression with ARIMA(1,1,1)(1,0,0)[12] errors 
## 
## Coefficients:
##          ar1      ma1    sar1  PetrolPrice      law
##       0.2589  -0.9503  0.6877      -0.3464  -0.3719
## s.e.  0.0826   0.0303  0.0548       0.0955   0.0467
## 
## sigma^2 = 0.009052:  log likelihood = 165.33
## AIC=-318.66   AICc=-318.18   BIC=-299.54</code></pre>
<p>次に、<code>forecast</code>パッケージの<code>auto.arima()</code>関数を用いて自動でモデルを同定します。実行すると数十秒計算が行われ（PCの性能により変わります）、その後結果が出力されます。</p>
<p><code>auto.arima()</code>関数では<span class="math inline">\(\mathit{SARIMA}(p,d,q)(P,D,Q)\)</span>の6つのラグ・階差次数を全て自動で選択することができますが、階差次数（和分次数）はADF検定で事前に確認できるため、引数<code>d</code>に直接指定します。ここでは、先に実施したADF検定の結果に基づき<code>d = 1</code>を指定します。また、1階の階差変換で単位根がなくなり定常化できることから、季節成分の階差次数<code>D</code>は<code>D = 0</code>を指定します。</p>
<p><code>auto.arima()</code>関数を実行した結果、<span class="math inline">\(\mathit{SARIMA}(2,1,4)(2,0,0)[12]\)</span>が選択されました。パラメータの推定結果を見ると、外生変数の<code>PetrolPrice</code>と<code>law</code>の係数はやはり両方マイナスになっています。また、モデル選択基準であるAICは-326.9と先ほど手動で同定・推定した<span class="math inline">\(\mathit{SARIMA}(1,1,1)(1,0,0)\)</span>の-318.7より小さく、自動選択のモデルが優れていることを意味しています。</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="09_var.html#cb908-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb908-2"><a href="09_var.html#cb908-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb908-3"><a href="09_var.html#cb908-3" aria-hidden="true" tabindex="-1"></a>model_sarimax_auto <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;front&quot;</span>], <span class="co"># 分析対象のデータ</span></span>
<span id="cb908-4"><a href="09_var.html#cb908-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">xreg =</span> data_train[, <span class="fu">c</span>(<span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;law&quot;</span>)], <span class="co"># 外生変数</span></span>
<span id="cb908-5"><a href="09_var.html#cb908-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ic =</span> <span class="st">&quot;aic&quot;</span>, <span class="co"># モデル選択に使用する情報量規準</span></span>
<span id="cb908-6"><a href="09_var.html#cb908-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">d =</span> <span class="dv">1</span>, <span class="co"># 階差次数dを指定</span></span>
<span id="cb908-7"><a href="09_var.html#cb908-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">D =</span> <span class="dv">0</span>, <span class="co"># 季節成分の階差次数Dを指定</span></span>
<span id="cb908-8"><a href="09_var.html#cb908-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">max.order =</span> <span class="dv">10</span>, <span class="co"># SARIMA(p,d,q)(P,D,Q)におけるラグ次数の合計p+q+P+Qの最大値</span></span>
<span id="cb908-9"><a href="09_var.html#cb908-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="co"># TRUEにするとステップワイズ法を使用して計算を省略</span></span>
<span id="cb908-10"><a href="09_var.html#cb908-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">approximation =</span> <span class="cn">FALSE</span>, <span class="co"># </span></span>
<span id="cb908-11"><a href="09_var.html#cb908-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">parallel =</span> <span class="cn">TRUE</span>, <span class="co"># TRUEにすると並列化演算で高速化</span></span>
<span id="cb908-12"><a href="09_var.html#cb908-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">num.cores =</span> <span class="dv">4</span> <span class="co"># 並列化演算に使用するCPUのコア数（PCの環境に合わせて指定）</span></span>
<span id="cb908-13"><a href="09_var.html#cb908-13" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb908-14"><a href="09_var.html#cb908-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb908-15"><a href="09_var.html#cb908-15" aria-hidden="true" tabindex="-1"></a>model_sarimax_auto</span></code></pre></div>
<pre><code>## Series: data_train[, &quot;front&quot;] 
## Regression with ARIMA(2,1,4)(2,0,0)[12] errors 
## 
## Coefficients:
##           ar1      ar2      ma1     ma2      ma3      ma4    sar1    sar2
##       -0.4325  -0.8034  -0.2811  0.4488  -0.7833  -0.1932  0.4910  0.2800
## s.e.   0.1156   0.0880   0.1337  0.0713   0.0656   0.0961  0.0808  0.0861
##       PetrolPrice      law
##           -0.4129  -0.3776
## s.e.       0.0864   0.0458
## 
## sigma^2 = 0.00824:  log likelihood = 174.45
## AIC=-326.9   AICc=-325.31   BIC=-291.83</code></pre>
</div>
<div id="残差チェック" class="section level4 unnumbered hasAnchor">
<h4>6. 残差チェック<a href="09_var.html#残差チェック" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>モデルの同定・推定ができたら、残差系列に自己相関が見られないこと、正規分布と異なっていないことを確認します。</p>
<p>まず、リュン＝ボックス検定で残差に有意な自己相関がないことを確認します。リュン＝ボックス検定を行うには<code>forecast</code>パッケージの<code>checkresiduals()</code>関数や<code>stats</code>パッケージの<code>Box.test()</code>関数を使用します。<code>checkresiduals()</code>関数はリュン＝ボックス検定の結果に加えて残差の折れ線グラフ、自己相関プロット（ACF）、ヒストグラムが出力されるので便利です。</p>
<p>どちらの結果もp値が有意水準の0.05を上回っており、残差に有意な自己相関が見られないことが確認できます。</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="09_var.html#cb910-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">checkresiduals</span>(model_sarimax_auto)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-416-1.png" width="672" /></p>
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from Regression with ARIMA(2,1,4)(2,0,0)[12] errors
## Q* = 15.685, df = 16, p-value = 0.4752
## 
## Model df: 8.   Total lags used: 24</code></pre>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="09_var.html#cb912-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">Box.test</span>(model_sarimax_auto<span class="sc">$</span>residuals, <span class="co"># 帰無仮説「自己相関なし」を検定する系列</span></span>
<span id="cb912-2"><a href="09_var.html#cb912-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">lag =</span> <span class="dv">24</span>, <span class="co"># ラグ次数</span></span>
<span id="cb912-3"><a href="09_var.html#cb912-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span></span>
<span id="cb912-4"><a href="09_var.html#cb912-4" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  model_sarimax_auto$residuals
## X-squared = 15.685, df = 24, p-value = 0.8991</code></pre>
<p>次に、ジャック＝ベラ検定で残差の正規性を確認します。ジャック＝ベラ検定を行うには<code>tseries</code>パッケージの<code>jarque.bera.test()</code>関数を使用します。</p>
<p><code>jarque.bera.test()</code>関数の実行結果を見ると、p値が有意水準の0.05を上回り、正規分布と有意に異なっていないと判断できます。これは、先ほど<code>checkresiduals()</code>関数で出力された残差のヒストグラムの見た目とも整合的です。</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="09_var.html#cb914-1" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">jarque.bera.test</span>(model_sarimax_auto<span class="sc">$</span>residuals)</span></code></pre></div>
<pre><code>## 
##  Jarque Bera Test
## 
## data:  model_sarimax_auto$residuals
## X-squared = 0.99073, df = 2, p-value = 0.6093</code></pre>
</div>
<div id="予測精度評価" class="section level4 unnumbered hasAnchor">
<h4>7. 予測精度評価<a href="09_var.html#予測精度評価" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>最後にモデルの予測精度評価として、テストデータを使った予測値のRMSEを計算し、ナイーブ予測の精度を上回ることを確認します。</p>
<p>まず、<code>forecast</code>パッケージの<code>forecast()</code>関数でテストデータを使って予測値を作成します。</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="09_var.html#cb916-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb916-2"><a href="09_var.html#cb916-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb916-3"><a href="09_var.html#cb916-3" aria-hidden="true" tabindex="-1"></a>forecast_sarimax_auto <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model_sarimax_auto, <span class="co"># 推定したモデルオブジェクト</span></span>
<span id="cb916-4"><a href="09_var.html#cb916-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">xreg =</span> data_test[, <span class="fu">c</span>(<span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;law&quot;</span>)], <span class="co"># 外生変数</span></span>
<span id="cb916-5"><a href="09_var.html#cb916-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">h =</span> <span class="dv">12</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb916-6"><a href="09_var.html#cb916-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb916-7"><a href="09_var.html#cb916-7" aria-hidden="true" tabindex="-1"></a>                                  )</span>
<span id="cb916-8"><a href="09_var.html#cb916-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb916-9"><a href="09_var.html#cb916-9" aria-hidden="true" tabindex="-1"></a>forecast_sarimax_auto</span></code></pre></div>
<pre><code>##          Point Forecast    Lo 95    Hi 95
## Jan 1984       6.106557 5.928631 6.284482
## Feb 1984       6.140590 5.955513 6.325668
## Mar 1984       6.171630 5.981673 6.361587
## Apr 1984       6.281025 6.090856 6.471194
## May 1984       6.321275 6.131059 6.511490
## Jun 1984       6.262684 6.070323 6.455044
## Jul 1984       6.379276 6.185295 6.573257
## Aug 1984       6.434001 6.240020 6.627983
## Sep 1984       6.391382 6.196907 6.585856
## Oct 1984       6.458118 6.261655 6.654582
## Nov 1984       6.305571 6.108808 6.502333
## Dec 1984       6.392778 6.195893 6.589662</code></pre>
<p>予測結果をプロットするには、<code>ggplot2</code>パッケージの<code>autoplot()</code>関数に予測オブジェクトを指定して実行します。テストデータを使った予測期間は、予測値に加えて<code>forecast()</code>関数で出力した信頼区間（ここでは95％）も図示されています。</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="09_var.html#cb918-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(forecast_sarimax_auto)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-420-1.png" width="672" /></p>
<p>予測値のRMSE（Root Mean Squared Error）は、<code>forecast</code>パッケージの<code>accuracy()</code>関数で計算できます。訓練データ（Training set）のRMSEは0.088、テストデータ（Test set）のRMSEは0.104と、テストデータの予測精度（テストスコア）が訓練データの予測精度（訓練スコア）に比べやや悪いことが確認できます。</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="09_var.html#cb919-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(forecast_sarimax_auto, <span class="co"># 予測オブジェクト</span></span>
<span id="cb919-2"><a href="09_var.html#cb919-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> data_test[, <span class="st">&quot;front&quot;</span>] <span class="co"># テストデータの目的変数</span></span>
<span id="cb919-3"><a href="09_var.html#cb919-3" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                        ME       RMSE        MAE          MPE     MAPE      MASE
## Training set 0.0005185015 0.08795943 0.07069291 -0.007384246 1.052949 0.6429185
## Test set     0.0607077026 0.10353372 0.07280132  0.933283584 1.132013 0.6620935
##                       ACF1 Theil&#39;s U
## Training set -0.0001765518        NA
## Test set      0.1767095028  1.087542</code></pre>
<p>ここではテストデータの外生変数を使って予測値を計算しましたが、実際にこのモデルを運用して将来予測を行う場合は外生変数の<code>PetrolPrice</code>が将来どのような値をとるか不明なため、予測対象期間の<code>PetrolPrice</code>の値を何らか想定する必要があります（<code>law</code>は法律の施行フラグであり1983年2月以降は1の値をとり続けます）。</p>
<p>そこで、予測対象期間の<code>PetrolPrice</code>の簡易的な想定として、訓練データにおける<code>PetrolPrice</code>の平均値と最後の値を用い、<code>front</code>の予測値を計算してRMSEを求めます。</p>
<p><code>PetrolPrice</code>の訓練データの平均値を用いて計算した<code>front</code>の予測値のRMSEは0.083になります。</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="09_var.html#cb921-1" aria-hidden="true" tabindex="-1"></a><span class="co"># テストデータのPetrolPriceを訓練データの平均値で置換</span></span>
<span id="cb921-2"><a href="09_var.html#cb921-2" aria-hidden="true" tabindex="-1"></a>data_test_exmean <span class="ot">&lt;-</span> data_test <span class="sc">%&gt;%</span> </span>
<span id="cb921-3"><a href="09_var.html#cb921-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb921-4"><a href="09_var.html#cb921-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">PetrolPrice =</span> <span class="fu">mean</span>(data_train[, <span class="st">&quot;PetrolPrice&quot;</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb921-5"><a href="09_var.html#cb921-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">12</span>, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1984</span>, <span class="dv">1</span>))</span>
<span id="cb921-6"><a href="09_var.html#cb921-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-7"><a href="09_var.html#cb921-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値を計算</span></span>
<span id="cb921-8"><a href="09_var.html#cb921-8" aria-hidden="true" tabindex="-1"></a>forecast_sarimax_auto_exmean <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model_sarimax_auto, <span class="co"># 推定したモデルオブジェクト</span></span>
<span id="cb921-9"><a href="09_var.html#cb921-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">xreg =</span> data_test_exmean[, <span class="fu">c</span>(<span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;law&quot;</span>)], <span class="co"># 外生変数</span></span>
<span id="cb921-10"><a href="09_var.html#cb921-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">h =</span> <span class="dv">12</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb921-11"><a href="09_var.html#cb921-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb921-12"><a href="09_var.html#cb921-12" aria-hidden="true" tabindex="-1"></a>                                         )</span>
<span id="cb921-13"><a href="09_var.html#cb921-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb921-14"><a href="09_var.html#cb921-14" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(forecast_sarimax_auto_exmean)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-422-1.png" width="672" /></p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="09_var.html#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSEを計算</span></span>
<span id="cb922-2"><a href="09_var.html#cb922-2" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(forecast_sarimax_auto_exmean, <span class="co"># 予測オブジェクト</span></span>
<span id="cb922-3"><a href="09_var.html#cb922-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> data_test[, <span class="st">&quot;front&quot;</span>] <span class="co"># テストデータの目的変数</span></span>
<span id="cb922-4"><a href="09_var.html#cb922-4" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                        ME       RMSE        MAE          MPE      MAPE
## Training set 0.0005185015 0.08795943 0.07069291 -0.007384246 1.0529490
## Test set     0.0099561964 0.08337008 0.05793756  0.135357382 0.9038067
##                   MASE          ACF1 Theil&#39;s U
## Training set 0.6429185 -0.0001765518        NA
## Test set     0.5269147  0.1681499910 0.8978384</code></pre>
<p><code>PetrolPrice</code>の訓練データの最後の値を用いて計算した<code>front</code>の予測値のRMSEは0.108になります。</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="09_var.html#cb924-1" aria-hidden="true" tabindex="-1"></a><span class="co"># テストデータのPetrolPriceを訓練データの最後の値で置換</span></span>
<span id="cb924-2"><a href="09_var.html#cb924-2" aria-hidden="true" tabindex="-1"></a>data_test_exlatest <span class="ot">&lt;-</span> data_test <span class="sc">%&gt;%</span> </span>
<span id="cb924-3"><a href="09_var.html#cb924-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb924-4"><a href="09_var.html#cb924-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">PetrolPrice =</span> <span class="fu">tail</span>(data_train[, <span class="st">&quot;PetrolPrice&quot;</span>], <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb924-5"><a href="09_var.html#cb924-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> <span class="dv">12</span>, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1984</span>, <span class="dv">1</span>))</span>
<span id="cb924-6"><a href="09_var.html#cb924-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-7"><a href="09_var.html#cb924-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値を計算</span></span>
<span id="cb924-8"><a href="09_var.html#cb924-8" aria-hidden="true" tabindex="-1"></a>forecast_sarimax_auto_exlatest <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model_sarimax_auto, <span class="co"># 推定したモデルオブジェクト</span></span>
<span id="cb924-9"><a href="09_var.html#cb924-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">xreg =</span> data_test_exlatest[, <span class="fu">c</span>(<span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;law&quot;</span>)], <span class="co"># 外生変数</span></span>
<span id="cb924-10"><a href="09_var.html#cb924-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">h =</span> <span class="dv">12</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb924-11"><a href="09_var.html#cb924-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb924-12"><a href="09_var.html#cb924-12" aria-hidden="true" tabindex="-1"></a>                                           )</span>
<span id="cb924-13"><a href="09_var.html#cb924-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-14"><a href="09_var.html#cb924-14" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(forecast_sarimax_auto_exlatest)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-423-1.png" width="672" /></p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="09_var.html#cb925-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSEを計算</span></span>
<span id="cb925-2"><a href="09_var.html#cb925-2" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(forecast_sarimax_auto_exlatest, <span class="co"># 予測オブジェクト</span></span>
<span id="cb925-3"><a href="09_var.html#cb925-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> data_test[, <span class="st">&quot;front&quot;</span>] <span class="co"># テストデータの目的変数</span></span>
<span id="cb925-4"><a href="09_var.html#cb925-4" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                        ME       RMSE        MAE          MPE     MAPE      MASE
## Training set 0.0005185015 0.08795943 0.07069291 -0.007384246 1.052949 0.6429185
## Test set     0.0686420839 0.10753223 0.07817732  1.057960774 1.214970 0.7109857
##                       ACF1 Theil&#39;s U
## Training set -0.0001765518        NA
## Test set      0.1681499910  1.131791</code></pre>
<p>最後に、予測精度の比較対象としてナイーブ予測による予測値を計算します。ここではナイーブ予測として、過去の平均値を予測値として用いるモデルと、前時点の値（訓練データの最後の値）を予測値として用いるモデルの2つを考え、RMSEを計算します。</p>
<p>過去の平均値による予測は<code>forecast</code>パッケージの<code>meanf()</code>関数を、前時点の値による予測は同じく<code>forecast</code>パッケージの<code>rwf()</code>関数を使用します。</p>
<p>ナイーブ予測では、過去の平均値による予測モデルのテストデータRMSEは0.395、前時点の値による予測モデルのテストデータRMSEは0.150になりました。それに比べると<span class="math inline">\(\mathit{SARIMA}(2,1,4)(2,0,0)[12]\)</span>モデルでは、<code>PetrolPrice</code>の訓練データの平均値を用いて計算した予測値のRMSEが0.083、同様に<code>PetrolPrice</code>の訓練データの最後の値を用いて計算した予測値のRMSEが0.108と、どちらもナイーブ予測モデルのRMSEより良好であり、<span class="math inline">\(\mathit{SARIMA}(2,1,4)(2,0,0)[12]\)</span>モデルによる予測に付加価値があることが確認できます。</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="09_var.html#cb927-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 過去の平均値による予測</span></span>
<span id="cb927-2"><a href="09_var.html#cb927-2" aria-hidden="true" tabindex="-1"></a>forecast_mean <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">meanf</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;front&quot;</span>], <span class="co"># 訓練データの目的変数</span></span>
<span id="cb927-3"><a href="09_var.html#cb927-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">h =</span> <span class="dv">12</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb927-4"><a href="09_var.html#cb927-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb927-5"><a href="09_var.html#cb927-5" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb927-6"><a href="09_var.html#cb927-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-7"><a href="09_var.html#cb927-7" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(forecast_mean)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-424-1.png" width="672" /></p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="09_var.html#cb928-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(forecast_mean, <span class="co"># 予測オブジェクト</span></span>
<span id="cb928-2"><a href="09_var.html#cb928-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> data_test[, <span class="st">&quot;front&quot;</span>] <span class="co"># テストデータの目的変数</span></span>
<span id="cb928-3"><a href="09_var.html#cb928-3" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                      ME      RMSE       MAE         MPE     MAPE     MASE
## Training set  0.0000000 0.2022141 0.1596050 -0.09183688 2.387333 1.451532
## Test set     -0.3655411 0.3949872 0.3655411 -5.80245549 5.802455 3.324423
##                   ACF1 Theil&#39;s U
## Training set 0.7279029        NA
## Test set     0.6688670  4.007374</code></pre>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="09_var.html#cb930-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 前時点の値（訓練データの最後の値）による予測</span></span>
<span id="cb930-2"><a href="09_var.html#cb930-2" aria-hidden="true" tabindex="-1"></a>forecast_latest <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">rwf</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;front&quot;</span>], <span class="co"># 訓練データの目的変数</span></span>
<span id="cb930-3"><a href="09_var.html#cb930-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">h =</span> <span class="dv">12</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb930-4"><a href="09_var.html#cb930-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb930-5"><a href="09_var.html#cb930-5" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb930-6"><a href="09_var.html#cb930-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb930-7"><a href="09_var.html#cb930-7" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(forecast_latest)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-425-1.png" width="672" /></p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="09_var.html#cb931-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(forecast_latest, <span class="co"># 予測オブジェクト</span></span>
<span id="cb931-2"><a href="09_var.html#cb931-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> data_test[, <span class="st">&quot;front&quot;</span>] <span class="co"># テストデータの目的変数</span></span>
<span id="cb931-3"><a href="09_var.html#cb931-3" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                        ME      RMSE       MAE         MPE     MAPE     MASE
## Training set -0.002197917 0.1471474 0.1174161 -0.05778118 1.755195 1.067844
## Test set     -0.007163588 0.1498196 0.1262996 -0.16838730 1.994628 1.148635
##                   ACF1 Theil&#39;s U
## Training set -0.209498        NA
## Test set      0.668867  1.525489</code></pre>
<p>以上で、ボックス＝ジェンキンス法による分析の流れは終了です。</p>
</div>
</div>
</div>
<div id="共和分" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> 共和分<a href="09_var.html#共和分" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="見せかけの回帰" class="section level3 hasAnchor" number="9.7.1">
<h3><span class="header-section-number">9.7.1</span> 見せかけの回帰<a href="09_var.html#見せかけの回帰" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>2つの無関係な<span class="math inline">\(I(1)\)</span>過程データを用いて回帰分析を行うと、データ間に関係がないにも関わらず回帰係数のt値や決定係数が大きくなり、「2つのデータに関係がある」と誤って判断してしまうことがあります。これを<strong>見せかけの回帰（spurious regression）</strong>と言います。</p>
<p>見せかけの回帰を判断するポイントの一つは、回帰分析の結果として得られる残差の系列相関に関する診断です。見せかけの回帰では残差が大きな系列相関を持つ症状があります。偏自己相関プロットやリュン＝ボックス検定で残差が系列相関を持つことが確認できれば、見せかけの回帰であることを疑うべきです。</p>
</div>
<div id="共和分関係" class="section level3 hasAnchor" number="9.7.2">
<h3><span class="header-section-number">9.7.2</span> 共和分関係<a href="09_var.html#共和分関係" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>一方、見せかけの回帰とは異なり、複数の<span class="math inline">\(I(1)\)</span>過程のデータの間に意味のある関係を見出すことができる場合があります。そうした関係を<strong>共和分（cointegration）</strong>と言います。</p>
<p>共和分は、<span class="math inline">\(I(1)\)</span>過程の2つのデータ<span class="math inline">\(Y_t \sim I(1)\)</span>と<span class="math inline">\(X_t \sim I(1)\)</span>の線型結合が<span class="math inline">\(I(0)\)</span>過程に従うこと、すなわち、</p>
<p><span class="math display">\[
\beta_1 Y_t + \beta_2 X_t \sim I(0)
\]</span></p>
<p>を満たす<span class="math inline">\(\beta_1\)</span>と<span class="math inline">\(\beta_2\)</span>が存在することと定義されます。これは、次の回帰式</p>
<p><span class="math display">\[
Y_t = \mu + \theta X_t + u_t
\]</span></p>
<p>を最小2乗法（OLS）で推定して得られる残差<span class="math inline">\(\hat{u}_t = Y_t - \hat{\mu} - \hat{\theta} X_t\)</span>が<span class="math inline">\(I(0)\)</span>過程に従うことを意味します。したがって、見せかけの回帰と共和分は「残差が<span class="math inline">\(I(1)\)</span>過程であれば見せかけの回帰」、「残差が<span class="math inline">\(I(0)\)</span>過程であれば共和分」と区別できます。</p>
</div>
<div id="エングルグレンジャー検定" class="section level3 hasAnchor" number="9.7.3">
<h3><span class="header-section-number">9.7.3</span> エングル＝グレンジャー検定<a href="09_var.html#エングルグレンジャー検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>見せかけの回帰では回帰残差が単位根をもつ<span class="math inline">\(I(1)\)</span>過程、共和分関係では回帰残差が定常（<span class="math inline">\(I(0)\)</span>過程）になるため、残差に単位根検定を行なって「単位根あり」の帰無仮説を棄却できなければ「見せかけの回帰」、「単位根あり」の帰無仮説を棄却できれば「共和分関係」であると判断できます。</p>
<p>このように、回帰残差に単位根検定を適用して「見せかけの回帰」か「共和分関係」かを判断する方法を、<strong>エングル＝グレンジャー検定（Engle-Granger test）</strong>と言います。</p>
<p>Rでは、エングル＝グレンジャー検定を一般化した<strong>フィリップ＝オーリアリス検定（Phillips-Ouliaris test、PO 検定）</strong>が用いられます（馬場（2018）P.142）。PO検定の帰無仮説は「共和分なし」（回帰残差が単位根をもつ）、対立仮説は「共和分あり」（回帰残差が単位根をもたない）です。</p>
</div>
<div id="実例見せかけの回帰" class="section level3 hasAnchor" number="9.7.4">
<h3><span class="header-section-number">9.7.4</span> 実例：見せかけの回帰<a href="09_var.html#実例見せかけの回帰" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次の例は、西山 他（2019）P.592の「実証例12.3 南極のペンギンの数と日本のGDP」を参考に、日本の実質GDPデータを南極のペンギンの数データに回帰したものです。データ頻度は年次であり、期間は1982〜2014年です。</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb933-1"><a href="09_var.html#cb933-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XLSXデータを読み込み</span></span>
<span id="cb933-2"><a href="09_var.html#cb933-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data_nishiyama/ch12/Fig_2_penguin.xlsx&quot;</span>, <span class="co"># ファイルパス（拡張子が必要、URLは不可）</span></span>
<span id="cb933-3"><a href="09_var.html#cb933-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="st">&quot;Figure&quot;</span>, <span class="co"># シートインデックス／シート名</span></span>
<span id="cb933-4"><a href="09_var.html#cb933-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;gdp&quot;</span>, <span class="st">&quot;penguin&quot;</span>), <span class="co"># ヘッダー（列名データ）の有無／列名指定</span></span>
<span id="cb933-5"><a href="09_var.html#cb933-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）</span></span>
<span id="cb933-6"><a href="09_var.html#cb933-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span> <span class="co"># 読み込み時に上からスキップする行数</span></span>
<span id="cb933-7"><a href="09_var.html#cb933-7" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb933-8"><a href="09_var.html#cb933-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb933-9"><a href="09_var.html#cb933-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ts()関数でtibble形式のデータをts形式に変換</span></span>
<span id="cb933-10"><a href="09_var.html#cb933-10" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date),</span>
<span id="cb933-11"><a href="09_var.html#cb933-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">start =</span> <span class="fu">min</span>(data<span class="sc">$</span>date),</span>
<span id="cb933-12"><a href="09_var.html#cb933-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">end =</span> <span class="fu">max</span>(data<span class="sc">$</span>date),</span>
<span id="cb933-13"><a href="09_var.html#cb933-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">frequency =</span> <span class="dv">1</span></span>
<span id="cb933-14"><a href="09_var.html#cb933-14" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
<p><code>forecast::ggtsdisplay()</code>関数で折れ線グラフと自己相関・偏自己相関プロットを図示します。</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="09_var.html#cb934-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(data_ts[, <span class="st">&quot;gdp&quot;</span>], <span class="at">main =</span> <span class="st">&quot;日本の実質GDP&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-427-1.png" width="672" /></p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="09_var.html#cb935-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(data_ts[, <span class="st">&quot;penguin&quot;</span>], <span class="at">main =</span> <span class="st">&quot;南極のペンギン数&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-428-1.png" width="672" /></p>
<p>まず、実質GDPデータとペンギン数データそれぞれについて<code>adf_test_flow()</code>自作関数で単位根検定を行うと、どちらも<span class="math inline">\(I(1)\)</span>過程と判断できます。</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="09_var.html#cb936-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日本の実質GDPデータのの単位根検定</span></span>
<span id="cb936-2"><a href="09_var.html#cb936-2" aria-hidden="true" tabindex="-1"></a>adf_gdp <span class="ot">&lt;-</span> <span class="fu">adf_test_flow</span>(<span class="at">y =</span> data<span class="sc">$</span>gdp, <span class="co"># 検定対象の時系列データ</span></span>
<span id="cb936-3"><a href="09_var.html#cb936-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lag_criterion =</span> <span class="st">&quot;AIC&quot;</span>, <span class="co"># ラグ次数選択基準</span></span>
<span id="cb936-4"><a href="09_var.html#cb936-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lags_max =</span> <span class="dv">10</span>, <span class="co"># AICで自動選択する最大ラグ次数</span></span>
<span id="cb936-5"><a href="09_var.html#cb936-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb936-6"><a href="09_var.html#cb936-6" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb936-7"><a href="09_var.html#cb936-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb936-8"><a href="09_var.html#cb936-8" aria-hidden="true" tabindex="-1"></a>adf_gdp</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["フロー"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["階差次数"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["モデル"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["帰無仮説"],"name":[5],"type":["chr"],"align":["left"]},{"label":["棄却点"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["結果"],"name":[8],"type":["chr"],"align":["left"]},{"label":["判断"],"name":[9],"type":["chr"],"align":["left"]},{"label":["判断経路"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"0","3":"trend 第1検定","4":"1","5":"単位根あり","6":"-3.500000","7":"-2.541326","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー2へ","10":"＊"},{"1":"2","2":"0","3":"trend 複合検定","4":"1","5":"トレンド項なし＆単位根あり","6":"6.730000","7":"3.320588","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー4へ","10":"＊"},{"1":"3","2":"0","3":"trend 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-2.541326","8":"帰無仮説を棄却","9":"単位根なし：I(0)過程","10":""},{"1":"4","2":"0","3":"drift 第1検定","4":"1","5":"単位根あり","6":"-2.930000","7":"-1.064565","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー5へ","10":"＊"},{"1":"5","2":"0","3":"drift 複合検定","4":"1","5":"定数項なし＆単位根あり","6":"4.860000","7":"2.610712","8":"複合帰無仮説を棄却できない","9":"定数項なし：フロー7へ","10":"＊"},{"1":"6","2":"0","3":"drift 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-1.064565","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"7","2":"0","3":"none","4":"1","5":"単位根あり","6":"-1.950000","7":"1.931645","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":"＊"},{"1":"8","2":"1","3":"trend 第1検定","4":"1","5":"単位根あり","6":"-3.500000","7":"-3.865291","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":"＊"},{"1":"9","2":"1","3":"trend 複合検定","4":"1","5":"トレンド項なし＆単位根あり","6":"6.730000","7":"7.477586","8":"複合帰無仮説を棄却","9":"トレンド項あり：フロー10へ","10":""},{"1":"10","2":"1","3":"trend 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-3.865291","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"11","2":"1","3":"drift 第1検定","4":"1","5":"単位根あり","6":"-2.930000","7":"-3.879543","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"12","2":"1","3":"drift 複合検定","4":"1","5":"定数項なし＆単位根あり","6":"4.860000","7":"7.529052","8":"複合帰無仮説を棄却","9":"定数項あり：フロー13へ","10":""},{"1":"13","2":"1","3":"drift 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-3.879543","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"14","2":"1","3":"none","4":"1","5":"単位根あり","6":"-1.950000","7":"-2.940815","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="09_var.html#cb937-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ペンギン数データの単位根検定</span></span>
<span id="cb937-2"><a href="09_var.html#cb937-2" aria-hidden="true" tabindex="-1"></a>adf_penguin <span class="ot">&lt;-</span> <span class="fu">adf_test_flow</span>(<span class="at">y =</span> data<span class="sc">$</span>penguin, <span class="co"># 検定対象の時系列データ</span></span>
<span id="cb937-3"><a href="09_var.html#cb937-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lag_criterion =</span> <span class="st">&quot;AIC&quot;</span>, <span class="co"># ラグ次数選択基準</span></span>
<span id="cb937-4"><a href="09_var.html#cb937-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lags_max =</span> <span class="dv">10</span>, <span class="co"># AICで自動選択する最大ラグ次数</span></span>
<span id="cb937-5"><a href="09_var.html#cb937-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb937-6"><a href="09_var.html#cb937-6" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb937-7"><a href="09_var.html#cb937-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb937-8"><a href="09_var.html#cb937-8" aria-hidden="true" tabindex="-1"></a>adf_penguin</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["フロー"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["階差次数"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["モデル"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["帰無仮説"],"name":[5],"type":["chr"],"align":["left"]},{"label":["棄却点"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["結果"],"name":[8],"type":["chr"],"align":["left"]},{"label":["判断"],"name":[9],"type":["chr"],"align":["left"]},{"label":["判断経路"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"0","3":"trend 第1検定","4":"1","5":"単位根あり","6":"-3.500000","7":"-1.5842538","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー2へ","10":"＊"},{"1":"2","2":"0","3":"trend 複合検定","4":"1","5":"トレンド項なし＆単位根あり","6":"6.730000","7":"2.0388546","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー4へ","10":"＊"},{"1":"3","2":"0","3":"trend 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-1.5842538","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"4","2":"0","3":"drift 第1検定","4":"10","5":"単位根あり","6":"-2.930000","7":"1.6925081","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー5へ","10":"＊"},{"1":"5","2":"0","3":"drift 複合検定","4":"10","5":"定数項なし＆単位根あり","6":"4.860000","7":"3.0951039","8":"複合帰無仮説を棄却できない","9":"定数項なし：フロー7へ","10":"＊"},{"1":"6","2":"0","3":"drift 第2検定","4":"10","5":"単位根あり","6":"-1.644854","7":"1.6925081","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"7","2":"0","3":"none","4":"1","5":"単位根あり","6":"-1.950000","7":"1.8788504","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":"＊"},{"1":"8","2":"1","3":"trend 第1検定","4":"9","5":"単位根あり","6":"-3.500000","7":"-2.0541416","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー9へ","10":"＊"},{"1":"9","2":"1","3":"trend 複合検定","4":"9","5":"トレンド項なし＆単位根あり","6":"6.730000","7":"2.2199392","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー11へ","10":"＊"},{"1":"10","2":"1","3":"trend 第2検定","4":"9","5":"単位根あり","6":"-1.644854","7":"-2.0541416","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"11","2":"1","3":"drift 第1検定","4":"1","5":"単位根あり","6":"-2.930000","7":"-3.9640143","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":"＊"},{"1":"12","2":"1","3":"drift 複合検定","4":"1","5":"定数項なし＆単位根あり","6":"4.860000","7":"7.9043602","8":"複合帰無仮説を棄却","9":"定数項あり：フロー13へ","10":""},{"1":"13","2":"1","3":"drift 第2検定","4":"1","5":"単位根あり","6":"-1.644854","7":"-3.9640143","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"14","2":"1","3":"none","4":"6","5":"単位根あり","6":"-1.950000","7":"0.5149527","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"15","2":"2","3":"trend 第1検定","4":"5","5":"単位根あり","6":"-3.500000","7":"-4.0251641","8":"帰無仮説を棄却","9":"単位根なし：I(2)過程","10":""},{"1":"16","2":"2","3":"trend 複合検定","4":"5","5":"トレンド項なし＆単位根あり","6":"6.730000","7":"8.1029189","8":"複合帰無仮説を棄却","9":"トレンド項あり：フロー17へ","10":""},{"1":"17","2":"2","3":"trend 第2検定","4":"5","5":"単位根あり","6":"-1.644854","7":"-4.0251641","8":"帰無仮説を棄却","9":"単位根なし：I(2)過程","10":""},{"1":"18","2":"2","3":"drift 第1検定","4":"5","5":"単位根あり","6":"-2.930000","7":"-4.1056584","8":"帰無仮説を棄却","9":"単位根なし：I(2)過程","10":""},{"1":"19","2":"2","3":"drift 複合検定","4":"5","5":"定数項なし＆単位根あり","6":"4.860000","7":"8.4419386","8":"複合帰無仮説を棄却","9":"定数項あり：フロー20へ","10":""},{"1":"20","2":"2","3":"drift 第2検定","4":"5","5":"単位根あり","6":"-1.644854","7":"-4.1056584","8":"帰無仮説を棄却","9":"単位根なし：I(2)過程","10":""},{"1":"21","2":"2","3":"none","4":"5","5":"単位根あり","6":"-1.950000","7":"-3.8741376","8":"帰無仮説を棄却","9":"単位根なし：I(2)過程","10":""}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>次に、実質GDPをペンギン数に回帰すると、両者には関係がないと考えられるにも関わらず、ペンギン数の回帰係数は5％の有意水準で有意に正であり、自由度修正済み決定係数は0.50とまずまずの大きさになっています。</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="09_var.html#cb938-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stats::lm()関数でgdpをpenguinに回帰</span></span>
<span id="cb938-2"><a href="09_var.html#cb938-2" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lm</span>(<span class="at">formula =</span> gdp <span class="sc">~</span> penguin, </span>
<span id="cb938-3"><a href="09_var.html#cb938-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> data</span>
<span id="cb938-4"><a href="09_var.html#cb938-4" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb938-5"><a href="09_var.html#cb938-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb938-6"><a href="09_var.html#cb938-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰した結果を出力</span></span>
<span id="cb938-7"><a href="09_var.html#cb938-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::lm(formula = gdp ~ penguin, data = data)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -84219 -25167  15091  34099  73038 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.232e+05  3.706e+04   6.022 1.15e-06 ***
## penguin     5.745e+01  9.958e+00   5.770 2.37e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 49190 on 31 degrees of freedom
## Multiple R-squared:  0.5178, Adjusted R-squared:  0.5022 
## F-statistic: 33.29 on 1 and 31 DF,  p-value: 2.367e-06</code></pre>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="09_var.html#cb940-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ホワイトの標準誤差で係数の仮設検定を実施</span></span>
<span id="cb940-2"><a href="09_var.html#cb940-2" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(model_lm,</span>
<span id="cb940-3"><a href="09_var.html#cb940-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov. =</span> sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(model_lm, <span class="at">type =</span> <span class="st">&quot;HC1&quot;</span>))</span></code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##               Estimate Std. Error t value  Pr(&gt;|t|)    
## (Intercept) 2.2319e+05 3.9867e+04  5.5985 3.862e-06 ***
## penguin     5.7452e+01 9.7492e+00  5.8930 1.664e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>回帰分析の結果を回帰診断プロットで視覚的に検証します。Residuals vs Fittedでは予測値に対し残差が一様に分布しておらず、残差に系列相関があることが示唆されます。</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="09_var.html#cb942-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰診断プロット</span></span>
<span id="cb942-2"><a href="09_var.html#cb942-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb942-3"><a href="09_var.html#cb942-3" aria-hidden="true" tabindex="-1"></a>model_lm <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-432-1.png" width="672" /></p>
<p>確認のために残差系列の偏自己相関プロット（PACF）を作成すると、ラグ次数1次の偏自己相関係数が有意に正であり、正の系列相関があることがわかります。</p>
<p>また、リュン＝ボックス検定（ラグ次数1次）の結果を見るとp値が0.05を下回り、5％の有意水準で残差が系列相関をもつと判断できます。これらの残差に関する診断は、日本の実質GDPと南極のペンギン数の関係が見せかけの回帰であることを支持しています。</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="09_var.html#cb943-1" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> model_lm<span class="sc">$</span>residuals</span>
<span id="cb943-2"><a href="09_var.html#cb943-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb943-3"><a href="09_var.html#cb943-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 残差の偏自己相関プロット</span></span>
<span id="cb943-4"><a href="09_var.html#cb943-4" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">pacf</span>(resid, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-433-1.png" width="672" /></p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="09_var.html#cb944-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 残差のリュン＝ボックス検定</span></span>
<span id="cb944-2"><a href="09_var.html#cb944-2" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">Box.test</span>(resid, <span class="co"># 帰無仮説「自己相関なし」を検定する系列</span></span>
<span id="cb944-3"><a href="09_var.html#cb944-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">lag =</span> <span class="dv">1</span>, <span class="co"># ラグ次数</span></span>
<span id="cb944-4"><a href="09_var.html#cb944-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span></span>
<span id="cb944-5"><a href="09_var.html#cb944-5" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  resid
## X-squared = 22.877, df = 1, p-value = 1.727e-06</code></pre>
<p>最後に、フィリップ＝オーリアリス検定で残差の単位根検定を行います。フィリップ＝オーリアリス検定を行うには<code>urca</code>パッケージの<code>ca.po()</code>関数を使用します。</p>
<p><code>ca.po()</code>関数の第一引数<code>z</code>には時系列データを行列形式で指定します。このとき、行列の列の順番に注意してください。第1列が回帰分析における非説明変数、第2列が説明変数に該当します。順番が異なるとPO検定の結果が異なる場合があります。</p>
<p><code>demean</code>引数には、モデルがトレンド項と定数項の両方を含む場合は<code>trend</code>、定数項のみ含む場合は<code>constant</code>、トレンド項も定数項も含まない場合は<code>none</code>を指定します。</p>
<p>フィリップ＝オーリアリス検定の結果、検定統計量（<code>Value of test-statistic</code>）が2.812であり、有意水準5％の棄却点48.8439より小さいことから、「単位根あり」の帰無仮説を棄却することができません。したがって日本の実質GDPと南極のペンギン数の関係は「共和分関係」ではなく「見せかけの回帰」であることが示唆されます。</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="09_var.html#cb946-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データセットからgdp、penguinの順で選択して行列形式に変換</span></span>
<span id="cb946-2"><a href="09_var.html#cb946-2" aria-hidden="true" tabindex="-1"></a>data_mat <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb946-3"><a href="09_var.html#cb946-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gdp, penguin</span>
<span id="cb946-4"><a href="09_var.html#cb946-4" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span> </span>
<span id="cb946-5"><a href="09_var.html#cb946-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb946-6"><a href="09_var.html#cb946-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb946-7"><a href="09_var.html#cb946-7" aria-hidden="true" tabindex="-1"></a><span class="co"># フィリップ＝オーリアリス検定</span></span>
<span id="cb946-8"><a href="09_var.html#cb946-8" aria-hidden="true" tabindex="-1"></a>urca<span class="sc">::</span><span class="fu">ca.po</span>(<span class="at">z =</span> data_mat, <span class="co"># データを格納した行列（非説明変数、説明変数の順）</span></span>
<span id="cb946-9"><a href="09_var.html#cb946-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">demean =</span> <span class="st">&quot;trend&quot;</span> <span class="co"># 検定モデル（&quot;trend&quot;, &quot;constant&quot;, &quot;none&quot;）</span></span>
<span id="cb946-10"><a href="09_var.html#cb946-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb946-11"><a href="09_var.html#cb946-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## ######################################## 
## # Phillips and Ouliaris Unit Root Test # 
## ######################################## 
## 
## Test of type Pu 
## detrending of series with constant and linear trend 
## 
## 
## Call:
## lm(formula = z[, 1] ~ z[, -1] + trd)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -46862 -10721   4466  16883  30395 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 393334.303  21530.139  18.269  &lt; 2e-16 ***
## z[, -1]        -33.631      8.858  -3.797 0.000666 ***
## trd           9394.786    800.005  11.743 9.56e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21140 on 30 degrees of freedom
## Multiple R-squared:  0.9138, Adjusted R-squared:  0.9081 
## F-statistic: 159.1 on 2 and 30 DF,  p-value: &lt; 2.2e-16
## 
## 
## Value of test-statistic is: 2.812 
## 
## Critical values of Pu are:
##                   10pct    5pct    1pct
## critical values 41.2488 48.8439 65.1714</code></pre>
</div>
<div id="実例共和分" class="section level3 hasAnchor" number="9.7.5">
<h3><span class="header-section-number">9.7.5</span> 実例：共和分<a href="09_var.html#実例共和分" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次の例は、西山 他（2019）P.597の「実証例12.4 金利の期間構造と共和分」を参考に、長期金利を短期金利に回帰したものです。データ頻度は月次であり、期間は1986年7月〜1995年9月です。</p>
<p>長期金利と短期金利はともに単位根過程ですが、その差である長短金利スプレッドは、リスク・プレミアムが定数である限り定常であることが示唆されます。この時、長期金利と短期金利の間に共和分関係が存在します。</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="09_var.html#cb948-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XLSXデータを読み込み</span></span>
<span id="cb948-2"><a href="09_var.html#cb948-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;data_nishiyama/ch12/Fig_1_longshortspread.xlsx&quot;</span>, <span class="co"># ファイルパス（拡張子が必要、URLは不可）</span></span>
<span id="cb948-3"><a href="09_var.html#cb948-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="dv">1</span>, <span class="co"># シートインデックス／シート名</span></span>
<span id="cb948-4"><a href="09_var.html#cb948-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;call&quot;</span>, <span class="st">&quot;yield10&quot;</span>, <span class="st">&quot;spread&quot;</span>), <span class="co"># ヘッダー（列名データ）の有無／列名指定</span></span>
<span id="cb948-5"><a href="09_var.html#cb948-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># 各列の型の指定（c：文字列型、d：数値型、D：日付型、l：論理値型）</span></span>
<span id="cb948-6"><a href="09_var.html#cb948-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">skip =</span> <span class="dv">1</span><span class="co"># 読み込み時に上からスキップする行数</span></span>
<span id="cb948-7"><a href="09_var.html#cb948-7" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb948-8"><a href="09_var.html#cb948-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb948-9"><a href="09_var.html#cb948-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ts()関数でtibble形式のデータをts形式に変換</span></span>
<span id="cb948-10"><a href="09_var.html#cb948-10" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date),</span>
<span id="cb948-11"><a href="09_var.html#cb948-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1986</span>, <span class="dv">7</span>),</span>
<span id="cb948-12"><a href="09_var.html#cb948-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1995</span>, <span class="dv">9</span>),</span>
<span id="cb948-13"><a href="09_var.html#cb948-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">frequency =</span> <span class="dv">12</span></span>
<span id="cb948-14"><a href="09_var.html#cb948-14" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
<p><code>forecast::ggtsdisplay()</code>関数で折れ線グラフと自己相関・偏自己相関プロットを図示します。</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="09_var.html#cb949-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(data_ts[, <span class="st">&quot;call&quot;</span>], <span class="at">main =</span> <span class="st">&quot;短期金利（コールレート）&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-436-1.png" width="672" /></p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="09_var.html#cb950-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(data_ts[, <span class="st">&quot;yield10&quot;</span>], <span class="at">main =</span> <span class="st">&quot;長期金利（10年物国債利回り）&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-437-1.png" width="672" /></p>
<p>短期金利データと長期金利データそれぞれについて<code>adf_test_flow()</code>自作関数で単位根検定を行うと、どちらも<span class="math inline">\(I(1)\)</span>過程と判断できます。</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="09_var.html#cb951-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 短期金利データのの単位根検定</span></span>
<span id="cb951-2"><a href="09_var.html#cb951-2" aria-hidden="true" tabindex="-1"></a>adf_call <span class="ot">&lt;-</span> <span class="fu">adf_test_flow</span>(<span class="at">y =</span> data_ts[, <span class="st">&quot;call&quot;</span>], <span class="co"># 検定対象の時系列データ</span></span>
<span id="cb951-3"><a href="09_var.html#cb951-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lag_criterion =</span> <span class="st">&quot;AIC&quot;</span>, <span class="co"># ラグ次数選択基準</span></span>
<span id="cb951-4"><a href="09_var.html#cb951-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lags_max =</span> <span class="dv">12</span>, <span class="co"># AICで自動選択する最大ラグ次数</span></span>
<span id="cb951-5"><a href="09_var.html#cb951-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb951-6"><a href="09_var.html#cb951-6" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb951-7"><a href="09_var.html#cb951-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb951-8"><a href="09_var.html#cb951-8" aria-hidden="true" tabindex="-1"></a>adf_call</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["フロー"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["階差次数"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["モデル"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["帰無仮説"],"name":[5],"type":["chr"],"align":["left"]},{"label":["棄却点"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["結果"],"name":[8],"type":["chr"],"align":["left"]},{"label":["判断"],"name":[9],"type":["chr"],"align":["left"]},{"label":["判断経路"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"0","3":"trend 第1検定","4":"4","5":"単位根あり","6":"-3.430000","7":"-1.7913549","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー2へ","10":"＊"},{"1":"2","2":"0","3":"trend 複合検定","4":"4","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"3.7302486","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー4へ","10":"＊"},{"1":"3","2":"0","3":"trend 第2検定","4":"4","5":"単位根あり","6":"-1.644854","7":"-1.7913549","8":"帰無仮説を棄却","9":"単位根なし：I(0)過程","10":""},{"1":"4","2":"0","3":"drift 第1検定","4":"4","5":"単位根あり","6":"-2.880000","7":"-0.9082529","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー5へ","10":"＊"},{"1":"5","2":"0","3":"drift 複合検定","4":"4","5":"定数項なし＆単位根あり","6":"4.630000","7":"0.5149077","8":"複合帰無仮説を棄却できない","9":"定数項なし：フロー7へ","10":"＊"},{"1":"6","2":"0","3":"drift 第2検定","4":"4","5":"単位根あり","6":"-1.644854","7":"-0.9082529","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"7","2":"0","3":"none","4":"4","5":"単位根あり","6":"-1.950000","7":"-0.7743167","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":"＊"},{"1":"8","2":"1","3":"trend 第1検定","4":"3","5":"単位根あり","6":"-3.430000","7":"-2.7183046","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー9へ","10":"＊"},{"1":"9","2":"1","3":"trend 複合検定","4":"3","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"3.8097707","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー11へ","10":"＊"},{"1":"10","2":"1","3":"trend 第2検定","4":"3","5":"単位根あり","6":"-1.644854","7":"-2.7183046","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"11","2":"1","3":"drift 第1検定","4":"3","5":"単位根あり","6":"-2.880000","7":"-2.0532843","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー12へ","10":"＊"},{"1":"12","2":"1","3":"drift 複合検定","4":"3","5":"定数項なし＆単位根あり","6":"4.630000","7":"2.1385647","8":"複合帰無仮説を棄却できない","9":"定数項なし：フロー14へ","10":"＊"},{"1":"13","2":"1","3":"drift 第2検定","4":"3","5":"単位根あり","6":"-1.644854","7":"-2.0532843","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"14","2":"1","3":"none","4":"3","5":"単位根あり","6":"-1.950000","7":"-2.0025373","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":"＊"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="09_var.html#cb952-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 長期金利データのの単位根検定</span></span>
<span id="cb952-2"><a href="09_var.html#cb952-2" aria-hidden="true" tabindex="-1"></a>adf_yield10 <span class="ot">&lt;-</span> <span class="fu">adf_test_flow</span>(<span class="at">y =</span> data_ts[, <span class="st">&quot;yield10&quot;</span>], <span class="co"># 検定対象の時系列データ</span></span>
<span id="cb952-3"><a href="09_var.html#cb952-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lag_criterion =</span> <span class="st">&quot;AIC&quot;</span>, <span class="co"># ラグ次数選択基準</span></span>
<span id="cb952-4"><a href="09_var.html#cb952-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lags_max =</span> <span class="dv">12</span>, <span class="co"># AICで自動選択する最大ラグ次数</span></span>
<span id="cb952-5"><a href="09_var.html#cb952-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb952-6"><a href="09_var.html#cb952-6" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb952-7"><a href="09_var.html#cb952-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb952-8"><a href="09_var.html#cb952-8" aria-hidden="true" tabindex="-1"></a>adf_yield10</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["フロー"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["階差次数"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["モデル"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["帰無仮説"],"name":[5],"type":["chr"],"align":["left"]},{"label":["棄却点"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["結果"],"name":[8],"type":["chr"],"align":["left"]},{"label":["判断"],"name":[9],"type":["chr"],"align":["left"]},{"label":["判断経路"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"0","3":"trend 第1検定","4":"5","5":"単位根あり","6":"-3.430000","7":"-1.1533901","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー2へ","10":"＊"},{"1":"2","2":"0","3":"trend 複合検定","4":"5","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"1.6311767","8":"複合帰無仮説を棄却できない","9":"トレンド項なし：フロー4へ","10":"＊"},{"1":"3","2":"0","3":"trend 第2検定","4":"5","5":"単位根あり","6":"-1.644854","7":"-1.1533901","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"4","2":"0","3":"drift 第1検定","4":"5","5":"単位根あり","6":"-2.880000","7":"-0.5266411","8":"帰無仮説を棄却できない","9":"単位根の判断保留：フロー5へ","10":"＊"},{"1":"5","2":"0","3":"drift 複合検定","4":"5","5":"定数項なし＆単位根あり","6":"4.630000","7":"0.4738156","8":"複合帰無仮説を棄却できない","9":"定数項なし：フロー7へ","10":"＊"},{"1":"6","2":"0","3":"drift 第2検定","4":"5","5":"単位根あり","6":"-1.644854","7":"-0.5266411","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":""},{"1":"7","2":"0","3":"none","4":"5","5":"単位根あり","6":"-1.950000","7":"-0.8997603","8":"帰無仮説を棄却できない","9":"階差変換し再検定","10":"＊"},{"1":"8","2":"1","3":"trend 第1検定","4":"4","5":"単位根あり","6":"-3.430000","7":"-4.7715720","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":"＊"},{"1":"9","2":"1","3":"trend 複合検定","4":"4","5":"トレンド項なし＆単位根あり","6":"6.490000","7":"11.4220113","8":"複合帰無仮説を棄却","9":"トレンド項あり：フロー10へ","10":""},{"1":"10","2":"1","3":"trend 第2検定","4":"4","5":"単位根あり","6":"-1.644854","7":"-4.7715720","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"11","2":"1","3":"drift 第1検定","4":"4","5":"単位根あり","6":"-2.880000","7":"-4.5699942","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"12","2":"1","3":"drift 複合検定","4":"4","5":"定数項なし＆単位根あり","6":"4.630000","7":"10.5343249","8":"複合帰無仮説を棄却","9":"定数項あり：フロー13へ","10":""},{"1":"13","2":"1","3":"drift 第2検定","4":"4","5":"単位根あり","6":"-1.644854","7":"-4.5699942","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""},{"1":"14","2":"1","3":"none","4":"4","5":"単位根あり","6":"-1.950000","7":"-4.5155886","8":"帰無仮説を棄却","9":"単位根なし：I(1)過程","10":""}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>次に、長期金利を短期金利に回帰すると、短期金利の回帰係数は5％の有意水準で有意に正であり、自由度修正済み決定係数は0.82と高い水準です。</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="09_var.html#cb953-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stats::lm()関数でgdpをpenguinに回帰</span></span>
<span id="cb953-2"><a href="09_var.html#cb953-2" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lm</span>(<span class="at">formula =</span> yield10 <span class="sc">~</span> call, </span>
<span id="cb953-3"><a href="09_var.html#cb953-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> data</span>
<span id="cb953-4"><a href="09_var.html#cb953-4" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb953-5"><a href="09_var.html#cb953-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-6"><a href="09_var.html#cb953-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰した結果を出力</span></span>
<span id="cb953-7"><a href="09_var.html#cb953-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::lm(formula = yield10 ~ call, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.87358 -0.26822 -0.05509  0.28396  1.34519 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.14184    0.09892   31.76   &lt;2e-16 ***
## call         0.46018    0.02049   22.46   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4242 on 109 degrees of freedom
## Multiple R-squared:  0.8223, Adjusted R-squared:  0.8207 
## F-statistic: 504.5 on 1 and 109 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="09_var.html#cb955-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ホワイトの標準誤差で係数の仮設検定を実施</span></span>
<span id="cb955-2"><a href="09_var.html#cb955-2" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(model_lm,</span>
<span id="cb955-3"><a href="09_var.html#cb955-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vcov. =</span> sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(model_lm, <span class="at">type =</span> <span class="st">&quot;HC1&quot;</span>))</span></code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##             Estimate Std. Error t value  Pr(&gt;|t|)    
## (Intercept) 3.141838   0.103495  30.357 &lt; 2.2e-16 ***
## call        0.460176   0.021376  21.527 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>残差系列の偏自己相関プロット（PACF）を作成すると、ラグ次数1〜3次の偏自己相関係数が有意であり、系列相関があることがわかります。また、リュン＝ボックス検定（ラグ次数3次）の結果を見るとp値が0.05を下回り、5％の有意水準で残差が系列相関をもつと判断できます。</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="09_var.html#cb957-1" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> model_lm<span class="sc">$</span>residuals</span>
<span id="cb957-2"><a href="09_var.html#cb957-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb957-3"><a href="09_var.html#cb957-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 残差の偏自己相関プロット</span></span>
<span id="cb957-4"><a href="09_var.html#cb957-4" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">pacf</span>(resid, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-441-1.png" width="672" /></p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="09_var.html#cb958-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 残差のリュン＝ボックス検定</span></span>
<span id="cb958-2"><a href="09_var.html#cb958-2" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">Box.test</span>(resid, <span class="co"># 帰無仮説「自己相関なし」を検定する系列</span></span>
<span id="cb958-3"><a href="09_var.html#cb958-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">lag =</span> <span class="dv">3</span>, <span class="co"># ラグ次数</span></span>
<span id="cb958-4"><a href="09_var.html#cb958-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span></span>
<span id="cb958-5"><a href="09_var.html#cb958-5" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  resid
## X-squared = 90.537, df = 3, p-value &lt; 2.2e-16</code></pre>
<p>最後に、フィリップ＝オーリアリス検定で残差の単位根検定を行います。フィリップ＝オーリアリス検定の結果、検定統計量（<code>Value of test-statistic</code>）が57.429であり、有意水準5％の棄却点48.844より大きいことから、「単位根あり」の帰無仮説を棄却します。したがって長期金利と短期金利の関係は「共和分関係」であると判断できます。</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="09_var.html#cb960-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データセットからyield10、callの順に選択して行列形式に変換</span></span>
<span id="cb960-2"><a href="09_var.html#cb960-2" aria-hidden="true" tabindex="-1"></a>data_mat <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb960-3"><a href="09_var.html#cb960-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(yield10, call</span>
<span id="cb960-4"><a href="09_var.html#cb960-4" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span> </span>
<span id="cb960-5"><a href="09_var.html#cb960-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb960-6"><a href="09_var.html#cb960-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb960-7"><a href="09_var.html#cb960-7" aria-hidden="true" tabindex="-1"></a><span class="co"># フィリップ＝オーリアリス検定</span></span>
<span id="cb960-8"><a href="09_var.html#cb960-8" aria-hidden="true" tabindex="-1"></a>urca<span class="sc">::</span><span class="fu">ca.po</span>(<span class="at">z =</span> data_mat, <span class="co"># データを格納した行列（非説明変数、説明変数の順）</span></span>
<span id="cb960-9"><a href="09_var.html#cb960-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">demean =</span> <span class="st">&quot;trend&quot;</span> <span class="co"># 検定モデル（&quot;trend&quot;, &quot;constant&quot;, &quot;none&quot;）</span></span>
<span id="cb960-10"><a href="09_var.html#cb960-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb960-11"><a href="09_var.html#cb960-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## ######################################## 
## # Phillips and Ouliaris Unit Root Test # 
## ######################################## 
## 
## Test of type Pu 
## detrending of series with constant and linear trend 
## 
## 
## Call:
## lm(formula = z[, 1] ~ z[, -1] + trd)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.9572 -0.2585 -0.0572  0.2389  1.2716 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.275015   0.148358  22.075   &lt;2e-16 ***
## z[, -1]      0.450544   0.021959  20.517   &lt;2e-16 ***
## trd         -0.001620   0.001347  -1.203    0.232    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4234 on 108 degrees of freedom
## Multiple R-squared:  0.8247, Adjusted R-squared:  0.8214 
## F-statistic:   254 on 2 and 108 DF,  p-value: &lt; 2.2e-16
## 
## 
## Value of test-statistic is: 57.4292 
## 
## Critical values of Pu are:
##                   10pct    5pct    1pct
## critical values 41.2488 48.8439 65.1714</code></pre>
</div>
<div id="ヨハンセン検定" class="section level3 hasAnchor" number="9.7.6">
<h3><span class="header-section-number">9.7.6</span> ヨハンセン検定<a href="09_var.html#ヨハンセン検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>変数間の共和分関係を判断するためのもう一つの方法が、<strong>ヨハンセン検定（Johansen test）</strong>です。エングル＝グレンジャー検定（フィリップ＝オーリアリス検定）が2変数の間の共和分の有無を判断する方法であるのに対し、ヨハンセン検定は2つ以上の多変数の間に共和分関係がいくつ存在するか判断します。</p>
<p>ヨハンセン検定には<strong>トレース検定（trace test）</strong>と<strong>最大固有値検定（maximum eigenvalue test）</strong>の2つの検定方法があります。</p>
<p>トレース検定の帰無仮説<span class="math inline">\(H_0\)</span>は「変数間に<span class="math inline">\(r\)</span>個の共和分関係が存在する」、対立仮説<span class="math inline">\(H_1\)</span>は「変数は全て定常な<span class="math inline">\(I(0)\)</span>過程である」です。通常は、分析対象の各変数に対して事前に単位根検定を行い、非定常な<span class="math inline">\(I(1)\)</span>過程の変数がある場合に共和分検定を行うため、トレース検定で対立仮説を採択するケースはないと想定されます。</p>
<p>最大固有値検定の帰無仮説<span class="math inline">\(H_0\)</span>は「変数間に最大で<span class="math inline">\(r\)</span>個の共和分関係が存在する」、対立仮説<span class="math inline">\(H_1\)</span>は「変数間に<span class="math inline">\(r+1\)</span>個の共和分関係が存在する」です。トレース検定に比べ、最大固有値検定では共和分関係の数をより細かく検討することができます。</p>
<p>ヨハンセン検定の具体的なフローは次のとおりです。</p>
<p>まず、分析対象のデータセットに含まれる各変数について単位根検定を行い、定常な<span class="math inline">\(I(0)\)</span>変数と非定常な<span class="math inline">\(I(1)\)</span>変数がそれぞれいくつあるか確認します。データセットに<span class="math inline">\(I(0)\)</span>変数が<span class="math inline">\(K_0\)</span>個、<span class="math inline">\(I(1)\)</span>変数が<span class="math inline">\(K_1\)</span>個含まれるとすると、ヨハンセン検定で検出される共和分関係の数の最小値は<span class="math inline">\(K_0\)</span>、最大値は<span class="math inline">\(K_0+K_1-1\)</span>になります。</p>
<p>次に、ヨハンセン検定に必要な事前情報としてラグ次数<span class="math inline">\(p\)</span>を確認します。ラグ次数<span class="math inline">\(p\)</span>は、次に説明するベクトル自己回帰（VAR）モデルを暫定的に推定して決定します。ラグ次数を選択するための情報量規準には、赤池情報量規準（Akaike Information Criterion、AIC）、赤池最終予測誤差（Akaike’s Final Prediction Error、FPE）、ハナン＝クイン情報量規準（Hannan-Quinn Information Criterion、HQ）、シュワルツのベイズ情報量規準（Schwarz Bayesian Information Criterion、SC）を用います。これら3つの情報量規準が選ぶラグ次数には、<span class="math inline">\(\mathit{SC} \leq \mathit{HQ} \leq \mathit{AIC} \fallingdotseq \mathit{FPE}\)</span>の関係があります。時系列データのサンプルサイズが大きい場合はSCを、小さい場合はAICかFPEを、どちらか迷う場合はHQを選択してください（村尾（2019）P.117）。</p>
<p>また、同様に事前情報として、共和分関係を表す式に定数項・トレンド項を含むか否かを、想定する共和分関係に基づいて設定します。定数項・トレンド項の有無で検定の棄却点が変化し、結果が変わりうるため、設定には注意を要します。</p>
<p>最後にヨハンセン検定を実行します。帰無仮説における共和分関係の数を<span class="math inline">\(H_0:r=0\)</span>、<span class="math inline">\(H_0:r=1\)</span>、<span class="math inline">\(H_0:r=2\)</span>と一つずつ増やしてトレース検定・最大固有値検定を繰り返し、帰無仮説<span class="math inline">\(H_0\)</span>が初めて棄却できなくなった時の<span class="math inline">\(r\)</span>を共和分関係の数と判断します。トレース検定で大まかな共和分関係の数を把握し、最大固有値検定で細かく見て最終的な共和分関係の数を決定します。</p>
<p>なお、ヨハンセン検定の詳細については、村尾（2019）7.3「ヨハンセン検定」（P.153〜）、西山 他（2019）第12章「ヨハンセン検定」（P.608〜）及び「補論」（P.626〜）を参照してください。</p>
</div>
<div id="ヨハンセン検定フロー自作関数" class="section level3 hasAnchor" number="9.7.7">
<h3><span class="header-section-number">9.7.7</span> ヨハンセン検定フロー自作関数<a href="09_var.html#ヨハンセン検定フロー自作関数" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>本書では、ヨハンセン検定フローを分析対象の時系列データセットに自動で適用する自作関数<code>johansen_test_flow()</code>を定義します。</p>
<p><code>johansen_test_flow()</code>自作関数の引数は次のとおりです。</p>
<ul>
<li><code>data</code>：ヨハンセン検定を適用する時系列データセット。数値型データを格納したdata.frame形式（tibble形式を含む）もしくはts形式のデータセットを指定します。</li>
<li><code>lag_criterion</code>：ラグ次数の選択基準。<code>"AIC"</code>、<code>"HQ"</code>、<code>"SC"</code>、<code>"Fixed"</code>のうち1つを指定します。<code>"AIC"</code>、<code>"HQ"</code>、<code>"SC"</code>を指定すると、それぞれ赤池情報量規準（Akaike Information Criterion）、ハナン＝クイン情報量規準（Hannan-Quinn Information Criterion）、シュワルツのベイズ情報量規準（Schwarz Bayesian Information Criterion）に基づき最適なラグ次数が自動で選択されます（このとき<code>lags_max</code>引数に指定した値が自動で選択されるラグ次数の上限になります）。<code>"Fixed"</code>を指定する場合は、適用するラグ次数を<code>lags_fixed</code>引数に手動で指定します。</li>
<li><code>lags_max</code>：ラグ次数の最大値（正の整数、デフォルト値は10）。<code>lag_criterion</code>引数に<code>"AIC"</code>、<code>"HQ"</code>、<code>"BIC"</code>を指定した場合に使用します。</li>
<li><code>lags_fixed</code>：ラグ次数（正の整数、デフォルト値は1）。<code>lag_criterion</code>引数に<code>"Fixed"</code>を指定した場合に使用します。</li>
<li><code>var_type</code>：ラグ次数を決定するために事前推定するVARモデルに含む確定項。<code>"const"</code>、<code>"trend"</code>、<code>"both"</code>、<code>"none"</code>のうち1つを指定します。<code>lag_criterion</code>引数に<code>"AIC"</code>、<code>"HQ"</code>、<code>"BIC"</code>を指定した場合に使用します。</li>
<li><code>johansen_spec</code>：ヨハンセン検定において、共和分関係の均衡からの誤差修正が一時的（<code>"transitory"</code>）か、長期的（<code>"longrun"</code>）かを指定します。</li>
<li><code>sig_level</code>：有意水準。0.01、0.05、0.1の3つのうち1つを指定します。</li>
</ul>
<p>これらの引数を設定して<code>johansen_test_flow()</code>自作関数を実行すると、共和分関係式にトレンド項を含むモデル、定数項を含むモデル、トレンド項・定数項どちらも含まないモデル、の3種類のヨハンセン検定フローの結果を格納したリストが返ります。</p>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb962-1"><a href="09_var.html#cb962-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(docstring)</span>
<span id="cb962-2"><a href="09_var.html#cb962-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb962-3"><a href="09_var.html#cb962-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 時系列データセットに対しヨハンセン検定フローを自動で適用する関数</span></span>
<span id="cb962-4"><a href="09_var.html#cb962-4" aria-hidden="true" tabindex="-1"></a>johansen_test_flow <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">lag_criterion =</span> <span class="fu">c</span>(<span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;HQ&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;Fixed&quot;</span>), <span class="at">lags_max =</span> <span class="dv">10</span>, <span class="at">var_type =</span> <span class="fu">c</span>(<span class="st">&quot;const&quot;</span>, <span class="st">&quot;trend&quot;</span>, <span class="st">&quot;both&quot;</span>, <span class="st">&quot;none&quot;</span>), <span class="at">lags_fixed =</span> <span class="dv">1</span>, <span class="at">johansen_spec =</span> <span class="fu">c</span>(<span class="st">&quot;transitory&quot;</span>, <span class="st">&quot;longrun&quot;</span>), <span class="at">sig_level =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>)) {</span>
<span id="cb962-5"><a href="09_var.html#cb962-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb962-6"><a href="09_var.html#cb962-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; Automatic Johansen Cointegration Test Flow</span></span>
<span id="cb962-7"><a href="09_var.html#cb962-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; </span></span>
<span id="cb962-8"><a href="09_var.html#cb962-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @description</span></span>
<span id="cb962-9"><a href="09_var.html#cb962-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; This function automatically performs the test flow of the Johansen cointegration test. Written by Naoki Hattori.</span></span>
<span id="cb962-10"><a href="09_var.html#cb962-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; </span></span>
<span id="cb962-11"><a href="09_var.html#cb962-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param data Numeric data frame or ts/mts. Time series data set for Johansen test.</span></span>
<span id="cb962-12"><a href="09_var.html#cb962-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param lag_criterion Character. Specifies how the lag order is set. &quot;AIC&quot; for Akaike Information Criterion, &quot;HQ&quot; for Hannan-Quinn Information Criterion, &quot;SC&quot; for Schwarz Bayesian Information Criterion. The maximum number of lags considered is set by lags_max. &quot;Fixed&quot; for manually set by lags_fixed.</span></span>
<span id="cb962-13"><a href="09_var.html#cb962-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param lags_max Integer. Specifies maximum number of lags considered when choose &quot;AIC&quot;, &quot;HQ&quot; or &quot;SC&quot; for lag_criterion. Default is 10.</span></span>
<span id="cb962-14"><a href="09_var.html#cb962-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param lags_fixed Integer. Specifies the lag order manually when choose &quot;Fixed&quot; for lag_criterion. Default is 1.</span></span>
<span id="cb962-15"><a href="09_var.html#cb962-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param var_type Character. Type of deterministic regressors to include in Pre-estimated VAR model.</span></span>
<span id="cb962-16"><a href="09_var.html#cb962-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param johansen_spec Character. Determines the specification of the VECM, &quot;transitory&quot; or &quot;longrun&quot;.</span></span>
<span id="cb962-17"><a href="09_var.html#cb962-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; @param sig_level Numeric. Significance level, either 0.01, 0.05, 0.1.</span></span>
<span id="cb962-18"><a href="09_var.html#cb962-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb962-19"><a href="09_var.html#cb962-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 引数sig_levelをurca::ur_df()関数用に文字列へ変換</span></span>
<span id="cb962-20"><a href="09_var.html#cb962-20" aria-hidden="true" tabindex="-1"></a>  sig_level_str <span class="ot">&lt;-</span> <span class="fu">str_c</span>(sig_level <span class="sc">*</span> <span class="dv">100</span>, <span class="st">&quot;pct&quot;</span>)</span>
<span id="cb962-21"><a href="09_var.html#cb962-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb962-22"><a href="09_var.html#cb962-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ラグ次数を決定</span></span>
<span id="cb962-23"><a href="09_var.html#cb962-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lag_criterion <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;AIC&quot;</span>, <span class="st">&quot;HQ&quot;</span>, <span class="st">&quot;SC&quot;</span>)) {</span>
<span id="cb962-24"><a href="09_var.html#cb962-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># VARモデルを事前推定</span></span>
<span id="cb962-25"><a href="09_var.html#cb962-25" aria-hidden="true" tabindex="-1"></a>    model_varselect <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VARselect</span>(<span class="at">y =</span> data, <span class="at">lag.max =</span> lags_max, <span class="at">type =</span> var_type, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exogen =</span> <span class="cn">NULL</span>)</span>
<span id="cb962-26"><a href="09_var.html#cb962-26" aria-hidden="true" tabindex="-1"></a>    lags <span class="ot">&lt;-</span> model_varselect<span class="sc">$</span>selection[<span class="fu">str_c</span>(lag_criterion, <span class="st">&quot;(n)&quot;</span>)] <span class="sc">%&gt;%</span> <span class="fu">unname</span>()</span>
<span id="cb962-27"><a href="09_var.html#cb962-27" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb962-28"><a href="09_var.html#cb962-28" aria-hidden="true" tabindex="-1"></a>    lags <span class="ot">&lt;-</span> lags_fixed</span>
<span id="cb962-29"><a href="09_var.html#cb962-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb962-30"><a href="09_var.html#cb962-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb962-31"><a href="09_var.html#cb962-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 結果を格納するリストを作成</span></span>
<span id="cb962-32"><a href="09_var.html#cb962-32" aria-hidden="true" tabindex="-1"></a>  res_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb962-33"><a href="09_var.html#cb962-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb962-34"><a href="09_var.html#cb962-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ヨハンセン検定に含む確定項のループ</span></span>
<span id="cb962-35"><a href="09_var.html#cb962-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ecdet <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;trend&quot;</span>, <span class="st">&quot;const&quot;</span>, <span class="st">&quot;none&quot;</span>)) {</span>
<span id="cb962-36"><a href="09_var.html#cb962-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb962-37"><a href="09_var.html#cb962-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ヨハンセン検定</span></span>
<span id="cb962-38"><a href="09_var.html#cb962-38" aria-hidden="true" tabindex="-1"></a>    test_trace <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">ca.jo</span>(<span class="at">x =</span> data, <span class="at">type =</span> <span class="st">&quot;trace&quot;</span>, <span class="at">ecdet =</span> ecdet, <span class="at">K =</span> lags, <span class="at">spec =</span> johansen_spec, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">dumvar =</span> <span class="cn">NULL</span>)</span>
<span id="cb962-39"><a href="09_var.html#cb962-39" aria-hidden="true" tabindex="-1"></a>    test_eigen <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">ca.jo</span>(<span class="at">x =</span> data, <span class="at">type =</span> <span class="st">&quot;eigen&quot;</span>, <span class="at">ecdet =</span> ecdet, <span class="at">K =</span> lags, <span class="at">spec =</span> johansen_spec, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">dumvar =</span> <span class="cn">NULL</span>)</span>
<span id="cb962-40"><a href="09_var.html#cb962-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb962-41"><a href="09_var.html#cb962-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># traceテストの結果を格納したtibbleを作成</span></span>
<span id="cb962-42"><a href="09_var.html#cb962-42" aria-hidden="true" tabindex="-1"></a>    res_trace <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="st">`</span><span class="at">タイプ</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;trace&quot;</span>,</span>
<span id="cb962-43"><a href="09_var.html#cb962-43" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">確定項</span><span class="st">`</span> <span class="ot">=</span> ecdet,</span>
<span id="cb962-44"><a href="09_var.html#cb962-44" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> lags,</span>
<span id="cb962-45"><a href="09_var.html#cb962-45" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">共和分関係の数</span><span class="st">`</span> <span class="ot">=</span> test_trace<span class="sc">@</span>cval <span class="sc">%&gt;%</span> <span class="fu">rownames</span>() <span class="sc">%&gt;%</span> <span class="fu">rev</span>() <span class="sc">%&gt;%</span> <span class="fu">str_extract</span>(<span class="st">&quot;[0-9]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb962-46"><a href="09_var.html#cb962-46" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> test_trace<span class="sc">@</span>cval[, sig_level_str] <span class="sc">%&gt;%</span> <span class="fu">rev</span>() <span class="sc">%&gt;%</span> <span class="fu">unname</span>(),</span>
<span id="cb962-47"><a href="09_var.html#cb962-47" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> test_trace<span class="sc">@</span>teststat <span class="sc">%&gt;%</span> <span class="fu">rev</span>(),</span>
<span id="cb962-48"><a href="09_var.html#cb962-48" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">判断</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span></span>
<span id="cb962-49"><a href="09_var.html#cb962-49" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb962-50"><a href="09_var.html#cb962-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb962-51"><a href="09_var.html#cb962-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(res_trace)[<span class="dv">1</span>]) {</span>
<span id="cb962-52"><a href="09_var.html#cb962-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (res_trace<span class="sc">$</span>検定値[i] <span class="sc">&gt;=</span> res_trace<span class="sc">$</span>棄却点[i]) {</span>
<span id="cb962-53"><a href="09_var.html#cb962-53" aria-hidden="true" tabindex="-1"></a>        res_trace<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;H0：共和分関係の数＝&quot;</span>, res_trace<span class="sc">$</span>共和分関係の数[i], <span class="st">&quot;を棄却&quot;</span>)</span>
<span id="cb962-54"><a href="09_var.html#cb962-54" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb962-55"><a href="09_var.html#cb962-55" aria-hidden="true" tabindex="-1"></a>        res_trace<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;共和分関係の数＝&quot;</span>, res_trace<span class="sc">$</span>共和分関係の数[i], <span class="st">&quot;と判断&quot;</span>)</span>
<span id="cb962-56"><a href="09_var.html#cb962-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb962-57"><a href="09_var.html#cb962-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb962-58"><a href="09_var.html#cb962-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb962-59"><a href="09_var.html#cb962-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb962-60"><a href="09_var.html#cb962-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># eigenテストの結果を格納したtibbleを作成</span></span>
<span id="cb962-61"><a href="09_var.html#cb962-61" aria-hidden="true" tabindex="-1"></a>    res_eigen <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="st">`</span><span class="at">タイプ</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;eigen&quot;</span>,</span>
<span id="cb962-62"><a href="09_var.html#cb962-62" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">確定項</span><span class="st">`</span> <span class="ot">=</span> ecdet,</span>
<span id="cb962-63"><a href="09_var.html#cb962-63" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">ラグ次数</span><span class="st">`</span> <span class="ot">=</span> lags,</span>
<span id="cb962-64"><a href="09_var.html#cb962-64" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">共和分関係の数</span><span class="st">`</span> <span class="ot">=</span> test_eigen<span class="sc">@</span>cval <span class="sc">%&gt;%</span> <span class="fu">rownames</span>() <span class="sc">%&gt;%</span> <span class="fu">rev</span>() <span class="sc">%&gt;%</span> <span class="fu">str_extract</span>(<span class="st">&quot;[0-9]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb962-65"><a href="09_var.html#cb962-65" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">棄却点</span><span class="st">`</span> <span class="ot">=</span> test_eigen<span class="sc">@</span>cval[, sig_level_str] <span class="sc">%&gt;%</span> <span class="fu">rev</span>() <span class="sc">%&gt;%</span> <span class="fu">unname</span>(),</span>
<span id="cb962-66"><a href="09_var.html#cb962-66" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">検定値</span><span class="st">`</span> <span class="ot">=</span> test_eigen<span class="sc">@</span>teststat <span class="sc">%&gt;%</span> <span class="fu">rev</span>(),</span>
<span id="cb962-67"><a href="09_var.html#cb962-67" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">判断</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span></span>
<span id="cb962-68"><a href="09_var.html#cb962-68" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb962-69"><a href="09_var.html#cb962-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb962-70"><a href="09_var.html#cb962-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(res_eigen)[<span class="dv">1</span>]) {</span>
<span id="cb962-71"><a href="09_var.html#cb962-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (res_eigen<span class="sc">$</span>検定値[i] <span class="sc">&gt;=</span> res_eigen<span class="sc">$</span>棄却点[i]) {</span>
<span id="cb962-72"><a href="09_var.html#cb962-72" aria-hidden="true" tabindex="-1"></a>        res_eigen<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;H0：共和分関係の数＝&quot;</span>, res_eigen<span class="sc">$</span>共和分関係の数[i], <span class="st">&quot;を棄却&quot;</span>)</span>
<span id="cb962-73"><a href="09_var.html#cb962-73" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb962-74"><a href="09_var.html#cb962-74" aria-hidden="true" tabindex="-1"></a>        res_eigen<span class="sc">$</span>判断[i] <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;共和分関係の数＝&quot;</span>, res_eigen<span class="sc">$</span>共和分関係の数[i], <span class="st">&quot;と判断&quot;</span>)</span>
<span id="cb962-75"><a href="09_var.html#cb962-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb962-76"><a href="09_var.html#cb962-76" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb962-77"><a href="09_var.html#cb962-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb962-78"><a href="09_var.html#cb962-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb962-79"><a href="09_var.html#cb962-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># traceテストとeigenテストの結果を結合してres_listに格納</span></span>
<span id="cb962-80"><a href="09_var.html#cb962-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">&quot;res_list &lt;- append(res_list, list(&quot;</span>, ecdet, <span class="st">&quot;= rbind(res_trace, res_eigen)))&quot;</span>)))</span>
<span id="cb962-81"><a href="09_var.html#cb962-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb962-82"><a href="09_var.html#cb962-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res_list)</span>
<span id="cb962-83"><a href="09_var.html#cb962-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb962-84"><a href="09_var.html#cb962-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb962-85"><a href="09_var.html#cb962-85" aria-hidden="true" tabindex="-1"></a><span class="co"># docstring::docstring(johansen_test_flow)</span></span></code></pre></div>
</div>
<div id="実例ヨハンセン検定" class="section level3 hasAnchor" number="9.7.8">
<h3><span class="header-section-number">9.7.8</span> 実例：ヨハンセン検定<a href="09_var.html#実例ヨハンセン検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>定義した自作関数<code>johansen_test_flow()</code>を用い、村尾（2019）「7.4 ヨハンセン検定の例」（P.158）及び、「7.7 Rによるヨハンセン検定」（P.166）の例を再現します。</p>
<p>村尾（2019）7.4及び7.7では、<code>vars</code>パッケージの<code>Canada</code>データセットに含まれるカナダの実質労働生産性（<code>prod</code>、自然対数×100）、雇用者数（<code>e</code>、自然対数×100）、失業率（<code>U</code>、％）、実質賃金（<code>rw</code>、自然対数×100）の4変数（サンプルサイズ84）に対し、ヨハンセン検定を適用しています。なお、<code>Canada</code>データセットのデータ頻度は四半期であり、期間は1980年1-3月期〜2000年10-12月期です。</p>
<p>村尾（2019）P.158には、「検定対象の変数は、単位根検定（ADF検定）において、それぞれ<span class="math inline">\(I(1)\)</span>過程と判断した4個の変数である」との記載がありますが、ADF検定フロー自作関数の<code>adf_test_flow()</code>でADF検定を実施したところ、有意水準5％では<code>Canada</code>データセットの実質賃金<code>rw</code>は<span class="math inline">\(I(1)\)</span>過程ではなく<span class="math inline">\(I(0)\)</span>過程と判断できます。すると4変数のうち<code>I(1)</code>過程の変数は3変数であり、共和分関係の数は最大で2になります。</p>
<p><code>johansen_test_flow()</code>自作関数における事前推定VARモデルのオプションでは、ラグ次数選択基準の<code>lag_criterion</code>にHannan-Quinn情報量規準を意味する<code>"HQ"</code>を、確定項の<code>ver_type</code>にトレンド項と定数項の両方を意味する<code>"both"</code>を指定します。また、ヨハンセン検定のオプションでは、誤差修正スペックを意味する<code>johansen_spec</code>に「一時的」を意味する<code>"transitory"</code>を指定します。なお、村尾（2019）7.4及び7.7では検定の優位水準を10％としていますが、ここでは5％を指定します。</p>
<p><code>johansen_test_flow()</code>自作関数を実行した結果、trendモデルとnoneモデルでは共和分関係の数が1、constモデルでは2と判断されました（ラグ次数は何も2次）。なお、トレース検定と最大固有値検定の結果はどのモデルにおいても一致しています。村尾（2019）7.4及び7.7ではtrendモデルを採用し、共和分関係の数を1と判断しています。</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="09_var.html#cb963-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb963-2"><a href="09_var.html#cb963-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb963-3"><a href="09_var.html#cb963-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb963-4"><a href="09_var.html#cb963-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaにヨハンセン検定フローを適用</span></span>
<span id="cb963-5"><a href="09_var.html#cb963-5" aria-hidden="true" tabindex="-1"></a>jo_canada <span class="ot">&lt;-</span> <span class="fu">johansen_test_flow</span>(<span class="at">data =</span> Canada, <span class="co"># ヨハンセン検定を行う時系列データセット</span></span>
<span id="cb963-6"><a href="09_var.html#cb963-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lag_criterion =</span> <span class="st">&quot;HQ&quot;</span>, <span class="co"># 事前推定VARモデルでラグ次数を決定する情報量規準</span></span>
<span id="cb963-7"><a href="09_var.html#cb963-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lags_max =</span> <span class="dv">10</span>, <span class="co"># 最大ラグ次数</span></span>
<span id="cb963-8"><a href="09_var.html#cb963-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">var_type =</span> <span class="st">&quot;both&quot;</span>, <span class="co"># 事前推定VARモデルに含む確定項</span></span>
<span id="cb963-9"><a href="09_var.html#cb963-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">johansen_spec =</span> <span class="st">&quot;transitory&quot;</span>, <span class="co"># 共和分関係の均衡からの乖離が一時的・長期的か（&quot;transitory&quot;, &quot;longrun&quot;）</span></span>
<span id="cb963-10"><a href="09_var.html#cb963-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb963-11"><a href="09_var.html#cb963-11" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb963-12"><a href="09_var.html#cb963-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb963-13"><a href="09_var.html#cb963-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果をコンソールに表示</span></span>
<span id="cb963-14"><a href="09_var.html#cb963-14" aria-hidden="true" tabindex="-1"></a>jo_canada<span class="sc">$</span>trend</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["タイプ"],"name":[1],"type":["chr"],"align":["left"]},{"label":["確定項"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[3],"type":["int"],"align":["right"]},{"label":["共和分関係の数"],"name":[4],"type":["int"],"align":["right"]},{"label":["棄却点"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["判断"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"trace","2":"trend","3":"2","4":"0","5":"62.99","6":"86.116246","7":"H0：共和分関係の数＝0を棄却"},{"1":"trace","2":"trend","3":"2","4":"1","5":"42.44","6":"37.333030","7":"共和分関係の数＝1と判断"},{"1":"trace","2":"trend","3":"2","4":"2","5":"25.32","6":"15.645187","7":"NA"},{"1":"trace","2":"trend","3":"2","4":"3","5":"12.25","6":"4.100722","7":"NA"},{"1":"eigen","2":"trend","3":"2","4":"0","5":"31.46","6":"48.783216","7":"H0：共和分関係の数＝0を棄却"},{"1":"eigen","2":"trend","3":"2","4":"1","5":"25.54","6":"21.687844","7":"共和分関係の数＝1と判断"},{"1":"eigen","2":"trend","3":"2","4":"2","5":"18.96","6":"11.544465","7":"NA"},{"1":"eigen","2":"trend","3":"2","4":"3","5":"12.25","6":"4.100722","7":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="09_var.html#cb964-1" aria-hidden="true" tabindex="-1"></a>jo_canada<span class="sc">$</span>const</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["タイプ"],"name":[1],"type":["chr"],"align":["left"]},{"label":["確定項"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[3],"type":["int"],"align":["right"]},{"label":["共和分関係の数"],"name":[4],"type":["int"],"align":["right"]},{"label":["棄却点"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["判断"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"trace","2":"const","3":"2","4":"0","5":"53.12","6":"105.84390","7":"H0：共和分関係の数＝0を棄却"},{"1":"trace","2":"const","3":"2","4":"1","5":"34.91","6":"42.30610","7":"H0：共和分関係の数＝1を棄却"},{"1":"trace","2":"const","3":"2","4":"2","5":"19.96","6":"17.39156","7":"共和分関係の数＝2と判断"},{"1":"trace","2":"const","3":"2","4":"3","5":"9.24","6":"6.87957","7":"NA"},{"1":"eigen","2":"const","3":"2","4":"0","5":"28.14","6":"63.53780","7":"H0：共和分関係の数＝0を棄却"},{"1":"eigen","2":"const","3":"2","4":"1","5":"22.00","6":"24.91455","7":"H0：共和分関係の数＝1を棄却"},{"1":"eigen","2":"const","3":"2","4":"2","5":"15.67","6":"10.51199","7":"共和分関係の数＝2と判断"},{"1":"eigen","2":"const","3":"2","4":"3","5":"9.24","6":"6.87957","7":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="09_var.html#cb965-1" aria-hidden="true" tabindex="-1"></a>jo_canada<span class="sc">$</span>none</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["タイプ"],"name":[1],"type":["chr"],"align":["left"]},{"label":["確定項"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[3],"type":["int"],"align":["right"]},{"label":["共和分関係の数"],"name":[4],"type":["int"],"align":["right"]},{"label":["棄却点"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["判断"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"trace","2":"none","3":"2","4":"0","5":"48.28","6":"75.9321088","7":"H0：共和分関係の数＝0を棄却"},{"1":"trace","2":"none","3":"2","4":"1","5":"31.52","6":"28.5951793","7":"共和分関係の数＝1と判断"},{"1":"trace","2":"none","3":"2","4":"2","5":"17.95","6":"8.9710543","7":"NA"},{"1":"trace","2":"none","3":"2","4":"3","5":"8.18","6":"0.3227339","7":"NA"},{"1":"eigen","2":"none","3":"2","4":"0","5":"27.14","6":"47.3369295","7":"H0：共和分関係の数＝0を棄却"},{"1":"eigen","2":"none","3":"2","4":"1","5":"21.07","6":"19.6241250","7":"共和分関係の数＝1と判断"},{"1":"eigen","2":"none","3":"2","4":"2","5":"14.90","6":"8.6483204","7":"NA"},{"1":"eigen","2":"none","3":"2","4":"3","5":"8.18","6":"0.3227339","7":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="varモデル" class="section level2 hasAnchor" number="9.8">
<h2><span class="header-section-number">9.8</span> VARモデル<a href="09_var.html#varモデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>ベクトル自己回帰（Vector AutoRegression、VAR）モデル</strong>は、多変量時系列モデルの一種です。VARモデルでは、将来予測やシミュレーションに加えて、複数の時系列データ間の相互作用を分析することができます。</p>
<div id="レベルvarモデル" class="section level3 hasAnchor" number="9.8.1">
<h3><span class="header-section-number">9.8.1</span> レベルVARモデル<a href="09_var.html#レベルvarモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>をモデル化したラグ次数1のVARモデル<span class="math inline">\(VAR(1)\)</span>は、次のように表すことができます。<span class="math inline">\(t\)</span>期の変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>が、それぞれ<span class="math inline">\(t-1\)</span>期の<span class="math inline">\(Y_{1,t-1}\)</span>と<span class="math inline">\(Y_{2,t-1}\)</span>によって説明されています。</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= b_{10} + b_{11,1}Y_{1,t-1} + b_{12,1}Y_{2,t-1} + u_{1,t} \\
Y_{2,t} &amp;= b_{20} + b_{21,1}Y_{1,t-1} + b_{22,1}Y_{2,t-1} + u_{2,t}
\end{aligned}
\]</span></p>
<p>誤差項<span class="math inline">\(u_{1,t}\)</span>と<span class="math inline">\(u_{2,t}\)</span>は定常なホワイトノイズであり、過去の自身の誤差項とは相関していない（誤差項に系列相関がない）と仮定します。ただし、同時点の誤差項<span class="math inline">\(u_{1,t}\)</span>、<span class="math inline">\(u_{2,t}\)</span>の間には相関関係があります（その理由は、後の「構造VARモデル」で明らかになります）。なお、VARモデルでは誤差項（error term）を撹乱項（disturbance term）と呼ぶことがありますが、意味は同じです（村尾（2019）P.90）。</p>
<p>上記のモデルでは、変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>がともに<span class="math inline">\(I(0)\)</span>過程であることが前提になっています。定常過程の線型結合は必ず定常過程になる（ここでは、<span class="math inline">\(c_1Y_{1,t} + c_2Y_{2,t} \sim I(0)\)</span>）ため、変数が全て<span class="math inline">\(I(0)\)</span>過程であればVARモデルの各式の左辺・右辺がどちらも<span class="math inline">\(I(0)\)</span>になり、VARモデル全体が定常になります（村尾（2019）P.94）。このように、定常な時系列データを原系列のまま用いて構築するVARモデルを<strong>レベルVARモデル</strong>と言います。</p>
<p>一般的に、<span class="math inline">\(n\)</span>個の変数を持つラグ次数<span class="math inline">\(p\)</span>のVARモデルを<span class="math inline">\(\mathit{VAR}(p)\)</span>と表記します。</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \boldsymbol{B_0} + \boldsymbol{B}_1\boldsymbol{Y}_{t-1} + \cdots + \boldsymbol{B}_{p}\boldsymbol{Y}_{t-p} + \boldsymbol{u}_t
\]</span></p>
<p>ここで、<span class="math inline">\(\boldsymbol{Y}_t\)</span>は<span class="math inline">\(n\)</span>個の変数ベクトル、<span class="math inline">\(\boldsymbol{B_0}\)</span>は<span class="math inline">\(n \times 1\)</span>の定数ベクトル、<span class="math inline">\(\boldsymbol{B}_1\)</span>〜<span class="math inline">\(\boldsymbol{B}_p\)</span>は<span class="math inline">\(n \times n\)</span>個の係数行列、<span class="math inline">\(\boldsymbol{u}_t\)</span>は<span class="math inline">\(n\)</span>個の誤差項ベクトルです。</p>
<p>このレベルVARモデル<span class="math inline">\(VAR(p)\)</span>が定常になるには、<span class="math inline">\(\boldsymbol{Y}_t\)</span>の<span class="math inline">\(n\)</span>個の変数が全て定常であることが必要です。</p>
</div>
<div id="階差varモデル" class="section level3 hasAnchor" number="9.8.2">
<h3><span class="header-section-number">9.8.2</span> 階差VARモデル<a href="09_var.html#階差varモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>レベルVARモデルでは全ての変数が定常であることを前提としていましたが、次に変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>が非定常な<span class="math inline">\(I(1)\)</span>過程のケースを考えます。</p>
<ul>
<li><p>1つの変数が<span class="math inline">\(I(1)\)</span>のケース</p>
<p>このケースでは、変数そのものが<span class="math inline">\(I(1)\)</span>であることに加え、変数の線型結合<span class="math inline">\(c_1Y_{1,t} + c_2Y_{2,t}\)</span>も必ず<span class="math inline">\(I(1)\)</span>過程になります。</p></li>
<li><p>全ての変数が<span class="math inline">\(I(1)\)</span>過程のケース</p>
<p>このケースでは、変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>がどちらも<span class="math inline">\(I(1)\)</span>過程であり、さらに両者の間に共和分の関係がない場合（すなわち「見せかけの回帰」の場合）には変数の線形結合<span class="math inline">\(c_1Y_{1,t} + c_2Y_{2,t}\)</span>も<span class="math inline">\(I(1)\)</span>過程になります。</p></li>
</ul>
<p>VARモデルの各式の項に一つでも<span class="math inline">\(I(1)\)</span>過程の項があれば、VARモデル全体が非定常になります。非定常なVARモデルには標準的な推定法が使えないため、VARモデル全体を定常化する必要があります（村尾（2019）P.101）。</p>
<p>上記の2つのケースでVARモデルを定常化するには、ボックス＝ジェンキンス法におけるARMAモデルとARIMAモデルの関係と同様に、変数を階差変換します。変数を階差変換すると、変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>に加えて、線形結合<span class="math inline">\(c_1\Delta{Y_{1,t}} + c_2\Delta{Y_{2,t}}\)</span>が<span class="math inline">\(I(0)\)</span>になり、VARモデル全体が定常になります（村尾（2019）P.96）。このように、時系列データを階差変換して構築するVARモデルを<strong>階差VARモデル</strong>と言います。</p>
</div>
<div id="vecモデル" class="section level3 hasAnchor" number="9.8.3">
<h3><span class="header-section-number">9.8.3</span> VECモデル<a href="09_var.html#vecモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>がどちらも<span class="math inline">\(I(1)\)</span>過程であり、かつ両者が共和分の関係にある場合は、変数の線型結合<span class="math inline">\(c_1Y_{1,t} + c_2Y_{2,t}\)</span>が<span class="math inline">\(I(0)\)</span>過程になります。こうした共和分の関係は、変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>の間に経済学的な均衡関係が成立していると解釈できます。</p>
<p>このとき、変数<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>それぞれは<span class="math inline">\(I(1)\)</span>変数なので、レベルVARモデルはモデル全体が定常になりません。しかし、定常性を確保するために階差変換して階差VARモデルを構築すると、共和分による均衡関係の情報が失われてしまいます。</p>
<p>このようなケースにおいて、共和分の関係を活かしつつモデルを定常化する方法が、<strong>ベクトル誤差修正（Vector Error Correction、VEC）モデル</strong>です（村尾（2019）P.101）。</p>
<p>まず、<span class="math inline">\(n\)</span>個の変数を持つラグ次数2のVARモデル：<span class="math inline">\(\mathit{VAR}(2)\)</span>を考えます。</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \boldsymbol{B}_1\boldsymbol{Y}_{t-1} + \boldsymbol{B}_{2}\boldsymbol{Y}_{t-2} + \boldsymbol{u}_t
\]</span></p>
<p>この両辺から<span class="math inline">\(\boldsymbol{Y}_{t-1}\)</span>を引いて式を整理すると、</p>
<p><span class="math display">\[
\Delta \boldsymbol{Y}_t = \boldsymbol{\Pi}\boldsymbol{Y}_{t-1} + \boldsymbol{\Gamma}_{1}\Delta\boldsymbol{Y}_{t-1} + \boldsymbol{u}_t
\]</span></p>
<p>となります。なお、<span class="math inline">\(\boldsymbol{\Pi} = - \boldsymbol{I}_n + \boldsymbol{B}_1 + \boldsymbol{B}_2\)</span>、<span class="math inline">\(\boldsymbol{\Gamma}_1 = - \boldsymbol{B}_2\)</span>であり、また<span class="math inline">\(\boldsymbol{I}_n\)</span>は<span class="math inline">\(n \times n\)</span>の単位行列です。</p>
<p>ここで、変数ベクトルを階差変換した<span class="math inline">\(\boldsymbol{Y}_t\)</span>と<span class="math inline">\(\boldsymbol{Y}_{t-1}\)</span>は<span class="math inline">\(I(0)\)</span>であり、レベル型の線形結合<span class="math inline">\(\boldsymbol{\Pi}\boldsymbol{Y}_{t-1}\)</span>も<span class="math inline">\(I(0)\)</span>になります。したがって、このモデル全体で定常化が達成されています。</p>
<p>さらに、係数行列<span class="math inline">\(\boldsymbol{\Pi}\)</span>が<span class="math inline">\(\boldsymbol{\Pi} = \boldsymbol{\alpha}\boldsymbol{\beta&#39;}\)</span>に分解できるため、上の式は次のように書き換えることができ、</p>
<p><span class="math display">\[
\Delta \boldsymbol{Y}_t = \boldsymbol{\alpha}\boldsymbol{\beta&#39;}\boldsymbol{Y}_{t-1} + \boldsymbol{\Gamma}_{1}\Delta\boldsymbol{Y}_{t-1} + \boldsymbol{u}_t
\]</span></p>
<p>これをベクトル誤差修正（VEC）モデルと呼びます。</p>
<p>この場合はラグ次数1のVECモデルのため、<span class="math inline">\(\mathit{VEC}(1)\)</span>と表記します。このように、非定常なラグ次数2のレベルVARモデル：<span class="math inline">\(\mathit{VAR}(2) \sim I(1)\)</span>を、共和分関係を利用することで、定常なラグ次数1次のVECモデル：<span class="math inline">\(\mathit{VEC}(1) \sim I(0)\)</span>に変換することができます。</p>
<p>ベクトル誤差修正モデルには3つの要素があります。</p>
<ul>
<li><p><span class="math inline">\(\boldsymbol{\beta&#39;}\boldsymbol{Y}_{t-1}\)</span>：<strong>誤差修正項（error correction term）</strong>は、共和分関係で表される均衡関係からの一時的な乖離を表していると解釈できます。</p></li>
<li><p><span class="math inline">\(\boldsymbol{\beta}\)</span>：<strong>共和分行列（cointegration matrix）</strong>は、<span class="math inline">\(n\)</span>個の内生変数から共和分関係（均衡関係）を選び出す役割があります。</p></li>
<li><p><span class="math inline">\(\boldsymbol{\alpha}\)</span>：<strong>調整行列（adjusting matrix）</strong>は、一時的な乖離が均衡へ向かうスピードを表しています。</p></li>
</ul>
</div>
<div id="構造varモデル" class="section level3 hasAnchor" number="9.8.4">
<h3><span class="header-section-number">9.8.4</span> 構造VARモデル<a href="09_var.html#構造varモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここまで検討してきたVARモデルは、右辺が定数項、内生変数のラグ項、誤差項のみで構成されており、右辺に内生変数の同時点（ここでは<code>t</code>時点）の項が含まれていません。このようにモデルを内生変数について解き、内生変数の変動を先決変数（内生変数のラグ項および外生変数）のみで表す次のようなモデルを、<strong>誘導型（reduced form）モデル</strong>と呼びます（エンダース（2019）P.263）。</p>
<p>「レベルVARモデル」に記載したとおり、誘導VARモデルの誤差項<span class="math inline">\(u_{1,t}\)</span>、<span class="math inline">\(u_{2,t}\)</span>は互いに相関しています。従って、誘導VARモデルの誤差項<span class="math inline">\(u_{1,t}\)</span>、<span class="math inline">\(u_{2,t}\)</span>は変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>の純粋なショックではなく、経済学的に意味を持ちません。</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= b_{11,1}Y_{1,t-1} + b_{12,1}Y_{2,t-1} + u_{1,t} \\
Y_{2,t} &amp;= b_{21,1}Y_{1,t-1} + b_{22,1}Y_{2,t-1} + u_{2,t}
\end{aligned}
\]</span></p>
<p>一方、モデルを内生変数について解く前は、右辺に内生変数の同時点の項が含まれています。これは変数が過去の値からだけでなく同時点の値からも影響を受けることを意味しており、経済構造の実態を表していると考えられます（例えば拡張的財政政策による同時点のGDP押し上げなど）。このように、変数間の理論的な相互関係を明示した次のようなモデルを、<strong>構造型（structured form）モデル</strong>もしくは<strong>構造VARモデル（Structural VAR、SVAR）</strong>と呼びます。</p>
<p>構造VARモデルの誤差項<span class="math inline">\(\epsilon_{1,t}\)</span>、<span class="math inline">\(\epsilon_{2,t}\)</span>は、誘導VARモデルの誤差項と異なり、互いに相関していません。構造VARモデルの誤差項<span class="math inline">\(\epsilon_{1,t}\)</span>、<span class="math inline">\(\epsilon_{2,t}\)</span>は変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>の純粋なショックであり、経済学的に意味を持っています。そのため、構造VARモデルの誤差項は<strong>構造ショック（structural shock）</strong>とも呼ばれます。</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= a_{12,0}Y_{2,t} + a_{11,1}Y_{1,t-1} + a_{12,1}Y_{2,t-1} + \epsilon_{1,t} \\
Y_{2,t} &amp;= a_{21,0}Y_{1,t} + a_{21,1}Y_{1,t-1} + a_{22,1}Y_{2,t-1} + \epsilon_{2,t}
\end{aligned}
\]</span></p>
<p>VARモデルを予測にのみ用いる場合は、誘導VARモデルを推定すればOKです。一方で、VARモデルを経済構造の分析に用いる場合、すなわち、各変数に生じたショックがモデルを通じて将来の変数にどのように影響するか知りたい場合は、構造VARモデルを推定する必要があります（エンダース（2019）P.299）。</p>
<p>しかし、ここで問題が生じます。誘導VARモデルはOLSで直接推定できますが、構造VARモデルは右辺にある同時点の内生変数の項と誤差項が相関しており、直接推定することができません。したがって、構造VARモデルを推定するためには、構造VARモデルを内生変数について解いて誘導VARモデルに変換し、誘導VARモデルの推定結果を用いて元の構造的VARモデルのパラメータを再現する必要があります。このように誘導VARモデルから構造VARモデルのパラメータを再現することを、<strong>識別（identification）</strong>と呼びます（エンダース（2019）P.276）。</p>
<p>例として、次の構造VARモデル、</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= a_{12,0}Y_{2,t} + a_{11,1}Y_{1,t-1} + a_{12,1}Y_{2,t-1} + \epsilon_{1,t} \\
Y_{2,t} &amp;= a_{21,0}Y_{1,t} + a_{21,1}Y_{1,t-1} + a_{22,1}Y_{2,t-1} + \epsilon_{2,t}
\end{aligned}
\]</span></p>
<p>を<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>について解くと、</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= \frac{(a_{11,1}+a_{12,0}a_{21,1})Y_{1,t-1} + (a_{12,1}+a_{12,0}a_{22,1})Y_{2,t-1} + \epsilon_{1,t} + a_{12,0}\epsilon_{2,t}}{1-a_{12,0}a_{21,0}} \\
Y_{2,t} &amp;= \frac{(a_{21,1}+a_{21,0}a_{11,1})Y_{1,t-1} + (a_{22,1}+a_{21,0}a_{12,1})Y_{2,t-1} + a_{21,0}\epsilon_{1,t} + \epsilon_{2,t}}{1-a_{12,0}a_{21,0}}
\end{aligned}
\]</span></p>
<p>の誘導VARモデルに変換できます。ここで、誘導VARモデルの誤差項<span class="math inline">\(u_{1,t}\)</span>、<span class="math inline">\(u_{2,t}\)</span>は、</p>
<p><span class="math display">\[
u_{1, t} = \frac{\epsilon_{1,t} + a_{12,0}\epsilon_{2,t}}{1-a_{12,0}a_{21,0}}, \quad
u_{2, t} = \frac{a_{21,0}\epsilon_{1,t} + \epsilon_{2,t}}{1-a_{12,0}a_{21,0}}
\]</span></p>
<p>であり、構造VARモデルの誤差項<span class="math inline">\(\epsilon_{1,t}\)</span>、<span class="math inline">\(\epsilon_{2,t}\)</span>の線型結合（加重平均）になっています。これが、誘導VARモデルの誤差項<span class="math inline">\(u_{1,t}\)</span>、<span class="math inline">\(u_{2,t}\)</span>が互いに相関している理由です。</p>
<p>変換した誘導VARモデルを、</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= b_{11,1}Y_{1,t-1} + b_{12,1}Y_{2,t-1} + u_{1,t} \\
Y_{2,t} &amp;= b_{21,1}Y_{1,t-1} + b_{22,1}Y_{2,t-1} + u_{2,t}
\end{aligned}
\]</span></p>
<p>に書き直すと、誘導VARモデルで推定できるパラメータは、係数<span class="math inline">\(b_{11,1}\)</span>、<span class="math inline">\(b_{12,1}\)</span>、<span class="math inline">\(b_{21,1}\)</span>、<span class="math inline">\(b_{22,1}\)</span>、誤差項の分散<span class="math inline">\(\mathit{Var}(u_{1, t})\)</span>、<span class="math inline">\(\mathit{Var}(u_{2, t})\)</span>、誤差項の共分散<span class="math inline">\(\mathit{Cov}(u_{1,t},\, u_{2,t})\)</span>の合計7個です。一方で、変換前の構造VARモデルの未知パラメータは、係数<span class="math inline">\(a_{12,0}\)</span>、<span class="math inline">\(a_{11,1}\)</span>、<span class="math inline">\(a_{12,1}\)</span>、<span class="math inline">\(a_{21,0}\)</span>、<span class="math inline">\(a_{21,1}\)</span>、<span class="math inline">\(a_{22,1}\)</span>、誤差項（構造ショック）の分散<span class="math inline">\(\sigma^2_{Y_1}\)</span>、<span class="math inline">\(\sigma^2_{Y_2}\)</span>の合計8個です（構造VARモデルの誤差項は互いに相関していないので共分散は常にゼロです）。誘導VARモデルで推定できるパラメータ数（7 個）は構造VARモデルの未知パラメータ数（8個）より少なく、この状態では誘導VARモデルから構造VARモデルを再現（識別）することはできません。したがって、<u>誘導VARモデルから構造VARモデルを識別するには、構造VARモデルに何らかの制約を課す必要があります</u>。</p>
<p>一般的に、<span class="math inline">\(n\)</span>種類の変数があるVARモデルについて、推定した誘導VARモデルから構造VARモデルを識別するためには、構造モデルに<span class="math inline">\(n(n-1)/2\)</span>個の制約を課す必要があります（エンダース（2019）P.301）。上記の例では変数が<span class="math inline">\(Y_{1,t}\)</span>と<span class="math inline">\(Y_{2,t}\)</span>の2種類のため、<span class="math inline">\(n(n-1)/2=1\)</span>となり、制約を1つ課す必要があることが分かります。変数が2〜10種類の場合に必要になる制約の数は次のとおりです。</p>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="09_var.html#cb966-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb966-2"><a href="09_var.html#cb966-2" aria-hidden="true" tabindex="-1"></a>  const <span class="ot">&lt;-</span> n <span class="sc">*</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb966-3"><a href="09_var.html#cb966-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">str_c</span>(<span class="st">&quot;変数：&quot;</span>, stringr<span class="sc">::</span><span class="fu">str_pad</span>(n, <span class="at">width =</span> <span class="dv">2</span>), <span class="st">&quot;種類　　制約：&quot;</span>, stringr<span class="sc">::</span><span class="fu">str_pad</span>(const, <span class="at">width =</span> <span class="dv">2</span>), <span class="st">&quot;個</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb966-4"><a href="09_var.html#cb966-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 変数： 2種類　　制約： 1個
## 変数： 3種類　　制約： 3個
## 変数： 4種類　　制約： 6個
## 変数： 5種類　　制約：10個
## 変数： 6種類　　制約：15個
## 変数： 7種類　　制約：21個
## 変数： 8種類　　制約：28個
## 変数： 9種類　　制約：36個
## 変数：10種類　　制約：45個</code></pre>
<div id="短期制約再帰的制約" class="section level4 unnumbered hasAnchor">
<h4>短期制約：再帰的制約<a href="09_var.html#短期制約再帰的制約" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>構造VARモデルの制約として最もよく用いられるのは、変数の順序に応じて機械的に制約を課す<strong>再帰的制約（recursive restriction）</strong>です（エンダース（2019）P.276、村尾（2019）P.197）。再帰的制約は<strong>コレスキー分解（Choleski decomposition）</strong>による識別とも呼ばれます。また、再帰的制約は変数の同時点間の関係に制約を課すことから、<strong>短期制約（short-run restriction）</strong>もしくは同時点制約とも呼ばれます（宮尾（2006）P.22、北岡 他（2013）P.70、西山 他（2019）P.612）。</p>
<p>次のような、未知パラメータが18個（係数15個、誤差項の分散3個）ある3変数1次ラグの構造VARを考えます。</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= a_{12,0}Y_{2,t} + a_{13,0}Y_{3,t} + a_{11,1}Y_{1,t-1} + a_{12,1}Y_{2,t-1} + a_{13,1}Y_{3,t-1} + \epsilon_{1,t} \\
Y_{2,t} &amp;= a_{21,0}Y_{1,t} + a_{23,0}Y_{3,t} + a_{21,1}Y_{1,t-1} + a_{22,1}Y_{2,t-1} + a_{23,1}Y_{3,t-1} + \epsilon_{2,t} \\
Y_{3,t} &amp;= a_{31,0}Y_{1,t} + a_{32,0}Y_{2,t} + a_{31,1}Y_{1,t-1} + a_{32,1}Y_{2,t-1} + a_{33,1}Y_{3,t-1} + \epsilon_{3,t}
\end{aligned}
\]</span></p>
<p>ここで、第1式の<span class="math inline">\(Y_{2,t}\)</span>の係数<span class="math inline">\(a_{12,0}\)</span>と<span class="math inline">\(Y_{3,t}\)</span>の係数<span class="math inline">\(a_{13,0}\)</span>、第2式の<span class="math inline">\(Y_{3,t}\)</span>の係数<span class="math inline">\(a_{23,0}\)</span>について、<span class="math inline">\(a_{12,0} = 0\)</span>、<span class="math inline">\(a_{13,0} = 0\)</span>、<span class="math inline">\(a_{23,0} = 0\)</span>という3つの制約を置くと、構造VARモデルの未知パラメータは15個になります。</p>
<p>一方、この構造VARモデルを誘導VARモデル、</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= b_{11,1}Y_{1,t-1} + b_{12,1}Y_{2,t-1} + b_{13,1}Y_{3,t-1} + u_{1,t} \\
Y_{2,t} &amp;= b_{21,1}Y_{1,t-1} + b_{22,1}Y_{2,t-1} + b_{23,1}Y_{3,t-1} + u_{2,t} \\
Y_{3,t} &amp;= b_{31,1}Y_{1,t-1} + b_{32,1}Y_{2,t-1} + b_{33,1}Y_{3,t-1} + u_{3,t}
\end{aligned}
\]</span></p>
<p>に変換すると、推定できるパラメータは15個（係数9個、誤差項の分散3個、誤差項の共分散3個）です。したがって、構造VARモデルに3つの制約を課すと、誘導VARモデルで推定した15個のパラメータから構造VARモデルの15個の未知パラメータが全て求められるようになります。このように、構造VARモデルを識別するために必要十分な数の制約を課すことを<strong>丁度識別（just identified）</strong>もしくは<strong>適度識別</strong>と言います（エンダース（2019）P.276、村尾（2019）P.200）。</p>
<p>ここで、構造VARモデルの係数に課した3つの制約について考えると、<span class="math inline">\(a_{12,0} = 0\)</span>と<span class="math inline">\(a_{13,0} = 0\)</span>の制約は、<span class="math inline">\(Y_{1}\)</span>が同時点の<span class="math inline">\(Y_{2}\)</span>と<span class="math inline">\(Y_{3}\)</span>から影響を受けないと想定していることを意味します。また、<span class="math inline">\(a_{23,0} = 0\)</span>は、<span class="math inline">\(Y_{2}\)</span>が同時点の<span class="math inline">\(Y_{3}\)</span>から影響を受けないと想定していることを意味します。一方、その他の係数にはゼロ制約を課していないため、<span class="math inline">\(Y_{3}\)</span>は同時点の<span class="math inline">\(Y_{1}\)</span>、<span class="math inline">\(Y_{2}\)</span>から影響を受け、<span class="math inline">\(Y_{2}\)</span>は同時点の<span class="math inline">\(Y_{1}\)</span>から影響を受けることが許容されています。</p>
<p>すなわち、誘導VARモデルから構造VARモデルを識別するために再帰的制約を課すことは、「順序が先の変数（ここでは<span class="math inline">\(Y_{1}\)</span>）ほど外生性が強く（他変数に影響するが自分は他変数の影響を受けない）、順序が後の変数（ここでは<span class="math inline">\(Y_{3}\)</span>）ほど内生性が強い（他変数の影響を受けるが自分は他変数に影響しない）」と暗黙理に仮定していることを意味します。実際のデータがこの仮定通りであれば問題ありませんが、仮定と異なっていれば、構造VARモデルを誤って識別することになります。こうした再帰的制約における変数の順序の問題は、この後のインパルス応答分析において大きな課題になります。</p>
</div>
<div id="短期制約非再帰的制約" class="section level4 unnumbered hasAnchor">
<h4>短期制約：非再帰的制約<a href="09_var.html#短期制約非再帰的制約" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>こうした機械的な再帰的制約に対し、変数の順序に依存しない柔軟な制約は<strong>非再帰的制約（nonrecursive restriction）</strong>と呼ばれます（宮尾（2006）P.23、エンダース（2019）P.302、村尾（2019）P.203）。非再帰的制約も変数の同時点間の関係に制約を課す点では再帰的制約と同じであり、<strong>短期制約（short-run restriction）</strong>の一種です。</p>
<p>再帰的制約で用いたものと同じ、3変数1次ラグの構造VARモデルを考えます。ただし、構造VARモデルの誤差項<span class="math inline">\(\epsilon_{i,t}\)</span>は<span class="math inline">\(\epsilon_{i,t} = \sigma_i \epsilon^{SD}_{i,t}\)</span>に変形します。<span class="math inline">\(\sigma_i\)</span>は誤差項<span class="math inline">\(\epsilon_{i,t}\)</span>の標準偏差、<span class="math inline">\(\epsilon^{SD}_{i,t}\)</span>は平均0、分散1になるよう標準化した標準化構造誤差項です。</p>
<p>この構造VARモデルの右辺にある<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>、<span class="math inline">\(Y_{3,t}\)</span>の項をそれぞれ左辺に移項し、行列形式で表示すると、</p>
<p><span class="math display">\[
\small
\begin{bmatrix}
1 &amp; -a_{12,0} &amp; -a_{13,0} \\
-a_{21,0} &amp; 1 &amp; -a_{23,0} \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}
\begin{bmatrix}
Y_{1,t} \\
Y_{2,t} \\
Y_{3,t}
\end{bmatrix}
=
\begin{bmatrix}
a_{11,1} &amp; a_{12,1} &amp; a_{13,1} \\
a_{21,1} &amp; a_{22,1} &amp; a_{23,1} \\
a_{31,1} &amp; a_{32,1} &amp; a_{33,1}
\end{bmatrix}
\begin{bmatrix}
Y_{1,t-1} \\
Y_{2,t-1} \\
Y_{3,t-1}
\end{bmatrix}
+
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix}
\begin{bmatrix}
\epsilon^{SD}_{1,t} \\
\epsilon^{SD}_{2,t} \\
\epsilon^{SD}_{3,t}
\end{bmatrix}
\]</span></p>
<p>となり、ここで、</p>
<p><span class="math display">\[
\small
\boldsymbol{A} =
\begin{bmatrix}
1 &amp; -a_{12,0} &amp; -a_{13,0} \\
-a_{21,0} &amp; 1 &amp; -a_{23,0} \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}
, \quad
\boldsymbol{A}_1 =
\begin{bmatrix}
a_{11,1} &amp; a_{12,1} &amp; a_{13,1} \\
a_{21,1} &amp; a_{22,1} &amp; a_{23,1} \\
a_{31,1} &amp; a_{32,1} &amp; a_{33,1}
\end{bmatrix}
, \quad
\boldsymbol{B} =
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix}
\]</span></p>
<p>とすると、構造VARモデルは次のように表すことができます。<span class="math inline">\(\boldsymbol{Y}_t\)</span>と<span class="math inline">\(\boldsymbol{Y}_{t-1}\)</span>は3個の変数ベクトルです。</p>
<p><span class="math display">\[
\boldsymbol{A} \boldsymbol{Y}_t = \boldsymbol{A}_1 \boldsymbol{Y}_{t-1} + \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t
\]</span></p>
<p>この構造VARモデルに対し、両辺に行列<span class="math inline">\(\boldsymbol{A}\)</span>の逆行列<span class="math inline">\(\boldsymbol{A}^{-1}\)</span>を掛けると、次のように誘導VARモデルに変換することができます。</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \boldsymbol{A}^{-1} \boldsymbol{A}_1 \boldsymbol{Y}_{t-1} + \boldsymbol{A}^{-1} \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t
\]</span></p>
<p>ここで、誘導誤差項ベクトル<span class="math inline">\(\boldsymbol{u}_t\)</span>は<span class="math inline">\(\boldsymbol{A}^{-1} \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t\)</span>に相当します。したがって、識別すべき（標準化）構造誤差項ベクトル<span class="math inline">\(\boldsymbol{\epsilon}^{SD}_t\)</span>は、誘導誤差項ベクトル<span class="math inline">\(\boldsymbol{u}_t\)</span>を使って<span class="math inline">\(\boldsymbol{\epsilon}^{SD}\_t = \boldsymbol{B}^{-1} \boldsymbol{A} \boldsymbol{u}\_t\)</span>と表すことができます。</p>
<p>いま、推定した誘導誤差項ベクトル<span class="math inline">\(\boldsymbol{u}_t\)</span>から（標準化）構造誤差項ベクトル<span class="math inline">\(\boldsymbol{\epsilon}_t\)</span>を識別するには、3変数VARの場合<span class="math inline">\(3(3-1)/2 = 3\)</span>個の制約が必要になります。</p>
<p>再帰的制約では<span class="math inline">\(a_{12,0} = 0\)</span>、<span class="math inline">\(a_{13,0} = 0\)</span>、<span class="math inline">\(a_{23,0} = 0\)</span>の制約を置きました。これは次のように、行列<span class="math inline">\(\boldsymbol{A}\)</span>の右上三角部分を0と置いたことを意味します。</p>
<p><span class="math display">\[
\boldsymbol{A} =
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
-a_{21,0} &amp; 1 &amp; 0 \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}
\]</span></p>
<p>このとき、構造VARモデルにおける変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>、<span class="math inline">\(Y_{3,t}\)</span>の同時点の関係は次のようになります。</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= \epsilon_{1,t} \\
Y_{2,t} &amp;= a_{21,0} Y_{1,t} + \epsilon_{2,t} \\
Y_{3,t} &amp;= a_{31,0} Y_{1,t} + a_{32,0} Y_{2,t} + \epsilon_{3,t}
\end{aligned}
\]</span></p>
<p>一方、非再帰的制約では想定する経済構造に基づいて、対角要素以外の場所に柔軟に制約を設定します。例えば、</p>
<p><span class="math display">\[
\boldsymbol{A} =
\begin{bmatrix}
1 &amp; -a_{12,0} &amp; 0 \\
0 &amp; 1 &amp; -a_{23,0} \\
-a_{31,0} &amp; 0 &amp; 1
\end{bmatrix}
\]</span></p>
<p>とすると、構造VARモデルにおける変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>、<span class="math inline">\(Y_{3,t}\)</span>の同時点の関係は、</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= a_{12,0} Y_{2,t} + \epsilon_{1,t} \\
Y_{2,t} &amp;= a_{23,0} Y_{3,t} + \epsilon_{2,t} \\
Y_{3,t} &amp;= a_{31,0} Y_{1,t} + \epsilon_{3,t}
\end{aligned}
\]</span></p>
<p>となり、再帰的制約とは異なる構造を想定することができます。</p>
<p>非再帰的制約の一例に、<a href="https://www.minneapolisfed.org/research/quarterly-review/are-forecasting-models-usable-for-policy-analysis">Sims (1986)</a>による6変量VARモデルがあります（詳細はエンダース（2019）P.313を参照してください。ただしエンダース（2019）では本書でいう行列<span class="math inline">\(\boldsymbol{A}\)</span>を行列<span class="math inline">\(\boldsymbol{B}\)</span>を記載している点に注意してください）。モデルには変数が、短期金利（<span class="math inline">\(r\)</span>）、貨幣供給量M1（<span class="math inline">\(m\)</span>）、実質GNP（<span class="math inline">\(y\)</span>）、GNPデフレータ（<span class="math inline">\(p\)</span>）、失業率（<span class="math inline">\(u\)</span>）、実質企業固定投資（<span class="math inline">\(i\)</span>）の順序で含まれています。Sims (1986)では行列<span class="math inline">\(\boldsymbol{A}\)</span>に対し、</p>
<p><span class="math display">\[
\boldsymbol{A} =
\begin{bmatrix}
1 &amp; -a_{12,0} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
-a_{21,0} &amp; 1 &amp; -a_{23,0} &amp; -a_{24,0} &amp; 0 &amp; 0 \\
-a_{31,0} &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; -a_{36,0} \\
-a_{41,0} &amp; 0 &amp; -a_{43,0} &amp; 1 &amp; 0 &amp; -a_{46,0} \\
-a_{51,0} &amp; 0 &amp; -a_{53,0} &amp; -a_{54,0} &amp; 1 &amp; -a_{56,0} \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\]</span></p>
<p>の制約が課されています。これは、変数間の同時点の関係を、</p>
<p><span class="math display">\[
\begin{aligned}
r_t &amp;= a_{12,0} m_t + \epsilon_{r,t} \\
m_t &amp;= a_{21,0} r_t + a_{23,} y_t + a_{24,0} p_t + \epsilon_{m,t} \\
y_t &amp;= a_{31,0} r_t + a_{36,0} i_t + \epsilon_{y,t} \\
p_t &amp;= a_{41,0} r_t + a_{43,0} y_t + a_{46,0} i_t + \epsilon_{p,t} \\
u_t &amp;= a_{51,0} r_t + a_{53,0} y_t + a_{54,0} p_t + a_{56,0} i_t + \epsilon_{p,t} \\
i_t &amp;= \epsilon_{i,t}
\end{aligned}
\]</span></p>
<p>と想定していることを意味します。なお、6変数VARモデルで識別に必要な制約の数は<span class="math inline">\(6(6-1)/2 = 15\)</span>個ですが、Sims (1986)は経済理論との整合性を重視し、<span class="math inline">\(\boldsymbol{A}\)</span>行列に17個の制約を課しています。このように、必要以上の制約を課すことを<strong>過剰識別（overidentified）</strong>と言います。</p>
</div>
<div id="長期制約" class="section level4 unnumbered hasAnchor">
<h4>長期制約<a href="09_var.html#長期制約" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>長期制約（long-run restriction）</strong>は、構造ショックが特定の変数に及ぼす累積的な効果が、長期的にみてゼロになるという制約です（宮尾（2006）P.24、北岡 他（2019）P.75、西山 他（2019）P.621）。長期制約は、金融政策や財政政策が実質GDPに対する長期的な効果をもたない、といった経済理論を表現するための制約として用いられます。</p>
<p>長期制約では、VARモデルを過去の誤差項の和で表す<strong>VMA表現（vector moving average representation）</strong>を用います。VARモデルがARモデルの多変数版であるのと同様に、MAモデルの多変数に拡張したものがVMA表現です。</p>
<p><span class="math inline">\(n\)</span>個の変数をもつラグ次数<span class="math inline">\(p\)</span>の構造VARモデル<span class="math inline">\(\mathit{VAR}(p)\)</span>は、右辺のラグ項に逐次代入を繰り返すことで、誤差項の無限大期までのラグで説明される<span class="math inline">\(\mathit{VMA}(\infty)\)</span>モデル、</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \boldsymbol{D}_0 \boldsymbol{\epsilon}_t + \boldsymbol{D}_1 \boldsymbol{\epsilon}_{t-1} + \boldsymbol{D}_2 \boldsymbol{\epsilon}_{t-2} + \cdots
\]</span></p>
<p>と表すことができます（宮尾（2006）P.19）。<span class="math inline">\(\boldsymbol{Y}_t\)</span>は<span class="math inline">\(n\)</span>個の変数ベクトル、<span class="math inline">\(\boldsymbol{D}_j\)</span>は<span class="math inline">\(n \times n\)</span>の係数行列、<span class="math inline">\(\boldsymbol{\epsilon}_{t-j}\)</span>は<span class="math inline">\(n\)</span>個の構造誤差項ベクトルです。例えば2変数であれば次のようになります。</p>
<p><span class="math display">\[
\small
\begin{bmatrix}
Y_{1,t} \\
Y_{2,t}
\end{bmatrix}
=
\begin{bmatrix}
d_{11,0} &amp; d_{12,0} \\
d_{21,0} &amp; d_{22,0}
\end{bmatrix}
\begin{bmatrix}
\epsilon_{1,t} \\
\epsilon_{2,t}
\end{bmatrix}
+
\begin{bmatrix}
d_{11,1} &amp; d_{12,1} \\
d_{21,1} &amp; d_{22,1}
\end{bmatrix}
\begin{bmatrix}
\epsilon_{1,t-1} \\
\epsilon_{2,t-1}
\end{bmatrix}
+
\begin{bmatrix}
d_{11,2} &amp; d_{12,2} \\
d_{21,2} &amp; d_{22,2}
\end{bmatrix}
\begin{bmatrix}
\epsilon_{1,t-2} \\
\epsilon_{2,t-2}
\end{bmatrix}
+ \cdots
\]</span></p>
<p>ここで、表記を簡単にするために、ラグオペレータ<span class="math inline">\(L\)</span>を導入します。ラグオペレータ<span class="math inline">\(L\)</span>は<span class="math inline">\(LY_t = Y_{t-1}\)</span>、<span class="math inline">\(L^pY_t = Y_{t-p}\)</span>のようにラグ次数を変数として表す演算子です。特に、ある変数<span class="math inline">\(x\)</span>を<span class="math inline">\(L\)</span>の関数をして表すとき、</p>
<p><span class="math display">\[
\begin{aligned}
x(L) y_t &amp;= (x_0 + x_1 L + x_2 L^2 + \cdots) y_t \\
&amp;= x_0 y_t + x_1 y_{t-1} + x_2 y_{t-2} + \cdots
\end{aligned}
\]</span></p>
<p>であることを意味します。このラグオペレータ<span class="math inline">\(L\)</span>を用いると、上の2変数VMAモデルは次のように表すことができます。</p>
<p><span class="math display">\[
\begin{aligned}
\begin{bmatrix}
Y_{1,t} \\
Y_{2,t}
\end{bmatrix}
&amp;=
\begin{bmatrix}
d_{11}(L) &amp; d_{12}(L) \\
d_{21}(L) &amp; d_{22}(L)
\end{bmatrix}
\begin{bmatrix}
\epsilon_{1,t} \\
\epsilon_{2,t}
\end{bmatrix} \\
\\
\boldsymbol{Y}_t &amp;= \boldsymbol{D}(L) \boldsymbol{\epsilon}_t
\end{aligned}
\]</span></p>
<p>このモデルにおいて、変数<span class="math inline">\(Y_2\)</span>の構造誤差項<span class="math inline">\(\epsilon_2\)</span>に生じた構造ショックが、変数<span class="math inline">\(Y_1\)</span>に対し長期的に影響を及ぼさないと想定します（例えば<span class="math inline">\(Y_2\)</span>が金融政策、<span class="math inline">\(Y_1\)</span>が実質GDP）。<span class="math inline">\(\epsilon_2\)</span>の<span class="math inline">\(Y_1\)</span>に対する効果を表す係数<span class="math inline">\(d_{12}(L)\)</span>に<span class="math inline">\(L=1\)</span>を代入すると、</p>
<p><span class="math display">\[
\begin{aligned}
d_{12}(1) &amp;= d_{12,0} + d_{12,1} + d_{12,2} + \cdots \\
&amp;= \sum^{\infty}_{j=0}{d_{12,j}}
\end{aligned}
\]</span></p>
<p>となり、<span class="math inline">\(d_{12}(1)\)</span>は<span class="math inline">\(\epsilon_2\)</span>の<span class="math inline">\(Y_1\)</span>に対する毎期の効果を長期にわたり全て合計したものに相当するため、係数行列<span class="math inline">\(\boldsymbol{D}(L)\)</span>を、</p>
<p><span class="math display">\[
D(1)
=
\begin{bmatrix}
d_{11}(1) &amp; 0 \\
d_{21}(1) &amp; d_{22}(1)
\end{bmatrix}
\]</span></p>
<p>とすると、想定した長期制約を課すことができます。</p>
</div>
</div>
<div id="構造vecモデル" class="section level3 hasAnchor" number="9.8.5">
<h3><span class="header-section-number">9.8.5</span> 構造VECモデル<a href="09_var.html#構造vecモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>VARモデルと同様に、ベクトル誤差修正（VEC）モデルでも、経済構造に基づく制約を課して誘導型モデルから構造型モデルを識別することができます。これを<strong>構造ベクトル誤差修正（Structural VEC、SVEC）モデル</strong>と言います。</p>
<p>VECモデルの節で導出したラグ次数1の誘導VECモデル<span class="math inline">\(\mathit{VEC}(1)\)</span>、</p>
<p><span class="math display">\[
\Delta \boldsymbol{Y}_t = \boldsymbol{\alpha}\boldsymbol{\beta&#39;}\boldsymbol{Y}_{t-1} + \boldsymbol{\Gamma}_{1}\Delta\boldsymbol{Y}_{t-1} + \boldsymbol{u}_t
\]</span></p>
<p>に対応する構造VECモデルは、</p>
<p><span class="math display">\[
\Delta \boldsymbol{Y}_t = \boldsymbol{\alpha}\boldsymbol{\beta&#39;}\boldsymbol{Y}_{t-1} + \boldsymbol{\Gamma}_{1}\Delta\boldsymbol{Y}_{t-1} + \boldsymbol{B}\boldsymbol{\epsilon}^{SD}_t
\]</span></p>
<p>です。<span class="math inline">\(\boldsymbol{u}_t\)</span>は要素数<span class="math inline">\(n\)</span>の誘導誤差項ベクトル、<span class="math inline">\(\boldsymbol{\epsilon}^{SD}_t\)</span>は要素数<span class="math inline">\(n\)</span>の標準化構造誤差項ベクトル、<span class="math inline">\(\boldsymbol{B}\)</span>は対角要素が構造誤差項の標準偏差<span class="math inline">\(\sigma_i\)</span>、非対角要素が0の<span class="math inline">\(n \times n\)</span>の行列です。誘導VECモデルと構造VECモデルは同じものを表しているため、誘導誤差項ベクトルと標準化構造誤差項ベクトルの間には次の関係が成立します。</p>
<p><span class="math display">\[
\boldsymbol{u}_t = \boldsymbol{B}\boldsymbol{\epsilon}^{SD}_t
\]</span></p>
<p>ここで、<span class="math inline">\(\mathit{MA}(\infty)\)</span>モデルを短期変動と長期変動に2分割する<strong>ベバリッジ＝ネルソン分解表現（Beveridge-Nelson decomposition、B-N分解）</strong>を用いると、誘導VECモデルは、</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \Xi \boldsymbol{B} \sum^{t}_{i=1}{\epsilon^{SD}_i} + \sum^{\infty}_{j=1}{\Xi^*_j \boldsymbol{B} \epsilon^{SD}_{t-j}} + \boldsymbol{Y}^*_0
\]</span></p>
<p>と表すことができます。<span class="math inline">\(\Xi\)</span>は共和分関係に対し直交関係にある<span class="math inline">\(n \times n\)</span>の行列、<span class="math inline">\(\Xi^*\)</span>は共和分関係を表現する<span class="math inline">\(n \times n\)</span>の行列、<span class="math inline">\(\boldsymbol{Y}^*_0\)</span>は<span class="math inline">\(\boldsymbol{Y}_t\)</span>の初期値に依存する項です。</p>
<p>このBeveridge-Nelson分解表現の各項が意味するのは次のとおりです。</p>
<ul>
<li><p><span class="math inline">\(\Xi \boldsymbol{B} \sum^{t}_{i=1}{\epsilon^{SD}_i}\)</span>：共和分関係にない<span class="math inline">\(I(1)\)</span>過程の、現在（<span class="math inline">\(t\)</span>期）までの変動の合計に相当し、<span class="math inline">\(\boldsymbol{Y}_t\)</span>の恒久的な動きを表します。この項を<strong>共通トレンド項（common trend terms）</strong>と呼日ます。構造ショック<span class="math inline">\(\epsilon^{SD}_t\)</span>の恒久的な波及効果は行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>によって決まり、<span class="math inline">\(\Xi \boldsymbol{B}\)</span>を<strong>長期インパクト行列</strong>と呼びます。</p></li>
<li><p><span class="math inline">\(\sum^{\infty}_{j=1}{\Xi^*_j \boldsymbol{B} \epsilon^{SD}_{t-j}}\)</span>：共和分関係にある<span class="math inline">\(I(0)\)</span>過程の変動に相当し、<span class="math inline">\(\boldsymbol{Y}_t\)</span>の過渡的な動きを表します。構造ショック<span class="math inline">\(\epsilon^{SD}_t\)</span>の過渡的な波及効果は行列<span class="math inline">\(\boldsymbol{B}\)</span>によって決まり、<span class="math inline">\(\boldsymbol{B}\)</span>を<strong>短期インパクト行列</strong>と呼びます。</p></li>
</ul>
<p>構造VECモデルでは、長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>に加える制約が長期的な制約、短期インパクト行列<span class="math inline">\(\boldsymbol{B}\)</span>に加える制約が短期的な制約になります。<span class="math inline">\(n\)</span>種類の変数をもつ誘導VECモデルから構造VECモデルを識別するには、VARモデルと同様に、<span class="math inline">\(n(n-1)/2\)</span>個の制約を課す必要があります。</p>
<div id="構造vecモデルの制約" class="section level4 unnumbered hasAnchor">
<h4>構造VECモデルの制約<a href="09_var.html#構造vecモデルの制約" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>村尾（2019）は構造VECモデルに<span class="math inline">\(n(n-1)/2\)</span>個の制約を課すための方法論を提案しています（P.212）。</p>
<ol style="list-style-type: decimal">
<li><p>共和分関係を表現する長期制約</p>
<p>共和分関係が<span class="math inline">\(r\)</span>個の場合、<span class="math inline">\(r\)</span>個の変数に関する長期的な均衡関係があると考えられることから、長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>にゼロからなる列を最大<span class="math inline">\(r\)</span>列だけ設けます。<span class="math inline">\(r\)</span>列のゼロ制約は<span class="math inline">\(r(n-r)\)</span>個の独立した制約になるため、残りの必要な制約は<span class="math inline">\(n(n-1)/2 - r(n-r)\)</span>個です。</p></li>
<li><p>恒久的ショックを識別する長期制約</p>
<p>恒久的なショックを識別するために、少なくとも<span class="math inline">\((n-r)\{(n-r)-1\}/2\)</span>個の制約を長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>に加えます。</p></li>
<li><p>過渡的ショックを識別する短期制約</p>
<p>過渡的なショックを識別するため、少なくとも<span class="math inline">\(r(r-1)/2\)</span>個の制約を短期インパクト行列<span class="math inline">\(\boldsymbol{B}\)</span>に加えます。</p></li>
</ol>
<p>1〜3の制約の合計は<span class="math inline">\(r(n-r) + (n-r)\{(n-r)-1\}/2 + r(r-1)/2 = n(n-1)/2\)</span>になり、適度識別に必要な制約の個数に一致します。</p>
<p>ここでは構造VECモデルにおける制約の例として、労働生産性（<span class="math inline">\(Y_{1,t}\)</span>）、雇用者数の自然対数（<span class="math inline">\(Y_{2,t}\)</span>）、失業率（<span class="math inline">\(Y_{3,t}\)</span>）、実質賃金の自然対数（<span class="math inline">\(Y_{4,t}\)</span>）、の4変数構造VECモデルを考えます。4個の内生変数は全て<span class="math inline">\(I(1)\)</span>過程であり、共和分関係は1個であるとします。識別に必要な制約は<span class="math inline">\(4(4-1)/2=6\)</span>個です。</p>
<p>まず、4変数間に存在する1個の共和分関係が、どの変数に関する均衡を表現しているか考えます。この例では、実質賃金の自然対数<span class="math inline">\(Y_{4}\)</span>に関する均衡であり、したがって実質賃金方程式（第4方程式）の標準化構造誤差項<span class="math inline">\(\epsilon^{SD}_4\)</span>は恒久的インパクトをもっていないと想定されることから、長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>の第4列の要素を全てゼロにします。これにより、<span class="math inline">\(1(4-1) = 3\)</span>個の独立な制約を課したことになります。残りの必要な制約数は<span class="math inline">\(6-3=3\)</span>個です。</p>
<p><span class="math display">\[
\Xi \boldsymbol{B}
=
\begin{bmatrix}
* &amp; * &amp; * &amp; 0 \\
* &amp; * &amp; * &amp; 0 \\
* &amp; * &amp; * &amp; 0 \\
* &amp; * &amp; * &amp; 0
\end{bmatrix}
\]</span></p>
<p>次に、恒久的なショックを識別するために、長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>へ制約を追加します。ここでは、労働生産性<span class="math inline">\(Y_1\)</span>が労働生産性の構造ショック<span class="math inline">\(\epsilon^{SD}_1\)</span>からのみ恒久的インパクトを受け、他の変数の構造ショック（<span class="math inline">\(\epsilon^{SD}_2\)</span>、<span class="math inline">\(\epsilon^{SD}_3\)</span>、<span class="math inline">\(\epsilon^{SD}_4\)</span>）からは恒久的インパクトを受けないと想定します。この想定は、長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>の<span class="math inline">\((1,2)\)</span>、<span class="math inline">\((1,3)\)</span>、<span class="math inline">\((1,4)\)</span>要素をゼロにすることで表現できます。これによる追加的な制約数は<span class="math inline">\(2\)</span>個であり、残りの必要な制約数は<span class="math inline">\(1\)</span>個です。</p>
<p><span class="math display">\[
\Xi \boldsymbol{B}
=
\begin{bmatrix}
* &amp; 0 &amp; 0 &amp; 0 \\
* &amp; * &amp; * &amp; 0 \\
* &amp; * &amp; * &amp; 0 \\
* &amp; * &amp; * &amp; 0
\end{bmatrix}
\]</span></p>
<p>最後に、過渡的ショックを識別するために、短期インパクト行列<span class="math inline">\(\boldsymbol{B}\)</span>へ制約を追加します。ここでは、実質賃金に関する硬直性の理論に基づき、実質賃金<span class="math inline">\(Y_4\)</span>は同時点における雇用者数の構造ショック<span class="math inline">\(\epsilon^{SD}_2\)</span>から影響を受けない（雇用者数の増減は同時点の実質賃金に影響しない）と想定します。この想定は、短期インパクト行列<span class="math inline">\(\boldsymbol{B}\)</span>の<span class="math inline">\((2,4)\)</span>要素をゼロにすることで表現できます。これによる追加的な制約数は<span class="math inline">\(1\)</span>個であり、残りの必要な制約数は<span class="math inline">\(0\)</span>個になります（適度識別）。</p>
<p><span class="math display">\[
\boldsymbol{B}
=
\begin{bmatrix}
* &amp; * &amp; * &amp; * \\
* &amp; * &amp; * &amp; * \\
* &amp; * &amp; * &amp; * \\
* &amp; 0 &amp; * &amp; *
\end{bmatrix}
\]</span></p>
</div>
</div>
</div>
<div id="varモデルに関連する分析" class="section level2 hasAnchor" number="9.9">
<h2><span class="header-section-number">9.9</span> VARモデルに関連する分析<a href="09_var.html#varモデルに関連する分析" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="グレンジャー因果性" class="section level3 hasAnchor" number="9.9.1">
<h3><span class="header-section-number">9.9.1</span> グレンジャー因果性<a href="09_var.html#グレンジャー因果性" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>グレンジャー因果性（Granger causality）</strong>は、予測精度の改善という観点から、時系列データの因果関係を評価する手法です（西山 他（2019）P.584）。</p>
<p>グレンジャー因果性では、「原因は結果に先立って起こる」、「原因には結果に関するユニークな情報が含まれている」という2つのアイデアをもとにして、背景の経済理論を必要とせずに時系列データのみから因果関係の有無を判断します（村尾（2019）P.369）。</p>
<p>具体例として、ある事象の原因（cause）を表すと考えられる変数<span class="math inline">\(X_t\)</span>、結果を表すと考えられる変数<span class="math inline">\(Y_t\)</span>、に関する次のモデルを考えます。</p>
<p><span class="math display">\[
\begin{aligned}
Y_t &amp;= \phi_1Y_{t-1} \quad \quad \quad \quad \; + u_{1,t} \\
Y_t &amp;= \phi_1Y_{t-1} + \phi_2X_{t-1} + u_{2,t}
\end{aligned}
\]</span></p>
<p>ここで、<span class="math inline">\(u_1\)</span>は過去の結果変数<span class="math inline">\(Y_t\)</span>だけを使って<span class="math inline">\(Y_t\)</span>を予測したときの残差、<span class="math inline">\(u_2\)</span>は過去の原因変数<span class="math inline">\(X_t\)</span>も使って<span class="math inline">\(Y_t\)</span>を予測したときの残差です。この2つの予測誤差の残差平方和（Mean Squared Error、MSE）を比較し、原因変数<span class="math inline">\(X_t\)</span>を予測に使うことで予測誤差が有意に小さくなったかを検定するのが、グレンジャー因果性検定です。</p>
<p>グレンジャー因果性検定では、原因変数<span class="math inline">\(X_t\)</span>と結果変数<span class="math inline">\(Y_t\)</span>を含むVARモデルを構築し、「結果変数の式における原因変数の係数がゼロ」との帰無仮説を検定する方法で行います。したがって、帰無仮説が棄却できれば原因変数<span class="math inline">\(X_t\)</span>は結果変数<span class="math inline">\(Y_t\)</span>に対しグレンジャー因果性をもつと判断されます。一方、帰無仮説が棄却できない場合はグレンジャー因果性をもつとは判断できず、結果変数<span class="math inline">\(Y_t\)</span>は原因変数<span class="math inline">\(X_t\)</span>に対し外生的であることが示唆されます。</p>
<div id="グレンジャー瞬間的因果性" class="section level4 unnumbered hasAnchor">
<h4>グレンジャー瞬間的因果性<a href="09_var.html#グレンジャー瞬間的因果性" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>グレンジャー瞬間的因果性（instantaneous Granger causality）</strong>は、グレンジャー因果性の発展形です。モデルに変数<span class="math inline">\(X_t\)</span>の予測値<span class="math inline">\(X_{t+1}\)</span>を追加した場合に、変数<span class="math inline">\(Y_{t}\)</span>の予測値<span class="math inline">\(Y_{t+1}\)</span>の予測誤差（MSE）が小さくなると、変数<span class="math inline">\(X\)</span>から変数<span class="math inline">\(Y\)</span>へのグレンジャー瞬間的因果性があると言います。</p>
<p>グレンジャー瞬間的因果性は、同時点における変数の影響を検定したものです。2変数のVARモデルにおいて、グレンジャー瞬間的因果性がないことの必要十分条件は、同時点における残差同士の共分散が0であることが知られています（馬場（2018）P.157）。したがって、2つの変数の間にグレンジャー瞬間的因果性があれば、VARモデルの2つの式の残差同士に関連があるといえます。</p>
<p>グレンジャー瞬間的因果性検定もグレンジャー因果性検定と同様に、「変数<span class="math inline">\(X\)</span>から変数<span class="math inline">\(Y\)</span>へのグレンジャー瞬間的因果性がない」との帰無仮説を検定します。帰無仮説が棄却できれば、変数<span class="math inline">\(X\)</span>は変数<span class="math inline">\(Y\)</span>に対しグレンジャー瞬間的因果性をもつと判断されます。</p>
</div>
<div id="ブロック外生性" class="section level4 unnumbered hasAnchor">
<h4>ブロック外生性<a href="09_var.html#ブロック外生性" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>グレンジャー因果性は、VARモデルにおける変数選択の指針として使用することができます。</p>
<p>いま、2つの変数<span class="math inline">\(X_t\)</span>と<span class="math inline">\(Y_t\)</span>からなるVARモデルを構築し、そこに変数<span class="math inline">\(Z_t\)</span>を新たに加えるか検討しているとします。グレンジャー因果性検定を行い、<span class="math inline">\(Z_t\)</span>が<span class="math inline">\(X_t\)</span>か<span class="math inline">\(Y_t\)</span>の少なくともどちらか一方にグレンジャー因果性をもつと判断できれば、<span class="math inline">\(Z_t\)</span>はこのVARモデルに加えるべきです（エンダース（2019）P.293）。</p>
<p>一方、<span class="math inline">\(Z_t\)</span>が<span class="math inline">\(X_t\)</span>と<span class="math inline">\(Y_t\)</span>のどちらに対してもグレンジャー因果性をもつと判断できない場合（厳密には、<span class="math inline">\(X_t\)</span>と<span class="math inline">\(Y_t\)</span>の式で<span class="math inline">\(Z_t\)</span>のすべてのラグの係数が0になる場合）、<span class="math inline">\(Z_t\)</span>は<strong>ブロック外生的</strong>であると言います。こうしたケースでは、<span class="math inline">\(Z_t\)</span>は将来の<span class="math inline">\(X_t\)</span>と<span class="math inline">\(Y_t\)</span>に影響を与えないため、<span class="math inline">\(Z_t\)</span>はこのVARモデルに加えるべきではありません。</p>
<p>このように、VARモデルにおいて、ある変数が他のどの変数に対してもグレンジャー因果性をもっていないことを<strong>ブロック外生性（block-exogeneity）</strong>と言います。</p>
</div>
<div id="グレンジャー因果性の注意点" class="section level4 unnumbered hasAnchor">
<h4>グレンジャー因果性の注意点<a href="09_var.html#グレンジャー因果性の注意点" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>なお、グレンジャー因果性を用いて分析する際は、次の点に注意してください。</p>
<ol style="list-style-type: decimal">
<li><p><u>グレンジャー因果性検定が使用できるのは、定常な時系列データのみです</u>（馬場（2018）P.147）。</p></li>
<li><p><u>原因と結果の変数両方に影響する第3の変数がある場合は、原因・結果変数のグレンジャー因果性が有意であったとしても、真の因果関係はありません</u>。例えば、原因：津波警報と結果：津波（真の原因は地震）、原因：雷光と結果：雷鳴（真の原因は落雷現象）などです（村尾（2019）P.372）。</p></li>
<li><p><u>VARモデルに他の変数を追加すると、グレンジャー因果性検定の結果が変わります</u>。特に、結果の変数と相関の強い第3の変数をモデルに追加すると、原因の変数のグレンジャー因果性は低下します（村尾（2019）P.372）。</p></li>
<li><p><u>グレンジャー因果性検定の結果をそのまま政策判断に用いるべきではありません</u>。政策手段である原因の変数が内生変数の場合（例えば貨幣供給量や名目金利など）、原因の変数を予測する回帰式の誤差項には政策変化以外の要因が含まれており、純粋な政策ショックの効果を捉えることができません。政策ショックの影響を分析するには、構造VARモデルに基づくインパルス応答を用いる必要があります（西山 他（2019）P.590）。</p></li>
</ol>
</div>
</div>
<div id="インパルス応答" class="section level3 hasAnchor" number="9.9.2">
<h3><span class="header-section-number">9.9.2</span> インパルス応答<a href="09_var.html#インパルス応答" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>インパルス応答（impulse response）</strong>は、VARモデルのある変数に急な変動（ショック）が発生した場合に、他の変数へ時間を通じてどのような影響が生じるかを定量的に評価する手法です。</p>
<p>インパルス応答では、「構造VARモデル」に記載したように、誘導VARモデルから構造VARモデルをいかに識別するかが重要になります。インパルス応答を引き起こすショックは変数の独立な構造ショック（構造VARモデルの誤差項）<span class="math inline">\(\epsilon_{t}\)</span>ですが、構造ショック<span class="math inline">\(\epsilon_{t}\)</span>は直接推定できず、誘導VARモデルの誤差項<span class="math inline">\(u_{t}\)</span>の推定値を使って再現（識別）する必要があるためです。識別の際に、どのような制約を構造VARモデルに課すかでインパルス応答の結果が変わるため、制約が経済構造の実態を反映したものか十分検討する必要があります。</p>
<p>3つの変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>、<span class="math inline">\(Y_{3,t}\)</span>からなるラグ次数1の構造VARモデルを考えます。構造VARモデルは誘導VARモデルと異なり、各式の右辺に左辺と同時点の項が含まれており、経済構造に基づいて変数の同時点間の相互関係を考慮する形状になっています。</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= a_{10} + a_{12,0}Y_{2,t} + a_{13,0}Y_{3,t} + a_{11,1}Y_{1,t-1} + a_{12,1}Y_{2,t-1} + a_{13,1}Y_{3,t-1} + \epsilon_{1,t} \\
Y_{2,t} &amp;= a_{20} + a_{21,0}Y_{1,t} + a_{23,0}Y_{3,t} + a_{21,1}Y_{1,t-1} + a_{22,1}Y_{2,t-1} + a_{23,1}Y_{3,t-1} + \epsilon_{2,t} \\
Y_{3,t} &amp;= a_{30} + a_{31,0}Y_{1,t} + a_{32,0}Y_{2,t} + a_{31,1}Y_{1,t-1} + a_{32,1}Y_{2,t-1} + a_{33,1}Y_{3,t-1} + \epsilon_{3,t}
\end{aligned}
\]</span></p>
<p>右辺にある同時点の項を左辺に移項し、行列表示すると、この構造VARモデルは次のように表すことができます。なお、構造誤差項<span class="math inline">\(\epsilon_{i,t}\)</span>は、構造誤差項の標準偏差<span class="math inline">\(\sigma_i\)</span>と、平均0、分散1になるよう標準化した標準化構造誤差項<span class="math inline">\(\epsilon^{SD}_{i,t}\)</span>に分解しています。</p>
<p><span class="math display">\[
\small
\begin{aligned}
\begin{bmatrix}
1 &amp; -a_{12,0} &amp; -a_{13,0} \\
-a_{21,0} &amp; 1 &amp; -a_{23,0} \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}
\begin{bmatrix}
Y_{1,t} \\
Y_{2,t} \\
Y_{3,t}
\end{bmatrix}
&amp;=
\begin{bmatrix}
a_{10} \\
a_{20} \\
a_{30}
\end{bmatrix}
+
\begin{bmatrix}
a_{11,1} &amp; a_{12,1} &amp; a_{13,1} \\
a_{21,1} &amp; a_{22,1} &amp; a_{23,1} \\
a_{31,1} &amp; a_{32,1} &amp; a_{33,1}
\end{bmatrix}
\begin{bmatrix}
Y_{1,t-1} \\
Y_{2,t-1} \\
Y_{3,t-1}
\end{bmatrix}
+
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix}
\begin{bmatrix}
\epsilon^{SD}_{1,t} \\
\epsilon^{SD}_{2,t} \\
\epsilon^{SD}_{3,t}
\end{bmatrix} \\
\end{aligned}
\]</span></p>
<p>上の式の各行列・ベクトルを記号に置き換え、式を次のように書き換えます。</p>
<p><span class="math display">\[
\boldsymbol{A} \boldsymbol{Y}_t = \boldsymbol{A}_0 + \boldsymbol{A}_1 \boldsymbol{Y}_{t-1} + \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t
\]</span></p>
<p>この構造VARモデルの両辺に、<span class="math inline">\(\boldsymbol{A}\)</span>の逆行列<span class="math inline">\(\boldsymbol{A}^{-1}\)</span>を乗じると、推計可能な誘導VARモデルに変換することができます。</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \boldsymbol{A}^{-1} \boldsymbol{A}_0 + \boldsymbol{A}^{-1} \boldsymbol{A}_1 \boldsymbol{Y}_{t-1} + \boldsymbol{A}^{-1} \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t
\]</span></p>
<p>一方、対応するラグ次数1の誘導VARモデルを、</p>
<p><span class="math display">\[
\begin{aligned}
Y_{1,t} &amp;= b_{10} + b_{11,1}Y_{1,t-1} + b_{12,1}Y_{2,t-1} + b_{13,1}Y_{3,t-1} + u_{1,t} \\
Y_{2,t} &amp;= b_{20} + b_{21,1}Y_{1,t-1} + b_{22,1}Y_{2,t-1} + b_{23,1}Y_{3,t-1} + u_{2,t} \\
Y_{3,t} &amp;= b_{30} + b_{31,1}Y_{1,t-1} + b_{32,1}Y_{2,t-1} + b_{33,1}Y_{3,t-1} + u_{3,t} \\
\\
\begin{bmatrix}
Y_{1,t} \\
Y_{2,t} \\
Y_{3,t}
\end{bmatrix}
&amp;=
\begin{bmatrix}
b_{10} \\
b_{20} \\
b_{30}
\end{bmatrix}
+
\begin{bmatrix}
b_{11,1} &amp; b_{12,1} &amp; b_{13,1} \\
b_{21,1} &amp; b_{22,1} &amp; b_{23,1} \\
b_{31,1} &amp; b_{32,1} &amp; b_{33,1}
\end{bmatrix}
\begin{bmatrix}
Y_{1,t-1} \\
Y_{2,t-1} \\
Y_{3,t-1}
\end{bmatrix}
+
\begin{bmatrix}
u_{1,t} \\
u_{2,t} \\
u_{3,t}
\end{bmatrix} \\
\\
\boldsymbol{Y}_t &amp;= \boldsymbol{B}_0 + \boldsymbol{B}_1 \boldsymbol{Y}_{t-1} + \boldsymbol{u}_t
\end{aligned}
\]</span></p>
<p>とすると、各項は次のように対応します。</p>
<p><span class="math display">\[
\boldsymbol{A}^{-1} \boldsymbol{A}_0= \boldsymbol{B}_0, \quad \boldsymbol{A}^{-1} \boldsymbol{A}_1 = \boldsymbol{B}_1, \quad \boldsymbol{A}^{-1} \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t = \boldsymbol{u}_t
\]</span></p>
<p>ラグ次数1の誘導VARモデル<span class="math inline">\(\boldsymbol{Y}_t = \boldsymbol{B}_0 + \boldsymbol{B}_1 \boldsymbol{Y}_{t-1} + \boldsymbol{u}_t\)</span>は、右辺の<span class="math inline">\(\boldsymbol{Y}_{t-1}\)</span>に1期前の式を逐次代入していくと、次のように<span class="math inline">\(\boldsymbol{Y}_t\)</span>を過去の誘導誤差項の和で表すVMA表現に変換できます（エンダース（2019）P.269、P.278、村尾（2019）P.251）。ここで、<span class="math inline">\(\overline{\boldsymbol{Y}}\)</span>は<span class="math inline">\((\boldsymbol{I} + \boldsymbol{A}_1 + \boldsymbol{A}^2_1 + \cdots + \boldsymbol{A}^n_1)\boldsymbol{A}_0\)</span>の極限であり、要素数3の定数ベクトルになります。</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \overline{\boldsymbol{Y}} + \sum^{\infty}_{s=0}{(\boldsymbol{B}^s_1 \boldsymbol{u}_{t-s})}
\]</span></p>
<p>この式に<span class="math inline">\(\boldsymbol{u}_t = \boldsymbol{A}^{-1} \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t\)</span>を代入すると、</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \overline{\boldsymbol{Y}} + \sum^{\infty}_{s=0}{(\boldsymbol{B}^s_1 \boldsymbol{A}^{-1} \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_{t-s})}
\]</span></p>
<p>となり、これを行列表示すると、</p>
<p><span class="math display">\[
\small
\begin{aligned}
\begin{bmatrix}
Y_{1,t} \\
Y_{2,t} \\
Y_{3,t}
\end{bmatrix}
&amp;=
\begin{bmatrix}
\overline{Y_1} \\
\overline{Y_2} \\
\overline{Y_3}
\end{bmatrix}
+
\sum^{\infty}_{s=0}
{
\begin{bmatrix}
b_{11,1} &amp; b_{12,1} &amp; b_{13,1} \\
b_{21,1} &amp; b_{22,1} &amp; b_{23,1} \\
b_{31,1} &amp; b_{32,1} &amp; b_{33,1}
\end{bmatrix}^s
\begin{bmatrix}
1 &amp; -a_{12,0} &amp; -a_{13,0} \\
-a_{21,0} &amp; 1 &amp; -a_{23,0} \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}^{-1}
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix}
\begin{bmatrix}
\epsilon^{SD}_{1,t-s} \\
\epsilon^{SD}_{2,t-s} \\
\epsilon^{SD}_{3,t-s}
\end{bmatrix}
}
\end{aligned}
\]</span></p>
<p>となります。この<span class="math inline">\(3 \times 3\)</span>の係数行列<span class="math inline">\(\boldsymbol{B}^j_1 \boldsymbol{A}^{-1} \boldsymbol{B}\)</span>をまとめて、</p>
<p><span class="math display">\[
\boldsymbol{IRF}_s = \boldsymbol{B}^s_1 \boldsymbol{A}^{-1} \boldsymbol{B}
\]</span></p>
<p>とします。行列表示すると、</p>
<p><span class="math display">\[
\small
\begin{aligned}
\begin{bmatrix}
\mathit{IRF}_{11}(s) &amp; \mathit{IRF}_{12}(s) &amp; \mathit{IRF}_{13}(s) \\
\mathit{IRF}_{21}(s) &amp; \mathit{IRF}_{22}(s) &amp; \mathit{IRF}_{23}(s) \\
\mathit{IRF}_{31}(s) &amp; \mathit{IRF}_{32}(s) &amp; \mathit{IRF}_{33}(s)
\end{bmatrix}
&amp;=
\begin{bmatrix}
b_{11,1} &amp; b_{12,1} &amp; b_{13,1} \\
b_{21,1} &amp; b_{22,1} &amp; b_{23,1} \\
b_{31,1} &amp; b_{32,1} &amp; b_{33,1}
\end{bmatrix}^s
\begin{bmatrix}
1 &amp; -a_{12,0} &amp; -a_{13,0} \\
-a_{21,0} &amp; 1 &amp; -a_{23,0} \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}^{-1}
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix}
\end{aligned}
\]</span></p>
<p>となります。この<span class="math inline">\(\mathit{IRF}_{ij}(s)\)</span>は、<span class="math inline">\(t\)</span>期の<span class="math inline">\(s\)</span>期前（<span class="math inline">\(t-s\)</span>期）に発生した変数<span class="math inline">\(Y_{j,t-s}\)</span>の（標準化）構造ショック<span class="math inline">\(\epsilon^{SD}_{j,t-s}\)</span>が、<span class="math inline">\(t\)</span>期の変数<span class="math inline">\(Y_{i,t}\)</span>に及ぼす影響を表します。</p>
<p>このように、<span class="math inline">\(t-s\)</span>期に変数<span class="math inline">\(Y_{j,t-s}\)</span>に発生した構造ショック<span class="math inline">\(\epsilon_{j,t-s}\)</span>が<span class="math inline">\(t\)</span>期の変数<span class="math inline">\(Y_{i,t}\)</span>に及ぼす影響を、<span class="math inline">\(Y_{i,t}\)</span>の<span class="math inline">\(Y_{j,t-s}\)</span>に対する<strong>インパルス応答</strong>と呼び、インパルス応答の大きさを表す関数<span class="math inline">\(\mathit{IRF}_{ij}(s)\)</span>を<strong>インパルス応答関数（impulse response function、IRF）</strong>と呼びます。インパルス応答関数<span class="math inline">\(\mathit{IRF}_{ij}(s)\)</span>は<strong>衝撃乗数</strong>とも呼ばれます（エンダース（2019）P.279）。また、インパルス応答関数を束ねた行列<span class="math inline">\(\boldsymbol{IRF}_s\)</span>の中の<span class="math inline">\(\boldsymbol{B^s_1}\)</span>は<strong>イノベーション係数行列</strong>と呼ばれることがあります（村尾（2019）P.253）。</p>
<p>なお、上記のインパルス応答関数<span class="math inline">\(\mathit{IRF}_{ij}(s)\)</span>やイノベーション係数行列<span class="math inline">\(\boldsymbol{B^s_1}\)</span>は、ラグ次数1次のVARモデル<span class="math inline">\(\mathit{VAR}(1)\)</span>の場合の特殊な列です（そのため、上記のイノベーション係数行列は、誘導VARモデルのラグ次数1次の係数行列<span class="math inline">\(\boldsymbol{B_1}\)</span>のみで構成されています）。ラグ次数を<span class="math inline">\(p\)</span>に拡張したインパルス応答関数については、村尾（2019）P.251を参照してください。</p>
<p>さて、ここで問題になるのは、<span class="math inline">\(\mathit{IRF}_{ij}(s)\)</span>の一部である（構造VARモデルに由来する）行列<span class="math inline">\(\boldsymbol{A}\)</span>に含まれるパラメータ（<span class="math inline">\(a_{12,0}\)</span>、<span class="math inline">\(a_{13,0}\)</span>、<span class="math inline">\(a_{21,0}\)</span>、<span class="math inline">\(a_{23,0}\)</span>、<span class="math inline">\(a_{31,0}\)</span>、<span class="math inline">\(a_{32,0}\)</span>）が未知であることです。</p>
<p>そこで、これらの構造VARモデルの未知パラメータを、誘導VARモデルの推定結果から求める必要があります。しかし、いま考えている3変数1次ラグの構造VARモデルには合計21個（係数18個、構造誤差項の分散3個）の未知パラメータがある一方、対応する誘導VARモデルには合計18個（係数12個、誘導誤差項の分散・共分散各3個）のパラメータしかなく、そのままでは構造VARモデルの未知パラメータを求めることができません。推定した誘導VARモデルのパラメータから構造VARモデルの未知パラメータを求め（構造VARモデルを識別し）、インパルス応答関数を導出するためには、構造VARモデルのパラメータに少なくとも<span class="math inline">\(n(n-1)/2\)</span>（<span class="math inline">\(n\)</span>は変数の種類）個の制約を課す必要があります。したがって、3変数VARモデルであれば、必要な制約は<span class="math inline">\(3(3-1)/2 = 3\)</span>個です。</p>
<p>構造VARモデルにどのような制約を課すかによって、インパルス応答は次のような種類に分けることができます。</p>
<div id="非直交化インパルス応答" class="section level4 unnumbered hasAnchor">
<h4>非直交化インパルス応答<a href="09_var.html#非直交化インパルス応答" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>最も単純な制約は、行列<span class="math inline">\(\boldsymbol{A}\)</span>の非対角要素である未知パラメータ（<span class="math inline">\(a_{12,0}\)</span>、<span class="math inline">\(a_{13,0}\)</span>、<span class="math inline">\(a_{21,0}\)</span>、<span class="math inline">\(a_{23,0}\)</span>、<span class="math inline">\(a_{31,0}\)</span>、<span class="math inline">\(a_{32,0}\)</span>）をすべて0にすることです。これは、行列<span class="math inline">\(\boldsymbol{A}\)</span>を単位行列<span class="math inline">\(\boldsymbol{I}\)</span>（対角要素が1、非対角要素が0）に置き換えることに相当します。</p>
<p>行列<span class="math inline">\(\boldsymbol{A}\)</span>の6個の未知パラメータは、構造VARモデルにおいて変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>、<span class="math inline">\(Y_{3,t}\)</span>の同時点間の関係を表す係数です。したがって、<u>この制約は変数に同時点間の関係がない経済構造を想定していることを意味します</u>。このように同時点無相関の制約を課したインパルス応答は、<strong>非直交化インパルス応答（non-orthogonal impulse response）</strong>と呼ばれます。EViewsでは<code>Impulse Definition</code>の<code>Decomposition Method</code>で<code>Residual</code>を選択すると、同時点無相関の制約を課すことができます。</p>
<p>同時点無相関の制約は非常に強い仮定であり、適用できるモデルが限定されます。例えばGDPと政府支出の変数でVARモデルを構築する場合、政府支出に生じたショック（拡張的財政政策など）は同じ期のGDPに影響するため、同時点無相関の制約を課すことは適切ではありません。</p>
<p>なお、この制約では構造VARモデルの右辺にある同時点の項が消えるため、構造VARモデルは誘導VARモデルに一致し、推定した誘導誤差項<span class="math inline">\(u_{i,t}\)</span>をそのまま構造誤差項<span class="math inline">\(\epsilon_{i,t}\)</span>として使用することができます。</p>
<p>行列<span class="math inline">\(\boldsymbol{A}\)</span>の非対角要素を0とおくと、インパルス応答関数<span class="math inline">\(\mathit{IRF}_{ij}(s)\)</span>は次のように表すことができます。</p>
<p><span class="math display">\[
\boldsymbol{IRF}_s = \boldsymbol{B}^s_1 \boldsymbol{I}^{-1} \boldsymbol{B}
\]</span></p>
<p>これを行列表示すると、次の式になります。</p>
<p><span class="math display">\[
\small
\begin{aligned}
\begin{bmatrix}
\mathit{IRF}_{11}(s) &amp; \mathit{IRF}_{12}(s) &amp; \mathit{IRF}_{13}(s) \\
\mathit{IRF}_{21}(s) &amp; \mathit{IRF}_{22}(s) &amp; \mathit{IRF}_{23}(s) \\
\mathit{IRF}_{31}(s) &amp; \mathit{IRF}_{32}(s) &amp; \mathit{IRF}_{33}(s)
\end{bmatrix}
&amp;=
\begin{bmatrix}
b_{11,1} &amp; b_{12,1} &amp; b_{13,1} \\
b_{21,1} &amp; b_{22,1} &amp; b_{23,1} \\
b_{31,1} &amp; b_{32,1} &amp; b_{33,1}
\end{bmatrix}^s
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}^{-1}
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix} \\
\\
&amp;=
\begin{bmatrix}
b_{11,1} &amp; b_{12,1} &amp; b_{13,1} \\
b_{21,1} &amp; b_{22,1} &amp; b_{23,1} \\
b_{31,1} &amp; b_{32,1} &amp; b_{33,1}
\end{bmatrix}^s
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix}
\end{aligned}
\]</span></p>
<p>ここから、例えば、<span class="math inline">\(Y_{1,t}\)</span>の<span class="math inline">\(Y_{1,t}\)</span>に対するインパルス応答（<span class="math inline">\(\epsilon^{SD}_{1,t}\)</span>の変化が<span class="math inline">\(Y_{1_t}\)</span>に及ぼす影響）は<span class="math inline">\(\mathit{IRF}_{11}(0) = \sigma_1\)</span>と計算できます（なお、<span class="math inline">\(s=0\)</span>のとき<span class="math inline">\(\boldsymbol{B}^s_1 = \boldsymbol{I}\)</span>になります）。一方、<span class="math inline">\(Y_{1,t}\)</span>の<span class="math inline">\(Y_{2,t}\)</span>に対するインパルス応答（<span class="math inline">\(\epsilon^{SD}_{2,t}\)</span>の変化が<span class="math inline">\(Y_{1_t}\)</span>に及ぼす影響）は<span class="math inline">\(\mathit{IRF}_{12}(0) = 0\)</span>であり、他の変数に対する同時点のインパルス応答は必ず0になることが確認できます。</p>
</div>
<div id="直交化インパルス応答" class="section level4 unnumbered hasAnchor">
<h4>直交化インパルス応答<a href="09_var.html#直交化インパルス応答" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>次に、非直交化インパルス応答で想定した「同時点無相関の制約」より柔軟な制約として、「構造VAR」の「短期制約：再帰的制約」（コレスキー分解による識別）と同じ制約を課したインパルス応答を求めます。再帰的制約を課したインパルス応答は、<strong>直交化インパルス応答（orthogonal impulse response）</strong>と呼ばれます。通常、インパルス応答と言えばこの直交化インパルス応答を指します。EViewsでは<code>Impulse Definition</code>の<code>Decomposition Method</code>で<code>Cholesky</code>を選択すると、再帰的制約を課した直交化インパルス応答を求めることができます。</p>
<p>再帰的制約では次のように、行列<span class="math inline">\(\boldsymbol{A}\)</span>の右上三角部分を0と置く制約を課します。</p>
<p><span class="math display">\[
\boldsymbol{IRF}_s = \boldsymbol{B}^s_1 \boldsymbol{A}^{-1} \boldsymbol{B}
\]</span></p>
<p>行列表記すると次のとおりです。</p>
<p><span class="math display">\[
\small
\begin{aligned}
\begin{bmatrix}
\mathit{IRF}_{11}(s) &amp; \mathit{IRF}_{12}(s) &amp; \mathit{IRF}_{13}(s) \\
\mathit{IRF}_{21}(s) &amp; \mathit{IRF}_{22}(s) &amp; \mathit{IRF}_{23}(s) \\
\mathit{IRF}_{31}(s) &amp; \mathit{IRF}_{32}(s) &amp; \mathit{IRF}_{33}(s)
\end{bmatrix}
&amp;=
\begin{bmatrix}
b_{11,1} &amp; b_{12,1} &amp; b_{13,1} \\
b_{21,1} &amp; b_{22,1} &amp; b_{23,1} \\
b_{31,1} &amp; b_{32,1} &amp; b_{33,1}
\end{bmatrix}^s
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
-a_{21,0} &amp; 1 &amp; 0 \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}^{-1}
\begin{bmatrix}
\sigma_{1} &amp; 0 &amp; 0 \\
0 &amp; \sigma_{2} &amp; 0 \\
0 &amp; 0 &amp; \sigma_{3}
\end{bmatrix}
\end{aligned}
\]</span></p>
<p>すると、同時点間（<span class="math inline">\(s=0\)</span>）のインパルス応答関数は、<span class="math inline">\(\boldsymbol{A}\)</span>の逆行列の計算結果、</p>
<p><span class="math display">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
-a_{21,0} &amp; 1 &amp; 0 \\
-a_{31,0} &amp; -a_{32,0} &amp; 1
\end{bmatrix}^{-1}
=
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
a_{21,0} &amp; 1 &amp; 0 \\
a_{31,0} + a_{21,0}a_{32,0} &amp; a_{32,0} &amp; 1
\end{bmatrix}
\]</span></p>
<p>を使うと、それぞれ次のように求められます。なお、<span class="math inline">\(s=0\)</span>のとき<span class="math inline">\(\boldsymbol{B}^s_1 = \boldsymbol{I}\)</span>になります。</p>
<p><span class="math display">\[
\begin{aligned}
\mathit{IRF}_{11}(0) &amp;= \sigma_1 \\
\mathit{IRF}_{12}(0) &amp;= 0 \\
\mathit{IRF}_{13}(0) &amp;= 0 \\
\\
\mathit{IRF}_{21}(0) &amp;= a_{21,0} \sigma_1 \\
\mathit{IRF}_{22}(0) &amp;= \sigma_2 \\
\mathit{IRF}_{23}(0) &amp;= 0 \\
\\
\mathit{IRF}_{31}(0) &amp;= (a_{31,0} + a_{21,0}a_{32,0}) \sigma_1 \\
\mathit{IRF}_{32}(0) &amp;= a_{32,0} \sigma_2 \\
\mathit{IRF}_{33}(0) &amp;= \sigma_3
\end{aligned}
\]</span></p>
<p>ここから分かるように、再帰的制約を課した直交化インパルス応答は、次のように変数の順序によってインパルス応答関数の形状が異なる非対称性があります。</p>
<ul>
<li><span class="math inline">\(Y_{1,t}\)</span>は同時点の<span class="math inline">\(Y_{2,t}\)</span>、<span class="math inline">\(Y_{3,t}\)</span>から影響を受けない（<span class="math inline">\(\mathit{IRF}_{12}(0)=0\)</span>、<span class="math inline">\(\mathit{IRF}_{13}(0)=0\)</span>）。</li>
<li><span class="math inline">\(Y_{2,t}\)</span>は同時点の<span class="math inline">\(Y_{1,t}\)</span>から影響を受けるが（<span class="math inline">\(\mathit{IRF}_{21}(0) = a_{21,0} \sigma_1\)</span>）、<span class="math inline">\(Y_{3,t}\)</span>から影響を受けない（<span class="math inline">\(\mathit{IRF}_{13}(0)=0\)</span>）。</li>
<li><span class="math inline">\(Y_{3,t}\)</span>は同時点の<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>から影響を受ける（<span class="math inline">\(\mathit{IRF}_{31}(0) = (a_{31,0} + a_{21,0}a_{32,0}) \sigma_1\)</span>、<span class="math inline">\(\mathit{IRF}_{32}(0) = a_{32,0} \sigma_2\)</span>）。</li>
</ul>
<p>これは、「順序が先の変数（ここでは<span class="math inline">\(Y_{1}\)</span>）ほど外生性が強く（他変数に影響するが自分は他変数の影響を受けない）、順序が後の変数（ここでは<span class="math inline">\(Y_{3}\)</span>）ほど内生性が強い（他変数の影響を受けるが自分は他変数に影響しない）」と暗黙理に仮定していることを意味します。実際のデータがこの仮定通りであれば問題ありませんが、仮定と異なっていれば、インパルス応答を誤って導出することになります。</p>
<p>直交化インパルス応答における変数の順序付けの影響を確認には、変数の順序を変えて複数のインパルス応答を計算し、結果を比較します。インパルス応答の形状が著しく異なっている場合は、どの順序が経済構造に照らし合わせて適切か判断する必要があります。また、より柔軟な制約として、同時点無相関の制約や再帰的制約以外の制約を構造VARに課したり、変数の順序に左右されない一般化インパルス応答の活用を検討します。</p>
</div>
<div id="構造varに基づくインパルス応答" class="section level4 unnumbered hasAnchor">
<h4>構造VARに基づくインパルス応答<a href="09_var.html#構造varに基づくインパルス応答" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>同時点無相関の制約を課した非直交化インパルス応答や、変数の順序に基づき機械的に同時点間の関係を決める直交化インパルス応答が、経済理論に照らし合わせて不自然な結果になる場合は、「構造VARモデル」の「短期制約：非再帰的制約」のように経済理論に基づいた柔軟な制約を課す必要があります。</p>
<p>非再帰的制約の具体例は、「構造VARモデル」の「短期制約：非再帰的制約」を参照してください。制約を考える際は、変数の種類<span class="math inline">\(n\)</span>に対して、少なくとも<span class="math inline">\(n(n-1)/2\)</span>個の制約を<span class="math inline">\(\boldsymbol{A}\)</span>行列に置く必要があることに注意します。</p>
</div>
<div id="一般化インパルス応答" class="section level4 unnumbered hasAnchor">
<h4>一般化インパルス応答<a href="09_var.html#一般化インパルス応答" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>ここまで紹介した非直交化インパルス応答、直交化インパルス応答、構造VARモデルに基づくインパルス応答は、全て構造VARモデルの同時点の関係を表す係数（行列<span class="math inline">\(\boldsymbol{A}\)</span>）に特定の制約を課して誘導VARモデルから構造VARモデルを識別し、インパルス応答を計算する仕組みでした。</p>
<p><strong>一般化インパルス応答（generalized impulse response）</strong>は、それらとは全く異なり、構造VARモデルに特定の制約を課さずにインパルス応答を計算する手法です（村尾（2019）P.265）。</p>
<p>任意の変数<span class="math inline">\(Y_{*,t}\)</span>の<span class="math inline">\(Y_{j,t-s}\)</span>に対するインパルス応答関数を<span class="math inline">\(\mathit{IRF}_{*j}(s)\)</span>とすると、これまで紹介したインパルス応答関数<span class="math inline">\(\mathit{IRF}^O_{*j}(s)\)</span>は次のように表すことができます（ラグ次数1次のVARモデル<span class="math inline">\(VAR(1)\)</span>の場合）。なお、<span class="math inline">\(\boldsymbol{e}_j\)</span>は変数<span class="math inline">\(Y_j\)</span>の標準化構造誤差項<span class="math inline">\(\epsilon^{SD}_j\)</span>の単位ショックを格納した列ベクトルであり、例えば3変数VARモデルにおける<span class="math inline">\(j=2\)</span>の単位ショックベクトルは<span class="math inline">\(\boldsymbol{e}_2=(0,1,0)&#39;\)</span>です（村尾（2019）P.261）。</p>
<p><span class="math display">\[
\mathit{IRF}^O_{*j}(s) = \boldsymbol{B}^s_1 \boldsymbol{A}^{-1} \boldsymbol{B} \boldsymbol{e}_j
\]</span></p>
<p>一方、ラグ次数1次のVARモデル<span class="math inline">\(VAR(1)\)</span>の場合の一般化インパルス応答関数<span class="math inline">\(\mathit{IRF}^G_{*j}(s)\)</span>は、<span class="math inline">\(\boldsymbol{A}^{-1} \boldsymbol{B}\)</span>を<span class="math inline">\(\boldsymbol{\Sigma}_u / \sqrt{\sigma_{jj}}\)</span>で置き換えた形になっています（村尾（2019）P.266）。<span class="math inline">\(\boldsymbol{\Sigma}_u\)</span>は誘導誤差項<span class="math inline">\(\boldsymbol{u}_t\)</span>の分散共分散行列、<span class="math inline">\(\sqrt{\sigma_{jj}}\)</span>は変数<span class="math inline">\(Y_{j,t}\)</span>の誘導誤差項<span class="math inline">\(u_{j,t}\)</span>の標準偏差（分散<span class="math inline">\(\sigma_{jj}\)</span>の平方根）です。</p>
<p><span class="math display">\[
\mathit{IRF}^G_{*j}(s) = \boldsymbol{B}^s_1 \frac{\boldsymbol{\Sigma}_u}{\sqrt{\sigma_{jj}}} \boldsymbol{e}_j
\]</span></p>
<p>誘導誤差項の分散共分散行列<span class="math inline">\(\boldsymbol{\Sigma}_u\)</span>（3変数の場合）は次の通り、対角要素に誘導誤差項<span class="math inline">\(u_{i,t}\)</span>の分散<span class="math inline">\(\sigma_{ii}\)</span>、非対角要素に誘導誤差項<span class="math inline">\(u_{i,t}\)</span>と<span class="math inline">\(u_{j,t}\)</span>の共分散<span class="math inline">\(\sigma_{ij}\)</span>が並ぶ行列です。なお、分母である誘導誤差項の標準偏差<span class="math inline">\(\sqrt{\sigma_{jj}}\)</span>は、ショック<span class="math inline">\(\boldsymbol{\Sigma}_u \boldsymbol{e}_j\)</span>の大きさを標準化する役割があります。</p>
<p><span class="math display">\[
\boldsymbol{\Sigma}_u =
\begin{bmatrix}
\sigma_{11} &amp; \sigma_{12} &amp; \sigma_{13} \\
\sigma_{21} &amp; \sigma_{22} &amp; \sigma_{23} \\
\sigma_{31} &amp; \sigma_{32} &amp; \sigma_{33}
\end{bmatrix}
\]</span></p>
<p>要するに一般化インパルス応答は、構造VARモデルに制約を置いて変数の同時点間の関係を（恣意的に）特定化する代わりに、データから推定できる誘導誤差項の同時点間の関係（誘導誤差項の分散共分散行列）をそのまま変数の同時点間の関係として使ってしまおうというアイデアです。</p>
<p>一般化インパルス応答を用いる際には、次の点に注意してください。</p>
<ol style="list-style-type: decimal">
<li><p>一般化インパルス応答は誤差項の正規分布を仮定しているため、誤差項の正規性の検定により、正規分布の仮定が妥当であるか確認する必要があります。</p></li>
<li><p>一般化インパルス応答は、直交インパルス応答と異なり、インパルス応答関数の形状が内生変数を並べる順序に依存しません。</p></li>
<li><p>第1変数の誤差項にショックを与える場合、一般化インパルス応答と直交化インパルス応答の結果は一致します。</p></li>
<li><p>第1変数以外の誤差項にショックを与える場合、一般化インパルス応答と直交化インパルス応答の結果は一致しません。</p></li>
<li><p>誘導誤差項の分散共分散行列<span class="math inline">\(\boldsymbol{\Sigma}_u\)</span>が対角行列の場合（すなわち変数が同時点無相関の場合）、一般化インパルス応答と直交化インパルス応答の結果は一致します。</p></li>
</ol>
</div>
</div>
<div id="予測誤差の分散分解" class="section level3 hasAnchor" number="9.9.3">
<h3><span class="header-section-number">9.9.3</span> 予測誤差の分散分解<a href="09_var.html#予測誤差の分散分解" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>予測誤差の分散分解（forecast error variance decomposition, FEVD）</strong>は、ある変数の変動に対して他の変数がどの程度影響しているかを定量的に分析する手法です（西山 他（2019）P.614、エンダース（2019）P.286、村尾（2019）P.339）。インパルス応答と、予測誤差の分散分解は、どちらも経済変数の総合依存関係を調べるための重要な分析手法であり、両者は合わせて<strong>イノベーション会計（innovation accounting）</strong>と呼ばれます（エンダース（2019）P.288）。</p>
<p>具体的には、<span class="math inline">\(t+1\)</span>期における変数の実現値を<span class="math inline">\(Y_{t+1}\)</span>、<span class="math inline">\(t\)</span>時点の情報をもとに<span class="math inline">\(t+1\)</span>期の値を予測した値を<span class="math inline">\(Y_{t+1|t}\)</span>とし、その差である予測誤差を<span class="math inline">\(Y_{t+1} - Y_{t+1|t}\)</span>としたとき、予測誤差の分散である<strong>平均2乗予測誤差（Mean Squared Forecast Error、MSFE）</strong><span class="math inline">\(E[(Y_{t+1} - Y_{t+1|t})^2]\)</span>に対して、各変数の独立ショックの寄与度を計算します。この寄与度を<strong>分散寄与度（Relative Variance Contribution、RVC）</strong>と呼びます。</p>
<p>例えば3変数<span class="math inline">\(Y_{1,t}\)</span>、<span class="math inline">\(Y_{2,t}\)</span>、<span class="math inline">\(Y_{3,t}\)</span>のVARモデルにおいて、<span class="math inline">\(t-s\)</span>期に変数<span class="math inline">\(Y_{j,t-s}\)</span>に発生した独立ショック<span class="math inline">\(\epsilon_{j,t-s}\)</span>が<span class="math inline">\(t\)</span>期の変数<span class="math inline">\(Y_{i,t}\)</span>に及ぼす影響を、<span class="math inline">\(Y_{i,t}\)</span>の<span class="math inline">\(Y_{j,t-s}\)</span>に対するインパルス応答と呼び、関数<span class="math inline">\(\mathit{IRF}_{ij}(s)\)</span>で表すとします。</p>
<p>ここで、<span class="math inline">\(h\)</span>期先の変数<span class="math inline">\(Y_{1,t+h}\)</span>のMSFEに占める<span class="math inline">\(\epsilon_{2,t}\)</span>の分散寄与度（RVC）は、</p>
<p><span class="math display">\[
\frac{\sum^{h-1}_{s=0}{\mathit{IRF}_{12}(s)^2}}{\sum^{h-1}_{s=0}{\mathit{IRF}{11}(s)^2} + \sum^{h-1}_{s=0}{\mathit{IRF}_{12}(s)^2} + \sum^{h-1}_{s=0}{\mathit{IRF}_{13}(s)^2}}
\]</span></p>
<p>で計算できます。</p>
<p>予測誤差の分散分解（FEVD）を行う上では、次の点に注意してください。</p>
<ol style="list-style-type: decimal">
<li><p><u>予測誤差の分散分解はインパルス応答関数を用いて計算されるため、インパルス応答と同様に構造誤差項の識別が問題になります</u>。構造VARモデルに誤った制約を課すと、そこから得られる分散分解の結果も現実の経済構造を反映しないものになります。</p></li>
<li><p>予測誤差の分散分解では、多くの場合、<u>予測期間が短い場合は自己変数のショックが予測誤差分散の大半を占め、予測期間が長くなるに連れてその他の変数のショックの影響が大きくなっていきます</u>。これは、変数間の同時点の相関関係が大きくないことに起因しています。</p></li>
</ol>
</div>
</div>
<div id="varモデルの分析フロー" class="section level2 hasAnchor" number="9.10">
<h2><span class="header-section-number">9.10</span> VARモデルの分析フロー<a href="09_var.html#varモデルの分析フロー" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>VARモデルは、次のような一連のフローに基づいて分析を実施します。</p>
<div id="探索的データ分析-2" class="section level3 unnumbered hasAnchor">
<h3>1. 探索的データ分析<a href="09_var.html#探索的データ分析-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データの折れ線グラフや自己相関・偏自己相関プロットを作成し、季節性やトレンドといったデータの特徴を把握します。</p>
</div>
<div id="変数選択" class="section level3 unnumbered hasAnchor">
<h3>2. 変数選択<a href="09_var.html#変数選択" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>経済理論やグレンジャー因果性検定をもとに、VARモデルに含める変数を選択します。</p>
<p>既存のモデルに新たな変数を加える場合は、グレンジャー因果性検定を実施し、新たな変数が少なくとも一つの既存変数に対しグレンジャー因果性をもてば（「因果性がない」との帰無仮説を棄却できれば）、変数をモデルに追加します（エンダース（2019）P.293）。</p>
<p>ただし、グレンジャー因果性検定の結果はラグ次数の選択に大きく依存します。したがって、グレンジャー因果性検定を使用した変数選択は、次の「ラグ次数の選択」と不可分であり、両者を同時並行で実施するのが良いでしょう。</p>
<p>Rでは<code>vars</code>パッケージの<code>causality()</code>関数でグレンジャー因果性検定を実施します。</p>
</div>
<div id="ラグ次数の選択" class="section level3 unnumbered hasAnchor">
<h3>3. ラグ次数の選択<a href="09_var.html#ラグ次数の選択" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>自己回帰（AR）過程のラグ次数<span class="math inline">\(p\)</span>を選択します。選択したラグ次数<span class="math inline">\(p\)</span>は、この後に行う単位根検定、共和分検定、モデル推定で使用します。</p>
<p>まず、妥当であると考えられる最長のラグ次数<span class="math inline">\(p\)</span>を設定します。例えば四半期データ分析において「モデルの動学的な特性を捉えるには3年程度の長さが必要である」と判断される場合、最長のラグは12になります（エンダース（2019）P.289）。</p>
<p>次に、情報量規準を用いて実際にモデルで用いるラグ次数<span class="math inline">\(p\)</span>を決定します。ラグ次数を選択するための情報量規準には、赤池情報量規準（Akaike Information Criterion、AIC）、赤池最終予測誤差（Akaike’s Final Prediction Error、FPE）、ハナン＝クイン情報量規準（Hannan-Quinn Information Criterion、HQ）、シュワルツのベイズ情報量規準（Schwarz Bayesian Information Criterion、SC）があります。これら3つの情報量規準が選ぶラグ次数には、<span class="math inline">\(\mathit{SC} \leq \mathit{HQ} \leq \mathit{AIC} \fallingdotseq \mathit{FPE}\)</span>の関係があります。時系列データのサンプルサイズが大きい場合はSCを、小さい場合はAICかFPEを、どちらか迷う場合はHQを選択してください（村尾（2019）P.117）。</p>
<p>ラグ次数<span class="math inline">\(p\)</span>が小さすぎると、モデルの特定化を誤ってしまう可能性が高まる点に注意してください。ラグ次数の選択で迷う場面があれば、長めのラグ次数にしておくことが無難です（エンダース（2019）P289、P.291）。</p>
<p>Rでは<code>vars</code>パッケージの<code>VARselect()</code>関数を用いてVARモデルを暫定的に推定し、あらかじめ決めておいた情報量規準に基づいてラグ次数を選択します。</p>
</div>
<div id="単位根検定-1" class="section level3 unnumbered hasAnchor">
<h3>4. 単位根検定<a href="09_var.html#単位根検定-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>VAR分析に用いる時系列データそれぞれに対してADF検定を行い、データの定常性を確認します。原系列のままで定常なレベル定常過程（<span class="math inline">\(I(0)\)</span>）か、単位根をもつ階差定常過程（和分過程、<span class="math inline">\(I(1)\)</span>）かを判断します。また、定数項やトレンド項の確定項の有無もあわせて確認します。</p>
<p>単位根検定の結果に基づき、適用するモデルが変わります。</p>
<ul>
<li>全ての変数が<span class="math inline">\(I(0)\)</span>のケース：　レベルVARモデルを適用（フロー7へ）</li>
<li>1つの変数が<span class="math inline">\(I(1)\)</span>：　階差VARモデルを適用（フロー7へ）</li>
<li>2つ以上の変数が<span class="math inline">\(I(1)\)</span>：　共和分検定を行い、<span class="math inline">\(I(1)\)</span>変数間の共和分関係の有無を確認（フロー5へ）</li>
</ul>
<p>Rでは本書で自作したADF検定フロー関数の<code>adf_test_flow()</code>関数を用いて単位根検定を行います。</p>
</div>
<div id="共和分検定" class="section level3 unnumbered hasAnchor">
<h3>5. 共和分検定<a href="09_var.html#共和分検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>単位根検定で2つ以上の<span class="math inline">\(I(1)\)</span>変数があると判断した場合は、共和分検定を行い、<span class="math inline">\(I(1)\)</span>変数間に共和分関係があるか判断します。</p>
<p>共和分検定の結果に基づき、適用するモデルが変わります。</p>
<ul>
<li>共和分関係がないケース：　階差VARモデルを適用（フロー7へ）</li>
<li>共和分関係があるケース：　VECモデルを適用（フロー7へ）</li>
</ul>
<p>Rでは本書で自作したヨハンセン検定フロー関数の<code>johansen_test_flow()</code>関数を用いて共和分検定を行います。</p>
</div>
<div id="データ分割-1" class="section level3 unnumbered hasAnchor">
<h3>6. データ分割<a href="09_var.html#データ分割-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>VARモデルを将来予測に用いる場合は、予測精度を評価するため、データを訓練データとテストデータに分割します。</p>
<p>Rでは、ts形式のデータを分割するには<code>stats::window()</code>関数を使用して<code>start</code>引数と<code>end</code>引数に時点を指定します。tibble形式などのデータフレーム形式の場合は、<code>dplyr::slice()</code>関数で行インデックスを指定するか、データフレームの列に日付などの時点情報の列が含まれる場合は<code>dplyr::filter()</code>関数で行をフィルタします。詳細は、第8章の「ts形式データ」、第4章の「行のスライスとサンプリング」と「行のフィルタ」を参照してください。</p>
</div>
<div id="誘導varvecモデルの推定" class="section level3 unnumbered hasAnchor">
<h3>7. 誘導VAR・VECモデルの推定<a href="09_var.html#誘導varvecモデルの推定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここまでに実施した一連の<strong>診断的検定（diagnostic test）</strong>に基づき、誘導形のレベルVARモデル、階差VARモデル、VECモデルを推定します。</p>
<p>誘導形のレベルVARモデルと階差VARモデルは、<code>vars</code>パッケージの<code>VAR()</code>関数で推定します。階差VARモデルの場合は事前に変数を階差変換しておきます。</p>
<p>一方、誘導形のVECモデルは、<code>urca</code>パッケージの<code>cajorls()</code>関数で推定します。具体的には、ヨハンセン検定に用いる<code>urca</code>パッケージの<code>ca.jo()</code>関数で共和分ランクを決定したうえで、<code>ca.jo()</code>関数で出力したオブジェクトを<code>urca::cajorls()</code>関数の入力として用い、VECモデルを推定します。</p>
</div>
<div id="構造varvecモデルの識別" class="section level3 unnumbered hasAnchor">
<h3>8. 構造VAR・VECモデルの識別<a href="09_var.html#構造varvecモデルの識別" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>インパルス応答や予測誤差の分散分解を行うには、推定した誘導VAR・VECモデルから構造VAR・VECモデルを識別する必要があります。</p>
<p>構造VARモデルは、<code>vars</code>パッケージの<code>SVAR()</code>関数で推定します。構造VECモデルは同じく<code>vars</code>パッケージの<code>SVEC()</code>関数で推定することができます。</p>
</div>
<div id="誤差項の検定" class="section level3 unnumbered hasAnchor">
<h3>9. 誤差項の検定<a href="09_var.html#誤差項の検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>誘導形のVAR・VECモデルが推定できたら、誤差項の推定量である残差系列を用いて、誤差項に系列相関がないか、分散が均一か、正規分布に従っているかを検定します。これらの誤差項の仮定が満たされない場合は、変数の選択やラグ次数の選択を再度行い、モデル推定をやり直す必要があります。</p>
<p>VARモデルの場合は、<code>vars::VAR()</code>関数で出力したオブジェクトを、それぞれの検定用関数に入力します。VECモデルの場合は、<code>urca::ca.jo()</code>関数で出力したアウトプットを<code>vars::vec2var()</code>関数でVARモデルのオブジェクトに変換し、検定用の関数に入力します。</p>
<div id="系列無相関" class="section level4 unnumbered hasAnchor">
<h4>系列無相関<a href="09_var.html#系列無相関" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>系列無相関の主な検定には、次の4種類があります。</p>
<ul>
<li>ボックス＝ピアース検定（Box-Pierce test）、別名：ポルトマント検定（Portmanteau test）</li>
<li>リュン＝ボックス検定（Ljung-Box test）、別名：修正ポルトマント検定（Adjusted Portmanteau test）</li>
<li>ブロイシュ＝ゴッドフレイLM検定（Breusch-Godfrey LM test）</li>
<li>エドガートン＝シュクル検定（Edgerton-Shukur test）</li>
</ul>
<p>ブロイシュ＝ゴッドフレイLM検定（もしくは、その小標本版のエドガートン＝シュクル検定）が主流です（村尾（2019）P.178）。4つの検定すべてにおいて、帰無仮説は「系列無相関」であり、Rでは<code>vars</code>パッケージの<code>serial.test()</code>関数で4つの検定を実行できます。</p>
</div>
<div id="均一分散" class="section level4 unnumbered hasAnchor">
<h4>均一分散<a href="09_var.html#均一分散" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>均一分散の主な検定には、次の3種類があります。</p>
<ul>
<li>ブロイシュ＝ペーガン検定（Breusch-Pagan test）</li>
<li>ホワイト検定（White test）</li>
<li>ARCH-LM検定</li>
</ul>
<p>村尾（2019）P.183では、実用性の観点からARCH-LM検定を用いるべきとしています。3つの検定すべてにおいて帰無仮説は「均一分散」です。Rでは<code>vars</code>パッケージの<code>arch.test()</code>関数でARCH-LM検定を実行することができます。</p>
</div>
<div id="正規分布" class="section level4 unnumbered hasAnchor">
<h4>正規分布<a href="09_var.html#正規分布" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>正規分布の検定には、ジャック＝ベラ検定（Jarque-Bera test）を用いるのが一般的です（村尾（2019）P.184）。ジャック＝ベラ検定の帰無仮説は「正規分布」であり、Rでは<code>vars</code>パッケージの<code>normality.test()</code>関数で実行できます。</p>
</div>
</div>
<div id="モデル推定後の分析" class="section level3 unnumbered hasAnchor">
<h3>10. モデル推定後の分析<a href="09_var.html#モデル推定後の分析" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>推定したモデルを用いて、インパルス応答、予測誤差の分散分解、グレンジャー因果性検定といった追加的な分析を行います。インパルス応答には<code>vars</code>パッケージの<code>irf()</code>関数、予測誤差の分散分解には<code>vars</code>パッケージの<code>fevd()</code>関数、グレンジャー因果性検定には<code>vars</code>パッケージの<code>causality()</code>関数を用います。</p>
<p><code>vars::irf()</code>関数と<code>vars::fevd()</code>関数の入力として用いることができるオブジェクトは、誘導VARモデル<code>vars::VAR()</code>、構造VARモデル<code>vars::SVAR()</code>、構造VECモデル<code>vars::SVEC()</code>の出力のみです。<code>urca</code>パッケージの<code>cajorls()</code>関数で推定した誘導VECモデルのオブジェクトは、そのままでは<code>vars::irf()</code>関数や<code>vars::fevd()</code>関数の入力としては使用できないため、あらかじめ<code>vars</code>パッケージの<code>vec2var()</code>関数でオブジェクトを変換しておきます。</p>
<p>なお、<code>vars::causality()</code>関数の入力として用いることができるオブジェクトは、誘導VARモデル<code>vars::VAR()</code>の出力のみです。</p>
</div>
<div id="予測" class="section level3 unnumbered hasAnchor">
<h3>11. 予測<a href="09_var.html#予測" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>推定したモデルを用いて、先行きの予測値を作成します。予測値の作成には、<code>vars</code>パッケージの<code>predict()</code>関数を用います。</p>
<p>予測値は、分割しておいたテストデータの実績値と比較して精度を評価します。評価指標にはRMSE（Root Mean Square Error）などが用いられます。加えて、過去の平均値や前期の値を予測値として用いるナイーブ予測（VARなどの複雑なモデルを使わない予測）の精度を上回ることを確認します。</p>
</div>
</div>
<div id="varモデルの実例" class="section level2 hasAnchor" number="9.11">
<h2><span class="header-section-number">9.11</span> VARモデルの実例<a href="09_var.html#varモデルの実例" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>VARモデルに関する様々なパターンの分析フローをRで再現した実例です。</p>
<div id="実例探索的データ分析" class="section level3 hasAnchor" number="9.11.1">
<h3><span class="header-section-number">9.11.1</span> 実例：探索的データ分析<a href="09_var.html#実例探索的データ分析" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>vars</code>パッケージの<code>Canada</code>データセットに含まれる雇用者数（<code>e</code>、自然対数×100）、実質労働生産性（<code>prod</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）の4変数に対し、探索的データ分析を行います。データ頻度は四半期、期間は1980年1-3月期〜2000年10-12月期です。</p>
<p>まず、<code>data()</code>関数で<code>Canada</code>データセットを呼び出し、<code>forecast</code>パッケージの<code>ggtsdisplay()</code>関数で折れ線グラフと自己相関・偏自己相関プロットを作成します。</p>
<p><code>Canada</code>データセットに格納されているデータはts形式データのため、そのまま<code>ggtsdisplay()</code>関数を適用します。なお、tibble形式などのデータフレーム形式のデータも<code>ggtsdisplay()</code>関数の入力として用いることができますが、その場合は<code>ggtsdisplay()</code>関数で出力した図表の横軸が日付ではなくインデックスになります。</p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="09_var.html#cb968-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb968-2"><a href="09_var.html#cb968-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb968-3"><a href="09_var.html#cb968-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb968-4"><a href="09_var.html#cb968-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数をプロット</span></span>
<span id="cb968-5"><a href="09_var.html#cb968-5" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(Canada[, <span class="st">&quot;e&quot;</span>], <span class="at">main =</span> <span class="st">&quot;雇用者数 e&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-446-1.png" width="672" /></p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="09_var.html#cb969-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(Canada[, <span class="st">&quot;prod&quot;</span>], <span class="at">main =</span> <span class="st">&quot;実質労働生産性 prod&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-446-2.png" width="672" /></p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="09_var.html#cb970-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(Canada[, <span class="st">&quot;rw&quot;</span>], <span class="at">main =</span> <span class="st">&quot;実質賃金 rw&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-446-3.png" width="672" /></p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="09_var.html#cb971-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ggtsdisplay</span>(Canada[, <span class="st">&quot;U&quot;</span>], <span class="at">main =</span> <span class="st">&quot;失業率 U&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-446-4.png" width="672" /></p>
<p>VARモデルでは変数間の関係性も重要なので、<code>GGally</code>パッケージの<code>ggpairs()</code>関数でペアプロットを作成します。<code>ggpairs()</code>関数で作成したペアプロットは、対角部分が各変数の折れ線グラフ、上三角部分が2変数間の相関係数、下三角部分が2変数の散布図になります。</p>
<p>ここでは、レベルVARモデル、階差VARモデル双方に対応できるよう、変数のレベル系列と階差系列それぞれについてペアプロットを作成します。階差系列を作成するには<code>diff()</code>関数を使用し、階差次数を<code>lag</code>引数に指定します。</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="09_var.html#cb972-1" aria-hidden="true" tabindex="-1"></a><span class="co"># レベル系列のペアプロット</span></span>
<span id="cb972-2"><a href="09_var.html#cb972-2" aria-hidden="true" tabindex="-1"></a>Canada <span class="sc">%&gt;%</span> </span>
<span id="cb972-3"><a href="09_var.html#cb972-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb972-4"><a href="09_var.html#cb972-4" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="at">progress =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-447-1.png" width="672" /></p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="09_var.html#cb973-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 階差系列のペアプロット</span></span>
<span id="cb973-2"><a href="09_var.html#cb973-2" aria-hidden="true" tabindex="-1"></a>Canada <span class="sc">%&gt;%</span> </span>
<span id="cb973-3"><a href="09_var.html#cb973-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>(<span class="at">lag =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb973-4"><a href="09_var.html#cb973-4" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb973-5"><a href="09_var.html#cb973-5" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="at">progress =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-447-2.png" width="672" /></p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="09_var.html#cb974-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyrを使って階差系列のペアプロットを作成する場合</span></span>
<span id="cb974-2"><a href="09_var.html#cb974-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Canada %&gt;% </span></span>
<span id="cb974-3"><a href="09_var.html#cb974-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   tibble::as_tibble() %&gt;% </span></span>
<span id="cb974-4"><a href="09_var.html#cb974-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::mutate(across(.cols = everything(), .fns = ~ {. - dplyr::lag(.)})) %&gt;% </span></span>
<span id="cb974-5"><a href="09_var.html#cb974-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   tidyr::drop_na() %&gt;% </span></span>
<span id="cb974-6"><a href="09_var.html#cb974-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   GGally::ggpairs(progress = FALSE)</span></span></code></pre></div>
</div>
<div id="実例変数選択グレンジャー因果性検定" class="section level3 hasAnchor" number="9.11.2">
<h3><span class="header-section-number">9.11.2</span> 実例：変数選択（グレンジャー因果性検定）<a href="09_var.html#実例変数選択グレンジャー因果性検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>村尾（2019）P.379の「15.7 Rによるグレンジャー因果性検定」を再現します。<code>vars</code>パッケージの<code>Canada</code>データセットに対しグレンジャー因果性検定を行って、VARモデルに含める変数を選択します。</p>
<p>雇用者数（<code>e</code>、自然対数×100）、実質労働生産性（<code>prod</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）の4変数について、原因変数を1つずつ選び、他の3変数に対するグレンジャー因果性があるかを確かめます。これら4変数はマクロ経済の時系列変数であり、何も単位根を持っている可能性があるため、レベル系列と階差系列の2パターンでグレンジャー因果性検定を行います。</p>
<p>Rのグレンジャー因果性検定は、まず<code>vars</code>パッケージの<code>VAR()</code>関数で検定対象になる変数を含むVARモデルを暫定的に推定し、次に<code>causality()</code>関数へVARモデルを入力して検定を行います。なお、ここではVARモデルのラグ次数<code>p</code>を暫定的に2としておきます。</p>
<p><code>Canada</code>データセットの4変数について、ラグ次数2でレベル系列のグレンジャー因果性検定を次のように実施したところ、全ての検定において有意水準5％で帰無仮説が棄却されました。したがって、どの変数も他の3変数に対しグレンジャー因果性を持っていると判断できます。</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="09_var.html#cb975-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb975-2"><a href="09_var.html#cb975-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb975-3"><a href="09_var.html#cb975-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb975-4"><a href="09_var.html#cb975-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットのレベル系列のVARモデルを暫定的に推定</span></span>
<span id="cb975-5"><a href="09_var.html#cb975-5" aria-hidden="true" tabindex="-1"></a>model_var_canada <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(Canada, <span class="co"># VARモデルを構築するデータセット</span></span>
<span id="cb975-6"><a href="09_var.html#cb975-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">p =</span> <span class="dv">2</span>, <span class="co"># ラグ次数</span></span>
<span id="cb975-7"><a href="09_var.html#cb975-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;const&quot;, &quot;trend&quot;, &quot;both&quot;, &quot;none&quot;）</span></span>
<span id="cb975-8"><a href="09_var.html#cb975-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb975-9"><a href="09_var.html#cb975-9" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb975-10"><a href="09_var.html#cb975-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb975-11"><a href="09_var.html#cb975-11" aria-hidden="true" tabindex="-1"></a><span class="co"># forループで全ての変数に対しグレンジャー因果性検定を実施</span></span>
<span id="cb975-12"><a href="09_var.html#cb975-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">colnames</span>(Canada)) {</span>
<span id="cb975-13"><a href="09_var.html#cb975-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># グレンジャー因果性検定</span></span>
<span id="cb975-14"><a href="09_var.html#cb975-14" aria-hidden="true" tabindex="-1"></a>  granger_canada <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">causality</span>(model_var_canada, <span class="co"># VARモデルの推計結果</span></span>
<span id="cb975-15"><a href="09_var.html#cb975-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cause =</span> x, <span class="co"># 原因変数（文字列で指定。ベクトルにして2種類以上の原因変数を指定することも可能）</span></span>
<span id="cb975-16"><a href="09_var.html#cb975-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">vcov. =</span> <span class="cn">NULL</span>, <span class="co"># 共和分行列を指定（デフォルトはNULL）</span></span>
<span id="cb975-17"><a href="09_var.html#cb975-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">boot =</span> <span class="cn">FALSE</span>, <span class="co"># 棄却点をブートストラップ法で計算する場合はTRUE（デフォルトはFALSE）</span></span>
<span id="cb975-18"><a href="09_var.html#cb975-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">boot.runs =</span> <span class="dv">1000</span> <span class="co"># ブートストラップ法の繰り返し数</span></span>
<span id="cb975-19"><a href="09_var.html#cb975-19" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb975-20"><a href="09_var.html#cb975-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># グレンジャー因果性検定の結果を出力</span></span>
<span id="cb975-21"><a href="09_var.html#cb975-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># $Instantにするとグレンジャー瞬間的因果性検定の結果が出力される</span></span>
<span id="cb975-22"><a href="09_var.html#cb975-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(granger_canada<span class="sc">$</span>Granger)</span>
<span id="cb975-23"><a href="09_var.html#cb975-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 
##  Granger causality H0: e do not Granger-cause prod rw U
## 
## data:  VAR object model_var_canada
## F-Test = 6.2768, df1 = 6, df2 = 292, p-value = 3.206e-06
## 
## 
##  Granger causality H0: prod do not Granger-cause e rw U
## 
## data:  VAR object model_var_canada
## F-Test = 2.7811, df1 = 6, df2 = 292, p-value = 0.01205
## 
## 
##  Granger causality H0: rw do not Granger-cause e prod U
## 
## data:  VAR object model_var_canada
## F-Test = 2.594, df1 = 6, df2 = 292, p-value = 0.01828
## 
## 
##  Granger causality H0: U do not Granger-cause e prod rw
## 
## data:  VAR object model_var_canada
## F-Test = 2.8116, df1 = 6, df2 = 292, p-value = 0.01126</code></pre>
<p>次に、<code>Canada</code>データセットの1階階差系列に対し、同様にグレンジャー因果性検定を行います。その結果、原因変数が失業率<code>U</code>の時だけ有意水準5％で帰無仮説を棄却できませんでした。したがって1階階差系列では、雇用者数<code>e</code>、実質労働生産性<code>prod</code>、実質賃金<code>rw</code>がそれぞれ他の3変数に対しグレンジャー因果性を持つと判断できる一方、失業率<code>U</code>は他の3変数に対しグレンジャー因果性を持つと判断することはできません。</p>
<p>階差VARモデルを構築する場合に、雇用者数<code>e</code>、実質労働生産性<code>prod</code>、実質賃金<code>rw</code>の予測が重要であり、失業率<code>U</code>に関心がないのであれば、失業率<code>U</code>をモデルから除くことを検討すべきです。ここでは失業率<code>U</code>の予測にも関心があることから、失業率<code>U</code>もVARモデルに含めます。</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="09_var.html#cb977-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットの1階階差系列のVARモデルを暫定的に推定</span></span>
<span id="cb977-2"><a href="09_var.html#cb977-2" aria-hidden="true" tabindex="-1"></a>model_var_canada_diff <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="fu">diff</span>(Canada, <span class="at">lag =</span> <span class="dv">1</span>), <span class="co"># VARモデルを構築するデータセット</span></span>
<span id="cb977-3"><a href="09_var.html#cb977-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">p =</span> <span class="dv">2</span>, <span class="co"># ラグ次数</span></span>
<span id="cb977-4"><a href="09_var.html#cb977-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;const&quot;, &quot;trend&quot;, &quot;both&quot;, &quot;none&quot;）</span></span>
<span id="cb977-5"><a href="09_var.html#cb977-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb977-6"><a href="09_var.html#cb977-6" aria-hidden="true" tabindex="-1"></a>                                   )</span>
<span id="cb977-7"><a href="09_var.html#cb977-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb977-8"><a href="09_var.html#cb977-8" aria-hidden="true" tabindex="-1"></a><span class="co"># forループで全ての変数に対しグレンジャー因果性検定を実施</span></span>
<span id="cb977-9"><a href="09_var.html#cb977-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">colnames</span>(Canada)) {</span>
<span id="cb977-10"><a href="09_var.html#cb977-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># グレンジャー因果性検定</span></span>
<span id="cb977-11"><a href="09_var.html#cb977-11" aria-hidden="true" tabindex="-1"></a>  granger_canada <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">causality</span>(model_var_canada_diff, <span class="co"># VARモデルの推計結果</span></span>
<span id="cb977-12"><a href="09_var.html#cb977-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cause =</span> x, <span class="co"># 原因変数（文字列で指定。ベクトルにして2種類以上の原因変数を指定することも可能）</span></span>
<span id="cb977-13"><a href="09_var.html#cb977-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">vcov. =</span> <span class="cn">NULL</span>, <span class="co"># 共和分行列を指定（デフォルトはNULL）</span></span>
<span id="cb977-14"><a href="09_var.html#cb977-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">boot =</span> <span class="cn">FALSE</span>, <span class="co"># 棄却点をブートストラップ法で計算する場合はTRUE（デフォルトはFALSE）</span></span>
<span id="cb977-15"><a href="09_var.html#cb977-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">boot.runs =</span> <span class="dv">1000</span> <span class="co"># ブートストラップ法の繰り返し数</span></span>
<span id="cb977-16"><a href="09_var.html#cb977-16" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb977-17"><a href="09_var.html#cb977-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># グレンジャー因果性検定の結果を出力</span></span>
<span id="cb977-18"><a href="09_var.html#cb977-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># $Instantにするとグレンジャー瞬間的因果性検定の結果が出力される</span></span>
<span id="cb977-19"><a href="09_var.html#cb977-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(granger_canada<span class="sc">$</span>Granger)</span>
<span id="cb977-20"><a href="09_var.html#cb977-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 
##  Granger causality H0: e do not Granger-cause prod rw U
## 
## data:  VAR object model_var_canada_diff
## F-Test = 5.6853, df1 = 6, df2 = 288, p-value = 1.332e-05
## 
## 
##  Granger causality H0: prod do not Granger-cause e rw U
## 
## data:  VAR object model_var_canada_diff
## F-Test = 3.3915, df1 = 6, df2 = 288, p-value = 0.003008
## 
## 
##  Granger causality H0: rw do not Granger-cause e prod U
## 
## data:  VAR object model_var_canada_diff
## F-Test = 2.9202, df1 = 6, df2 = 288, p-value = 0.00883
## 
## 
##  Granger causality H0: U do not Granger-cause e prod rw
## 
## data:  VAR object model_var_canada_diff
## F-Test = 1.5734, df1 = 6, df2 = 288, p-value = 0.1547</code></pre>
<p>なお、ラグ次数を変化させてグレンジャー因果性検定の結果がどう変わるかを<code>for</code>ループで確認することができます。次の例は、<code>Canada</code>データセットの1階階差系列に対し、VARモデル推定時のラグ次数を1〜12で変化させた結果を出力するコードです。</p>
<p>その結果を見ると、ラグ次数が2〜3のときは失業率<code>U</code>を除く3変数がグレンジャー因果性を持ちますが、ラグ次数が4〜5次ではGranegr因果性を持つ変数が雇用者数<code>e</code>のみになり、6次以上では全ての変数がグレンジャー因果性を持たないとの結果になりました。この傾向は<code>Canada</code>データセットのレベル系列を対象にする場合でも大きく変わらず、ラグ次数が高次になるとグレンジャー因果性が消失することが確認できます。</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="09_var.html#cb979-1" aria-hidden="true" tabindex="-1"></a><span class="co"># グレンジャー因果性検定の結果を格納するtibbleを作成</span></span>
<span id="cb979-2"><a href="09_var.html#cb979-2" aria-hidden="true" tabindex="-1"></a>granger_canada_diff <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb979-3"><a href="09_var.html#cb979-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lag =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb979-4"><a href="09_var.html#cb979-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">variable =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb979-5"><a href="09_var.html#cb979-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">pvalue =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb979-6"><a href="09_var.html#cb979-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">sig =</span> <span class="cn">NA_character_</span></span>
<span id="cb979-7"><a href="09_var.html#cb979-7" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb979-8"><a href="09_var.html#cb979-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-9"><a href="09_var.html#cb979-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ラグ次数の候補</span></span>
<span id="cb979-10"><a href="09_var.html#cb979-10" aria-hidden="true" tabindex="-1"></a>lags <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb979-11"><a href="09_var.html#cb979-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-12"><a href="09_var.html#cb979-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ラグ次数のforループ</span></span>
<span id="cb979-13"><a href="09_var.html#cb979-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (l <span class="cf">in</span> lags) {</span>
<span id="cb979-14"><a href="09_var.html#cb979-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># VARモデル推定</span></span>
<span id="cb979-15"><a href="09_var.html#cb979-15" aria-hidden="true" tabindex="-1"></a>  model_temp <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="fu">diff</span>(Canada, <span class="at">lag =</span> <span class="dv">1</span>), <span class="co"># VARモデルを構築するデータセット</span></span>
<span id="cb979-16"><a href="09_var.html#cb979-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">p =</span> l, <span class="co"># ラグ次数</span></span>
<span id="cb979-17"><a href="09_var.html#cb979-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;const&quot;, &quot;trend&quot;, &quot;both&quot;, &quot;none&quot;）</span></span>
<span id="cb979-18"><a href="09_var.html#cb979-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb979-19"><a href="09_var.html#cb979-19" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb979-20"><a href="09_var.html#cb979-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 変数のforループ</span></span>
<span id="cb979-21"><a href="09_var.html#cb979-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">colnames</span>(Canada)) {</span>
<span id="cb979-22"><a href="09_var.html#cb979-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># グレンジャー因果性検定</span></span>
<span id="cb979-23"><a href="09_var.html#cb979-23" aria-hidden="true" tabindex="-1"></a>    granger_temp <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">causality</span>(model_temp, <span class="co"># VARモデルの推計結果</span></span>
<span id="cb979-24"><a href="09_var.html#cb979-24" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cause =</span> x, <span class="co"># 原因変数（文字列で指定。ベクトルにして2種類以上の原因変数を指定することも可能）</span></span>
<span id="cb979-25"><a href="09_var.html#cb979-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">vcov. =</span> <span class="cn">NULL</span>, <span class="co"># 共和分行列を指定（デフォルトはNULL）</span></span>
<span id="cb979-26"><a href="09_var.html#cb979-26" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">boot =</span> <span class="cn">FALSE</span>, <span class="co"># 棄却点をブートストラップ法で計算する場合はTRUE（デフォルトはFALSE）</span></span>
<span id="cb979-27"><a href="09_var.html#cb979-27" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">boot.runs =</span> <span class="dv">1000</span> <span class="co"># ブートストラップ法の繰り返し数</span></span>
<span id="cb979-28"><a href="09_var.html#cb979-28" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb979-29"><a href="09_var.html#cb979-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># グレンジャー因果性検定の結果をtibbleに追加</span></span>
<span id="cb979-30"><a href="09_var.html#cb979-30" aria-hidden="true" tabindex="-1"></a>    granger_canada_diff <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb979-31"><a href="09_var.html#cb979-31" aria-hidden="true" tabindex="-1"></a>      tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="at">lag =</span> l,</span>
<span id="cb979-32"><a href="09_var.html#cb979-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">variable =</span> x,</span>
<span id="cb979-33"><a href="09_var.html#cb979-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pvalue =</span> granger_temp<span class="sc">$</span>Granger<span class="sc">$</span>p.value <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb979-34"><a href="09_var.html#cb979-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sig =</span> <span class="fu">case_when</span>(granger_temp<span class="sc">$</span>Granger<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">&quot;＊&quot;</span>)</span>
<span id="cb979-35"><a href="09_var.html#cb979-35" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb979-36"><a href="09_var.html#cb979-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb979-37"><a href="09_var.html#cb979-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb979-38"><a href="09_var.html#cb979-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb979-39"><a href="09_var.html#cb979-39" aria-hidden="true" tabindex="-1"></a><span class="co"># tibbleを横型に変換して出力</span></span>
<span id="cb979-40"><a href="09_var.html#cb979-40" aria-hidden="true" tabindex="-1"></a>granger_canada_diff <span class="sc">%&gt;%</span> </span>
<span id="cb979-41"><a href="09_var.html#cb979-41" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">&quot;lag&quot;</span>, <span class="at">names_from =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;pvalue&quot;</span>, <span class="st">&quot;sig&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb979-42"><a href="09_var.html#cb979-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 12 × 9
##      lag  pvalue_e pvalue_prod pvalue_rw pvalue_U sig_e sig_prod sig_rw sig_U
##    &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;
##  1     1 0.0000159     0.00781   0.381     0.0540 ＊    ＊       &lt;NA&gt;   &lt;NA&gt; 
##  2     2 0.0000133     0.00301   0.00883   0.155  ＊    ＊       ＊     &lt;NA&gt; 
##  3     3 0.000154      0.0301    0.0133    0.152  ＊    ＊       ＊     &lt;NA&gt; 
##  4     4 0.00205       0.0742    0.0854    0.0736 ＊    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
##  5     5 0.0163        0.0588    0.0611    0.0762 ＊    &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
##  6     6 0.121         0.235     0.181     0.200  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
##  7     7 0.269         0.422     0.681     0.390  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
##  8     8 0.473         0.439     0.904     0.336  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
##  9     9 0.574         0.419     0.986     0.216  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
## 10    10 0.723         0.565     0.912     0.280  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
## 11    11 0.889         0.745     0.969     0.295  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt; 
## 12    12 0.786         0.825     0.846     0.307  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;</code></pre>
</div>
<div id="実例ラグ次数選択" class="section level3 hasAnchor" number="9.11.3">
<h3><span class="header-section-number">9.11.3</span> 実例：ラグ次数選択<a href="09_var.html#実例ラグ次数選択" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>村尾（2019）P.118の「5.3 Rによるラグ字数の選択」を再現します。対象は<code>vars</code>パッケージの<code>Canada</code>データセットに含まれる雇用者数（<code>e</code>、自然対数×100）、実質労働生産性（<code>prod</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）の4変数です。</p>
<p>まず、<code>Canada</code>データセットのレベル系列に対して<code>vars</code>パッケージの<code>VARselect()</code>関数を適用し、情報量規準に基づくラグ次数を計算します。<code>VARselect()</code>関数の<code>type</code>引数には、モデルに含む確定項を指定します。確定項は、<code>const</code>：定数項のみ、<code>trend</code>：タイムトレンド項のみ、<code>both</code>：定数項とタイムトレンド項の両方、<code>none</code>：確定項なし、の4種類から選択します。</p>
<p><code>Canada</code>データセットのレベル系列に対し<code>VARselect()</code>関数を適用すると、次の結果が得られます。情報量規準により最適なラグ次数が1〜3と異なりますが、ここでは中間的なHQ（Hannan-Quinn Information Criterion）の「2」を暫定的に選択します。最終的なラグ次数の決定は、VAR・VECモデルの推定後に誤差項の仮定に関する検定を行い、選択したラグ次数のもとで誤差項が系列無相関、均一分散、正規分布の仮定を満たしているかを踏まえて判断します。</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="09_var.html#cb981-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb981-2"><a href="09_var.html#cb981-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb981-3"><a href="09_var.html#cb981-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb981-4"><a href="09_var.html#cb981-4" aria-hidden="true" tabindex="-1"></a>varselect_canada <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VARselect</span>(<span class="at">y =</span> Canada, <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb981-5"><a href="09_var.html#cb981-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">&quot;both&quot;</span>, <span class="co"># モデルに含む確定項（&quot;const&quot;, &quot;trend&quot;, &quot;both&quot;, &quot;none&quot;）</span></span>
<span id="cb981-6"><a href="09_var.html#cb981-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">lag.max =</span> <span class="dv">8</span> <span class="co"># 検査するラグ次数の最大値</span></span>
<span id="cb981-7"><a href="09_var.html#cb981-7" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb981-8"><a href="09_var.html#cb981-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb981-9"><a href="09_var.html#cb981-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(varselect_canada)</span></code></pre></div>
<pre><code>## $selection
## AIC(n)  HQ(n)  SC(n) FPE(n) 
##      3      2      1      3 
## 
## $criteria
##                   1            2            3            4            5
## AIC(n) -6.272579064 -6.636669705 -6.771176872 -6.634609210 -6.398132246
## HQ(n)  -5.978429449 -6.146420347 -6.084827770 -5.752160366 -5.319583658
## SC(n)  -5.536558009 -5.409967947 -5.053794411 -4.426546046 -3.699388378
## FPE(n)  0.001889842  0.001319462  0.001166019  0.001363175  0.001782055
##                   6            7           8
## AIC(n) -6.307704843 -6.070727259 -6.06159685
## HQ(n)  -5.033056512 -4.599979185 -4.39474903
## SC(n)  -3.118280272 -2.390621985 -1.89081087
## FPE(n)  0.002044202  0.002768551  0.00306012</code></pre>
<p>また、1次の階差系列についても同様に最適なラグ次数を確認すると、1〜2次となります。ここでも同様にHQの「1」を暫定的に採用します。</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="09_var.html#cb983-1" aria-hidden="true" tabindex="-1"></a>varselect_canada <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VARselect</span>(<span class="at">y =</span> <span class="fu">diff</span>(Canada, <span class="at">lag =</span> <span class="dv">1</span>),</span>
<span id="cb983-2"><a href="09_var.html#cb983-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">&quot;both&quot;</span>,</span>
<span id="cb983-3"><a href="09_var.html#cb983-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">lag.max =</span> <span class="dv">8</span></span>
<span id="cb983-4"><a href="09_var.html#cb983-4" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb983-5"><a href="09_var.html#cb983-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb983-6"><a href="09_var.html#cb983-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(varselect_canada)</span></code></pre></div>
<pre><code>## $selection
## AIC(n)  HQ(n)  SC(n) FPE(n) 
##      2      1      1      2 
## 
## $criteria
##                  1            2            3            4            5
## AIC(n) -6.27372428 -6.356374491 -6.175322581 -6.076315440 -5.956187509
## HQ(n)  -5.97761306 -5.862855794 -5.484396406 -5.187981786 -4.870446377
## SC(n)  -5.53212808 -5.120380830 -4.444931456 -3.851526851 -3.237001456
## FPE(n)  0.00188778  0.001746773  0.002117316  0.002386034  0.002780352
##                   6           7            8
## AIC(n) -5.825348974 -5.83585581 -5.800448783
## HQ(n)  -4.542200363 -4.35529972 -4.122485215
## SC(n)  -2.611765456 -2.12787483 -1.598070337
## FPE(n)  0.003327675  0.00352927  0.004021854</code></pre>
</div>
<div id="実例adf検定" class="section level3 hasAnchor" number="9.11.4">
<h3><span class="header-section-number">9.11.4</span> 実例：ADF検定<a href="09_var.html#実例adf検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>定義した自作関数<code>adf_test_flow()</code>を用い、村尾（2019）「6.7 拡張ディッキー＝フラー検定の例」（P.141）及び、「6.10 Rによる拡張ディッキー＝フラー検定」（P.147）の例を再現します。村尾（2019）6.7、6.10では、<code>vars</code>パッケージの<code>Canada</code>データセットのうち実質労働生産性（<code>prod</code>、自然対数×100）だけがADF検定の対象になっていますが、ここでは雇用者数（<code>e</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）に対してもADF検定を行います。</p>
<p>自作関数<code>adf_test_flow()</code>で4変数に対しADF検定を行った結果、次の結果が得られました。なお、ラグ次数選択基準はAIC（Akaike Information Criterion）とし、最大ラグ次数は「実例：ラグ次数選択」で選択した2に設定しています。</p>
<ul>
<li>雇用者数<code>e</code>：1次の階差系列に対するtrend第1検定で「単位根あり」の帰無仮説を棄却。<code>I(1)</code>過程と判断。</li>
<li>実質労働生産性<code>prod</code>：1次の階差系列に対するtrend第1検定で「単位根あり」の帰無仮説を棄却。<code>I(1)</code>過程と判断。</li>
<li>実質賃金<code>rw</code>：レベル系列に対するtrend第2検定で「単位根あり」の帰無仮説を棄却。<code>I(0)</code>過程と判断。</li>
<li>失業率<code>U</code>：1次の階差系列に対するtrend第1検定で「単位根あり」の帰無仮説を棄却。<code>I(1)</code>過程と判断。</li>
</ul>
<p>4変数のうち3変数が非定常な<code>I(1)</code>過程、1変数が定常な<code>I(0)</code>過程と判断できました。<code>I(1)</code>過程の変数が2つ以上あるため、分析フローに基けば、この後に共和分検定を実施して、<code>I(1)</code>変数間に共和分の関係があるか確認するのが適切です。</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="09_var.html#cb985-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb985-2"><a href="09_var.html#cb985-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb985-3"><a href="09_var.html#cb985-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb985-4"><a href="09_var.html#cb985-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaの変数名に対するforループ</span></span>
<span id="cb985-5"><a href="09_var.html#cb985-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="fu">colnames</span>(Canada)) {</span>
<span id="cb985-6"><a href="09_var.html#cb985-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yにadf_test_flow()関数を適用</span></span>
<span id="cb985-7"><a href="09_var.html#cb985-7" aria-hidden="true" tabindex="-1"></a>  test_adf <span class="ot">&lt;-</span> <span class="fu">adf_test_flow</span>(<span class="at">y =</span> Canada[, y], <span class="co"># 検定対象の時系列データ</span></span>
<span id="cb985-8"><a href="09_var.html#cb985-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">lag_criterion =</span> <span class="st">&quot;AIC&quot;</span>, <span class="co"># ラグ次数選択基準</span></span>
<span id="cb985-9"><a href="09_var.html#cb985-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">lags_max =</span> <span class="dv">2</span>, <span class="co"># AICで自動選択する最大ラグ次数</span></span>
<span id="cb985-10"><a href="09_var.html#cb985-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb985-11"><a href="09_var.html#cb985-11" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb985-12"><a href="09_var.html#cb985-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 結果をコンソールに出力</span></span>
<span id="cb985-13"><a href="09_var.html#cb985-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(y)</span>
<span id="cb985-14"><a href="09_var.html#cb985-14" aria-hidden="true" tabindex="-1"></a>  test_adf <span class="sc">%&gt;%</span> </span>
<span id="cb985-15"><a href="09_var.html#cb985-15" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">フロー</span><span class="st">`</span>, <span class="st">`</span><span class="at">階差次数</span><span class="st">`</span>, <span class="st">`</span><span class="at">モデル</span><span class="st">`</span>, <span class="st">`</span><span class="at">判断</span><span class="st">`</span>, <span class="st">`</span><span class="at">判断経路</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb985-16"><a href="09_var.html#cb985-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb985-17"><a href="09_var.html#cb985-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;e&quot;
## # A tibble: 14 × 5
##    フロー 階差次数 モデル         判断                        判断経路
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                       &lt;chr&gt;   
##  1      1        0 trend 第1検定  単位根の判断保留：フロー2へ &quot;＊&quot;    
##  2      2        0 trend 複合検定 トレンド項なし：フロー4へ   &quot;＊&quot;    
##  3      3        0 trend 第2検定  単位根なし：I(0)過程        &quot;&quot;      
##  4      4        0 drift 第1検定  単位根の判断保留：フロー5へ &quot;＊&quot;    
##  5      5        0 drift 複合検定 定数項なし：フロー7へ       &quot;＊&quot;    
##  6      6        0 drift 第2検定  階差変換し再検定            &quot;&quot;      
##  7      7        0 none           階差変換し再検定            &quot;＊&quot;    
##  8      8        1 trend 第1検定  単位根なし：I(1)過程        &quot;＊&quot;    
##  9      9        1 trend 複合検定 トレンド項あり：フロー10へ  &quot;&quot;      
## 10     10        1 trend 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 11     11        1 drift 第1検定  単位根なし：I(1)過程        &quot;&quot;      
## 12     12        1 drift 複合検定 定数項あり：フロー13へ      &quot;&quot;      
## 13     13        1 drift 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 14     14        1 none           単位根なし：I(1)過程        &quot;&quot;      
## [1] &quot;prod&quot;
## # A tibble: 14 × 5
##    フロー 階差次数 モデル         判断                        判断経路
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                       &lt;chr&gt;   
##  1      1        0 trend 第1検定  単位根の判断保留：フロー2へ &quot;＊&quot;    
##  2      2        0 trend 複合検定 トレンド項なし：フロー4へ   &quot;＊&quot;    
##  3      3        0 trend 第2検定  単位根なし：I(0)過程        &quot;&quot;      
##  4      4        0 drift 第1検定  単位根の判断保留：フロー5へ &quot;＊&quot;    
##  5      5        0 drift 複合検定 定数項なし：フロー7へ       &quot;＊&quot;    
##  6      6        0 drift 第2検定  階差変換し再検定            &quot;&quot;      
##  7      7        0 none           階差変換し再検定            &quot;＊&quot;    
##  8      8        1 trend 第1検定  単位根なし：I(1)過程        &quot;＊&quot;    
##  9      9        1 trend 複合検定 トレンド項あり：フロー10へ  &quot;&quot;      
## 10     10        1 trend 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 11     11        1 drift 第1検定  単位根なし：I(1)過程        &quot;&quot;      
## 12     12        1 drift 複合検定 定数項あり：フロー13へ      &quot;&quot;      
## 13     13        1 drift 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 14     14        1 none           単位根なし：I(1)過程        &quot;&quot;      
## [1] &quot;rw&quot;
## # A tibble: 14 × 5
##    フロー 階差次数 モデル         判断                        判断経路
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                       &lt;chr&gt;   
##  1      1        0 trend 第1検定  単位根の判断保留：フロー2へ &quot;＊&quot;    
##  2      2        0 trend 複合検定 トレンド項あり：フロー3へ   &quot;＊&quot;    
##  3      3        0 trend 第2検定  単位根なし：I(0)過程        &quot;＊&quot;    
##  4      4        0 drift 第1検定  単位根なし：I(0)過程        &quot;&quot;      
##  5      5        0 drift 複合検定 定数項あり：フロー6へ       &quot;&quot;      
##  6      6        0 drift 第2検定  単位根なし：I(0)過程        &quot;&quot;      
##  7      7        0 none           階差変換し再検定            &quot;&quot;      
##  8      8        1 trend 第1検定  単位根なし：I(1)過程        &quot;&quot;      
##  9      9        1 trend 複合検定 トレンド項あり：フロー10へ  &quot;&quot;      
## 10     10        1 trend 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 11     11        1 drift 第1検定  単位根なし：I(1)過程        &quot;&quot;      
## 12     12        1 drift 複合検定 定数項あり：フロー13へ      &quot;&quot;      
## 13     13        1 drift 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 14     14        1 none           単位根なし：I(1)過程        &quot;&quot;      
## [1] &quot;U&quot;
## # A tibble: 14 × 5
##    フロー 階差次数 モデル         判断                        判断経路
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                       &lt;chr&gt;   
##  1      1        0 trend 第1検定  単位根の判断保留：フロー2へ &quot;＊&quot;    
##  2      2        0 trend 複合検定 トレンド項なし：フロー4へ   &quot;＊&quot;    
##  3      3        0 trend 第2検定  単位根なし：I(0)過程        &quot;&quot;      
##  4      4        0 drift 第1検定  単位根の判断保留：フロー5へ &quot;＊&quot;    
##  5      5        0 drift 複合検定 定数項なし：フロー7へ       &quot;＊&quot;    
##  6      6        0 drift 第2検定  単位根なし：I(0)過程        &quot;&quot;      
##  7      7        0 none           階差変換し再検定            &quot;＊&quot;    
##  8      8        1 trend 第1検定  単位根なし：I(1)過程        &quot;＊&quot;    
##  9      9        1 trend 複合検定 トレンド項あり：フロー10へ  &quot;&quot;      
## 10     10        1 trend 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 11     11        1 drift 第1検定  単位根なし：I(1)過程        &quot;&quot;      
## 12     12        1 drift 複合検定 定数項あり：フロー13へ      &quot;&quot;      
## 13     13        1 drift 第2検定  単位根なし：I(1)過程        &quot;&quot;      
## 14     14        1 none           単位根なし：I(1)過程        &quot;&quot;</code></pre>
</div>
<div id="実例ヨハンセン検定-1" class="section level3 hasAnchor" number="9.11.5">
<h3><span class="header-section-number">9.11.5</span> 実例：ヨハンセン検定<a href="09_var.html#実例ヨハンセン検定-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>定義した自作関数<code>johansen_test_flow()</code>を用い、村尾（2019）「7.4 ヨハンセン検定の例」（P.158）及び、「7.7 Rによるヨハンセン検定」（P.166）の例を再現します。</p>
<p>村尾（2019）7.4及び7.7では、<code>vars</code>パッケージの<code>Canada</code>データセットに含まれるカナダの実質労働生産性（<code>prod</code>、自然対数×100）、雇用者数（<code>e</code>、自然対数×100）、失業率（<code>U</code>、％）、実質賃金（<code>rw</code>、自然対数×100）の4変数（サンプルサイズ84）に対し、ヨハンセン検定を適用しています。</p>
<p>村尾（2019）P.158には、「検定対象の変数は、単位根検定（ADF検定）において、それぞれ<span class="math inline">\(I(1)\)</span>過程と判断した4個の変数である」との記載がありますが、ADF検定フロー自作関数の<code>adf_test_flow()</code>でADF検定を実施したところ、有意水準5％では<code>Canada</code>データセットの実質賃金<code>rw</code>は<span class="math inline">\(I(1)\)</span>過程ではなく<span class="math inline">\(I(0)\)</span>過程と判断できます。すると4変数のうち<code>I(1)</code>過程の変数は3変数であり、共和分関係の数は最大で2になります。</p>
<p><code>johansen_test_flow()</code>自作関数における事前推定VARモデルのオプションでは、ラグ次数選択基準の<code>lag_criterion</code>にHannan-Quinn情報量規準を意味する<code>"HQ"</code>を、確定項の<code>ver_type</code>にトレンド項と定数項の両方を意味する<code>"both"</code>を指定します。また、ヨハンセン検定のオプションでは、誤差修正スペックを意味する<code>johansen_spec</code>に「一時的」を意味する<code>"transitory"</code>を指定します。なお、村尾（2019）7.4及び7.7では検定の優位水準を10％としていますが、ここでは5％を指定します。</p>
<p><code>johansen_test_flow()</code>自作関数を実行した結果、trendモデルとnoneモデルでは共和分関係の数が1、constモデルでは2と判断されました（ラグ次数は何も2次）。なお、トレース検定と最大固有値検定の結果はどのモデルにおいても一致しています。村尾（2019）7.4及び7.7ではtrendモデルを採用し、共和分関係の数を1と判断しています。</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="09_var.html#cb987-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb987-2"><a href="09_var.html#cb987-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb987-3"><a href="09_var.html#cb987-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-4"><a href="09_var.html#cb987-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaにヨハンセン検定フローを適用</span></span>
<span id="cb987-5"><a href="09_var.html#cb987-5" aria-hidden="true" tabindex="-1"></a>jo_canada <span class="ot">&lt;-</span> <span class="fu">johansen_test_flow</span>(<span class="at">data =</span> Canada, <span class="co"># ヨハンセン検定を行う時系列データセット</span></span>
<span id="cb987-6"><a href="09_var.html#cb987-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lag_criterion =</span> <span class="st">&quot;HQ&quot;</span>, <span class="co"># 事前推定VARモデルでラグ次数を決定する情報量規準</span></span>
<span id="cb987-7"><a href="09_var.html#cb987-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lags_max =</span> <span class="dv">10</span>, <span class="co"># 最大ラグ次数</span></span>
<span id="cb987-8"><a href="09_var.html#cb987-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">var_type =</span> <span class="st">&quot;both&quot;</span>, <span class="co"># 事前推定VARモデルに含む確定項</span></span>
<span id="cb987-9"><a href="09_var.html#cb987-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">johansen_spec =</span> <span class="st">&quot;transitory&quot;</span>, <span class="co"># 共和分関係の均衡からの乖離が一時的・長期的か（&quot;transitory&quot;, &quot;longrun&quot;）</span></span>
<span id="cb987-10"><a href="09_var.html#cb987-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sig_level =</span> <span class="fl">0.05</span> <span class="co"># 有意水準</span></span>
<span id="cb987-11"><a href="09_var.html#cb987-11" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb987-12"><a href="09_var.html#cb987-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-13"><a href="09_var.html#cb987-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果をコンソールに表示</span></span>
<span id="cb987-14"><a href="09_var.html#cb987-14" aria-hidden="true" tabindex="-1"></a>jo_canada<span class="sc">$</span>trend</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["タイプ"],"name":[1],"type":["chr"],"align":["left"]},{"label":["確定項"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[3],"type":["int"],"align":["right"]},{"label":["共和分関係の数"],"name":[4],"type":["int"],"align":["right"]},{"label":["棄却点"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["判断"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"trace","2":"trend","3":"2","4":"0","5":"62.99","6":"86.116246","7":"H0：共和分関係の数＝0を棄却"},{"1":"trace","2":"trend","3":"2","4":"1","5":"42.44","6":"37.333030","7":"共和分関係の数＝1と判断"},{"1":"trace","2":"trend","3":"2","4":"2","5":"25.32","6":"15.645187","7":"NA"},{"1":"trace","2":"trend","3":"2","4":"3","5":"12.25","6":"4.100722","7":"NA"},{"1":"eigen","2":"trend","3":"2","4":"0","5":"31.46","6":"48.783216","7":"H0：共和分関係の数＝0を棄却"},{"1":"eigen","2":"trend","3":"2","4":"1","5":"25.54","6":"21.687844","7":"共和分関係の数＝1と判断"},{"1":"eigen","2":"trend","3":"2","4":"2","5":"18.96","6":"11.544465","7":"NA"},{"1":"eigen","2":"trend","3":"2","4":"3","5":"12.25","6":"4.100722","7":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="09_var.html#cb988-1" aria-hidden="true" tabindex="-1"></a>jo_canada<span class="sc">$</span>const</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["タイプ"],"name":[1],"type":["chr"],"align":["left"]},{"label":["確定項"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[3],"type":["int"],"align":["right"]},{"label":["共和分関係の数"],"name":[4],"type":["int"],"align":["right"]},{"label":["棄却点"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["判断"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"trace","2":"const","3":"2","4":"0","5":"53.12","6":"105.84390","7":"H0：共和分関係の数＝0を棄却"},{"1":"trace","2":"const","3":"2","4":"1","5":"34.91","6":"42.30610","7":"H0：共和分関係の数＝1を棄却"},{"1":"trace","2":"const","3":"2","4":"2","5":"19.96","6":"17.39156","7":"共和分関係の数＝2と判断"},{"1":"trace","2":"const","3":"2","4":"3","5":"9.24","6":"6.87957","7":"NA"},{"1":"eigen","2":"const","3":"2","4":"0","5":"28.14","6":"63.53780","7":"H0：共和分関係の数＝0を棄却"},{"1":"eigen","2":"const","3":"2","4":"1","5":"22.00","6":"24.91455","7":"H0：共和分関係の数＝1を棄却"},{"1":"eigen","2":"const","3":"2","4":"2","5":"15.67","6":"10.51199","7":"共和分関係の数＝2と判断"},{"1":"eigen","2":"const","3":"2","4":"3","5":"9.24","6":"6.87957","7":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="09_var.html#cb989-1" aria-hidden="true" tabindex="-1"></a>jo_canada<span class="sc">$</span>none</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["タイプ"],"name":[1],"type":["chr"],"align":["left"]},{"label":["確定項"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ラグ次数"],"name":[3],"type":["int"],"align":["right"]},{"label":["共和分関係の数"],"name":[4],"type":["int"],"align":["right"]},{"label":["棄却点"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["検定値"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["判断"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"trace","2":"none","3":"2","4":"0","5":"48.28","6":"75.9321088","7":"H0：共和分関係の数＝0を棄却"},{"1":"trace","2":"none","3":"2","4":"1","5":"31.52","6":"28.5951793","7":"共和分関係の数＝1と判断"},{"1":"trace","2":"none","3":"2","4":"2","5":"17.95","6":"8.9710543","7":"NA"},{"1":"trace","2":"none","3":"2","4":"3","5":"8.18","6":"0.3227339","7":"NA"},{"1":"eigen","2":"none","3":"2","4":"0","5":"27.14","6":"47.3369295","7":"H0：共和分関係の数＝0を棄却"},{"1":"eigen","2":"none","3":"2","4":"1","5":"21.07","6":"19.6241250","7":"共和分関係の数＝1と判断"},{"1":"eigen","2":"none","3":"2","4":"2","5":"14.90","6":"8.6483204","7":"NA"},{"1":"eigen","2":"none","3":"2","4":"3","5":"8.18","6":"0.3227339","7":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="実例varモデルの推定" class="section level3 hasAnchor" number="9.11.6">
<h3><span class="header-section-number">9.11.6</span> 実例：VARモデルの推定<a href="09_var.html#実例varモデルの推定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>村尾（2019）P.218の「9.8 RによるVARモデルの推定」を再現します。使用するデータは、<code>vars</code>パッケージの<code>Canada</code>データセットです。データ頻度は四半期、期間は1980年1-3月期〜2000年10-12月期です。格納されているデータは、雇用者数（<code>e</code>、自然対数×100）、実質労働生産性（<code>prod</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）です。これら4変数を用いて、レベルVARモデル、階差VARモデル、外生変数を用いたVARモデルを構築します。</p>
<div id="レベルvarモデル-1" class="section level4 unnumbered hasAnchor">
<h4>レベルVARモデル<a href="09_var.html#レベルvarモデル-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>ADF検定とヨハンセン検定の結果に基けば、<code>Canada</code>データセットに対してはVECモデルを適用すべきですが、ここでは例としてレベルVARモデルを推計します。変数の順番は、実質労働生産性<code>prod</code>、雇用者数<code>e</code>、失業率<code>U</code>、実質賃金<code>rw</code>とします。</p>
<p>VARモデルの推定は、<code>vars</code>パッケージの<code>VAR()</code>関数で行います。</p>
<p><code>VAR()</code>関数で出力したモデルオブジェクトに対し<code>summary()</code>関数を適用すると、各内生変数の推定結果が出力されます。出力結果の最後には残差の共分散行列と相関係数行列も表示されています。</p>
<p>また、<code>VAR()</code>関数で出力したモデルオブジェクトに対し<code>plot()</code>関数を適用すると、各内生変数の推定結果の折れ線グラフ、自己相関プロット（ACF）、偏自己相関プロット（PACF）のグラフが<code>Plots</code>画面に出力されます。グラフは内生変数の順番に出力され、<code>Enter</code>キーを押すと次の内生変数に進みます。</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="09_var.html#cb990-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb990-2"><a href="09_var.html#cb990-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb990-3"><a href="09_var.html#cb990-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb990-4"><a href="09_var.html#cb990-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定</span></span>
<span id="cb990-5"><a href="09_var.html#cb990-5" aria-hidden="true" tabindex="-1"></a>model_var_level <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> Canada[, <span class="fu">c</span>(<span class="st">&quot;prod&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;rw&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb990-6"><a href="09_var.html#cb990-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">p =</span> <span class="dv">2</span>, <span class="co"># ラグ次数</span></span>
<span id="cb990-7"><a href="09_var.html#cb990-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">&quot;trend&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb990-8"><a href="09_var.html#cb990-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb990-9"><a href="09_var.html#cb990-9" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb990-10"><a href="09_var.html#cb990-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb990-11"><a href="09_var.html#cb990-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定結果を出力</span></span>
<span id="cb990-12"><a href="09_var.html#cb990-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_var_level)</span></code></pre></div>
<pre><code>## 
## VAR Estimation Results:
## ========================= 
## Endogenous variables: prod, e, U, rw 
## Deterministic variables: trend 
## Sample size: 82 
## Log Likelihood: -177.03 
## Roots of the characteristic polynomial:
##     1 0.8828 0.8728 0.8728 0.7164 0.2545 0.1573 0.1573
## Call:
## vars::VAR(y = Canada[, c(&quot;prod&quot;, &quot;e&quot;, &quot;U&quot;, &quot;rw&quot;)], p = 2, type = &quot;trend&quot;, 
##     exogen = NULL)
## 
## 
## Estimation results for equation prod: 
## ===================================== 
## prod = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + trend 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1  1.09870    0.10804  10.169 1.24e-15 ***
## e.l1    -0.14824    0.26017  -0.570  0.57058    
## U.l1    -0.57940    0.33582  -1.725  0.08870 .  
## rw.l1    0.01523    0.09693   0.157  0.87562    
## prod.l2 -0.21979    0.11443  -1.921  0.05868 .  
## e.l2     0.23074    0.25527   0.904  0.36901    
## U.l2     0.88798    0.33311   2.666  0.00945 ** 
## rw.l2   -0.09289    0.09215  -1.008  0.31674    
## trend    0.06759    0.02310   2.926  0.00458 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.6288 on 73 degrees of freedom
## Multiple R-Squared:     1,   Adjusted R-squared:     1 
## F-statistic: 3.834e+06 on 9 and 73 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation e: 
## ================================== 
## e = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + trend 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1  0.16456    0.06431   2.559   0.0126 *  
## e.l1     1.63082    0.15486  10.531 2.69e-16 ***
## U.l1     0.13232    0.19989   0.662   0.5101    
## rw.l1   -0.05765    0.05770  -0.999   0.3210    
## prod.l2 -0.12339    0.06812  -1.811   0.0742 .  
## e.l2    -0.64150    0.15194  -4.222 6.89e-05 ***
## U.l2    -0.04002    0.19828  -0.202   0.8406    
## rw.l2    0.03935    0.05485   0.717   0.4754    
## trend    0.01533    0.01375   1.115   0.2686    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.3743 on 73 degrees of freedom
## Multiple R-Squared:     1,   Adjusted R-squared:     1 
## F-statistic: 5.803e+07 on 9 and 73 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation U: 
## ================================== 
## U = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + trend 
## 
##          Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1 -0.079404   0.051432  -1.544    0.127    
## e.l1    -0.570210   0.123849  -4.604 1.71e-05 ***
## U.l1     0.770015   0.159858   4.817 7.69e-06 ***
## rw.l1    0.008927   0.046142   0.193    0.847    
## prod.l2  0.074044   0.054473   1.359    0.178    
## e.l2     0.569518   0.121514   4.687 1.26e-05 ***
## U.l2     0.124884   0.158570   0.788    0.434    
## rw.l2    0.001470   0.043865   0.034    0.973    
## trend   -0.012464   0.010997  -1.133    0.261    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.2993 on 73 degrees of freedom
## Multiple R-Squared: 0.9991,  Adjusted R-squared: 0.999 
## F-statistic:  9163 on 9 and 73 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation rw: 
## =================================== 
## rw = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + trend 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1 -0.12702    0.13138  -0.967   0.3368    
## e.l1    -0.23961    0.31636  -0.757   0.4512    
## U.l1     0.03722    0.40834   0.091   0.9276    
## rw.l1    0.85682    0.11786   7.270 3.28e-10 ***
## prod.l2 -0.03001    0.13915  -0.216   0.8298    
## e.l2     0.35274    0.31039   1.136   0.2595    
## U.l2    -0.09255    0.40505  -0.228   0.8199    
## rw.l2    0.04513    0.11205   0.403   0.6883    
## trend    0.04948    0.02809   1.762   0.0823 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.7646 on 73 degrees of freedom
## Multiple R-Squared:     1,   Adjusted R-squared:     1 
## F-statistic: 3.053e+06 on 9 and 73 DF,  p-value: &lt; 2.2e-16 
## 
## 
## 
## Covariance matrix of residuals:
##           prod         e         U       rw
## prod  0.395423 -0.004776  0.008032  0.03387
## e    -0.004776  0.140101 -0.079011 -0.04717
## U     0.008032 -0.079011  0.089603  0.03761
## rw    0.033867 -0.047169  0.037607  0.58464
## 
## Correlation matrix of residuals:
##          prod        e        U       rw
## prod  1.00000 -0.02029  0.04267  0.07044
## e    -0.02029  1.00000 -0.70519 -0.16481
## U     0.04267 -0.70519  1.00000  0.16431
## rw    0.07044 -0.16481  0.16431  1.00000</code></pre>
</div>
<div id="階差varモデル-1" class="section level4 unnumbered hasAnchor">
<h4>階差VARモデル<a href="09_var.html#階差varモデル-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>ADF検定とヨハンセン検定の結果に基けば、<code>Canada</code>データセットに対してはVECモデルを適用すべきですが、ここでは例として階差VARモデルを推計します。変数の順番は、実質労働生産性<code>prod</code>、雇用者数<code>e</code>、失業率<code>U</code>、実質賃金<code>rw</code>とします。</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="09_var.html#cb992-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb992-2"><a href="09_var.html#cb992-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb992-3"><a href="09_var.html#cb992-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb992-4"><a href="09_var.html#cb992-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 階差VARモデルの推定</span></span>
<span id="cb992-5"><a href="09_var.html#cb992-5" aria-hidden="true" tabindex="-1"></a>model_var_diff <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> <span class="fu">diff</span>(Canada[, <span class="fu">c</span>(<span class="st">&quot;prod&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;rw&quot;</span>)], <span class="at">lag =</span> <span class="dv">1</span>), <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb992-6"><a href="09_var.html#cb992-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">p =</span> <span class="dv">1</span>, <span class="co"># ラグ次数</span></span>
<span id="cb992-7"><a href="09_var.html#cb992-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb992-8"><a href="09_var.html#cb992-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb992-9"><a href="09_var.html#cb992-9" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb992-10"><a href="09_var.html#cb992-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb992-11"><a href="09_var.html#cb992-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定結果を出力</span></span>
<span id="cb992-12"><a href="09_var.html#cb992-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_var_diff)</span></code></pre></div>
<pre><code>## 
## VAR Estimation Results:
## ========================= 
## Endogenous variables: prod, e, U, rw 
## Deterministic variables: const 
## Sample size: 82 
## Log Likelihood: -213.785 
## Roots of the characteristic polynomial:
## 0.7431 0.401 0.1095 0.06195
## Call:
## vars::VAR(y = diff(Canada[, c(&quot;prod&quot;, &quot;e&quot;, &quot;U&quot;, &quot;rw&quot;)], lag = 1), 
##     p = 1, type = &quot;const&quot;, exogen = NULL)
## 
## 
## Estimation results for equation prod: 
## ===================================== 
## prod = prod.l1 + e.l1 + U.l1 + rw.l1 + const 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)  
## prod.l1  0.24427    0.10722   2.278   0.0255 *
## e.l1    -0.42335    0.24837  -1.705   0.0923 .
## U.l1    -0.85238    0.34801  -2.449   0.0166 *
## rw.l1   -0.02006    0.08007  -0.251   0.8029  
## const    0.29283    0.14203   2.062   0.0426 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.6735 on 77 degrees of freedom
## Multiple R-Squared: 0.1729,  Adjusted R-squared: 0.1299 
## F-statistic: 4.023 on 4 and 77 DF,  p-value: 0.005139 
## 
## 
## Estimation results for equation e: 
## ================================== 
## e = prod.l1 + e.l1 + U.l1 + rw.l1 + const 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1  0.18428    0.06176   2.984  0.00381 ** 
## e.l1     0.74083    0.14305   5.179 1.74e-06 ***
## U.l1     0.14031    0.20045   0.700  0.48603    
## rw.l1   -0.05207    0.04612  -1.129  0.26239    
## const    0.13182    0.08180   1.611  0.11119    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.3879 on 77 degrees of freedom
## Multiple R-Squared: 0.5854,  Adjusted R-squared: 0.5639 
## F-statistic: 27.18 on 4 and 77 DF,  p-value: 4.457e-14 
## 
## 
## Estimation results for equation U: 
## ================================== 
## U = prod.l1 + e.l1 + U.l1 + rw.l1 + const 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1 -0.13648    0.04988  -2.736  0.00772 ** 
## e.l1    -0.50251    0.11555  -4.349 4.14e-05 ***
## U.l1    -0.12721    0.16191  -0.786  0.43447    
## rw.l1    0.06515    0.03725   1.749  0.08432 .  
## const    0.13588    0.06608   2.056  0.04313 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.3134 on 77 degrees of freedom
## Multiple R-Squared: 0.5109,  Adjusted R-squared: 0.4855 
## F-statistic: 20.11 on 4 and 77 DF,  p-value: 2.27e-11 
## 
## 
## Estimation results for equation rw: 
## =================================== 
## rw = prod.l1 + e.l1 + U.l1 + rw.l1 + const 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)   
## prod.l1  -0.3065     0.1479  -2.072  0.04159 * 
## e.l1      0.1440     0.3426   0.420  0.67546   
## U.l1      0.4594     0.4801   0.957  0.34158   
## rw.l1     0.3337     0.1105   3.021  0.00342 **
## const     0.6481     0.1959   3.308  0.00143 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.9291 on 77 degrees of freedom
## Multiple R-Squared: 0.2478,  Adjusted R-squared: 0.2088 
## F-statistic: 6.343 on 4 and 77 DF,  p-value: 0.0001823 
## 
## 
## 
## Covariance matrix of residuals:
##            prod         e        U         rw
## prod  0.4536329  0.007223 -0.01728  0.0001991
## e     0.0072231  0.150491 -0.08396 -0.0465106
## U    -0.0172828 -0.083958  0.09819  0.0760282
## rw    0.0001991 -0.046511  0.07603  0.8631851
## 
## Correlation matrix of residuals:
##            prod        e        U         rw
## prod  1.0000000  0.02765 -0.08189  0.0003181
## e     0.0276451  1.00000 -0.69068 -0.1290461
## U    -0.0818896 -0.69068  1.00000  0.2611502
## rw    0.0003181 -0.12905  0.26115  1.0000000</code></pre>
</div>
<div id="外生変数がある階差varモデル" class="section level4 unnumbered hasAnchor">
<h4>外生変数がある階差VARモデル<a href="09_var.html#外生変数がある階差varモデル" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>Canada</code>データセットのうち、雇用者数<code>e</code>、失業率<code>U</code>、実質賃金<code>rw</code>を内生変数、実質労働生産性<code>prod</code>を外生変数として、階差VARモデルを推定します。</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="09_var.html#cb994-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb994-2"><a href="09_var.html#cb994-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb994-3"><a href="09_var.html#cb994-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb994-4"><a href="09_var.html#cb994-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 内生変数</span></span>
<span id="cb994-5"><a href="09_var.html#cb994-5" aria-hidden="true" tabindex="-1"></a>data_endo <span class="ot">&lt;-</span> <span class="fu">diff</span>(Canada[, <span class="fu">c</span>(<span class="st">&quot;e&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;rw&quot;</span>)], <span class="at">lag =</span> <span class="dv">1</span>)</span>
<span id="cb994-6"><a href="09_var.html#cb994-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb994-7"><a href="09_var.html#cb994-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 外生変数</span></span>
<span id="cb994-8"><a href="09_var.html#cb994-8" aria-hidden="true" tabindex="-1"></a>data_exo <span class="ot">&lt;-</span> <span class="fu">diff</span>(Canada[, <span class="st">&quot;prod&quot;</span>], <span class="at">lag =</span> <span class="dv">1</span>)</span>
<span id="cb994-9"><a href="09_var.html#cb994-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb994-10"><a href="09_var.html#cb994-10" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定</span></span>
<span id="cb994-11"><a href="09_var.html#cb994-11" aria-hidden="true" tabindex="-1"></a>model_var_diff_exo <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> data_endo, <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb994-12"><a href="09_var.html#cb994-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">p =</span> <span class="dv">2</span>, <span class="co"># ラグ次数</span></span>
<span id="cb994-13"><a href="09_var.html#cb994-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb994-14"><a href="09_var.html#cb994-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">exogen =</span> data_exo <span class="co"># 外生変数</span></span>
<span id="cb994-15"><a href="09_var.html#cb994-15" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb994-16"><a href="09_var.html#cb994-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb994-17"><a href="09_var.html#cb994-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 推定結果を出力</span></span>
<span id="cb994-18"><a href="09_var.html#cb994-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_var_diff_exo)</span></code></pre></div>
<pre><code>## 
## VAR Estimation Results:
## ========================= 
## Endogenous variables: e, U, rw 
## Deterministic variables: const 
## Sample size: 81 
## Log Likelihood: -121.213 
## Roots of the characteristic polynomial:
## 0.6608 0.6608 0.4838 0.4838 0.1943 0.1943
## Call:
## vars::VAR(y = data_endo, p = 2, type = &quot;const&quot;, exogen = data_exo)
## 
## 
## Estimation results for equation e: 
## ================================== 
## e = e.l1 + U.l1 + rw.l1 + e.l2 + U.l2 + rw.l2 + const + exo1 
## 
##         Estimate Std. Error t value Pr(&gt;|t|)    
## e.l1   0.9417544  0.1584011   5.945 8.73e-08 ***
## U.l1   0.0363265  0.2134018   0.170  0.86530    
## rw.l1 -0.0395863  0.0497552  -0.796  0.42883    
## e.l2  -0.4772416  0.1731212  -2.757  0.00737 ** 
## U.l2  -0.2276251  0.2056673  -1.107  0.27203    
## rw.l2 -0.0495961  0.0503728  -0.985  0.32808    
## const  0.2976861  0.1027403   2.897  0.00496 ** 
## exo1   0.0008943  0.0685323   0.013  0.98962    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.3893 on 73 degrees of freedom
## Multiple R-Squared: 0.604,   Adjusted R-squared: 0.5661 
## F-statistic: 15.91 on 7 and 73 DF,  p-value: 1.662e-12 
## 
## 
## Estimation results for equation U: 
## ================================== 
## U = e.l1 + U.l1 + rw.l1 + e.l2 + U.l2 + rw.l2 + const + exo1 
## 
##       Estimate Std. Error t value Pr(&gt;|t|)    
## e.l1  -0.60910    0.12635  -4.821 7.58e-06 ***
## U.l1  -0.13478    0.17023  -0.792   0.4311    
## rw.l1  0.05039    0.03969   1.270   0.2082    
## e.l2   0.09755    0.13810   0.706   0.4822    
## U.l2  -0.11506    0.16406  -0.701   0.4853    
## rw.l2  0.10516    0.04018   2.617   0.0108 *  
## const  0.03407    0.08195   0.416   0.6788    
## exo1  -0.03389    0.05467  -0.620   0.5372    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.3105 on 73 degrees of freedom
## Multiple R-Squared: 0.5433,  Adjusted R-squared: 0.4995 
## F-statistic:  12.4 on 7 and 73 DF,  p-value: 2.368e-10 
## 
## 
## Estimation results for equation rw: 
## =================================== 
## rw = e.l1 + U.l1 + rw.l1 + e.l2 + U.l2 + rw.l2 + const + exo1 
## 
##       Estimate Std. Error t value Pr(&gt;|t|)  
## e.l1  -0.22779    0.37705  -0.604   0.5476  
## U.l1   0.71662    0.50797   1.411   0.1626  
## rw.l1  0.28900    0.11843   2.440   0.0171 *
## e.l2   0.84637    0.41209   2.054   0.0436 *
## U.l2   0.24604    0.48956   0.503   0.6168  
## rw.l2  0.13062    0.11990   1.089   0.2796  
## const  0.30734    0.24456   1.257   0.2129  
## exo1   0.08683    0.16313   0.532   0.5961  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.9266 on 73 degrees of freedom
## Multiple R-Squared: 0.2742,  Adjusted R-squared: 0.2046 
## F-statistic:  3.94 on 7 and 73 DF,  p-value: 0.001065 
## 
## 
## 
## Covariance matrix of residuals:
##           e        U       rw
## e   0.15153 -0.08689 -0.03912
## U  -0.08689  0.09642  0.08105
## rw -0.03912  0.08105  0.85855
## 
## Correlation matrix of residuals:
##          e       U      rw
## e   1.0000 -0.7189 -0.1085
## U  -0.7189  1.0000  0.2817
## rw -0.1085  0.2817  1.0000</code></pre>
</div>
</div>
<div id="実例vecモデルの推定" class="section level3 hasAnchor" number="9.11.7">
<h3><span class="header-section-number">9.11.7</span> 実例：VECモデルの推定<a href="09_var.html#実例vecモデルの推定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>村尾（2019）P.221の「9.9 RによるVECモデルの推定」を再現します。使用するデータは、<code>vars</code>パッケージの<code>Canada</code>データセットです。データ頻度は四半期、期間は1980年1-3月期〜2000年10-12月期です。格納されているデータは、雇用者数（<code>e</code>、自然対数×100）、実質労働生産性（<code>prod</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）です。これら4変数を用いてVECモデルを推定します。</p>
<p>「実例：ADF検定（村尾（2019）6.7）」では、<code>Canada</code>データセットの4変数のうち、雇用者数<code>e</code>、実質労働生産性<code>prod</code>、失業率<code>U</code>が<code>I(1)</code>過程、実質賃金<code>rw</code>が<code>I(0)</code>過程と判断しました。その後、「実例：ヨハンセン検定（村尾（2019）7.4、7.7）」では、Trendモデルを指定したトレース検定、最大固有値検定の両方で、これら4変数の間に1つの共和分関係があると判断しました。したがって、VARモデルの分析フローを踏まえると、<code>Canada</code>データセットの4変数にはVECモデルが適していると考えられます。</p>
<p>RによるVECモデルの推定は2段階で行います。まず、<code>urca</code>パッケージの<code>ca.jo()</code>関数で、ヨハンセン検定による共和分ランクの決定を行います。次に、<code>ca.jo()</code>関数で出力したオブジェクトを<code>urca::cajorls()</code>関数に入力し、VECモデルを推定します。</p>
<p>ここでは先に実施したヨハンセン検定の結果を踏まえ、<code>type</code>引数にトレース検定を意味する<code>trace</code>を、<code>ecdet</code>引数にTrendモデルを意味する<code>trend</code>を、<code>spec</code>引数には均衡からの乖離が一時的とする<code>transitory</code>を指定します。</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="09_var.html#cb996-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb996-2"><a href="09_var.html#cb996-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb996-3"><a href="09_var.html#cb996-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb996-4"><a href="09_var.html#cb996-4" aria-hidden="true" tabindex="-1"></a><span class="co"># VECモデル推定の第１段階（ヨハンセン検定）</span></span>
<span id="cb996-5"><a href="09_var.html#cb996-5" aria-hidden="true" tabindex="-1"></a>model_vec <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">ca.jo</span>(<span class="at">x =</span> Canada[, <span class="fu">c</span>(<span class="st">&quot;prod&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;rw&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb996-6"><a href="09_var.html#cb996-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="st">&quot;trace&quot;</span>, <span class="co"># 検定タイプ（&quot;eigen&quot;, &quot;trace&quot;）</span></span>
<span id="cb996-7"><a href="09_var.html#cb996-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ecdet =</span> <span class="st">&quot;trend&quot;</span>, <span class="co"># 確定項（&quot;none&quot;, &quot;const&quot;, &quot;trend&quot;）</span></span>
<span id="cb996-8"><a href="09_var.html#cb996-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">K =</span> <span class="dv">3</span>, <span class="co"># ラグ次数</span></span>
<span id="cb996-9"><a href="09_var.html#cb996-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">spec =</span> <span class="st">&quot;transitory&quot;</span>, <span class="co"># 共和分関係の均衡からの乖離が一時的・長期的か（&quot;transitory&quot;, &quot;longrun&quot;）</span></span>
<span id="cb996-10"><a href="09_var.html#cb996-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">season =</span> <span class="cn">NULL</span>, <span class="co"># 季節ダミー（四半期の場合は4）</span></span>
<span id="cb996-11"><a href="09_var.html#cb996-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dumvar =</span> <span class="cn">NULL</span> <span class="co"># 引数xに指定したデータセットにダミー変数が含まれている場合はTRUEにする</span></span>
<span id="cb996-12"><a href="09_var.html#cb996-12" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb996-13"><a href="09_var.html#cb996-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb996-14"><a href="09_var.html#cb996-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_vec)</span></code></pre></div>
<pre><code>## 
## ###################### 
## # Johansen-Procedure # 
## ###################### 
## 
## Test type: trace statistic , with linear trend in cointegration 
## 
## Eigenvalues (lambda):
## [1] 4.505013e-01 1.962777e-01 1.676668e-01 4.647108e-02 2.894486e-17
## 
## Values of teststatistic and critical values of test:
## 
##           test 10pct  5pct  1pct
## r &lt;= 3 |  3.85 10.49 12.25 16.26
## r &lt;= 2 | 18.72 22.76 25.32 30.45
## r &lt;= 1 | 36.42 39.06 42.44 48.45
## r = 0  | 84.92 59.14 62.99 70.05
## 
## Eigenvectors, normalised to first column:
## (These are the cointegration relations)
## 
##              prod.l1       e.l1       U.l1      rw.l1    trend.l1
## prod.l1   1.00000000  1.0000000  1.0000000  1.0000000   1.0000000
## e.l1     -0.02385142  1.2946681 -2.8831559  4.2418087  -8.2903941
## U.l1      3.16874550  3.4036732 -7.4261513  6.8413561 -12.5578436
## rw.l1     1.83528156 -0.3330945  1.3978788 -0.1393999   2.4466500
## trend.l1 -1.30156097 -0.2302803 -0.5093218 -1.5925918   0.2831079
## 
## Weights W:
## (This is the loading matrix)
## 
##             prod.l1        e.l1         U.l1        rw.l1      trend.l1
## prod.d -0.006535281 -0.02763446 -0.070975297 -0.014754352 -8.205627e-12
## e.d    -0.008503348  0.11414011 -0.008156659  0.003988051 -5.756735e-12
## U.d    -0.004718574 -0.06154306  0.020719431 -0.006557248  3.631716e-12
## rw.d   -0.046213351 -0.14579644 -0.016945105  0.011896044 -4.801434e-12</code></pre>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="09_var.html#cb998-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VECモデル推定の第２段階（VECモデル推定）</span></span>
<span id="cb998-2"><a href="09_var.html#cb998-2" aria-hidden="true" tabindex="-1"></a>model_vec <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">cajorls</span>(<span class="at">z =</span> model_vec, <span class="co"># 第１段階の結果</span></span>
<span id="cb998-3"><a href="09_var.html#cb998-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">r =</span> <span class="dv">1</span>, <span class="co"># 共和分関係の数（共和分ランク）</span></span>
<span id="cb998-4"><a href="09_var.html#cb998-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">reg.number =</span> <span class="cn">NULL</span> <span class="co"># 推定すべき方程式の本数（デフォルトはNULL）</span></span>
<span id="cb998-5"><a href="09_var.html#cb998-5" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb998-6"><a href="09_var.html#cb998-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb998-7"><a href="09_var.html#cb998-7" aria-hidden="true" tabindex="-1"></a><span class="co"># VECモデルの推定結果を出力</span></span>
<span id="cb998-8"><a href="09_var.html#cb998-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rlm：係数推定値</span></span>
<span id="cb998-9"><a href="09_var.html#cb998-9" aria-hidden="true" tabindex="-1"></a><span class="co"># beta：共和分ベクトルの係数推定値（第1変数の係数が1になるよう標準化）</span></span>
<span id="cb998-10"><a href="09_var.html#cb998-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_vec)</span></code></pre></div>
<pre><code>## $rlm
## 
## Call:
## lm(formula = substitute(form1), data = data.mat)
## 
## Coefficients:
##           prod.d     e.d        U.d        rw.d     
## ect1      -0.006535  -0.008503  -0.004719  -0.046213
## constant   8.274808  10.331308   5.687832  55.469125
## prod.dl1   0.234441   0.200953  -0.138916  -0.074493
## e.dl1     -0.246544   0.821558  -0.646846  -0.634084
## U.dl1     -0.979868   0.003379  -0.191125   0.063137
## rw.dl1     0.004707  -0.078491   0.017263  -0.012082
## prod.dl2  -0.029520   0.048273  -0.002909  -0.251940
## e.dl2     -0.580473  -0.459693  -0.019741   0.081197
## U.dl2     -0.128101  -0.103415  -0.262685  -0.230009
## rw.dl2    -0.190264  -0.095835   0.080354  -0.157388
## 
## 
## $beta
##                 ect1
## prod.l1   1.00000000
## e.l1     -0.02385142
## U.l1      3.16874550
## rw.l1     1.83528156
## trend.l1 -1.30156097</code></pre>
</div>
<div id="実例構造varモデルの推定" class="section level3 hasAnchor" number="9.11.8">
<h3><span class="header-section-number">9.11.8</span> 実例：構造VARモデルの推定<a href="09_var.html#実例構造varモデルの推定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>村尾（2019）P.223の「9.10 Rによる構造VARモデルの推定」を再現します。使用するデータは、<code>vars</code>パッケージの<code>Canada</code>データセットです。データ頻度は四半期、期間は1980年1-3月期〜2000年10-12月期です。格納されているデータは、雇用者数（<code>e</code>、自然対数×100）、実質労働生産性（<code>prod</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）です。これら4変数を用いて構造VARモデルを推定します。</p>
<p>Rによる構造VARモデルの推定は、2段階で行います。まず、<code>vars</code>パッケージの<code>VAR()</code>関数で準備的な推定を行い、次に、<code>VAR()</code>関数で出力したオブジェクトを<code>SVAR()</code>関数に入力し、構造VARモデルを推定します。<code>SVAR()</code>関数の<code>Amat</code>、<code>Bmat</code>引数にはそれぞれ、変数<span class="math inline">\(\boldsymbol{Y}_t\)</span>の同時点間の関係を表す行列<span class="math inline">\(\boldsymbol{A}\)</span>と、構造誤差項の標準偏差を表す行列<span class="math inline">\(\boldsymbol{B}\)</span>を指定します。</p>
<p><span class="math display">\[
\boldsymbol{A} \boldsymbol{Y}_t = \boldsymbol{A}_1 \boldsymbol{Y}_{t-1} + \boldsymbol{B} \boldsymbol{\epsilon}^{SD}_t
\]</span></p>
<p>ここでは<code>Canada</code>データセットの4変数の順序を、実質労働生産性（<code>prod</code>、自然対数×100）、雇用者数（<code>e</code>、自然対数×100）、失業率（<code>U</code>、％）、実質賃金（<code>rw</code>、自然対数×100）とし、行列<span class="math inline">\(\boldsymbol{A}\)</span>を次のように指定します。</p>
<p><span class="math display">\[
\boldsymbol{A} =
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
* &amp; 1 &amp; 0 &amp; 0 \\
* &amp; * &amp; 1 &amp; 0 \\
* &amp; 0 &amp; * &amp; 1 \\
\end{bmatrix}
\]</span></p>
<p>＊は当該要素に制約を課さないことを意味し、Rで行列<span class="math inline">\(\boldsymbol{A}\)</span>を作成する際は<code>NA</code>を入れます。構造VARモデルの識別に必要な制約の数は、変数の個数を<span class="math inline">\(n\)</span>として<span class="math inline">\(n(n-1)/2\)</span>であり、すなわちこのモデルでは<span class="math inline">\(4(4-1)/2 = 6\)</span>個になります。上記の行列<span class="math inline">\(\boldsymbol{A}\)</span>にはゼロ制約が7個あるため、識別の条件を満たしています。</p>
<p>なお、仮に上記の行列<span class="math inline">\(\boldsymbol{A}\)</span>を、</p>
<p><span class="math display">\[
\boldsymbol{A} =
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
a_{21} &amp; 1 &amp; 0 &amp; 0 \\
a_{31} &amp; a_{32} &amp; 1 &amp; 0 \\
a_{41} &amp; 0 &amp; a_{43} &amp; 1 \\
\end{bmatrix}
\]</span></p>
<p>を表すと、変数間の同時点の関係を、次のように想定していることを意味します。ただしこれは一例であって、こうした同時点間の制約の置き方が<code>Canada</code>データセットに対してベストな制約であることを意味するものではありません。</p>
<p><span class="math display">\[
\begin{aligned}
prod_t &amp;= \epsilon_{prod,t} \\
e_t &amp;= a_{21} prod_t + \epsilon_{e,t} \\
U_t &amp;= a_{31} prod_t + a_{32} e_t + \epsilon_{U,t} \\
rw_t &amp;= a_{41} prod_t + a_{43} U_t + \epsilon_{rw,t} \\
\end{aligned}
\]</span></p>
<p>また、行列<span class="math inline">\(\boldsymbol{B}\)</span>は次のように指定します。＊には各変数の構造誤差項の標準偏差が入ります。Rで行列<span class="math inline">\(\boldsymbol{B}\)</span>を作成する際は制約を課さないことを示す<code>NA</code>を入力します。</p>
<p><span class="math display">\[
\boldsymbol{B} =
\begin{bmatrix}
* &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; * &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; * &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; * \\
\end{bmatrix}
\]</span></p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="09_var.html#cb1000-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb1000-2"><a href="09_var.html#cb1000-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb1000-3"><a href="09_var.html#cb1000-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-4"><a href="09_var.html#cb1000-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 構造VARモデル推定の第１段階（VARモデル推定）</span></span>
<span id="cb1000-5"><a href="09_var.html#cb1000-5" aria-hidden="true" tabindex="-1"></a>model_svar <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> Canada[, <span class="fu">c</span>(<span class="st">&quot;prod&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;rw&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1000-6"><a href="09_var.html#cb1000-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">p =</span> <span class="dv">3</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1000-7"><a href="09_var.html#cb1000-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;both&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1000-8"><a href="09_var.html#cb1000-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb1000-9"><a href="09_var.html#cb1000-9" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb1000-10"><a href="09_var.html#cb1000-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-11"><a href="09_var.html#cb1000-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_svar)</span></code></pre></div>
<pre><code>## 
## VAR Estimation Results:
## ========================= 
## Endogenous variables: prod, e, U, rw 
## Deterministic variables: both 
## Sample size: 81 
## Log Likelihood: -143.629 
## Roots of the characteristic polynomial:
## 0.9576 0.9576 0.8187 0.8187 0.6087 0.6087 0.5687 0.5687 0.5422 0.5422 0.2911  0.26
## Call:
## vars::VAR(y = Canada[, c(&quot;prod&quot;, &quot;e&quot;, &quot;U&quot;, &quot;rw&quot;)], p = 3, type = &quot;both&quot;, 
##     exogen = NULL)
## 
## 
## Estimation results for equation prod: 
## ===================================== 
## prod = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + prod.l3 + e.l3 + U.l3 + rw.l3 + const + trend 
## 
##          Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1   1.08139    0.11837   9.136 2.19e-13 ***
## e.l1     -0.19623    0.27967  -0.702   0.4853    
## U.l1     -0.75410    0.36739  -2.053   0.0440 *  
## rw.l1    -0.01995    0.09922  -0.201   0.8413    
## prod.l2  -0.18079    0.17447  -1.036   0.3038    
## e.l2     -0.15481    0.43518  -0.356   0.7231    
## U.l2      0.74329    0.45500   1.634   0.1070    
## rw.l2    -0.20124    0.12870  -1.564   0.1226    
## prod.l3  -0.02050    0.12100  -0.169   0.8660    
## e.l3      0.45747    0.30770   1.487   0.1418    
## U.l3      0.32218    0.38113   0.845   0.4009    
## rw.l3     0.12124    0.09990   1.214   0.2291    
## const   -13.21924  135.17985  -0.098   0.9224    
## trend     0.07452    0.03035   2.455   0.0167 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.6287 on 67 degrees of freedom
## Multiple R-Squared: 0.9816,  Adjusted R-squared: 0.9781 
## F-statistic: 275.5 on 13 and 67 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation e: 
## ================================== 
## e = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + prod.l3 + e.l3 + U.l3 + rw.l3 + const + trend 
## 
##           Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1    0.18518    0.06393   2.897 0.005087 ** 
## e.l1       1.76383    0.15104  11.678  &lt; 2e-16 ***
## U.l1       0.12194    0.19841   0.615 0.540906    
## rw.l1     -0.07242    0.05359  -1.352 0.181069    
## prod.l2   -0.10936    0.09423  -1.161 0.249915    
## e.l2      -1.19012    0.23502  -5.064 3.44e-06 ***
## U.l2      -0.03229    0.24573  -0.131 0.895837    
## rw.l2     -0.02488    0.06951  -0.358 0.721456    
## prod.l3    0.02565    0.06535   0.392 0.695963    
## e.l3       0.61471    0.16617   3.699 0.000438 ***
## U.l3       0.35976    0.20583   1.748 0.085078 .  
## rw.l3      0.03172    0.05395   0.588 0.558480    
## const   -193.37044   73.00464  -2.649 0.010066 *  
## trend     -0.01741    0.01639  -1.062 0.291941    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.3395 on 67 degrees of freedom
## Multiple R-Squared: 0.9988,  Adjusted R-squared: 0.9985 
## F-statistic:  4212 on 13 and 67 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation U: 
## ================================== 
## U = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + prod.l3 + e.l3 + U.l3 + rw.l3 + const + trend 
## 
##           Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1  -0.115838   0.052588  -2.203 0.031056 *  
## e.l1     -0.630594   0.124249  -5.075 3.29e-06 ***
## U.l1      0.633746   0.163223   3.883 0.000239 ***
## rw.l1     0.002742   0.044083   0.062 0.950579    
## prod.l2   0.092189   0.077514   1.189 0.238512    
## e.l2      0.525390   0.193337   2.717 0.008364 ** 
## U.l2     -0.102428   0.202146  -0.507 0.614027    
## rw.l2     0.070509   0.057178   1.233 0.221829    
## prod.l3  -0.028450   0.053757  -0.529 0.598388    
## e.l3     -0.061913   0.136701  -0.453 0.652079    
## U.l3      0.045532   0.169328   0.269 0.788836    
## rw.l3    -0.031535   0.044382  -0.711 0.479841    
## const   163.889696  60.056811   2.729 0.008108 ** 
## trend     0.020204   0.013486   1.498 0.138790    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.2793 on 67 degrees of freedom
## Multiple R-Squared: 0.9745,  Adjusted R-squared: 0.9695 
## F-statistic: 196.8 on 13 and 67 DF,  p-value: &lt; 2.2e-16 
## 
## 
## Estimation results for equation rw: 
## =================================== 
## rw = prod.l1 + e.l1 + U.l1 + rw.l1 + prod.l2 + e.l2 + U.l2 + rw.l2 + prod.l3 + e.l3 + U.l3 + rw.l3 + const + trend 
## 
##          Estimate Std. Error t value Pr(&gt;|t|)    
## prod.l1  -0.13954    0.13859  -1.007   0.3176    
## e.l1     -0.52468    0.32745  -1.602   0.1138    
## U.l1     -0.10820    0.43016  -0.252   0.8022    
## rw.l1     0.86031    0.11618   7.405 2.84e-10 ***
## prod.l2  -0.19911    0.20428  -0.975   0.3332    
## e.l2      0.69674    0.50953   1.367   0.1761    
## U.l2     -0.38989    0.53275  -0.732   0.4668    
## rw.l2    -0.14327    0.15069  -0.951   0.3451    
## prod.l3   0.14160    0.14167   0.999   0.3212    
## e.l3     -0.26039    0.36027  -0.723   0.4723    
## U.l3      0.06263    0.44625   0.140   0.8888    
## rw.l3     0.22136    0.11697   1.893   0.0627 .  
## const   192.77721  158.27618   1.218   0.2275    
## trend     0.08341    0.03554   2.347   0.0219 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## 
## Residual standard error: 0.7361 on 67 degrees of freedom
## Multiple R-Squared: 0.999,   Adjusted R-squared: 0.9988 
## F-statistic:  5157 on 13 and 67 DF,  p-value: &lt; 2.2e-16 
## 
## 
## 
## Covariance matrix of residuals:
##           prod        e         U       rw
## prod  0.395271 -0.02377  0.005524  0.01693
## e    -0.023775  0.11528 -0.069133 -0.02806
## U     0.005524 -0.06913  0.078018  0.02636
## rw    0.016932 -0.02806  0.026359  0.54188
## 
## Correlation matrix of residuals:
##          prod       e        U       rw
## prod  1.00000 -0.1114  0.03146  0.03659
## e    -0.11137  1.0000 -0.72896 -0.11225
## U     0.03146 -0.7290  1.00000  0.12820
## rw    0.03659 -0.1122  0.12820  1.00000</code></pre>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="09_var.html#cb1002-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行列A</span></span>
<span id="cb1002-2"><a href="09_var.html#cb1002-2" aria-hidden="true" tabindex="-1"></a>mat_a <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">4</span>)</span>
<span id="cb1002-3"><a href="09_var.html#cb1002-3" aria-hidden="true" tabindex="-1"></a>mat_a[<span class="dv">2</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1002-4"><a href="09_var.html#cb1002-4" aria-hidden="true" tabindex="-1"></a>mat_a[<span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1002-5"><a href="09_var.html#cb1002-5" aria-hidden="true" tabindex="-1"></a>mat_a[<span class="dv">4</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1002-6"><a href="09_var.html#cb1002-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mat_a)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    0    0    0
## [2,]   NA    1    0    0
## [3,]   NA   NA    1    0
## [4,]   NA    0   NA    1</code></pre>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="09_var.html#cb1004-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行列B</span></span>
<span id="cb1004-2"><a href="09_var.html#cb1004-2" aria-hidden="true" tabindex="-1"></a>mat_b <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">4</span>)</span>
<span id="cb1004-3"><a href="09_var.html#cb1004-3" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(mat_b) <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1004-4"><a href="09_var.html#cb1004-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mat_b)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   NA    0    0    0
## [2,]    0   NA    0    0
## [3,]    0    0   NA    0
## [4,]    0    0    0   NA</code></pre>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="09_var.html#cb1006-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 構造VARモデル推定の第２段階（構造VARモデル推定）</span></span>
<span id="cb1006-2"><a href="09_var.html#cb1006-2" aria-hidden="true" tabindex="-1"></a>model_svar <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">SVAR</span>(<span class="at">x =</span> model_svar, <span class="co"># 推定対象のオブジェクト（VAR()関数の出力）</span></span>
<span id="cb1006-3"><a href="09_var.html#cb1006-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">estmethod =</span> <span class="st">&quot;scoring&quot;</span>, <span class="co"># 最尤法の推定オプション（&quot;scoring&quot;、&quot;direct&quot;）</span></span>
<span id="cb1006-4"><a href="09_var.html#cb1006-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Amat =</span> mat_a, <span class="co"># 変数の同時点間の関係を表す行列Aを指定</span></span>
<span id="cb1006-5"><a href="09_var.html#cb1006-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Bmat =</span> mat_b, <span class="co"># 構造誤差項の標準偏差を表す行列Bを指定</span></span>
<span id="cb1006-6"><a href="09_var.html#cb1006-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">max.iter =</span> <span class="dv">100</span>, <span class="co"># 最尤法の計算を繰り返す最大回数</span></span>
<span id="cb1006-7"><a href="09_var.html#cb1006-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">maxls =</span> <span class="dv">1000</span>, <span class="co"># </span></span>
<span id="cb1006-8"><a href="09_var.html#cb1006-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">conv.crit =</span> <span class="fl">1.0e-8</span> <span class="co"># 推定正確性（収束）の基準</span></span>
<span id="cb1006-9"><a href="09_var.html#cb1006-9" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb1006-10"><a href="09_var.html#cb1006-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1006-11"><a href="09_var.html#cb1006-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_svar)</span></code></pre></div>
<pre><code>## 
## SVAR Estimation Results:
## ======================== 
## 
## 
## Estimated A matrix:
##          prod      e       U rw
## prod  1.00000 0.0000  0.0000  0
## e     0.06015 1.0000  0.0000  0
## U     0.02237 0.6043  1.0000  0
## rw   -0.03815 0.0000 -0.3352  1
## 
## Estimated B matrix:
##        prod      e      U     rw
## prod 0.6287 0.0000 0.0000 0.0000
## e    0.0000 0.3374 0.0000 0.0000
## U    0.0000 0.0000 0.1907 0.0000
## rw   0.0000 0.0000 0.0000 0.7297</code></pre>
</div>
<div id="実例構造vecモデルの推定" class="section level3 hasAnchor" number="9.11.9">
<h3><span class="header-section-number">9.11.9</span> 実例：構造VECモデルの推定<a href="09_var.html#実例構造vecモデルの推定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>村尾（2019）P.227の「9.11 Rによる構造VECモデルの推定」を再現します。使用するデータは、<code>vars</code>パッケージの<code>Canada</code>データセットです。データ頻度は四半期、期間は1980年1-3月期〜2000年10-12月期です。格納されているデータは、雇用者数（<code>e</code>、自然対数×100）、実質労働生産性（<code>prod</code>、自然対数×100）、実質賃金（<code>rw</code>、自然対数×100）、失業率（<code>U</code>、％）です。これら4変数を用いて構造VECモデルを推定します。</p>
<p>Rによる構造VECモデルの推定は、2段階で行います。まず、<code>urca</code>パッケージの<code>ca.jo()</code>関数で、ヨハンセン検定による共和分ランクの決定を行います。次に、<code>ca.jo()</code>関数で出力したオブジェクトを<code>vars</code>パッケージの<code>SVEC()</code>関数に入力し、構造VECモデルを推定します。<code>SVEC()</code>関数の<code>LR</code>、<code>SR</code>引数にはそれぞれ、長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>と、短期インパクト行列<span class="math inline">\(\boldsymbol{B}\)</span>を指定します。</p>
<p><span class="math display">\[
\boldsymbol{Y}_t = \Xi \boldsymbol{B} \sum^{t}_{i=1}{\epsilon^{SD}_i} + \sum^{\infty}_{j=1}{\Xi^*_j \boldsymbol{B} \epsilon^{SD}_{t-j}} + \boldsymbol{Y}^*_0
\]</span></p>
<p>ここでは<code>Canada</code>データセットの4変数の順序を、実質労働生産性（<code>prod</code>、自然対数×100）、雇用者数（<code>e</code>、自然対数×100）、失業率（<code>U</code>、％）、実質賃金（<code>rw</code>、自然対数×100）とし、長期インパクト行列<span class="math inline">\(\Xi \boldsymbol{B}\)</span>と短期インパクト行列<span class="math inline">\(\boldsymbol{B}\)</span>を次のように指定します。なお、＊は当該要素に制約を課さないことを意味し、Rで行列を作成する際は<code>NA</code>を入れます。</p>
<p><span class="math display">\[
\Xi \boldsymbol{B} =
\begin{bmatrix}
* &amp; 0 &amp; 0 &amp; 0 \\
* &amp; * &amp; * &amp; 0 \\
* &amp; * &amp; * &amp; 0 \\
* &amp; * &amp; * &amp; * \\
\end{bmatrix}
, \quad
\boldsymbol{B} =
\begin{bmatrix}
* &amp; * &amp; * &amp; * \\
* &amp; * &amp; * &amp; * \\
* &amp; * &amp; * &amp; * \\
* &amp; 0 &amp; * &amp; * \\
\end{bmatrix}
\]</span></p>
<p>まず、<code>urca::ca.jo()</code>関数で共和分ランクを決定します。ここでは先に実施したヨハンセン検定の結果を踏まえ、<code>type</code>引数にトレース検定を意味する<code>trace</code>を、<code>ecdet</code>引数にTrendモデルを意味する<code>trend</code>を、<code>spec</code>引数には均衡からの乖離が一時的とする<code>transitory</code>を指定します。</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="09_var.html#cb1008-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb1008-2"><a href="09_var.html#cb1008-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb1008-3"><a href="09_var.html#cb1008-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1008-4"><a href="09_var.html#cb1008-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 構造VECモデル推定の第１段階（ヨハンセン検定）</span></span>
<span id="cb1008-5"><a href="09_var.html#cb1008-5" aria-hidden="true" tabindex="-1"></a>model_svec <span class="ot">&lt;-</span> urca<span class="sc">::</span><span class="fu">ca.jo</span>(<span class="at">x =</span> Canada[, <span class="fu">c</span>(<span class="st">&quot;prod&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;rw&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1008-6"><a href="09_var.html#cb1008-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">type =</span> <span class="st">&quot;trace&quot;</span>, <span class="co"># 検定タイプ（&quot;eigen&quot;, &quot;trace&quot;）</span></span>
<span id="cb1008-7"><a href="09_var.html#cb1008-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ecdet =</span> <span class="st">&quot;trend&quot;</span>, <span class="co"># 確定項（&quot;none&quot;, &quot;const&quot;, &quot;trend&quot;）</span></span>
<span id="cb1008-8"><a href="09_var.html#cb1008-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">K =</span> <span class="dv">3</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1008-9"><a href="09_var.html#cb1008-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">spec =</span> <span class="st">&quot;transitory&quot;</span>, <span class="co"># 共和分関係の均衡からの乖離が一時的・長期的か（&quot;transitory&quot;, &quot;longrun&quot;）</span></span>
<span id="cb1008-10"><a href="09_var.html#cb1008-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">season =</span> <span class="cn">NULL</span>, <span class="co"># 季節ダミー（四半期の場合は4）</span></span>
<span id="cb1008-11"><a href="09_var.html#cb1008-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">dumvar =</span> <span class="cn">NULL</span> <span class="co"># 引数xに指定したデータセットにダミー変数が含まれている場合はTRUEにする</span></span>
<span id="cb1008-12"><a href="09_var.html#cb1008-12" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb1008-13"><a href="09_var.html#cb1008-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1008-14"><a href="09_var.html#cb1008-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_svec)</span></code></pre></div>
<pre><code>## 
## ###################### 
## # Johansen-Procedure # 
## ###################### 
## 
## Test type: trace statistic , with linear trend in cointegration 
## 
## Eigenvalues (lambda):
## [1] 4.505013e-01 1.962777e-01 1.676668e-01 4.647108e-02 2.894486e-17
## 
## Values of teststatistic and critical values of test:
## 
##           test 10pct  5pct  1pct
## r &lt;= 3 |  3.85 10.49 12.25 16.26
## r &lt;= 2 | 18.72 22.76 25.32 30.45
## r &lt;= 1 | 36.42 39.06 42.44 48.45
## r = 0  | 84.92 59.14 62.99 70.05
## 
## Eigenvectors, normalised to first column:
## (These are the cointegration relations)
## 
##              prod.l1       e.l1       U.l1      rw.l1    trend.l1
## prod.l1   1.00000000  1.0000000  1.0000000  1.0000000   1.0000000
## e.l1     -0.02385142  1.2946681 -2.8831559  4.2418087  -8.2903941
## U.l1      3.16874550  3.4036732 -7.4261513  6.8413561 -12.5578436
## rw.l1     1.83528156 -0.3330945  1.3978788 -0.1393999   2.4466500
## trend.l1 -1.30156097 -0.2302803 -0.5093218 -1.5925918   0.2831079
## 
## Weights W:
## (This is the loading matrix)
## 
##             prod.l1        e.l1         U.l1        rw.l1      trend.l1
## prod.d -0.006535281 -0.02763446 -0.070975297 -0.014754352 -8.205627e-12
## e.d    -0.008503348  0.11414011 -0.008156659  0.003988051 -5.756735e-12
## U.d    -0.004718574 -0.06154306  0.020719431 -0.006557248  3.631716e-12
## rw.d   -0.046213351 -0.14579644 -0.016945105  0.011896044 -4.801434e-12</code></pre>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="09_var.html#cb1010-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 長期インパクト行列</span></span>
<span id="cb1010-2"><a href="09_var.html#cb1010-2" aria-hidden="true" tabindex="-1"></a>mat_lr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb1010-3"><a href="09_var.html#cb1010-3" aria-hidden="true" tabindex="-1"></a>mat_lr[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1010-4"><a href="09_var.html#cb1010-4" aria-hidden="true" tabindex="-1"></a>mat_lr[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1010-5"><a href="09_var.html#cb1010-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mat_lr)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   NA    0    0    0
## [2,]   NA   NA   NA    0
## [3,]   NA   NA   NA    0
## [4,]   NA   NA   NA    0</code></pre>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="09_var.html#cb1012-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 短期インパクト行列</span></span>
<span id="cb1012-2"><a href="09_var.html#cb1012-2" aria-hidden="true" tabindex="-1"></a>mat_sr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb1012-3"><a href="09_var.html#cb1012-3" aria-hidden="true" tabindex="-1"></a>mat_sr[<span class="dv">4</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1012-4"><a href="09_var.html#cb1012-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mat_sr)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   NA   NA   NA   NA
## [2,]   NA   NA   NA   NA
## [3,]   NA   NA   NA   NA
## [4,]   NA    0   NA   NA</code></pre>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="09_var.html#cb1014-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 構造VACモデル推定の第２段階（構造VACモデル推定）</span></span>
<span id="cb1014-2"><a href="09_var.html#cb1014-2" aria-hidden="true" tabindex="-1"></a>model_svec <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">SVEC</span>(<span class="at">x =</span> model_svec, <span class="co"># 推定対象のオブジェクト（ca.jo()関数の出力）</span></span>
<span id="cb1014-3"><a href="09_var.html#cb1014-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">LR =</span> mat_lr, <span class="co"># 長期的な制約を加える行列</span></span>
<span id="cb1014-4"><a href="09_var.html#cb1014-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">SR =</span> mat_sr, <span class="co"># 短期的な制約を加える行列</span></span>
<span id="cb1014-5"><a href="09_var.html#cb1014-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">r =</span> <span class="dv">1</span>, <span class="co"># 共和分関係の数</span></span>
<span id="cb1014-6"><a href="09_var.html#cb1014-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lrtest =</span> <span class="cn">FALSE</span>, <span class="co"># 過剰識別のための尤度比検定の必要性（適度識別の場合はNULL、過剰識別の場合はTRUEを指定）</span></span>
<span id="cb1014-7"><a href="09_var.html#cb1014-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">boot =</span> <span class="cn">TRUE</span>, <span class="co"># ブートストラップ法により推定量の標準誤差を計算するか</span></span>
<span id="cb1014-8"><a href="09_var.html#cb1014-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">runs =</span> <span class="dv">100</span> <span class="co"># ブートストラップ方による計算の繰り返し数</span></span>
<span id="cb1014-9"><a href="09_var.html#cb1014-9" aria-hidden="true" tabindex="-1"></a>                         )</span>
<span id="cb1014-10"><a href="09_var.html#cb1014-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1014-11"><a href="09_var.html#cb1014-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_svec)</span></code></pre></div>
<pre><code>## 
## SVEC Estimation Results:
## ======================== 
## 
## Call:
## vars::SVEC(x = model_svec, LR = mat_lr, SR = mat_sr, r = 1, lrtest = FALSE, 
##     boot = TRUE, runs = 100)
## 
## Type: B-model 
## Sample size: 81 
## Log Likelihood: -161.838 
## Number of iterations: 15 
## 
## Estimated contemporaneous impact matrix:
##          prod        e         U      rw
## prod  0.58402  0.07434 -0.152578 0.06900
## e    -0.12029  0.26144 -0.155096 0.08978
## U     0.02526 -0.26720  0.005488 0.04982
## rw    0.11170  0.00000  0.483771 0.48791
## 
## Estimated standard errors for impact matrix:
##         prod       e       U      rw
## prod 0.10678 0.11723 0.23968 0.07066
## e    0.07052 0.05533 0.18008 0.04340
## U    0.05557 0.05296 0.05899 0.02921
## rw   0.15727 0.00000 0.66049 0.08427
## 
## Estimated long run impact matrix:
##         prod       e       U rw
## prod  0.7910  0.0000  0.0000  0
## e     0.2024  0.5769 -0.4923  0
## U    -0.1592 -0.3409  0.1408  0
## rw   -0.1535  0.5961 -0.2495  0
## 
## Estimated standard errors for long-run matrix:
##        prod       e      U rw
## prod 0.1541 0.00000 0.0000  0
## e    0.2812 0.15162 0.5922  0
## U    0.1303 0.08053 0.1540  0
## rw   0.2071 0.14084 0.2732  0
## 
## Covariance matrix of reduced form residuals (*100):
##         prod      e       U     rw
## prod 37.4642 -2.096 -0.2512  2.509
## e    -2.0960 11.494 -6.9273 -4.467
## U    -0.2512 -6.927  7.4544  2.978
## rw    2.5087 -4.467  2.9783 48.457</code></pre>
</div>
<div id="実例誤差項の検定" class="section level3 hasAnchor" number="9.11.10">
<h3><span class="header-section-number">9.11.10</span> 実例：誤差項の検定<a href="09_var.html#実例誤差項の検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>村尾（2019）の「8.6 Rによる系列無相関の検定」（P.185）、「8.7 Rによる均一分散の検定」（P.187）、「8.8 Rによる正規分布の検定」（P.189）を再現します。まず、<code>vars</code>パッケージの<code>Canada</code>データセットを使ってレベルVARモデルを推定し、その推定結果に対して誤差項の検定を行います。</p>
<div id="系列無相関の検定" class="section level4 unnumbered hasAnchor">
<h4>系列無相関の検定<a href="09_var.html#系列無相関の検定" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>vars</code>パッケージの<code>serial.test()</code>関数で、ボックス＝ピアース検定（ポルトマント検定）、リュン＝ボックス検定（修正ポルトマント検定）、ブロイシュ＝ゴッドフレイLM検定、エドガートン＝シュクル検定を実行します。</p>
<p>どの検定を行うかは、<code>serial.test()</code>関数の<code>type</code>引数に指定します。</p>
<p>4つの検定を実施した結果、ボックス＝ピアース検定（ポルトマント検定）とリュン＝ボックス検定（修正ポルトマント検定）では帰無仮説「系列無相関」を棄却できませんが、一方で、ブロイシュ＝ゴッドフレイLM検定とエドガートン＝シュクル検定では帰無仮説「系列無相関」が棄却されました。</p>
<p>ここでは、ブロイシュ＝ゴッドフレイLM検定とエドガートン＝シュクル検定の結果を重視し、誤差項に系列相関の観点で問題がある、と判断します。</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="09_var.html#cb1016-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb1016-2"><a href="09_var.html#cb1016-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb1016-3"><a href="09_var.html#cb1016-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1016-4"><a href="09_var.html#cb1016-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルを推定</span></span>
<span id="cb1016-5"><a href="09_var.html#cb1016-5" aria-hidden="true" tabindex="-1"></a>model_var <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(Canada, <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1016-6"><a href="09_var.html#cb1016-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p =</span> <span class="dv">3</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1016-7"><a href="09_var.html#cb1016-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">&quot;both&quot;</span> <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1016-8"><a href="09_var.html#cb1016-8" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb1016-9"><a href="09_var.html#cb1016-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1016-10"><a href="09_var.html#cb1016-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ボックス＝ピアース検定（ポルトマント検定）</span></span>
<span id="cb1016-11"><a href="09_var.html#cb1016-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 帰無仮説：系列無相関</span></span>
<span id="cb1016-12"><a href="09_var.html#cb1016-12" aria-hidden="true" tabindex="-1"></a>test_serial_ptasy <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">serial.test</span>(model_var, <span class="co"># 検定対象のモデルオブジェクト</span></span>
<span id="cb1016-13"><a href="09_var.html#cb1016-13" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">lags.pt =</span> <span class="dv">16</span>, <span class="co"># ポルトマント検定のラグ次数</span></span>
<span id="cb1016-14"><a href="09_var.html#cb1016-14" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">type =</span> <span class="st">&quot;PT.asymptotic&quot;</span> <span class="co"># 検定タイプ（&quot;PT.asymptotic&quot;、&quot;PT.adjusted&quot;、&quot;BG&quot;、&quot;ES&quot;）</span></span>
<span id="cb1016-15"><a href="09_var.html#cb1016-15" aria-hidden="true" tabindex="-1"></a>                                       )</span>
<span id="cb1016-16"><a href="09_var.html#cb1016-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1016-17"><a href="09_var.html#cb1016-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(test_serial_ptasy)</span></code></pre></div>
<pre><code>## 
##  Portmanteau Test (asymptotic)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 173.97, df = 208, p-value = 0.9587</code></pre>
<pre><code>## $serial
## 
##  Portmanteau Test (asymptotic)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 173.97, df = 208, p-value = 0.9587</code></pre>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="09_var.html#cb1019-1" aria-hidden="true" tabindex="-1"></a><span class="co"># リュン＝ボックス検定（修正ポルトマント検定）</span></span>
<span id="cb1019-2"><a href="09_var.html#cb1019-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 帰無仮説：系列無相関</span></span>
<span id="cb1019-3"><a href="09_var.html#cb1019-3" aria-hidden="true" tabindex="-1"></a>test_serial_ptadj <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">serial.test</span>(model_var, <span class="co"># 検定対象のモデルオブジェクト</span></span>
<span id="cb1019-4"><a href="09_var.html#cb1019-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">lags.pt =</span> <span class="dv">16</span>, <span class="co"># ポルトマント検定のラグ次数</span></span>
<span id="cb1019-5"><a href="09_var.html#cb1019-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">type =</span> <span class="st">&quot;PT.adjusted&quot;</span> <span class="co"># 検定タイプ（&quot;PT.asymptotic&quot;、&quot;PT.adjusted&quot;、&quot;BG&quot;、&quot;ES&quot;）</span></span>
<span id="cb1019-6"><a href="09_var.html#cb1019-6" aria-hidden="true" tabindex="-1"></a>                                       )</span>
<span id="cb1019-7"><a href="09_var.html#cb1019-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1019-8"><a href="09_var.html#cb1019-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(test_serial_ptadj)</span></code></pre></div>
<pre><code>## 
##  Portmanteau Test (adjusted)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 198.04, df = 208, p-value = 0.6785</code></pre>
<pre><code>## $serial
## 
##  Portmanteau Test (adjusted)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 198.04, df = 208, p-value = 0.6785</code></pre>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="09_var.html#cb1022-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ブロイシュ＝ゴッドフレイ検定</span></span>
<span id="cb1022-2"><a href="09_var.html#cb1022-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 帰無仮説：系列無相関</span></span>
<span id="cb1022-3"><a href="09_var.html#cb1022-3" aria-hidden="true" tabindex="-1"></a>test_serial_bg <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">serial.test</span>(model_var, <span class="co"># 検定対象のモデルオブジェクト</span></span>
<span id="cb1022-4"><a href="09_var.html#cb1022-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">lags.bg =</span> <span class="dv">16</span>, <span class="co"># ブロイシュ＝ゴッドフレイ検定のラグ次数</span></span>
<span id="cb1022-5"><a href="09_var.html#cb1022-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">&quot;BG&quot;</span> <span class="co"># 検定タイプ（&quot;PT.asymptotic&quot;、&quot;PT.adjusted&quot;、&quot;BG&quot;、&quot;ES&quot;）</span></span>
<span id="cb1022-6"><a href="09_var.html#cb1022-6" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb1022-7"><a href="09_var.html#cb1022-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1022-8"><a href="09_var.html#cb1022-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(test_serial_bg)</span></code></pre></div>
<pre><code>## 
##  Breusch-Godfrey LM test
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 315.2, df = 256, p-value = 0.006811</code></pre>
<pre><code>## $serial
## 
##  Breusch-Godfrey LM test
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 315.2, df = 256, p-value = 0.006811</code></pre>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="09_var.html#cb1025-1" aria-hidden="true" tabindex="-1"></a><span class="co"># エドガートン＝シュクル検定</span></span>
<span id="cb1025-2"><a href="09_var.html#cb1025-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 帰無仮説：系列無相関</span></span>
<span id="cb1025-3"><a href="09_var.html#cb1025-3" aria-hidden="true" tabindex="-1"></a>test_serial_es <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">serial.test</span>(model_var, <span class="co"># 検定対象のモデルオブジェクト</span></span>
<span id="cb1025-4"><a href="09_var.html#cb1025-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">lags.bg =</span> <span class="dv">16</span>, <span class="co"># ブロイシュ＝ゴッドフレイ検定のラグ次数</span></span>
<span id="cb1025-5"><a href="09_var.html#cb1025-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">&quot;ES&quot;</span> <span class="co"># 検定タイプ（&quot;PT.asymptotic&quot;、&quot;PT.adjusted&quot;、&quot;BG&quot;、&quot;ES&quot;）</span></span>
<span id="cb1025-6"><a href="09_var.html#cb1025-6" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb1025-7"><a href="09_var.html#cb1025-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1025-8"><a href="09_var.html#cb1025-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(test_serial_es)</span></code></pre></div>
<pre><code>## 
##  Edgerton-Shukur F test
## 
## data:  Residuals of VAR object model_var
## F statistic = Inf, df1 = 256, df2 = 2, p-value &lt; 2.2e-16</code></pre>
<pre><code>## $serial
## 
##  Edgerton-Shukur F test
## 
## data:  Residuals of VAR object model_var
## F statistic = Inf, df1 = 256, df2 = 2, p-value &lt; 2.2e-16</code></pre>
</div>
<div id="均一分散の検定" class="section level4 unnumbered hasAnchor">
<h4>均一分散の検定<a href="09_var.html#均一分散の検定" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>vars</code>パッケージの<code>arch.test()</code>関数で、ARCH-LM検定を実行します。</p>
<p>ARCH-LM検定を実行した結果、帰無仮説「均一分散」を棄却できません。したがって、分散均一性の観点では誤差項に問題はない、と判断します。</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="09_var.html#cb1028-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb1028-2"><a href="09_var.html#cb1028-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb1028-3"><a href="09_var.html#cb1028-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-4"><a href="09_var.html#cb1028-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルを推定</span></span>
<span id="cb1028-5"><a href="09_var.html#cb1028-5" aria-hidden="true" tabindex="-1"></a>model_var <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(Canada, <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1028-6"><a href="09_var.html#cb1028-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p =</span> <span class="dv">3</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1028-7"><a href="09_var.html#cb1028-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">&quot;both&quot;</span> <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1028-8"><a href="09_var.html#cb1028-8" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb1028-9"><a href="09_var.html#cb1028-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-10"><a href="09_var.html#cb1028-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ARCH-LM検定</span></span>
<span id="cb1028-11"><a href="09_var.html#cb1028-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 帰無仮説：均一分散</span></span>
<span id="cb1028-12"><a href="09_var.html#cb1028-12" aria-hidden="true" tabindex="-1"></a>test_arch <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">arch.test</span>(model_var, <span class="co"># 検定対象のモデルオブジェクト</span></span>
<span id="cb1028-13"><a href="09_var.html#cb1028-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lags.multi =</span> <span class="dv">5</span> <span class="co"># 他変量ARCH検定のラグ次数</span></span>
<span id="cb1028-14"><a href="09_var.html#cb1028-14" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb1028-15"><a href="09_var.html#cb1028-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-16"><a href="09_var.html#cb1028-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(test_arch)</span></code></pre></div>
<pre><code>## 
##  ARCH (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 512.04, df = 500, p-value = 0.3451</code></pre>
<pre><code>## $arch.mul
## 
##  ARCH (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 512.04, df = 500, p-value = 0.3451</code></pre>
</div>
<div id="正規分布の検定" class="section level4 unnumbered hasAnchor">
<h4>正規分布の検定<a href="09_var.html#正規分布の検定" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>vars</code>パッケージの<code>normality.test()</code>関数で、ジャック＝ベラ検定を実行します。</p>
<p>ジャック＝ベラ検定を実行した結果、帰無仮説「正規分布」を棄却できません。したがって、正規性の観点では誤差項に問題はない、と判断します。</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="09_var.html#cb1031-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Canadaデータセットを呼び出し</span></span>
<span id="cb1031-2"><a href="09_var.html#cb1031-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Canada)</span>
<span id="cb1031-3"><a href="09_var.html#cb1031-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1031-4"><a href="09_var.html#cb1031-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルを推定</span></span>
<span id="cb1031-5"><a href="09_var.html#cb1031-5" aria-hidden="true" tabindex="-1"></a>model_var <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(Canada, <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1031-6"><a href="09_var.html#cb1031-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p =</span> <span class="dv">3</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1031-7"><a href="09_var.html#cb1031-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">&quot;both&quot;</span> <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1031-8"><a href="09_var.html#cb1031-8" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb1031-9"><a href="09_var.html#cb1031-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1031-10"><a href="09_var.html#cb1031-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ジャック＝ベラ検定</span></span>
<span id="cb1031-11"><a href="09_var.html#cb1031-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 帰無仮説：正規分布</span></span>
<span id="cb1031-12"><a href="09_var.html#cb1031-12" aria-hidden="true" tabindex="-1"></a>test_jb <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">normality.test</span>(model_var, <span class="co"># 検定対象のモデルオブジェクト</span></span>
<span id="cb1031-13"><a href="09_var.html#cb1031-13" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb1031-14"><a href="09_var.html#cb1031-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1031-15"><a href="09_var.html#cb1031-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(test_jb)</span></code></pre></div>
<pre><code>## $JB
## 
##  JB-Test (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 9.6532, df = 8, p-value = 0.2902
## 
## 
## $Skewness
## 
##  Skewness only (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 4.4454, df = 4, p-value = 0.3491
## 
## 
## $Kurtosis
## 
##  Kurtosis only (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 5.2078, df = 4, p-value = 0.2666</code></pre>
<pre><code>## $jb.mul
## $jb.mul$JB
## 
##  JB-Test (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 9.6532, df = 8, p-value = 0.2902
## 
## 
## $jb.mul$Skewness
## 
##  Skewness only (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 4.4454, df = 4, p-value = 0.3491
## 
## 
## $jb.mul$Kurtosis
## 
##  Kurtosis only (multivariate)
## 
## data:  Residuals of VAR object model_var
## Chi-squared = 5.2078, df = 4, p-value = 0.2666</code></pre>
</div>
</div>
<div id="実例インパルス応答" class="section level3 hasAnchor" number="9.11.11">
<h3><span class="header-section-number">9.11.11</span> 実例：インパルス応答<a href="09_var.html#実例インパルス応答" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>馬場（2018）の第3部2章「VARモデル」の「2-10 Rによるインパルス応答関数」を再現します。</p>
<p>使用するデータセットは、<code>fpp</code>パッケージの<code>usconsumption</code>データセットです。データ頻度は四半期、期間は1970年1-3月期〜2010年10-12月期です。格納されているデータは、実質個人消費支出（<code>consumption</code>、前期比、％）、実質可処分所得（<code>income</code>、前期比、％）です。</p>
<p><code>usconsumption</code>データセットの消費・所得データはどちらも前期比変化率のため、ADF検定を行うと単位根をもたない<code>I(0)</code>過程であることが確認できます（ここではADF検定は省略します）。</p>
<p>また、VARモデル推定の準備として<code>vars::VARselect()</code>関数で<code>type = "const"</code>として定数項のあるモデルでラグ次数の選択を行うと、AICで5次のラグ次数が選択されます。そこで、ここではラグ次数が5次で定数項があるVARモデルを推定し、その結果をもとに、<code>vars</code>パッケージの<code>irf()</code>関数でインパルス応答（直交化インパルス応答）を求めます。なお、変数は実質個人消費支出、実質可処分所得の順番です。</p>
<p>例として、消費・所得それぞれに発生したショックにより、消費と所得にどのような影響が現れるかをインパルス応答関数で計算します。結果を図示すると、消費のショックは0期目（ショックと同時点）から消費と所得の両方に影響し、その後1年程度で減衰していくことが確認できます。一方、所得は変数の順序を後にしているため、所得のショックは0期目の消費には全く影響しません。その後も、所得のショックは消費にはあまり影響しないことが確認できます。</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="09_var.html#cb1034-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usconsumptionデータを格納</span></span>
<span id="cb1034-2"><a href="09_var.html#cb1034-2" aria-hidden="true" tabindex="-1"></a>data_usconsumption <span class="ot">&lt;-</span> fpp<span class="sc">::</span>usconsumption</span>
<span id="cb1034-3"><a href="09_var.html#cb1034-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-4"><a href="09_var.html#cb1034-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定（変数は消費、所得の順番）</span></span>
<span id="cb1034-5"><a href="09_var.html#cb1034-5" aria-hidden="true" tabindex="-1"></a>model_var_usconsumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> data_usconsumption[, <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1034-6"><a href="09_var.html#cb1034-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">p =</span> <span class="dv">5</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1034-7"><a href="09_var.html#cb1034-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1034-8"><a href="09_var.html#cb1034-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb1034-9"><a href="09_var.html#cb1034-9" aria-hidden="true" tabindex="-1"></a>                                     )</span>
<span id="cb1034-10"><a href="09_var.html#cb1034-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-11"><a href="09_var.html#cb1034-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 消費のショックに対するインパルス応答</span></span>
<span id="cb1034-12"><a href="09_var.html#cb1034-12" aria-hidden="true" tabindex="-1"></a>irf_consumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">irf</span>(<span class="at">x =</span> model_var_usconsumption, <span class="co"># インパルス応答を計算するモデルオブジェクト（VAR、SVAR、SVEC、vec2varの出力）</span></span>
<span id="cb1034-13"><a href="09_var.html#cb1034-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">impulse =</span> <span class="st">&quot;consumption&quot;</span>, <span class="co"># ショックを発生させる変数（デフォルトは全ての変数）</span></span>
<span id="cb1034-14"><a href="09_var.html#cb1034-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">response =</span> <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>), <span class="co"># ショックを受ける変数（デフォルトは全ての変数）</span></span>
<span id="cb1034-15"><a href="09_var.html#cb1034-15" aria-hidden="true" tabindex="-1"></a>                             <span class="at">n.ahead =</span> <span class="dv">12</span>, <span class="co"># 何期先までインパルス応答を計算するか</span></span>
<span id="cb1034-16"><a href="09_var.html#cb1034-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ortho =</span> <span class="cn">TRUE</span>, <span class="co"># 直交化インパルス応答の場合はTRUE（VAR()関数の出力を用いる場合のみ）</span></span>
<span id="cb1034-17"><a href="09_var.html#cb1034-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">boot =</span> <span class="cn">TRUE</span> <span class="co"># ブートストラップ法による信頼区間を求める場合はTRUE</span></span>
<span id="cb1034-18"><a href="09_var.html#cb1034-18" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb1034-19"><a href="09_var.html#cb1034-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-20"><a href="09_var.html#cb1034-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(irf_consumption)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-464-1.png" width="672" /></p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="09_var.html#cb1035-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 所得のショックに対するインパルス応答</span></span>
<span id="cb1035-2"><a href="09_var.html#cb1035-2" aria-hidden="true" tabindex="-1"></a>irf_income <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">irf</span>(<span class="at">x =</span> model_var_usconsumption, <span class="co"># インパルス応答を計算するモデルオブジェクト</span></span>
<span id="cb1035-3"><a href="09_var.html#cb1035-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">impulse =</span> <span class="st">&quot;income&quot;</span>, <span class="co"># ショックを発生させる変数（デフォルトは全ての変数）</span></span>
<span id="cb1035-4"><a href="09_var.html#cb1035-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">response =</span> <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>), <span class="co"># ショックを受ける変数（デフォルトは全ての変数）</span></span>
<span id="cb1035-5"><a href="09_var.html#cb1035-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.ahead =</span> <span class="dv">12</span>, <span class="co"># 何期先までインパルス応答を計算するか</span></span>
<span id="cb1035-6"><a href="09_var.html#cb1035-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ortho =</span> <span class="cn">TRUE</span>, <span class="co"># 直交化インパルス応答の場合はTRUE（VAR()関数の出力を用いる場合のみ）</span></span>
<span id="cb1035-7"><a href="09_var.html#cb1035-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">boot =</span> <span class="cn">TRUE</span> <span class="co"># ブートストラップ法による信頼区間を求める場合はTRUE</span></span>
<span id="cb1035-8"><a href="09_var.html#cb1035-8" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb1035-9"><a href="09_var.html#cb1035-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1035-10"><a href="09_var.html#cb1035-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(irf_income)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-464-2.png" width="672" /></p>
<p>VARモデルを推定する際に変数の順序を実質可処分所得、実質個人消費支出の順番に逆転させると、インパルス応答（直交化インパルス応答）の結果が変化します。この場合は、消費のショックが0期目の所得に影響しなくなる一方、所得のショックが0期目の消費に影響するようになります。</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="09_var.html#cb1036-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usconsumptionデータを格納</span></span>
<span id="cb1036-2"><a href="09_var.html#cb1036-2" aria-hidden="true" tabindex="-1"></a>data_usconsumption <span class="ot">&lt;-</span> fpp<span class="sc">::</span>usconsumption</span>
<span id="cb1036-3"><a href="09_var.html#cb1036-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-4"><a href="09_var.html#cb1036-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定（変数は所得、消費の順番）</span></span>
<span id="cb1036-5"><a href="09_var.html#cb1036-5" aria-hidden="true" tabindex="-1"></a>model_var_usconsumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> data_usconsumption[, <span class="fu">c</span>(<span class="st">&quot;income&quot;</span>, <span class="st">&quot;consumption&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1036-6"><a href="09_var.html#cb1036-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">p =</span> <span class="dv">5</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1036-7"><a href="09_var.html#cb1036-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1036-8"><a href="09_var.html#cb1036-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb1036-9"><a href="09_var.html#cb1036-9" aria-hidden="true" tabindex="-1"></a>                                     )</span>
<span id="cb1036-10"><a href="09_var.html#cb1036-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-11"><a href="09_var.html#cb1036-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 消費のショックに対するインパルス応答</span></span>
<span id="cb1036-12"><a href="09_var.html#cb1036-12" aria-hidden="true" tabindex="-1"></a>irf_consumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">irf</span>(<span class="at">x =</span> model_var_usconsumption, <span class="co"># インパルス応答を計算するモデルオブジェクト（VAR、SVAR、SVEC、vec2varの出力）</span></span>
<span id="cb1036-13"><a href="09_var.html#cb1036-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">impulse =</span> <span class="st">&quot;consumption&quot;</span>, <span class="co"># ショックを発生させる変数（デフォルトは全ての変数）</span></span>
<span id="cb1036-14"><a href="09_var.html#cb1036-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">response =</span> <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>), <span class="co"># ショックを受ける変数（デフォルトは全ての変数）</span></span>
<span id="cb1036-15"><a href="09_var.html#cb1036-15" aria-hidden="true" tabindex="-1"></a>                             <span class="at">n.ahead =</span> <span class="dv">12</span>, <span class="co"># 何期先までインパルス応答を計算するか</span></span>
<span id="cb1036-16"><a href="09_var.html#cb1036-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ortho =</span> <span class="cn">TRUE</span>, <span class="co"># 直交化インパルス応答の場合はTRUE（VAR()関数の出力を用いる場合のみ）</span></span>
<span id="cb1036-17"><a href="09_var.html#cb1036-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">boot =</span> <span class="cn">TRUE</span> <span class="co"># ブートストラップ法による信頼区間を求める場合はTRUE</span></span>
<span id="cb1036-18"><a href="09_var.html#cb1036-18" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb1036-19"><a href="09_var.html#cb1036-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-20"><a href="09_var.html#cb1036-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(irf_consumption)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-465-1.png" width="672" /></p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="09_var.html#cb1037-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 所得のショックに対するインパルス応答</span></span>
<span id="cb1037-2"><a href="09_var.html#cb1037-2" aria-hidden="true" tabindex="-1"></a>irf_income <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">irf</span>(<span class="at">x =</span> model_var_usconsumption, <span class="co"># インパルス応答を計算するモデルオブジェクト</span></span>
<span id="cb1037-3"><a href="09_var.html#cb1037-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">impulse =</span> <span class="st">&quot;income&quot;</span>, <span class="co"># ショックを発生させる変数（デフォルトは全ての変数）</span></span>
<span id="cb1037-4"><a href="09_var.html#cb1037-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">response =</span> <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>), <span class="co"># ショックを受ける変数（デフォルトは全ての変数）</span></span>
<span id="cb1037-5"><a href="09_var.html#cb1037-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.ahead =</span> <span class="dv">12</span>, <span class="co"># 何期先までインパルス応答を計算するか</span></span>
<span id="cb1037-6"><a href="09_var.html#cb1037-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ortho =</span> <span class="cn">TRUE</span>, <span class="co"># 直交化インパルス応答の場合はTRUE（VAR()関数の出力を用いる場合のみ）</span></span>
<span id="cb1037-7"><a href="09_var.html#cb1037-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">boot =</span> <span class="cn">TRUE</span> <span class="co"># ブートストラップ法による信頼区間を求める場合はTRUE</span></span>
<span id="cb1037-8"><a href="09_var.html#cb1037-8" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb1037-9"><a href="09_var.html#cb1037-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1037-10"><a href="09_var.html#cb1037-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(irf_income)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-465-2.png" width="672" /></p>
</div>
<div id="実例予測誤差の分散分解" class="section level3 hasAnchor" number="9.11.12">
<h3><span class="header-section-number">9.11.12</span> 実例：予測誤差の分散分解<a href="09_var.html#実例予測誤差の分散分解" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>馬場（2018）の第3部2章「VARモデル」の「2-10 Rによるインパルス応答関数」の後半に記載されている、予測誤差の分散分解（forecast error variance decomposition, FEVD）を再現します。使用するデータセットは、「2-10 Rによるインパルス応答関数」と同じ<code>fpp</code>パッケージの<code>usconsumption</code>データセットです。分散分解は<code>vars</code>パッケージの<code>fevd()</code>関数で求めます。</p>
<p>まず、変数の順序を消費、所得としてVARモデルを推定し、その推定結果をもとに分散分解を求めます。分散分解の結果を図示すると、消費は所得の影響をほとんど受けていませんが、所得は1〜5期にかけて消費の影響が25％程度まで徐々に拡大していくことが確認できます。</p>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="09_var.html#cb1038-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usconsumptionデータを格納</span></span>
<span id="cb1038-2"><a href="09_var.html#cb1038-2" aria-hidden="true" tabindex="-1"></a>data_usconsumption <span class="ot">&lt;-</span> fpp<span class="sc">::</span>usconsumption</span>
<span id="cb1038-3"><a href="09_var.html#cb1038-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-4"><a href="09_var.html#cb1038-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定（変数は消費、所得の順番）</span></span>
<span id="cb1038-5"><a href="09_var.html#cb1038-5" aria-hidden="true" tabindex="-1"></a>model_var_usconsumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> data_usconsumption[, <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1038-6"><a href="09_var.html#cb1038-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">p =</span> <span class="dv">5</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1038-7"><a href="09_var.html#cb1038-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1038-8"><a href="09_var.html#cb1038-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb1038-9"><a href="09_var.html#cb1038-9" aria-hidden="true" tabindex="-1"></a>                                     )</span>
<span id="cb1038-10"><a href="09_var.html#cb1038-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-11"><a href="09_var.html#cb1038-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 分散分解</span></span>
<span id="cb1038-12"><a href="09_var.html#cb1038-12" aria-hidden="true" tabindex="-1"></a>fevd_usconsumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">fevd</span>(<span class="at">x =</span> model_var_usconsumption, <span class="co"># 分散分解を計算するモデルオブジェクト（VAR、SVAR、SVEC、vec2varの出力）</span></span>
<span id="cb1038-13"><a href="09_var.html#cb1038-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n.ahead =</span> <span class="dv">12</span>, <span class="co"># 何期先まで分散分解を計算するか</span></span>
<span id="cb1038-14"><a href="09_var.html#cb1038-14" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb1038-15"><a href="09_var.html#cb1038-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-16"><a href="09_var.html#cb1038-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fevd_usconsumption)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-466-1.png" width="672" /></p>
<p>次に、VARモデルの推定における変数の順序を所得、消費に変更し、分散分解を求め直します。すると、消費に対して所得が10％程度の影響度をもつようになりました。このように、分散分解もインパルス応答（直交化インパルス応答）と同様に変数の順序によって結果が変わりうる点に注意が必要です。</p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="09_var.html#cb1039-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usconsumptionデータを格納</span></span>
<span id="cb1039-2"><a href="09_var.html#cb1039-2" aria-hidden="true" tabindex="-1"></a>data_usconsumption <span class="ot">&lt;-</span> fpp<span class="sc">::</span>usconsumption</span>
<span id="cb1039-3"><a href="09_var.html#cb1039-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-4"><a href="09_var.html#cb1039-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定（変数は所得、消費の順番）</span></span>
<span id="cb1039-5"><a href="09_var.html#cb1039-5" aria-hidden="true" tabindex="-1"></a>model_var_usconsumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> data_usconsumption[, <span class="fu">c</span>(<span class="st">&quot;income&quot;</span>, <span class="st">&quot;consumption&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1039-6"><a href="09_var.html#cb1039-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">p =</span> <span class="dv">5</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1039-7"><a href="09_var.html#cb1039-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1039-8"><a href="09_var.html#cb1039-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb1039-9"><a href="09_var.html#cb1039-9" aria-hidden="true" tabindex="-1"></a>                                     )</span>
<span id="cb1039-10"><a href="09_var.html#cb1039-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-11"><a href="09_var.html#cb1039-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 分散分解</span></span>
<span id="cb1039-12"><a href="09_var.html#cb1039-12" aria-hidden="true" tabindex="-1"></a>fevd_usconsumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">fevd</span>(<span class="at">x =</span> model_var_usconsumption, <span class="co"># 分散分解を計算するモデルオブジェクト（VAR、SVAR、SVEC、vec2varの出力）</span></span>
<span id="cb1039-13"><a href="09_var.html#cb1039-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n.ahead =</span> <span class="dv">12</span>, <span class="co"># 何期先まで分散分解を計算するか</span></span>
<span id="cb1039-14"><a href="09_var.html#cb1039-14" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb1039-15"><a href="09_var.html#cb1039-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-16"><a href="09_var.html#cb1039-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fevd_usconsumption)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-467-1.png" width="672" /></p>
</div>
<div id="実例グレンジャー因果性検定" class="section level3 hasAnchor" number="9.11.13">
<h3><span class="header-section-number">9.11.13</span> 実例：グレンジャー因果性検定<a href="09_var.html#実例グレンジャー因果性検定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>馬場（2018）の第3部2章「VARモデル」の「2-9 RによるGranger因果性検定」を再現します。使用するデータセットは、「2-10 Rによるインパルス応答関数」と同じ<code>fpp</code>パッケージの<code>usconsumption</code>データセットです。分散分解は<code>vars</code>パッケージの<code>causality()</code>関数で求めます。</p>
<p>あらかじめ、変数の順序を消費、所得としてVARモデルを推定します。</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="09_var.html#cb1040-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usconsumptionデータを格納</span></span>
<span id="cb1040-2"><a href="09_var.html#cb1040-2" aria-hidden="true" tabindex="-1"></a>data_usconsumption <span class="ot">&lt;-</span> fpp<span class="sc">::</span>usconsumption</span>
<span id="cb1040-3"><a href="09_var.html#cb1040-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1040-4"><a href="09_var.html#cb1040-4" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定（変数は消費、所得の順番）</span></span>
<span id="cb1040-5"><a href="09_var.html#cb1040-5" aria-hidden="true" tabindex="-1"></a>model_var_usconsumption <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> data_usconsumption[, <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1040-6"><a href="09_var.html#cb1040-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">p =</span> <span class="dv">5</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1040-7"><a href="09_var.html#cb1040-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1040-8"><a href="09_var.html#cb1040-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb1040-9"><a href="09_var.html#cb1040-9" aria-hidden="true" tabindex="-1"></a>                                     )</span></code></pre></div>
<p>VARモデルの推定結果を使い、まず所得から消費へのグレンジャー因果を検証します。原因変数が所得なので、<code>vars::causality()</code>関数の<code>cause</code>引数に<code>"income"</code>を指定します。<code>vars::causality()</code>関数の出力のうち、<code>Granger</code>がグレンジャー因果性検定の結果、<code>Instant</code>がグレンジャー瞬間的因果性検定の結果を示しています。</p>
<p>グレンジャー因果性検定ではp値が0.212と5％有意水準を上回り、「グレンジャー因果性がない」との帰無仮説を棄却できないため、所得から消費へのグレンジャー因果があるとは判断できません。</p>
<p>一方、グレンジャー瞬間的因果性検定ではp値が5％有意水準より小さく、「グレンジャー瞬間的因果性がない」との帰無仮説を棄却するため、所得から消費へのグレンジャー瞬間的因果があると判断します。これは、所得が同時点の消費に影響し、VARモデルにおける所得の式の残差と消費の式の残差に関連性があることを意味しています。</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="09_var.html#cb1041-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 所得から消費へのグレンジャー因果</span></span>
<span id="cb1041-2"><a href="09_var.html#cb1041-2" aria-hidden="true" tabindex="-1"></a>vars<span class="sc">::</span><span class="fu">causality</span>(model_var_usconsumption, <span class="co"># VARモデルの推計結果</span></span>
<span id="cb1041-3"><a href="09_var.html#cb1041-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">cause =</span> <span class="st">&quot;income&quot;</span>, <span class="co"># 原因変数（文字列で指定。ベクトルにして2種類以上の原因変数を指定することも可能）</span></span>
<span id="cb1041-4"><a href="09_var.html#cb1041-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">vcov. =</span> <span class="cn">NULL</span>, <span class="co"># 共和分行列を指定（デフォルトはNULL）</span></span>
<span id="cb1041-5"><a href="09_var.html#cb1041-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">boot =</span> <span class="cn">FALSE</span>, <span class="co"># 棄却点をブートストラップ法で計算する場合はTRUE（デフォルトはFALSE）</span></span>
<span id="cb1041-6"><a href="09_var.html#cb1041-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">boot.runs =</span> <span class="dv">1000</span> <span class="co"># ブートストラップ法の繰り返し数</span></span>
<span id="cb1041-7"><a href="09_var.html#cb1041-7" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## $Granger
## 
##  Granger causality H0: income do not Granger-cause consumption
## 
## data:  VAR object model_var_usconsumption
## F-Test = 1.4337, df1 = 5, df2 = 296, p-value = 0.212
## 
## 
## $Instant
## 
##  H0: No instantaneous causality between: income and consumption
## 
## data:  VAR object model_var_usconsumption
## Chi-squared = 15.492, df = 1, p-value = 8.285e-05</code></pre>
<p>次に、消費から所得へのグレンジャー因果を検証します。グレンジャー因果性検定、グレンジャー瞬間的因果性検定ともにp値が有意水準5％より小さく、消費から所得へのグレンジャー因果性、グレンジャー瞬間的因果性があると判断します。</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="09_var.html#cb1043-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 消費から所得へのグレンジャー因果</span></span>
<span id="cb1043-2"><a href="09_var.html#cb1043-2" aria-hidden="true" tabindex="-1"></a>vars<span class="sc">::</span><span class="fu">causality</span>(model_var_usconsumption, <span class="co"># VARモデルの推計結果</span></span>
<span id="cb1043-3"><a href="09_var.html#cb1043-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">cause =</span> <span class="st">&quot;consumption&quot;</span>, <span class="co"># 原因変数（文字列で指定。ベクトルにして2種類以上の原因変数を指定することも可能）</span></span>
<span id="cb1043-4"><a href="09_var.html#cb1043-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">vcov. =</span> <span class="cn">NULL</span>, <span class="co"># 共和分行列を指定（デフォルトはNULL）</span></span>
<span id="cb1043-5"><a href="09_var.html#cb1043-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">boot =</span> <span class="cn">FALSE</span>, <span class="co"># 棄却点をブートストラップ法で計算する場合はTRUE（デフォルトはFALSE）</span></span>
<span id="cb1043-6"><a href="09_var.html#cb1043-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">boot.runs =</span> <span class="dv">1000</span> <span class="co"># ブートストラップ法の繰り返し数</span></span>
<span id="cb1043-7"><a href="09_var.html#cb1043-7" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## $Granger
## 
##  Granger causality H0: consumption do not Granger-cause income
## 
## data:  VAR object model_var_usconsumption
## F-Test = 10.575, df1 = 5, df2 = 296, p-value = 2.334e-09
## 
## 
## $Instant
## 
##  H0: No instantaneous causality between: consumption and income
## 
## data:  VAR object model_var_usconsumption
## Chi-squared = 15.492, df = 1, p-value = 8.285e-05</code></pre>
</div>
<div id="実例予測" class="section level3 hasAnchor" number="9.11.14">
<h3><span class="header-section-number">9.11.14</span> 実例：予測<a href="09_var.html#実例予測" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>馬場（2018）の第3部2章「VARモデル」の「2-8 VARモデルによる予測」をもとに、VARモデルによる予測精度を評価します。</p>
<p>使用するデータセットは、「2-10 Rによるインパルス応答関数」と同じ<code>fpp</code>パッケージの<code>usconsumption</code>データセットです。データ頻度は四半期、期間は1970年1-3月期〜2010年10-12月期です。格納されているデータは、実質個人消費支出（<code>consumption</code>、前期比、％）、実質可処分所得（<code>income</code>、前期比、％）です。<code>usconsumption</code>データセットの消費・所得データはどちらも前期比変化率のため、ADF検定を行うと単位根をもたない<code>I(0)</code>過程であることが確認できます（ここではADF検定は省略します）。また、VARモデル推定の準備として<code>vars::VARselect()</code>関数で<code>type = "const"</code>として定数項のあるモデルでラグ次数の選択を行うと、AICで5次のラグ次数が選択されます。</p>
<p>まず、予測精度を評価するため、データを訓練データとテストデータに分割します。ここでは、1970年1-3月期〜2010年10-12月期の41年間のうち、最後5年間（2006年1-3月期以降）をテストデータとしてホールドアウトしておきます。</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="09_var.html#cb1045-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usconsumptionデータを格納</span></span>
<span id="cb1045-2"><a href="09_var.html#cb1045-2" aria-hidden="true" tabindex="-1"></a>data_usconsumption <span class="ot">&lt;-</span> fpp<span class="sc">::</span>usconsumption</span>
<span id="cb1045-3"><a href="09_var.html#cb1045-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1045-4"><a href="09_var.html#cb1045-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 訓練データ（2005年10-12月期以前）</span></span>
<span id="cb1045-5"><a href="09_var.html#cb1045-5" aria-hidden="true" tabindex="-1"></a>data_train <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">window</span>(data_usconsumption, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">4</span>))</span>
<span id="cb1045-6"><a href="09_var.html#cb1045-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(data_train)</span></code></pre></div>
<pre><code>##         consumption     income
## 2004 Q3   0.8703787  0.6660822
## 2004 Q4   1.0739515  1.3889037
## 2005 Q1   0.7939389 -1.2255228
## 2005 Q2   0.9847789  0.7016735
## 2005 Q3   0.7562780  0.5947781
## 2005 Q4   0.2481979  0.5453283</code></pre>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="09_var.html#cb1047-1" aria-hidden="true" tabindex="-1"></a><span class="co"># テストデータ（2006年1-3月期以降）</span></span>
<span id="cb1047-2"><a href="09_var.html#cb1047-2" aria-hidden="true" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">window</span>(data_usconsumption, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2006</span>, <span class="dv">1</span>))</span>
<span id="cb1047-3"><a href="09_var.html#cb1047-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_test)</span></code></pre></div>
<pre><code>##         consumption    income
## 2006 Q1   1.0190271 1.8556786
## 2006 Q2   0.6004822 0.8823418
## 2006 Q3   0.5980000 0.4791447
## 2006 Q4   0.9258411 1.3023574
## 2007 Q1   0.5542412 0.4513898
## 2007 Q2   0.3825796 0.1493349</code></pre>
<p>次に、訓練データでVARモデルのラグ次数を選択します。ここでは、確定項は定数項のみを意味する<code>const</code>としておきます。全てのデータを用いてラグ次数を選択したときと同様に、AICで最適なラグ次数が「5」になることを踏まえ、ラグ次数は「5」を選択します。</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="09_var.html#cb1049-1" aria-hidden="true" tabindex="-1"></a>varselect_train <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VARselect</span>(<span class="at">y =</span> data_train, <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1049-2"><a href="09_var.html#cb1049-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># モデルに含む確定項（&quot;const&quot;, &quot;trend&quot;, &quot;both&quot;, &quot;none&quot;）</span></span>
<span id="cb1049-3"><a href="09_var.html#cb1049-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">lag.max =</span> <span class="dv">10</span> <span class="co"># 検査するラグ次数の最大値</span></span>
<span id="cb1049-4"><a href="09_var.html#cb1049-4" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb1049-5"><a href="09_var.html#cb1049-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-6"><a href="09_var.html#cb1049-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(varselect_train)</span></code></pre></div>
<pre><code>## $selection
## AIC(n)  HQ(n)  SC(n) FPE(n) 
##      5      1      1      5 
## 
## $criteria
##                 1          2          3          4          5          6
## AIC(n) -1.2852084 -1.2458673 -1.2632626 -1.2554251 -1.2877577 -1.2388627
## HQ(n)  -1.2324805 -1.1579875 -1.1402309 -1.0972415 -1.0944222 -1.0103754
## SC(n)  -1.1554544 -1.0296106 -0.9605032 -0.8661630 -0.8119929 -0.6765953
## FPE(n)  0.2765971  0.2877112  0.2827839  0.2850701  0.2760931  0.2900685
##                 7          8          9         10
## AIC(n) -1.1953796 -1.1813493 -1.1430871 -1.1109326
## HQ(n)  -0.9317404 -0.8825582 -0.8091441 -0.7418377
## SC(n)  -0.5466095 -0.4460765 -0.3213116 -0.2026544
## FPE(n)  0.3031598  0.3077092  0.3200623  0.3309713</code></pre>
<p>訓練データでVARモデルを推定し、予測値を作成します。予測値の作成には<code>stats::predict()</code>関数を使用します。</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="09_var.html#cb1051-1" aria-hidden="true" tabindex="-1"></a><span class="co"># レベルVARモデルの推定（変数は消費、所得の順番）</span></span>
<span id="cb1051-2"><a href="09_var.html#cb1051-2" aria-hidden="true" tabindex="-1"></a>model_var_train <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(<span class="at">y =</span> data_train[, <span class="fu">c</span>(<span class="st">&quot;consumption&quot;</span>, <span class="st">&quot;income&quot;</span>)], <span class="co"># 内生変数を含むデータセット</span></span>
<span id="cb1051-3"><a href="09_var.html#cb1051-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">p =</span> <span class="dv">5</span>, <span class="co"># ラグ次数</span></span>
<span id="cb1051-4"><a href="09_var.html#cb1051-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">&quot;const&quot;</span>, <span class="co"># 確定項（&quot;both&quot;, &quot;const&quot;, &quot;trend&quot;, &quot;none&quot;）</span></span>
<span id="cb1051-5"><a href="09_var.html#cb1051-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">exogen =</span> <span class="cn">NULL</span> <span class="co"># 外生変数</span></span>
<span id="cb1051-6"><a href="09_var.html#cb1051-6" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb1051-7"><a href="09_var.html#cb1051-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1051-8"><a href="09_var.html#cb1051-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値を作成</span></span>
<span id="cb1051-9"><a href="09_var.html#cb1051-9" aria-hidden="true" tabindex="-1"></a>pred_train <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">predict</span>(model_var_train, <span class="co"># 予測値を計算するモデルオブジェクト（VAR、vec2varの出力）</span></span>
<span id="cb1051-10"><a href="09_var.html#cb1051-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">n.ahead =</span> <span class="fu">nrow</span>(data_test), <span class="co"># 何期先まで予測値を作成するか</span></span>
<span id="cb1051-11"><a href="09_var.html#cb1051-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ci =</span> <span class="fl">0.95</span>, <span class="co"># 予測の信頼区間</span></span>
<span id="cb1051-12"><a href="09_var.html#cb1051-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">dumvar =</span> <span class="cn">NULL</span> <span class="co"># ダミー変数を含む外生変数（行列形式）</span></span>
<span id="cb1051-13"><a href="09_var.html#cb1051-13" aria-hidden="true" tabindex="-1"></a>                             )</span>
<span id="cb1051-14"><a href="09_var.html#cb1051-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1051-15"><a href="09_var.html#cb1051-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 予測値を図示</span></span>
<span id="cb1051-16"><a href="09_var.html#cb1051-16" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pred_train)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-473-1.png" width="672" /></p>
<p>最後に、<code>forecast</code>パッケージの<code>accuracy()</code>関数で予測精度を評価します。</p>
<p>消費の予測精度をRMSEで評価すると、VARモデル予測は0.849、ナイーブ予測（過去の平均値）は0.847、ナイーブ予測（最後の値）は0.620と、残念ながらナイーブ予測の精度より悪い結果になりました。</p>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="09_var.html#cb1052-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 消費のVARモデル予測値の精度</span></span>
<span id="cb1052-2"><a href="09_var.html#cb1052-2" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(data_test[, <span class="st">&quot;consumption&quot;</span>], <span class="co"># ホールドアウトしたテストデータ</span></span>
<span id="cb1052-3"><a href="09_var.html#cb1052-3" aria-hidden="true" tabindex="-1"></a>                   pred_train<span class="sc">$</span>fcst<span class="sc">$</span>consumption[, <span class="st">&quot;fcst&quot;</span>] <span class="co"># 作成した予測値</span></span>
<span id="cb1052-4"><a href="09_var.html#cb1052-4" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                 ME      RMSE       MAE      MPE     MAPE
## Test set 0.5796194 0.8493349 0.6078776 69.91951 73.23117</code></pre>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="09_var.html#cb1054-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ナイーブ予測（過去の平均値）の精度</span></span>
<span id="cb1054-2"><a href="09_var.html#cb1054-2" aria-hidden="true" tabindex="-1"></a>pred_meanf <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">meanf</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;consumption&quot;</span>], <span class="co"># 訓練データの目的変数</span></span>
<span id="cb1054-3"><a href="09_var.html#cb1054-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">h =</span> <span class="dv">20</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb1054-4"><a href="09_var.html#cb1054-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb1054-5"><a href="09_var.html#cb1054-5" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb1054-6"><a href="09_var.html#cb1054-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-7"><a href="09_var.html#cb1054-7" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(data_test[, <span class="st">&quot;consumption&quot;</span>], <span class="co"># ホールドアウトしたテストデータ</span></span>
<span id="cb1054-8"><a href="09_var.html#cb1054-8" aria-hidden="true" tabindex="-1"></a>                   pred_meanf<span class="sc">$</span>mean</span>
<span id="cb1054-9"><a href="09_var.html#cb1054-9" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                ME      RMSE       MAE      MPE     MAPE      ACF1 Theil&#39;s U
## Test set 0.576444 0.8472476 0.6107782 69.81901 73.97757 0.6536854       Inf</code></pre>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="09_var.html#cb1056-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ナイーブ予測（最後の値）の精度</span></span>
<span id="cb1056-2"><a href="09_var.html#cb1056-2" aria-hidden="true" tabindex="-1"></a>pred_rwf <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">rwf</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;consumption&quot;</span>], <span class="co"># 訓練データの目的変数</span></span>
<span id="cb1056-3"><a href="09_var.html#cb1056-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">h =</span> <span class="dv">20</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb1056-4"><a href="09_var.html#cb1056-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb1056-5"><a href="09_var.html#cb1056-5" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb1056-6"><a href="09_var.html#cb1056-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1056-7"><a href="09_var.html#cb1056-7" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(data_test[, <span class="st">&quot;consumption&quot;</span>], <span class="co"># ホールドアウトしたテストデータ</span></span>
<span id="cb1056-8"><a href="09_var.html#cb1056-8" aria-hidden="true" tabindex="-1"></a>                   pred_rwf<span class="sc">$</span>mean</span>
<span id="cb1056-9"><a href="09_var.html#cb1056-9" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                     ME    RMSE       MAE        MPE     MAPE      ACF1
## Test set -0.0009843402 0.62092 0.5068942 -0.3965949 204.2299 0.6536854
##          Theil&#39;s U
## Test set       Inf</code></pre>
<p>同様に所得の予測精度をRMSEで評価すると、VARモデル予測は1.097、ナイーブ予測（過去の平均値）は1.101、ナイーブ予測（最後の値）は1.044と、ナイーブ予測（過去の平均値）の精度より良いものの、ナイーブ予測（最後の値）の精度より悪い結果になりました。VARモデルの予測精度が悪い背景として、予測期間（2006-2010年）にGlobal Financial Crisisが発生し、消費、所得ともに外的要因で大きく変動したことがあると考えられます。</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="09_var.html#cb1058-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 所得のVARモデル予測値の精度</span></span>
<span id="cb1058-2"><a href="09_var.html#cb1058-2" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(data_test[, <span class="st">&quot;income&quot;</span>], <span class="co"># ホールドアウトしたテストデータ</span></span>
<span id="cb1058-3"><a href="09_var.html#cb1058-3" aria-hidden="true" tabindex="-1"></a>                   pred_train<span class="sc">$</span>fcst<span class="sc">$</span>income[, <span class="st">&quot;fcst&quot;</span>] <span class="co"># 作成した予測値</span></span>
<span id="cb1058-4"><a href="09_var.html#cb1058-4" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                 ME     RMSE       MAE      MPE     MAPE
## Test set 0.3852657 1.097126 0.8229979 48.80035 104.1688</code></pre>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="09_var.html#cb1060-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ナイーブ予測（過去の平均値）の精度</span></span>
<span id="cb1060-2"><a href="09_var.html#cb1060-2" aria-hidden="true" tabindex="-1"></a>pred_meanf <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">meanf</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;income&quot;</span>], <span class="co"># 訓練データの目的変数</span></span>
<span id="cb1060-3"><a href="09_var.html#cb1060-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">h =</span> <span class="dv">20</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb1060-4"><a href="09_var.html#cb1060-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb1060-5"><a href="09_var.html#cb1060-5" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb1060-6"><a href="09_var.html#cb1060-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-7"><a href="09_var.html#cb1060-7" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(data_test[, <span class="st">&quot;income&quot;</span>], <span class="co"># ホールドアウトしたテストデータ</span></span>
<span id="cb1060-8"><a href="09_var.html#cb1060-8" aria-hidden="true" tabindex="-1"></a>                   pred_meanf<span class="sc">$</span>mean</span>
<span id="cb1060-9"><a href="09_var.html#cb1060-9" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                 ME     RMSE       MAE      MPE     MAPE      ACF1 Theil&#39;s U
## Test set 0.3758971 1.100584 0.8268816 48.04421 105.6855 0.1283031       Inf</code></pre>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="09_var.html#cb1062-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ナイーブ予測（最後の値）の精度</span></span>
<span id="cb1062-2"><a href="09_var.html#cb1062-2" aria-hidden="true" tabindex="-1"></a>pred_rwf <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">rwf</span>(<span class="at">y =</span> data_train[, <span class="st">&quot;income&quot;</span>], <span class="co"># 訓練データの目的変数</span></span>
<span id="cb1062-3"><a href="09_var.html#cb1062-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">h =</span> <span class="dv">20</span>, <span class="co"># 何期先まで予測するか</span></span>
<span id="cb1062-4"><a href="09_var.html#cb1062-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">level =</span> <span class="dv">95</span> <span class="co"># 出力する予測値の信頼区間。複数出力するときはc(95, 70)などとベクトルで指定</span></span>
<span id="cb1062-5"><a href="09_var.html#cb1062-5" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb1062-6"><a href="09_var.html#cb1062-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1062-7"><a href="09_var.html#cb1062-7" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(data_test[, <span class="st">&quot;income&quot;</span>], <span class="co"># ホールドアウトしたテストデータ</span></span>
<span id="cb1062-8"><a href="09_var.html#cb1062-8" aria-hidden="true" tabindex="-1"></a>                   pred_rwf<span class="sc">$</span>mean</span>
<span id="cb1062-9"><a href="09_var.html#cb1062-9" aria-hidden="true" tabindex="-1"></a>                   )</span></code></pre></div>
<pre><code>##                 ME     RMSE      MAE      MPE    MAPE      ACF1 Theil&#39;s U
## Test set 0.1388272 1.043676 0.757668 25.45754 138.938 0.1283031       Inf</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="08_ts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix_cont.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlights": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
