# Rの設定

第1章「Rの設定」では、Rを使用する際の各種設定について解説します。パッケージのインストール・インポートや、プロキシサーバーの設定（プロキシ環境のみ）など、Rの使用に欠かせない様々な設定について記載しています。

## 設定全般

### Rのバージョン確認 {.unnumbered}

Rのバージョン情報を出力します。

```{r}
version
```

### セッション情報の確認 {.unnumbered}

Rのバージョンに加え、使用環境、パッケージ情報を出力します。

```{r}
sessionInfo()
```

### 警告の非表示 {.unnumbered}

Rが出力する警告（Warning）を非表示にします。

```{r}
options(warn = -1)
```

### 関数が出力する警告やメッセージの非表示 {.unnumbered}

関数が出力する警告やメッセージは`options(warn = -1)`で非表示にできないため、`suppressWarnings()`関数や`suppressMessages()`関数を使用します。

```{r, eval=FALSE}
suppressWarnings(警告を出力する関数)
suppressMessages(メッセージを出力する関数)
```

## プロキシサーバーの設定

Webからデータを直接読み込むため、企業や大学などのプロキシ環境ではプロキシサーバーの設定を行ってください。なお、下記のコードは認証プロキシには非対応です。

```{r, eval=FALSE}
## プロキシサーバーとポートを記入
proxy_url <- "http://proxyserver:port/"


## Rのシステム環境変数を設定
Sys.setenv("http_proxy" = proxy_url)
Sys.setenv("https_proxy" = proxy_url)


## Rのダウンロードオプションを設定
options(download.file.method = "libcurl")
options(timeout = NA)
```

## パッケージのインストールとインポート

### 使用するパッケージ一覧 {.unnumbered}

-   tidyverse系
    -   [lubridate](https://lubridate.tidyverse.org/)：日付処理
    -   [magrittr](https://magrittr.tidyverse.org/)：パイプ処理
    -   [tidyverse](https://www.tidyverse.org/)：モダンなデータ分析用パッケージセット
    -   [readxl](https://readxl.tidyverse.org/)：Excelファイルの読み込み
-   図表系
    -   [esquisse](https://cran.r-project.org/web/packages/esquisse/vignettes/get-started.html)：shanyを使用した直感的な図表作成
    -   [geofacet](https://cran.r-project.org/web/packages/geofacet/vignettes/geofacet.html)：地図形式のファセット図配置
    -   [ggplotgui](https://cran.r-project.org/web/packages/ggplotgui/README.html)：shanyを使用した直感的な図表作成
    -   [ggpubr](https://rpkgs.datanovia.com/ggpubr/)：論文形式の図表作成
    -   [ggsci](https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html)：科学系論文の雑誌別カラーパレット
    -   [ggrepel](https://ggrepel.slowkow.com/index.html)：散布図のラベル付与
    -   hexbin：`geom_hex()`関数を使用するために必要なパッケージ
    -   [lemon](https://github.com/stefanedwards/lemon)：ファセット図の軸・目盛り表示
    -   [RColorBrewer](https://cran.r-project.org/web/packages/RColorBrewer/index.html)：カラーパレット
-   統計系
    -   [corrplot](https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html)：相関係数行列の計算・可視化
    -   [corrr](https://corrr.tidymodels.org/)：相関係数行列の計算・可視化
    -   [DataExplorer](https://cran.r-project.org/web/packages/DataExplorer/vignettes/dataexplorer-intro.html)：探索的データ分析の一括実行
    -   [GGally](https://ggobi.github.io/ggally/index.html)：ペアプロットなどのデータ可視化
    -   mgcv：一般化加法モデル（GAM）
    -   plm：パネルデータモデル
    -   [psych](https://personality-project.org/r/psych/)：心理統計パッケージ
    -   sigmoid：シグモイド関数
    -   [SmartEDA](https://daya6489.github.io/SmartEDA/)：探索的データ分析の一括実行
    -   [tidyquant](https://business-science.github.io/tidyquant/index.html)：金融時系列データ分析
-   その他
    -   [openxlsx](https://ycphs.github.io/openxlsx/)：Excelのxlsxファイルの読み込み・編集・書き出し

### パッケージのインストールとインポート {.unnumbered}

パッケージのインストールは`install.packages()`関数、インストールしたパッケージのインポート（呼び出し）は`library()`関数で実行します。一度インストールすれば、その後はインポートするだけでパッケージを使用することができます。

```{r, results='hide', warning=FALSE, message=FALSE}
# パッケージ一覧
packages <- c(
  "lubridate", "magrittr", "tidyverse", "readxl",
  "esquisse", "geofacet", "ggplotgui", "ggpubr", "ggsci", "ggrepel", "hexbin", "lemon", "RColorBrewer",
  "corrplot", "corrr", "DataExplorer", "GGally", "mgcv", "plm", "psych", "sigmoid", "SmartEDA", "tidyquant",
  "openxlsx"
)

# インストールしていないパッケージがあればインストール
new_packages <- packages[!(packages %in% installed.packages()[,"Package"])]

if(length(new_packages)) {
  install.packages(new_packages)
}

# パッケージをインポート
for (pkg in packages) {
  library(pkg, character.only = TRUE)
}

# 変数を削除
rm(
  new_packages,
  packages,
  pkg
)
```

Rのパッケージは開発者が随時アップデートしていますが、自動で反映されることはありません。パッケージをアップデートする場合は、次のコードを実行してください。

```{r, eval=FALSE}
# パッケージをすべてアップデート
update.packages()

# アップデートの対象になる古いバージョンのパッケージ一覧を出力
old.packages()

# パッケージを指定してアップデート
install.packages("tidyverse")
```

## グラフの設定

レポートやスライドに掲載するためのグラフは、主にRのggplot2パッケージで作成します。

### グラフのテーマ設定 {.unnumbered}

実務上、Excelと併用することを想定しているため、Excelで出力されるグラフに似たテーマを設定します。ggplot2にデフォルトで用意されている様々なテーマについては、[公式ウェブサイト](https://ggplot2.tidyverse.org/reference/ggtheme.html)を参照してください。

```{r}
theme_set(theme_light())
```

### グラフのフォント設定 {.unnumbered}

Windows上でRを使用する場合は、日本語フォントをグラフ上で表示するために以下の設定が必要です。ここでは代表的なフォントとしてMeiryo UIとYu Gothic UIを設定します。それぞれのフォントに`MEIRYO`、`YUGO`というキーを割り当て、ggplot2でグラフを作成する際にキーを指定します。

```{r}
windowsFonts("MEIRYO" = windowsFont("Meiryo UI"))
windowsFonts("YUGO" = windowsFont("Yu Gothic UI"))
```
